{"url":"https://api.github.com/repos/electron/electron/issues/10470","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/10470/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/10470/comments","events_url":"https://api.github.com/repos/electron/electron/issues/10470/events","html_url":"https://github.com/electron/electron/issues/10470","id":256167417,"node_id":"MDU6SXNzdWUyNTYxNjc0MTc=","number":10470,"title":"Inconsistent behaviors in sandbox mode with iframe","user":{"login":"emmkimme","id":14014607,"node_id":"MDQ6VXNlcjE0MDE0NjA3","avatar_url":"https://avatars.githubusercontent.com/u/14014607?v=4","gravatar_id":"","url":"https://api.github.com/users/emmkimme","html_url":"https://github.com/emmkimme","followers_url":"https://api.github.com/users/emmkimme/followers","following_url":"https://api.github.com/users/emmkimme/following{/other_user}","gists_url":"https://api.github.com/users/emmkimme/gists{/gist_id}","starred_url":"https://api.github.com/users/emmkimme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/emmkimme/subscriptions","organizations_url":"https://api.github.com/users/emmkimme/orgs","repos_url":"https://api.github.com/users/emmkimme/repos","events_url":"https://api.github.com/users/emmkimme/events{/privacy}","received_events_url":"https://api.github.com/users/emmkimme/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":97403549,"node_id":"MDU6TGFiZWw5NzQwMzU0OQ==","url":"https://api.github.com/repos/electron/electron/labels/platform/windows","name":"platform/windows","color":"c7def8","default":false,"description":null},{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":3,"created_at":"2017-09-08T07:41:45Z","updated_at":"2017-11-28T06:25:48Z","closed_at":"2017-11-28T06:25:48Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"* Electron version: 1.6.7\r\n* Operating system: Windows 10\r\n\r\nAccording to the activation of the sandbox, I’m facing inconsistent behaviors with a window containing iframes.\r\n\r\n# 1st. issue\r\n### How to reproduce\r\nHave a preload.js (pretty basic)\r\n```\r\nconst _ipcRenderer = require('electron').ipcRenderer;\r\nwindowLocal.ipcRenderer = _ipcRenderer;\r\nconsole.log(‘preload file loaded’);\r\n```\r\nA html page with at least one iframe\r\n\r\n### Actual behavior\r\nWhen loading such page, we have the preload file loaded several times :\r\n-\tone for the top window\r\n-\tone for each iframe\r\nWithout the sandbox the preload file is loaded only once whatever the number of iframes.\r\n\r\n### Expected behavior\r\nIt could make sense to load preload file for each iFrame whatever the mode. We are in position to test in the preload if we are in a iframe (window.frameset) and then adapt our code.\r\n\r\n# 2nd issue \r\n### How to reproduce\r\nIn sandbox mode, from the top window and from each iframe I send a specific message to the master using the ipcRenderer.\r\n\r\nI build a response channel and the message from the window id and frame id\r\n```\r\n    let message = `I'm here from Window '${windowId}'`;\r\n    let responseChannel = `child-response-${windowId}`;\r\n    if (window.frameElement) {\r\n        message += ` Frame '${window.frameElement.id}'`;\r\n        responseChannel += `-${window.frameElement.id}`;\r\n    }\r\n```\r\n\r\nI listen the response on this specific response channel\r\n```\r\n    ipcRenderer.on(responseChannel, (...args) => {\r\n        console.log(…args);\r\n    });\r\n```\r\nI send this specific message to master\r\n`    ipcRenderer.send('child-message', responseChannel, message);\r\n`\r\nThe master looks like\r\n```\r\n        ipcMain.on('child-message', (event: Electron.IpcMainEvent, ...args: any[]) => {\r\n            console.log(...args);\r\n            event.sender.send(args[0], 'I got your message !');\r\n        });\r\n```\r\n\r\n### Actual behavior\r\nMaster receives the expected messages\r\n-\tchild-response-xxx, I'm here from Window 'xxx’\r\n-\tchild-response-xxx –yyy, I'm here from Window 'xxx’ Frame ‘yyy’\r\n\r\ntop window receives the response but Iframes never receive their own responses.\r\n\r\nIf I listen from the topWindow the response channel of the iframe/s, I receive in the topwindow the message supposed to be sent to the iframe.\r\n\r\n### Expected behavior\r\nIf we can send ipc message from an iframe we should be able to listen ipc as well.\r\n\r\nUnfortunately, my sample is deeply linked to my environment, If needed I can build an independent one.\r\n\r\nRegards\r\n","closed_by":{"login":"zcbenz","id":639601,"node_id":"MDQ6VXNlcjYzOTYwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/639601?v=4","gravatar_id":"","url":"https://api.github.com/users/zcbenz","html_url":"https://github.com/zcbenz","followers_url":"https://api.github.com/users/zcbenz/followers","following_url":"https://api.github.com/users/zcbenz/following{/other_user}","gists_url":"https://api.github.com/users/zcbenz/gists{/gist_id}","starred_url":"https://api.github.com/users/zcbenz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcbenz/subscriptions","organizations_url":"https://api.github.com/users/zcbenz/orgs","repos_url":"https://api.github.com/users/zcbenz/repos","events_url":"https://api.github.com/users/zcbenz/events{/privacy}","received_events_url":"https://api.github.com/users/zcbenz/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/10470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/10470/timeline","performed_via_github_app":null,"state_reason":"completed"}