{"url":"https://api.github.com/repos/electron/electron/issues/8911","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/8911/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/8911/comments","events_url":"https://api.github.com/repos/electron/electron/issues/8911/events","html_url":"https://github.com/electron/electron/issues/8911","id":213716290,"node_id":"MDU6SXNzdWUyMTM3MTYyOTA=","number":8911,"title":"beforeunload event not called on subsequent reloads","user":{"login":"inukshuk","id":325102,"node_id":"MDQ6VXNlcjMyNTEwMg==","avatar_url":"https://avatars.githubusercontent.com/u/325102?v=4","gravatar_id":"","url":"https://api.github.com/users/inukshuk","html_url":"https://github.com/inukshuk","followers_url":"https://api.github.com/users/inukshuk/followers","following_url":"https://api.github.com/users/inukshuk/following{/other_user}","gists_url":"https://api.github.com/users/inukshuk/gists{/gist_id}","starred_url":"https://api.github.com/users/inukshuk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/inukshuk/subscriptions","organizations_url":"https://api.github.com/users/inukshuk/orgs","repos_url":"https://api.github.com/users/inukshuk/repos","events_url":"https://api.github.com/users/inukshuk/events{/privacy}","received_events_url":"https://api.github.com/users/inukshuk/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":538879644,"node_id":"MDU6TGFiZWw1Mzg4Nzk2NDQ=","url":"https://api.github.com/repos/electron/electron/labels/bug/regression%20:leftwards_arrow_with_hook:","name":"bug/regression :leftwards_arrow_with_hook:","color":"fbca04","default":false,"description":"A new version of Electron broke something"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2017-03-13T09:45:03Z","updated_at":"2017-05-09T16:06:27Z","closed_at":"2017-05-09T16:06:27Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"* Electron version: 1.6.3\r\n* Operating system: Linux\r\n\r\n### Expected behavior\r\n\r\nWhen registering a `beforeunload` handler which cancels unloading, I would expect the handler to be called for every `BrowserWindow.reload()`.\r\n\r\n### Actual behavior\r\n\r\nOn 1.6.3, the `beforeunload` handler is called for the first `reload` but not on subsequent calls. Even after removing the event handler, `reload` will not reload the window anymore.\r\n\r\n### How to reproduce\r\n\r\n```javascript\r\nconst cancelUnload = e => {\r\n   console.log('cancelUnload called')\r\n   e.returnValue = false\r\n}\r\n\r\nwindow.addEventListener('beforeunload', cancelUnload)\r\n\r\nremote.getCurrentWindow().reload()  // [1] -> cancelUnload called\r\nremote.getCurrentWindow().reload()  // [2] -> cancelUnload called\r\n\r\nremote.getCurrentWindow().close()   // [3] -> cancelUnload called\r\nremote.getCurrentWindow().close()   // [4] -> cancelUnload called\r\n\r\nwindow.removeEventListener('beforeunload', cancelUnload)\r\n\r\nremote.getCurrentWindow().reload()  // [5] -> reloads window\r\n\r\nremote.getCurrentWindow().close()   // [6] -> closes window\r\n```\r\nI would expect `cancelUnload` to be printed to the console four times and the step at `[5]` to actually reload the window. This is works up to Electron 1.6.2.\r\n\r\nOn Electron 1.6.3 `cancelUnload` is not printed at step `[2]` (nor on any subsequent calls to reload). What's more, event after removing the `beforeunload` handler, `reload` does not work anymore: at step `[5]` the window does not reload (but closing the window at `[6]` works).","closed_by":{"login":"kevinsawicki","id":671378,"node_id":"MDQ6VXNlcjY3MTM3OA==","avatar_url":"https://avatars.githubusercontent.com/u/671378?v=4","gravatar_id":"","url":"https://api.github.com/users/kevinsawicki","html_url":"https://github.com/kevinsawicki","followers_url":"https://api.github.com/users/kevinsawicki/followers","following_url":"https://api.github.com/users/kevinsawicki/following{/other_user}","gists_url":"https://api.github.com/users/kevinsawicki/gists{/gist_id}","starred_url":"https://api.github.com/users/kevinsawicki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevinsawicki/subscriptions","organizations_url":"https://api.github.com/users/kevinsawicki/orgs","repos_url":"https://api.github.com/users/kevinsawicki/repos","events_url":"https://api.github.com/users/kevinsawicki/events{/privacy}","received_events_url":"https://api.github.com/users/kevinsawicki/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/8911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/8911/timeline","performed_via_github_app":null,"state_reason":"completed"}