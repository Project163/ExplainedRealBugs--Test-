{"url":"https://api.github.com/repos/electron/electron/issues/12506","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/12506/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/12506/comments","events_url":"https://api.github.com/repos/electron/electron/issues/12506/events","html_url":"https://github.com/electron/electron/issues/12506","id":310549371,"node_id":"MDU6SXNzdWUzMTA1NDkzNzE=","number":12506,"title":"contentTracing categoryFilter regression on 2.0.0-beta.6","user":{"login":"kwonoj","id":1210596,"node_id":"MDQ6VXNlcjEyMTA1OTY=","avatar_url":"https://avatars.githubusercontent.com/u/1210596?v=4","gravatar_id":"","url":"https://api.github.com/users/kwonoj","html_url":"https://github.com/kwonoj","followers_url":"https://api.github.com/users/kwonoj/followers","following_url":"https://api.github.com/users/kwonoj/following{/other_user}","gists_url":"https://api.github.com/users/kwonoj/gists{/gist_id}","starred_url":"https://api.github.com/users/kwonoj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kwonoj/subscriptions","organizations_url":"https://api.github.com/users/kwonoj/orgs","repos_url":"https://api.github.com/users/kwonoj/repos","events_url":"https://api.github.com/users/kwonoj/events{/privacy}","received_events_url":"https://api.github.com/users/kwonoj/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""},{"id":538879644,"node_id":"MDU6TGFiZWw1Mzg4Nzk2NDQ=","url":"https://api.github.com/repos/electron/electron/labels/bug/regression%20:leftwards_arrow_with_hook:","name":"bug/regression :leftwards_arrow_with_hook:","color":"fbca04","default":false,"description":"A new version of Electron broke something"},{"id":657195638,"node_id":"MDU6TGFiZWw2NTcxOTU2Mzg=","url":"https://api.github.com/repos/electron/electron/labels/status/reviewed","name":"status/reviewed","color":"c2e0c6","default":false,"description":"A maintainer made an initial review but not reproduced the issue"},{"id":759869934,"node_id":"MDU6TGFiZWw3NTk4Njk5MzQ=","url":"https://api.github.com/repos/electron/electron/labels/platform/all","name":"platform/all","color":"c5def5","default":false,"description":null},{"id":839475038,"node_id":"MDU6TGFiZWw4Mzk0NzUwMzg=","url":"https://api.github.com/repos/electron/electron/labels/2-0-x","name":"2-0-x","color":"ededed","default":false,"description":""},{"id":992069387,"node_id":"MDU6TGFiZWw5OTIwNjkzODc=","url":"https://api.github.com/repos/electron/electron/labels/app-feedback-program","name":"app-feedback-program","color":"0052cc","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":4,"created_at":"2018-04-02T17:33:20Z","updated_at":"2018-12-20T12:11:18Z","closed_at":"2018-12-20T12:11:18Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--\r\nThanks for opening an issue! A few things to keep in mind:\r\n\r\n- The issue tracker is only for bugs and feature requests.\r\n- Before reporting a bug, please try reproducing your issue against\r\n  the latest version of Electron.\r\n- If you need general advice, join our Slack: http://atom-slack.herokuapp.com\r\n-->\r\n\r\n* Electron version: 2.0.0-beta.6\r\n* Operating system: confirmed on macOS locally, assume same on other OS\r\n\r\n### Expected behavior\r\n`disabled-by-default-memory-infra` should be collected.\r\n\r\n<!-- What do you think should happen? -->\r\n\r\n### Actual behavior\r\nIt is not. \r\n\r\n**It does seem some of other categories are also not working correctly, but hard to verify what's working vs. what's not working**\r\n\r\n<!-- What actually happens? -->\r\n\r\n### How to reproduce\r\n\r\nBelow's minimal code to automatically trigger content tracing, with single category filter `disabled-by-default-memory-infra` specified:\r\n\r\nindex.js\r\n```\r\nconst { app, BrowserView, BrowserWindow, contentTracing } = require('electron')\r\nconst path = require('path')\r\nconst url = require('url')\r\n\r\nlet win\r\nfunction createWindow() {\r\n  win = new BrowserWindow({ width: 800, height: 600 })\r\n\r\n  win.loadURL(url.format({\r\n    pathname: path.join(`${__dirname}/src`, 'index.html'),\r\n    protocol: 'file:',\r\n    slashes: true\r\n  }));\r\n\r\n  //setup browserview to create dummy `load` to capture memory change\r\n  let view = new BrowserView({\r\n    webPreferences: {\r\n      nodeIntegration: false\r\n    }\r\n  })\r\n\r\n  win.setBrowserView(view)\r\n  view.setBounds({ x: 0, y: 0, width: 300, height: 300 })\r\n  view.webContents.loadURL('https://web.basemark.com/')\r\n\r\n  win.on('closed', () => {\r\n    win = null\r\n  })\r\n\r\n  const options = {\r\n    traceOptions: 'record-until-full',\r\n    categoryFilter: '-*,disabled-by-default-memory-infra' //exclude all category, set memory-infra only\r\n  }\r\n\r\n  contentTracing.startRecording(options, () => {\r\n    console.log('Tracing started')\r\n\r\n    setTimeout(() => {\r\n      contentTracing.stopRecording('./a.trace', (path) => {\r\n        console.log('Tracing data recorded to ' + path)\r\n      })\r\n    }, 10000)\r\n  })\r\n}\r\n\r\napp.on('ready', createWindow)\r\n\r\napp.on('window-all-closed', () => {\r\n  if (process.platform !== 'darwin') {\r\n    app.quit()\r\n  }\r\n})\r\n\r\napp.on('activate', () => {\r\n  if (win === null) {\r\n    createWindow()\r\n  }\r\n})\r\n```\r\n\r\nindex.html\r\n```\r\n<!DOCTYPE html>\r\n  <html>\r\n    <head>\r\n      <meta charset=\"UTF-8\">\r\n      <title>Hello World!</title>\r\n    </head>\r\n    <body>\r\n      <h1>Hello World!</h1>\r\n      We are using node <script>document.write(process.versions.node)</script>,\r\n      Chrome <script>document.write(process.versions.chrome)</script>,\r\n      and Electron <script>document.write(process.versions.electron)</script>.\r\n    </body>\r\n  </html>\r\n```\r\n\r\nOn 1.8.4, it collects memory infra stats correctly: \r\n![image](https://user-images.githubusercontent.com/1210596/38206798-a21bf7c4-3660-11e8-8d5a-1bfa086a1ff9.png)\r\n\r\nOn 2.0.0, the collected trace is simply empty: \r\n![image](https://user-images.githubusercontent.com/1210596/38206925-0db5c348-3661-11e8-8b9e-1d710f3bf33f.png)\r\n\r\nthis is full trace metadata on 2.0.0. As you could see below, it doesn't contain any actual trace but only initial metadata when trace kicked off \r\n```\r\n{\"traceEvents\":[{\"pid\":93553,\"tid\":0,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"num_cpus\",\"args\":{\"number\":8}},\r\n{\"pid\":93553,\"tid\":13827,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_sort_index\",\"args\":{\"sort_index\":-1}},\r\n{\"pid\":93553,\"tid\":13827,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_name\",\"args\":{\"name\":\"GPU Process\"}},\r\n{\"pid\":93553,\"tid\":13827,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_uptime_seconds\",\"args\":{\"uptime\":10}},{\"pid\":93565,\"tid\":0,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"num_cpus\",\"args\":{\"number\":8}},\r\n{\"pid\":93565,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_sort_index\",\"args\":{\"sort_index\":-5}},\r\n{\"pid\":93565,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_name\",\"args\":{\"name\":\"Renderer\"}},\r\n{\"pid\":93565,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_uptime_seconds\",\"args\":{\"uptime\":0}},\r\n{\"pid\":93565,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_labels\",\"args\":{\"labels\":\"Basemark Web 3.0 | Main page\"}},\r\n{\"pid\":93565,\"tid\":775,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"thread_sort_index\",\"args\":{\"sort_index\":-1}},{\"pid\":93556,\"tid\":0,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"num_cpus\",\"args\":{\"number\":8}},\r\n{\"pid\":93556,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_sort_index\",\"args\":{\"sort_index\":-5}},\r\n{\"pid\":93556,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_name\",\"args\":{\"name\":\"Renderer\"}},\r\n{\"pid\":93556,\"tid\":21511,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_uptime_seconds\",\"args\":{\"uptime\":10}},\r\n{\"pid\":93556,\"tid\":775,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"thread_sort_index\",\"args\":{\"sort_index\":-1}},{\"pid\":93554,\"tid\":0,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"num_cpus\",\"args\":{\"number\":8}},\r\n{\"pid\":93554,\"tid\":8455,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_sort_index\",\"args\":{\"sort_index\":-5}},\r\n{\"pid\":93554,\"tid\":8455,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_name\",\"args\":{\"name\":\"Renderer\"}},\r\n{\"pid\":93554,\"tid\":8455,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_uptime_seconds\",\"args\":{\"uptime\":10}},\r\n{\"pid\":93554,\"tid\":8455,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_labels\",\"args\":{\"labels\":\"Hello World!\"}},\r\n{\"pid\":93554,\"tid\":775,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"thread_sort_index\",\"args\":{\"sort_index\":-1}},{\"pid\":93551,\"tid\":775,\"ts\":473973638595,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"IsTimeTicksHighResolution\",\"args\":{\"value\":true},\"tts\":311029},\r\n{\"pid\":93551,\"tid\":0,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"num_cpus\",\"args\":{\"number\":8}},\r\n{\"pid\":93551,\"tid\":26883,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_sort_index\",\"args\":{\"sort_index\":-6}},\r\n{\"pid\":93551,\"tid\":26883,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_name\",\"args\":{\"name\":\"Browser\"}},\r\n{\"pid\":93551,\"tid\":26883,\"ts\":0,\"ph\":\"M\",\"cat\":\"__metadata\",\"name\":\"process_uptime_seconds\",\"args\":{\"uptime\":10}}],\"metadata\": {\"clock-domain\":\"MAC_MACH_ABSOLUTE_TIME\",\"command_line\":\"/Users/ojkwon/github/dummy-electron/node_modules/electron/dist/Electron.app/Contents/MacOS/Electron --no-sandbox --allow-file-access-from-files --enable-avfoundation ./src/index.js\",\"cpu-brand\":\"Intel(R) Core(TM) i7-4980HQ CPU @ 2.80GHz\",\"cpu-family\":6,\"cpu-model\":70,\"cpu-stepping\":1,\"gpu-devid\":26657,\"gpu-driver\":\"\",\"gpu-glver\":\"\",\"gpu-psver\":\"\",\"gpu-venid\":4098,\"gpu-vsver\":\"\",\"highres-ticks\":true,\"network-type\":\"WiFi\",\"num-cpus\":8,\"os-arch\":\"x86_64\",\"os-name\":\"Mac OS X\",\"os-version\":\"10.13.3\",\"physical-memory\":16384,\"product-version\":\"Chrome/61.0.3163.100\",\"trace-capture-datetime\":\"2018-4-2 17:23:53\",\"trace-config\":\"{\\\"enable_argument_filter\\\":false,\\\"enable_systrace\\\":false,\\\"excluded_categories\\\":[\\\"*\\\"],\\\"included_categories\\\":[\\\"disabled-by-default-memory-infra\\\"],\\\"memory_dump_config\\\":{\\\"allowed_dump_modes\\\":[\\\"background\\\",\\\"light\\\",\\\"detailed\\\"],\\\"triggers\\\":[]},\\\"record_mode\\\":\\\"record-until-full\\\"}\",\"user-agent\":\"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/61.0.3163.100 Electron/2.0.0-beta.6 Safari/537.36\",\"v8-version\":\"6.1.534.41\"}}\r\n```\r\n\r\n**Both (1.8.4/2.0.0) getCategories reports given trace category is supported one**\r\n\r\nI couldn't verify each category, but it does seem few other categories are not working as well (mostly around `net-*` related, but based on limited testing)\r\n\r\n<!-- \r\n\r\nYour best chance of getting this bug looked at quickly is to provide a REPOSITORY that can be cloned and run.\r\n\r\nYou can fork https://github.com/electron/electron-quick-start and include a link to the branch with your changes.\r\n\r\nIf you provide a URL, please list the commands required to clone/setup/run your repo e.g.\r\n\r\n  $ git clone $YOUR_URL -b $BRANCH\r\n  $ npm install\r\n  $ npm start || electron .\r\n\r\n-->\r\n","closed_by":{"login":"alexeykuzmin","id":607250,"node_id":"MDQ6VXNlcjYwNzI1MA==","avatar_url":"https://avatars.githubusercontent.com/u/607250?v=4","gravatar_id":"","url":"https://api.github.com/users/alexeykuzmin","html_url":"https://github.com/alexeykuzmin","followers_url":"https://api.github.com/users/alexeykuzmin/followers","following_url":"https://api.github.com/users/alexeykuzmin/following{/other_user}","gists_url":"https://api.github.com/users/alexeykuzmin/gists{/gist_id}","starred_url":"https://api.github.com/users/alexeykuzmin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alexeykuzmin/subscriptions","organizations_url":"https://api.github.com/users/alexeykuzmin/orgs","repos_url":"https://api.github.com/users/alexeykuzmin/repos","events_url":"https://api.github.com/users/alexeykuzmin/events{/privacy}","received_events_url":"https://api.github.com/users/alexeykuzmin/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/12506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/12506/timeline","performed_via_github_app":null,"state_reason":"completed"}