{"url":"https://api.github.com/repos/electron/electron/issues/21716","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/21716/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/21716/comments","events_url":"https://api.github.com/repos/electron/electron/issues/21716/events","html_url":"https://github.com/electron/electron/issues/21716","id":547550175,"node_id":"MDU6SXNzdWU1NDc1NTAxNzU=","number":21716,"title":"importing powerMonitor from electron before 'ready' event causes crash","user":{"login":"mtgto","id":1213991,"node_id":"MDQ6VXNlcjEyMTM5OTE=","avatar_url":"https://avatars.githubusercontent.com/u/1213991?v=4","gravatar_id":"","url":"https://api.github.com/users/mtgto","html_url":"https://github.com/mtgto","followers_url":"https://api.github.com/users/mtgto/followers","following_url":"https://api.github.com/users/mtgto/following{/other_user}","gists_url":"https://api.github.com/users/mtgto/gists{/gist_id}","starred_url":"https://api.github.com/users/mtgto/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtgto/subscriptions","organizations_url":"https://api.github.com/users/mtgto/orgs","repos_url":"https://api.github.com/users/mtgto/repos","events_url":"https://api.github.com/users/mtgto/events{/privacy}","received_events_url":"https://api.github.com/users/mtgto/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":97403642,"node_id":"MDU6TGFiZWw5NzQwMzY0Mg==","url":"https://api.github.com/repos/electron/electron/labels/platform/linux","name":"platform/linux","color":"c7def8","default":false,"description":null},{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""},{"id":1482096496,"node_id":"MDU6TGFiZWwxNDgyMDk2NDk2","url":"https://api.github.com/repos/electron/electron/labels/8-x-y","name":"8-x-y","color":"ededed","default":false,"description":""},{"id":1657611958,"node_id":"MDU6TGFiZWwxNjU3NjExOTU4","url":"https://api.github.com/repos/electron/electron/labels/7-1-x","name":"7-1-x","color":"ededed","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2020-01-09T15:30:09Z","updated_at":"2020-01-28T18:19:45Z","closed_at":"2020-01-28T18:19:45Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--  As an open source project with a dedicated but small maintainer team, it can sometimes take a long time for issues to be addressed so please be patient and we will get back to you as soon as we can.\r\n-->\r\n\r\n### Preflight Checklist\r\n<!-- Please ensure you've completed the following steps by replacing [ ] with [x]-->\r\n\r\n* [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/master/CONTRIBUTING.md) for this project.\r\n* [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/master/CODE_OF_CONDUCT.md) that this project adheres to.\r\n* [x] I have searched the issue tracker for an issue that matches the one I want to file, without success.\r\n\r\n### Issue Details\r\n\r\nSame as #18966, app crashed when launched.\r\n\r\n```typescript\r\nimport electron, { app } from \"electron\";\r\n\r\nlet mainWindow: electron.BrowserWindow;\r\n\r\napp.on(\"ready\", () => {\r\n  mainWindow = new electron.BrowserWindow({\r\n    width: 800,\r\n    height: 600,\r\n  });\r\n});\r\n```\r\n\r\nHere is my repro sample.\r\nhttps://github.com/mtgto/sample-electron-crash\r\n\r\nHere is compiled index.ts\r\nhttps://gist.github.com/mtgto/2a60ed4ce2e280c7577412884cde166e\r\n\r\n* **Electron Version:**\r\n  * v7.1.8\r\n* **Operating System:**\r\n  * Ubuntu 18.04.3\r\n* **Last Known Working Electron version:**\r\n  * Don't know\r\n\r\n### Expected Behavior\r\n<!-- A clear and concise description of what you expected to happen. -->\r\n\r\nOpen an empty window.\r\n\r\n### Actual Behavior\r\n\r\n```console\r\n$ yarn start\r\nyarn run v1.21.1\r\n$ electron index.js\r\nApp threw an error during load\r\nError: The 'powerMonitor' module can't be used before the app 'ready' event\r\n    at Object.module.<computed> [as on] (electron/js2c/browser_init.js:6800:30)\r\n    at Object../lib/browser/api/power-monitor.ts (electron/js2c/browser_init.js:2671:18)\r\n    at __webpack_require__ (electron/js2c/browser_init.js:20:30)\r\n    at loader (electron/js2c/browser_init.js:2060:41)\r\n    at Object.powerMonitor (electron/js2c/browser_init.js:7079:17)\r\n    at __importStar (/home/user/sample-electron-crash/index.js:5:96)\r\n    at Object.<anonymous> (/home/user/sample-electron-crash/index.js:10:18)\r\n    at Module._compile (internal/modules/cjs/loader.js:880:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:892:10)\r\n    at Module.load (internal/modules/cjs/loader.js:735:32)\r\nA JavaScript error occurred in the main process\r\nUncaught Exception:\r\nError: The 'powerMonitor' module can't be used before the app 'ready' event\r\n    at Object.module.<computed> [as on] (electron/js2c/browser_init.js:6800:30)\r\n    at Object../lib/browser/api/power-monitor.ts (electron/js2c/browser_init.js:2671:18)\r\n    at __webpack_require__ (electron/js2c/browser_init.js:20:30)\r\n    at loader (electron/js2c/browser_init.js:2060:41)\r\n    at Object.powerMonitor (electron/js2c/browser_init.js:7079:17)\r\n    at __importStar (/home/user/sample-electron-crash/index.js:5:96)\r\n    at Object.<anonymous> (/home/user/sample-electron-crash/index.js:10:18)\r\n    at Module._compile (internal/modules/cjs/loader.js:880:30)\r\n    at Object.Module._extensions..js (internal/modules/cjs/loader.js:892:10)\r\n    at Module.load (internal/modules/cjs/loader.js:735:32)\r\n```\r\n\r\n### To Reproduce\r\n<!--\r\nYour best chance of getting this bug looked at quickly is to provide an example.\r\n-->\r\n\r\n```console\r\n$ git clone https://github.com/mtgto/sample-electron-crash.git\r\n$ cd sample-electron-crash\r\n$ yarn install\r\n$ yarn build\r\n$ yarn start\r\n```\r\n\r\n<!--\r\nFor bugs that can be encapsulated in a small experiment, you can use Electron Fiddle (https://github.com/electron/fiddle) to publish your example to a GitHub Gist and link it your bug report.\r\n-->\r\n\r\n<!--\r\nIf Fiddle is insufficient to produce an example, please provide an example REPOSITORY that can be cloned and run. You can fork electron-quick-start (https://github.com/electron/electron-quick-start) and include a link to the branch with your changes.\r\n-->\r\n\r\n<!--\r\nIf you provide a URL, please list the commands required to clone/setup/run your repo e.g.\r\n```sh\r\n$ git clone $YOUR_URL -b $BRANCH\r\n$ npm install\r\n$ npm start || electron .\r\n```\r\n-->\r\n\r\n### Screenshots\r\n<!-- If applicable, add screenshots to help explain your problem. -->\r\nN/A\r\n\r\n### Additional Information\r\nStacktrace says `__importStar` calls powerMonitor. It happens when tsconfig uses `esModuleInterop: true` (default is true)\r\nIn macOS, app doesn't crash.\r\n","closed_by":{"login":"ckerr","id":70381,"node_id":"MDQ6VXNlcjcwMzgx","avatar_url":"https://avatars.githubusercontent.com/u/70381?v=4","gravatar_id":"","url":"https://api.github.com/users/ckerr","html_url":"https://github.com/ckerr","followers_url":"https://api.github.com/users/ckerr/followers","following_url":"https://api.github.com/users/ckerr/following{/other_user}","gists_url":"https://api.github.com/users/ckerr/gists{/gist_id}","starred_url":"https://api.github.com/users/ckerr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ckerr/subscriptions","organizations_url":"https://api.github.com/users/ckerr/orgs","repos_url":"https://api.github.com/users/ckerr/repos","events_url":"https://api.github.com/users/ckerr/events{/privacy}","received_events_url":"https://api.github.com/users/ckerr/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/21716/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/21716/timeline","performed_via_github_app":null,"state_reason":"completed"}