{"url":"https://api.github.com/repos/electron/electron/issues/19908","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/19908/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/19908/comments","events_url":"https://api.github.com/repos/electron/electron/issues/19908/events","html_url":"https://github.com/electron/electron/issues/19908","id":484465468,"node_id":"MDU6SXNzdWU0ODQ0NjU0Njg=","number":19908,"title":"desktopCapturer.getSources memory leaks","user":{"login":"osan15","id":10058753,"node_id":"MDQ6VXNlcjEwMDU4NzUz","avatar_url":"https://avatars.githubusercontent.com/u/10058753?v=4","gravatar_id":"","url":"https://api.github.com/users/osan15","html_url":"https://github.com/osan15","followers_url":"https://api.github.com/users/osan15/followers","following_url":"https://api.github.com/users/osan15/following{/other_user}","gists_url":"https://api.github.com/users/osan15/gists{/gist_id}","starred_url":"https://api.github.com/users/osan15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/osan15/subscriptions","organizations_url":"https://api.github.com/users/osan15/orgs","repos_url":"https://api.github.com/users/osan15/repos","events_url":"https://api.github.com/users/osan15/events{/privacy}","received_events_url":"https://api.github.com/users/osan15/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":97403642,"node_id":"MDU6TGFiZWw5NzQwMzY0Mg==","url":"https://api.github.com/repos/electron/electron/labels/platform/linux","name":"platform/linux","color":"c7def8","default":false,"description":null},{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""},{"id":1054948123,"node_id":"MDU6TGFiZWwxMDU0OTQ4MTIz","url":"https://api.github.com/repos/electron/electron/labels/4-2-x","name":"4-2-x","color":"ededed","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2019-08-23T10:49:49Z","updated_at":"2019-10-27T22:22:56Z","closed_at":"2019-10-27T22:20:44Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"### Issue Details\r\n\r\n* **Electron Version:**\r\n  * v4.0.0\r\n* **Operating System:**\r\n  * Ubuntu 18.04.3 LTS \r\n* **Last Known Working Electron version:**\r\n  * Unknown\r\n\r\n### Expected Behavior\r\nThe Resident set size of the Main process when using desktopCapturer.getSources not growing.\r\n\r\n\r\n### Actual Behavior\r\nMemory leak in the Main process (rss memory growing) when using the desktopCapturer.getSources method in the Rendering process.\r\n\r\n### To Reproduce\r\n\r\n> main.js\r\n```javascript\r\nconst {\r\n    app,\r\n    BrowserWindow\r\n} = require('electron');\r\nconst url = require('url');\r\nconst path = require('path');\r\n\r\nlet win;\r\n\r\nconst logBytes = x => `${x[0]}=${x[1] / (1000.0 * 1000)}MB`;\r\n\r\nconst logMemory = () => {\r\n    console.log(\r\n        Object.entries(process.memoryUsage())\r\n        .map(logBytes)\r\n        .join(', ')\r\n    );\r\n};\r\n\r\nconst createWindow = () => {\r\n    win = new BrowserWindow();\r\n    win.loadURL(url.format({\r\n        pathname: path.join(__dirname, 'index.html'),\r\n        protocol: 'file:',\r\n        slashes: true\r\n    }));\r\n};\r\n\r\ntry {\r\n    app.on('ready', createWindow);\r\n} catch (e) {\r\n    console.err(e);\r\n}\r\n\r\nlogMemory();\r\nsetInterval(logMemory, 10000);\r\n\r\n```\r\n\r\n> index.html \r\n```html\r\n<!DOCTYPE html>\r\n<html>\r\n  <head>\r\n    <meta charset=\"UTF-8\">\r\n    <title>Hello World!</title>\r\n  </head>\r\n  <body>\r\n    <h1>Hello World!</h1>\r\n    We are using Node.js <span id=\"node-version\"></span>,\r\n    Chromium <span id=\"chrome-version\"></span>,\r\n    and Electron <span id=\"electron-version\"></span>.\r\n\r\n    <!-- You can also require other files to run in this process -->\r\n    <script src=\"./renderer.js\"></script>\r\n  </body>\r\n```\r\n\r\n> renderer.js\r\n```javascript\r\nconst electron = require('electron');\r\nconst desktopCapturer = electron.desktopCapturer;\r\n\r\nconst getSourcesLoop = () => {\r\n    console.log('getSources() call');\r\n    desktopCapturer.getSources({\r\n        types: ['screen', 'window']\r\n    }).then(sources => {\r\n        console.log('getSources() success', sources);\r\n        setTimeout(getSources, 5000);\r\n    });\r\n};\r\ngetSourcesLoop();\r\n```\r\n\r\n\r\n### Screenshots\r\n<!-- If applicable, add screenshots to help explain your problem. -->\r\n![image](https://user-images.githubusercontent.com/10058753/63587467-64534d00-c5a4-11e9-9622-630e62cebbdf.png)\r\n\r\n\r\n\r\n","closed_by":{"login":"miniak","id":1281234,"node_id":"MDQ6VXNlcjEyODEyMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1281234?v=4","gravatar_id":"","url":"https://api.github.com/users/miniak","html_url":"https://github.com/miniak","followers_url":"https://api.github.com/users/miniak/followers","following_url":"https://api.github.com/users/miniak/following{/other_user}","gists_url":"https://api.github.com/users/miniak/gists{/gist_id}","starred_url":"https://api.github.com/users/miniak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/miniak/subscriptions","organizations_url":"https://api.github.com/users/miniak/orgs","repos_url":"https://api.github.com/users/miniak/repos","events_url":"https://api.github.com/users/miniak/events{/privacy}","received_events_url":"https://api.github.com/users/miniak/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/19908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/19908/timeline","performed_via_github_app":null,"state_reason":"completed"}