{"url":"https://api.github.com/repos/electron/electron/issues/21515","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/21515/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/21515/comments","events_url":"https://api.github.com/repos/electron/electron/issues/21515/events","html_url":"https://github.com/electron/electron/issues/21515","id":537702035,"node_id":"MDU6SXNzdWU1Mzc3MDIwMzU=","number":21515,"title":"await Promise with Timer behavior regress from previous version","user":{"login":"JasonYeMSFT","id":39359541,"node_id":"MDQ6VXNlcjM5MzU5NTQx","avatar_url":"https://avatars.githubusercontent.com/u/39359541?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonYeMSFT","html_url":"https://github.com/JasonYeMSFT","followers_url":"https://api.github.com/users/JasonYeMSFT/followers","following_url":"https://api.github.com/users/JasonYeMSFT/following{/other_user}","gists_url":"https://api.github.com/users/JasonYeMSFT/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonYeMSFT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonYeMSFT/subscriptions","organizations_url":"https://api.github.com/users/JasonYeMSFT/orgs","repos_url":"https://api.github.com/users/JasonYeMSFT/repos","events_url":"https://api.github.com/users/JasonYeMSFT/events{/privacy}","received_events_url":"https://api.github.com/users/JasonYeMSFT/received_events","type":"User","user_view_type":"public","site_admin":true},"labels":[{"id":97403549,"node_id":"MDU6TGFiZWw5NzQwMzU0OQ==","url":"https://api.github.com/repos/electron/electron/labels/platform/windows","name":"platform/windows","color":"c7def8","default":false,"description":null},{"id":97403606,"node_id":"MDU6TGFiZWw5NzQwMzYwNg==","url":"https://api.github.com/repos/electron/electron/labels/platform/macOS","name":"platform/macOS","color":"c7def8","default":false,"description":null},{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""},{"id":1133156478,"node_id":"MDU6TGFiZWwxMTMzMTU2NDc4","url":"https://api.github.com/repos/electron/electron/labels/5-0-x","name":"5-0-x","color":"ededed","default":false,"description":""},{"id":1630185126,"node_id":"MDU6TGFiZWwxNjMwMTg1MTI2","url":"https://api.github.com/repos/electron/electron/labels/6-1-x","name":"6-1-x","color":"ededed","default":false,"description":""},{"id":1657611958,"node_id":"MDU6TGFiZWwxNjU3NjExOTU4","url":"https://api.github.com/repos/electron/electron/labels/7-1-x","name":"7-1-x","color":"ededed","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"ckerr","id":70381,"node_id":"MDQ6VXNlcjcwMzgx","avatar_url":"https://avatars.githubusercontent.com/u/70381?v=4","gravatar_id":"","url":"https://api.github.com/users/ckerr","html_url":"https://github.com/ckerr","followers_url":"https://api.github.com/users/ckerr/followers","following_url":"https://api.github.com/users/ckerr/following{/other_user}","gists_url":"https://api.github.com/users/ckerr/gists{/gist_id}","starred_url":"https://api.github.com/users/ckerr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ckerr/subscriptions","organizations_url":"https://api.github.com/users/ckerr/orgs","repos_url":"https://api.github.com/users/ckerr/repos","events_url":"https://api.github.com/users/ckerr/events{/privacy}","received_events_url":"https://api.github.com/users/ckerr/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"ckerr","id":70381,"node_id":"MDQ6VXNlcjcwMzgx","avatar_url":"https://avatars.githubusercontent.com/u/70381?v=4","gravatar_id":"","url":"https://api.github.com/users/ckerr","html_url":"https://github.com/ckerr","followers_url":"https://api.github.com/users/ckerr/followers","following_url":"https://api.github.com/users/ckerr/following{/other_user}","gists_url":"https://api.github.com/users/ckerr/gists{/gist_id}","starred_url":"https://api.github.com/users/ckerr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ckerr/subscriptions","organizations_url":"https://api.github.com/users/ckerr/orgs","repos_url":"https://api.github.com/users/ckerr/repos","events_url":"https://api.github.com/users/ckerr/events{/privacy}","received_events_url":"https://api.github.com/users/ckerr/received_events","type":"User","user_view_type":"public","site_admin":false},{"login":"codebytere","id":2036040,"node_id":"MDQ6VXNlcjIwMzYwNDA=","avatar_url":"https://avatars.githubusercontent.com/u/2036040?v=4","gravatar_id":"","url":"https://api.github.com/users/codebytere","html_url":"https://github.com/codebytere","followers_url":"https://api.github.com/users/codebytere/followers","following_url":"https://api.github.com/users/codebytere/following{/other_user}","gists_url":"https://api.github.com/users/codebytere/gists{/gist_id}","starred_url":"https://api.github.com/users/codebytere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codebytere/subscriptions","organizations_url":"https://api.github.com/users/codebytere/orgs","repos_url":"https://api.github.com/users/codebytere/repos","events_url":"https://api.github.com/users/codebytere/events{/privacy}","received_events_url":"https://api.github.com/users/codebytere/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":28,"created_at":"2019-12-13T18:28:46Z","updated_at":"2020-04-29T16:21:54Z","closed_at":"2020-04-21T19:18:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"<!--  As an open source project with a dedicated but small maintainer team, it can sometimes take a long time for issues to be addressed so please be patient and we will get back to you as soon as we can.\r\n-->\r\n\r\n### Preflight Checklist\r\n<!-- Please ensure you've completed the following steps by replacing [ ] with [x]-->\r\n\r\n* [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/master/CONTRIBUTING.md) for this project.\r\n* [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/master/CODE_OF_CONDUCT.md) that this project adheres to.\r\n* [x] I have searched the issue tracker for an issue that matches the one I want to file, without success.\r\n\r\n### Issue Details\r\n\r\n* **Electron Version:**\r\n  * 5.0.12 - 7.1.10\r\n* **Operating System:**\r\n  * Windows 10/macOS 10.15\r\n* **Last Known Working Electron version:**\r\n  * 4.2.5\r\n\r\n### Expected Behavior\r\nWe have been using the piece of code to perform asynchronous operations.\r\n```js\r\nawait new Promise((resolve) => { setTimeout(resolve, 1000); }\r\n```\r\nIt would pause the execution of the code path containing it for about 1 second and resume it then. This has been working well for a long time.\r\n\r\n### Actual Behavior\r\nSince we upgrade to Electron 7, in forked node processes, only the first several timer callbacks are called on time, while the rest of them are called extremely late for unknown reason.\r\n\r\nSuppose we call the above piece of code for 10 times in a loop. Only the first two promises are created and resolved correctly. In addition, the process exits for unknown reason. In our production code, since there are other things going on (not computationally intensive) which keeps the process alive, we are seeing the 3rd and the rest of the Timers being created and invoked unreasonably late (around 12s after the 2nd one resolves).\r\n\r\nThe output in the renderer console is\r\n```\r\nSpawned child process <some_pid>\r\nchild process send a message INIT_ACK\r\nchild process send a message INIT_ACK\r\nchild process exits\r\n```\r\n\r\n### To Reproduce\r\nhttps://github.com/JasonYeMSFT/electron-quick-start/tree/bug/await-Promise\r\n\r\nTo run the repro steps\r\n```sh\r\n$ git clone https://github.com/JasonYeMSFT/electron-quick-start -b bug/await-Promise\r\n$ npm install\r\n$ npm start\r\n```\r\n<!--\r\nIf you provide a URL, please list the commands required to clone/setup/run your repo e.g.\r\n```sh\r\n$ git clone $YOUR_URL -b $BRANCH\r\n$ npm install\r\n$ npm start || electron .\r\n```\r\n-->\r\n\r\n### Screenshots\r\n<!-- If applicable, add screenshots to help explain your problem. -->\r\n\r\n### Additional Information\r\nElectron 4.2.5 behaves correctly for exactly the same code in this repo. The behavior doesn't reproduce in renderer process. Also it doesn't seem to be a nodejs problem because I can run the renderer.js directly with node on the same version and it behaves correctly.\r\n\r\nI did some extra experiment and it turns out that `setInterval` is producing much more stable behaviors compared to `setTimeout` (update, I was wrong, `setInterval` also has the weird behavior).","closed_by":{"login":"codebytere","id":2036040,"node_id":"MDQ6VXNlcjIwMzYwNDA=","avatar_url":"https://avatars.githubusercontent.com/u/2036040?v=4","gravatar_id":"","url":"https://api.github.com/users/codebytere","html_url":"https://github.com/codebytere","followers_url":"https://api.github.com/users/codebytere/followers","following_url":"https://api.github.com/users/codebytere/following{/other_user}","gists_url":"https://api.github.com/users/codebytere/gists{/gist_id}","starred_url":"https://api.github.com/users/codebytere/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codebytere/subscriptions","organizations_url":"https://api.github.com/users/codebytere/orgs","repos_url":"https://api.github.com/users/codebytere/repos","events_url":"https://api.github.com/users/codebytere/events{/privacy}","received_events_url":"https://api.github.com/users/codebytere/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/21515/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/21515/timeline","performed_via_github_app":null,"state_reason":"completed"}