{"url":"https://api.github.com/repos/electron/electron/issues/8664","repository_url":"https://api.github.com/repos/electron/electron","labels_url":"https://api.github.com/repos/electron/electron/issues/8664/labels{/name}","comments_url":"https://api.github.com/repos/electron/electron/issues/8664/comments","events_url":"https://api.github.com/repos/electron/electron/issues/8664/events","html_url":"https://github.com/electron/electron/issues/8664","id":207066519,"node_id":"MDU6SXNzdWUyMDcwNjY1MTk=","number":8664,"title":"BrowserWindow `show` and `hide` events are inconsistent between platforms","user":{"login":"poiru","id":1319028,"node_id":"MDQ6VXNlcjEzMTkwMjg=","avatar_url":"https://avatars.githubusercontent.com/u/1319028?v=4","gravatar_id":"","url":"https://api.github.com/users/poiru","html_url":"https://github.com/poiru","followers_url":"https://api.github.com/users/poiru/followers","following_url":"https://api.github.com/users/poiru/following{/other_user}","gists_url":"https://api.github.com/users/poiru/gists{/gist_id}","starred_url":"https://api.github.com/users/poiru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/poiru/subscriptions","organizations_url":"https://api.github.com/users/poiru/orgs","repos_url":"https://api.github.com/users/poiru/repos","events_url":"https://api.github.com/users/poiru/events{/privacy}","received_events_url":"https://api.github.com/users/poiru/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":520323169,"node_id":"MDU6TGFiZWw1MjAzMjMxNjk=","url":"https://api.github.com/repos/electron/electron/labels/bug%20:beetle:","name":"bug :beetle:","color":"fbca04","default":false,"description":""}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":6,"created_at":"2017-02-12T17:57:25Z","updated_at":"2021-03-09T17:41:46Z","closed_at":"2021-03-09T17:41:46Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"For example, with this script:\r\n\r\n```js\r\nconst {app, BrowserWindow} = require('electron')\r\n\r\napp.on('ready', () => {\r\n  const win = new BrowserWindow()\r\n\r\n  win.on('show', () => console.log('show'))\r\n  win.on('hide', () => console.log('hide'))\r\n  win.on('minimize', () => console.log('minimize'))\r\n  win.on('restore', () => console.log('restore'))\r\n\r\n  setTimeout(() => win.hide(), 500)\r\n  setTimeout(() => win.show(), 1000)\r\n  setTimeout(() => win.minimize(), 1500)\r\n  setTimeout(() => win.restore(), 2000)\r\n  setTimeout(() => app.quit(), 2500)\r\n})\r\n```\r\n\r\nOn Linux and Windows, you get:\r\n```\r\nhide\r\nshow\r\nminimize\r\nrestore\r\n```\r\n\r\nOn macOS, you get:\r\n```\r\nshow\r\nhide\r\nshow\r\nminimize\r\nhide\r\nrestore\r\nshow\r\n```\r\n\r\nThis is because we use the window occlusion state to drive `show` and `hide` on macOS, but tie them to `BrowserWindow.show()` and `BrowserWindow.hide()` on other platforms.\r\n\r\nAlso note that `BrowserWindow.isVisible()` does *not* use the occlusion state. So on macOS, this will confusingly print `true` when the window is occluded:\r\n```js\r\nwin.on('hide', () => {\r\n  console.log(win.isVisible())\r\n})\r\n```\r\n\r\nThat is also problematic because we use `isVisible()` to determine `document.hidden` and `document.visibilityState`. In Chrome, they *are* driven by the occlusion state on macOS (see [Chromium issue](https://bugs.chromium.org/p/chromium/issues/detail?id=246844)) so we don't match Chrome behaviour.\r\n\r\nTo address these issues, I think we should:\r\n\r\n* Change `show`/`hide` events on macOS to behave like they do on Windows/Linux. This could be considered a breaking change.\r\n* Implement `occluded`/`unoccluded` events and `isOccluded()` for macOS. These can be left undocumented if we so wish.\r\n* Change `document.hidden` and `document.visibilityState` to be driven by the new occlusion events/method on macOS.\r\n\r\nI'm happy to write the patch, but any thoughts before I submit the PR?\r\n\r\ncc @kevinsawicki @zcbenz","closed_by":{"login":"electron-triage","id":61068198,"node_id":"MDQ6VXNlcjYxMDY4MTk4","avatar_url":"https://avatars.githubusercontent.com/u/61068198?v=4","gravatar_id":"","url":"https://api.github.com/users/electron-triage","html_url":"https://github.com/electron-triage","followers_url":"https://api.github.com/users/electron-triage/followers","following_url":"https://api.github.com/users/electron-triage/following{/other_user}","gists_url":"https://api.github.com/users/electron-triage/gists{/gist_id}","starred_url":"https://api.github.com/users/electron-triage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/electron-triage/subscriptions","organizations_url":"https://api.github.com/users/electron-triage/orgs","repos_url":"https://api.github.com/users/electron-triage/repos","events_url":"https://api.github.com/users/electron-triage/events{/privacy}","received_events_url":"https://api.github.com/users/electron-triage/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/electron/electron/issues/8664/reactions","total_count":7,"+1":7,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/electron/electron/issues/8664/timeline","performed_via_github_app":null,"state_reason":"completed"}