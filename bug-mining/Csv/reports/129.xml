<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:44:17 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-294] CSVFormat does not support explicit &quot; as escape char</title>
                <link>https://issues.apache.org/jira/browse/CSV-294</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;Reading data that contains &quot; does not work if escape character is &lt;b&gt;manually set to &lt;tt&gt;&apos;&quot;&apos;&lt;/tt&gt;&lt;/b&gt; as specified in &lt;a href=&quot;https://datatracker.ietf.org/doc/html/rfc4180&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;RFC 4180&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;&lt;b&gt;It works for other escape characters or if no escape character is explicitly defined in the format.&lt;/b&gt;&lt;/p&gt;

&lt;p&gt;This line in &lt;tt&gt;Lexer.java&lt;/tt&gt; is responsible for the originally quite erroneous ticket:&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;this.escape = mapNullToDisabled(format.getEscapeCharacter());&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;From this line I (wrongly) deduced that an unspecified escape character would actually disable escaping. Because of that I wanted to enable it by setting it to &lt;tt&gt;&apos;&quot;&apos;&lt;/tt&gt; which causes exceptions in the Lexer for perfectly valid input. That in turn convinced my that this is a way bigger issue than it is. Sorry about that.&lt;/p&gt;

&lt;p&gt;I don&apos;t think that the current situation is ideal, though.&lt;/p&gt;

&lt;p&gt;I would not have been this confused if &lt;tt&gt;CSVFormat&lt;/tt&gt; would be more explicit about the escape char that will be used, i.e. if &lt;tt&gt;toString()&lt;/tt&gt; would show the implicitly used quote character or print - in case of &lt;tt&gt;null&lt;/tt&gt; - that this means it&apos;s using the quote character. It is currently omitted from the output if it is not set explicitly.&lt;/p&gt;

&lt;p&gt;There is also no documentation about what &lt;tt&gt;null&lt;/tt&gt; as escape character actually means - it may be documented somewhere but isn&apos;t documented for &lt;tt&gt;CSVFormat.getEscapeCharacter()&lt;/tt&gt; or &lt;tt&gt;CSVFormat.Builder.set/getEscape()&lt;/tt&gt; methods.&lt;/p&gt;

&lt;p&gt;And setting the escape character explicitly to the value specified in the RFC should certainly not fail, even if setting it to that value is superfluous since &lt;tt&gt;null&lt;/tt&gt; behaves exactly the same. &lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;RelevantpartoftheRFC%3A&quot;&gt;&lt;/a&gt;Relevant part of the RFC:&lt;/h4&gt;

&lt;p&gt;7. If double-quotes are used to enclose fields, then a double-quote&lt;br/&gt;
appearing inside a field must be escaped by preceding it with&lt;br/&gt;
another double quote. For example:&lt;/p&gt;

&lt;p&gt;&quot;aaa&quot;,&quot;b&quot;&quot;bb&quot;,&quot;ccc&quot;&lt;/p&gt;

&lt;h4&gt;&lt;a name=&quot;Relatedissue%3A&quot;&gt;&lt;/a&gt;Related issue:&lt;/h4&gt;

&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-150&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CSV-150&lt;/a&gt;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13417489">CSV-294</key>
            <summary>CSVFormat does not support explicit &quot; as escape char</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="huxi">Joern Huxhorn</reporter>
                        <labels>
                    </labels>
                <created>Tue, 14 Dec 2021 16:17:14 +0000</created>
                <updated>Sat, 14 Sep 2024 14:35:53 +0000</updated>
                            <resolved>Sat, 14 Sep 2024 14:35:53 +0000</resolved>
                                    <version>1.9.0</version>
                                    <fixVersion>1.12.0</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>2</watches>
                                                                                                                <comments>
                            <comment id="17460128" author="huxi" created="Wed, 15 Dec 2021 17:32:18 +0000"  >&lt;p&gt;This is the exception thrown while parsing with &quot; as escape character:&lt;/p&gt;

&lt;p&gt;Caused by: java.io.IOException: (startline 3) EOF reached before encapsulated token finished&lt;br/&gt;
&#160; &#160; at org.apache.commons.csv.Lexer.parseEncapsulatedToken(Lexer.java:371)&lt;br/&gt;
&#160; &#160; at org.apache.commons.csv.Lexer.nextToken(Lexer.java:285)&lt;br/&gt;
&#160; &#160; at org.apache.commons.csv.CSVParser.nextRecord(CSVParser.java:701)&lt;br/&gt;
&#160; &#160; at org.apache.commons.csv.CSVParser$CSVRecordIterator.getNextRecord(CSVParser.java:146)&lt;br/&gt;
&#160; &#160; ... 3 more&lt;/p&gt;</comment>
                            <comment id="17460861" author="huxi" created="Thu, 16 Dec 2021 16:41:33 +0000"  >&lt;p&gt;Added a test reproducing the issue.&lt;/p&gt;</comment>
                            <comment id="17492138" author="JIRAUSER285196" created="Mon, 14 Feb 2022 17:57:27 +0000"  >&lt;p&gt;Even the input string (&quot;a&quot;) will cause the exception as Lexer.java treats the second (&quot;) as an escape char and read the unescaped \r, and then complain for missing the ending-quote (&quot;)&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
CSVFormat.Builder.create().setEscape(&lt;span class=&quot;code-quote&quot;&gt;&apos;&lt;span class=&quot;code-quote&quot;&gt;&quot;&apos;&lt;/span&gt;).build().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(&quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;a\&quot;&lt;/span&gt;&quot;)).getRecords();&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I think you cannot use the quote char as escape char. commons-cvs already implement the RFC part that the quote char is escaped by preceding quote char, but not the escape char&lt;/p&gt;

&lt;p&gt;E.g.&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;1 &quot;&lt;/span&gt; + CSVFormat.Builder.create().build().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;a\&quot;&quot;)).getRecords().get(0).get(0));
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;2 &quot;&lt;/span&gt; + CSVFormat.Builder.create().build().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;\&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;a\&lt;span class=&quot;code-quote&quot;&gt;&quot;\&quot;&lt;/span&gt;\&quot;&quot;)).getRecords().get(0).get(0));
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;3 &quot;&lt;/span&gt; + CSVFormat.Builder.create().setQuote(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;).build().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(&lt;span class=&quot;code-quote&quot;&gt;&quot;|a|&quot;&lt;/span&gt;)).getRecords().get(0).get(0));
&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out.println(&lt;span class=&quot;code-quote&quot;&gt;&quot;4 &quot;&lt;/span&gt; + CSVFormat.Builder.create().setQuote(&lt;span class=&quot;code-quote&quot;&gt;&apos;|&apos;&lt;/span&gt;).build().parse(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; StringReader(&lt;span class=&quot;code-quote&quot;&gt;&quot;|||a|||&quot;&lt;/span&gt;)).getRecords().get(0).get(0));
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Output&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
1 a
2 &lt;span class=&quot;code-quote&quot;&gt;&quot;a&quot;&lt;/span&gt;
3 a
4 |a|
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                            <comment id="17881789" author="garydgregory" created="Sat, 14 Sep 2024 14:35:53 +0000"  >&lt;p&gt;I added JiraCsv294Test to git master and it is green, so this has been fixed since 1.9.0.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                            <attachment id="13037606" name="JiraCsv294Test.java" size="3546" author="huxi" created="Thu, 16 Dec 2021 16:41:11 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            1 year, 8 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0xp7k:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>