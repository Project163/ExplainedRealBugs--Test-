<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:43:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-219] The behavior of quote char using is not similar as Excel does when the first string contains CJK char(s)</title>
                <link>https://issues.apache.org/jira/browse/CSV-219</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;When using CSVFormat.EXCEL to print a CSV file, the behavior of quote char using is not similar as Microsoft Excel does when the first string contains Chinese, Japanese or Korean (CJK) char(s).&lt;/p&gt;

&lt;p&gt;e.g.&lt;br/&gt;
There are 3 data members in a record, with Japanese chars: &quot;&#12354;&quot;, &quot;&#12356;&quot;, &quot;&#12358;&quot;:&lt;br/&gt;
  Microsoft Excel outputs:&lt;br/&gt;
  &#12354;,&#12356;,&#12358;&lt;br/&gt;
  Apache Common CSV outputs:&lt;br/&gt;
  &quot;&#12354;&quot;,&#12356;,&#12358;&lt;/p&gt;</description>
                <environment></environment>
        <key id="13123992">CSV-219</key>
            <summary>The behavior of quote char using is not similar as Excel does when the first string contains CJK char(s)</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="6" iconUrl="https://issues.apache.org/jira/images/icons/statuses/closed.png" description="The issue is considered finished, the resolution is correct. Issues which are not closed can be reopened.">Closed</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="hongda">Zhang Hongda</reporter>
                        <labels>
                    </labels>
                <created>Sun, 10 Dec 2017 13:49:44 +0000</created>
                <updated>Tue, 12 Dec 2017 13:11:12 +0000</updated>
                            <resolved>Mon, 11 Dec 2017 18:16:37 +0000</resolved>
                                    <version>1.5</version>
                                    <fixVersion>1.6</fixVersion>
                                    <component>Printer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="16285255" author="hongda" created="Sun, 10 Dec 2017 13:52:58 +0000"  >&lt;p&gt;This is the patch to solve the problem. &lt;/p&gt;</comment>
                            <comment id="16285409" author="garydgregory" created="Sun, 10 Dec 2017 23:18:57 +0000"  >&lt;p&gt;Our quoting seems off IMO. Why not simply do:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;diff --git a/src/main/java/org/apache/commons/csv/CSVFormat.java b/src/main/java/org/apache/commons/csv/CSVFormat.java
index 58948fd..dc7588b 100644
--- a/src/main/java/org/apache/commons/csv/CSVFormat.java
+++ b/src/main/java/org/apache/commons/csv/CSVFormat.java
@@ -1186,10 +1186,7 @@
             } else {
                 char c = value.charAt(pos);
 
-                // RFC4180 (https://tools.ietf.org/html/rfc4180) TEXTDATA =  %x20-21 / %x23-2B / %x2D-7E
-                if (newRecord &amp;amp;&amp;amp; (c &amp;lt; 0x20 || c &amp;gt; 0x21 &amp;amp;&amp;amp; c &amp;lt; 0x23 || c &amp;gt; 0x2B &amp;amp;&amp;amp; c &amp;lt; 0x2D || c &amp;gt; 0x7E)) {
-                    quote = true;
-                } else if (c &amp;lt;= COMMENT) {
+                if (c &amp;lt;= COMMENT) {
                     // Some other chars at the start of a value caused the parser to fail, so for now
                     // encapsulate if we start in anything less than &apos;#&apos;. We are being conservative
                     // by including the default comment char too.
diff --git a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java
index ae7aae2..5a09627 100644
--- a/src/test/java/org/apache/commons/csv/CSVPrinterTest.java
+++ b/src/test/java/org/apache/commons/csv/CSVPrinterTest.java
@@ -1033,11 +1033,20 @@
     }
 
     @Test
-    public void testRfc4180QuoteSingleChar() throws IOException {
+    public void testDontQuoteEuroFirstChar() throws IOException {
         final StringWriter sw = new StringWriter();
         try (final CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {
             printer.printRecord(EURO_CH, &quot;Deux&quot;);
-            assertEquals(&quot;\&quot;&quot; + EURO_CH + &quot;\&quot;,Deux&quot; + recordSeparator, sw.toString());
+            assertEquals(EURO_CH + &quot;,Deux&quot; + recordSeparator, sw.toString());
+        }
+    }
+
+    @Test
+    public void testQuoteCommaFirstChar() throws IOException {
+        final StringWriter sw = new StringWriter();
+        try (final CSVPrinter printer = new CSVPrinter(sw, CSVFormat.RFC4180)) {
+            printer.printRecord(&quot;,&quot;);
+            assertEquals(&quot;\&quot;,\&quot;&quot; + recordSeparator, sw.toString());
         }
     }
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;I do not see why the first char in a record being not in TEXTDATA should quote the first field.&lt;/p&gt;

&lt;p&gt;Thoughts from other. With the above patch, all tests pass.&lt;/p&gt;</comment>
                            <comment id="16285876" author="hongda" created="Mon, 11 Dec 2017 13:14:12 +0000"  >&lt;p&gt;Thanks Gary. By the way, I even deleted the &quot;if (c &amp;lt;= COMMENT) {&quot; branch to meet what the Microsoft Excel does in my job. But when I have read the comment under it, I am not sure if it is a bug or a feature. I think this sourcecode is only affect to the printing of a CSV file, but has no no effect on the parser. When I tried to parse a CSV file with a char which ASCII code less than &apos;#&apos; but more or equal than 0x20 without quoting it, I didn&apos;t find any problem which the comment says. I still wondered in which case the parser will fail in common cases. So for the time being, I am not reporting that as a bug.&lt;/p&gt;</comment>
                            <comment id="16286119" author="charles_honton@intuit.com" created="Mon, 11 Dec 2017 16:18:15 +0000"  >&lt;p&gt;The quoting of the first row probably has something to do with excel misreading certain prefixes.  For example, &lt;a href=&quot;https://support.microsoft.com/en-us/help/323626/-sylk-file-format-is-not-valid-error-message-when-you-open-file&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;if the first field starts with &apos;ID&apos;, then excel will interpret the file as SYLK format&lt;/a&gt;.  I&apos;m not sure that this is a bug.  Just a different, more conservative format.&lt;/p&gt;

&lt;p&gt;I&apos;d suggest making sure there is a unit test with first field containing &quot;ID&quot;&lt;/p&gt;</comment>
                            <comment id="16286145" author="garydgregory" created="Mon, 11 Dec 2017 16:28:27 +0000"  >&lt;p&gt;Reading up &lt;a href=&quot;https://en.m.wikipedia.org/wiki/SYmbolic_LinK_(SYLK&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://en.m.wikipedia.org/wiki/SYmbolic_LinK_(SYLK&lt;/a&gt;)&lt;/p&gt;

&lt;p&gt;It seems that we need an Excel SYLK format and quote mode.&lt;/p&gt;</comment>
                            <comment id="16286375" author="garydgregory" created="Mon, 11 Dec 2017 18:16:37 +0000"  >&lt;p&gt;In git master. Please verify and close.&lt;/p&gt;</comment>
                            <comment id="16287576" author="hongda" created="Tue, 12 Dec 2017 13:10:55 +0000"  >&lt;p&gt;Thanks Gary very much. I have confirmed and tested the sourcecode of git master, it is OK now.&lt;br/&gt;
Also thanks Charles for the comment.&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10032">
                    <name>Blocker</name>
                                            <outwardlinks description="blocks">
                                        <issuelink>
            <issuekey id="12939344">CSV-172</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12901407" name="diff.patch" size="1604" author="hongda" created="Sun, 10 Dec 2017 13:51:45 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            7 years, 48 weeks, 4 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i3nqof:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>