<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:42:47 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-35] Escaped line separators are not supported</title>
                <link>https://issues.apache.org/jira/browse/CSV-35</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;Commons CSV doesn&apos;t handle escaped line separators, for example:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;value1;value2;value3a\
value3b
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In this case the expected result is:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;[&lt;span class=&quot;code-quote&quot;&gt;&quot;value1&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value2&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;value3a\nvalue3b&quot;&lt;/span&gt;]&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This kind of escaping is produced by MySQL, whether the field enclosing is enabled or not. It&apos;s possible to see enclosing quotes and escaped line separators like this:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;&lt;span class=&quot;code-quote&quot;&gt;&quot;value1&quot;&lt;/span&gt;;&lt;span class=&quot;code-quote&quot;&gt;&quot;value2&quot;&lt;/span&gt;;&quot;value3a\
value3b&quot;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment></environment>
        <key id="12545640">CSV-35</key>
            <summary>Escaped line separators are not supported</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="ebourg">Emmanuel Bourg</reporter>
                        <labels>
                    </labels>
                <created>Thu, 8 Mar 2012 11:29:29 +0000</created>
                <updated>Thu, 10 Jul 2014 18:31:32 +0000</updated>
                                                            <fixVersion>1.x</fixVersion>
                                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                                                                                                <comments>
                            <comment id="13236649" author="sebb@apache.org" created="Fri, 23 Mar 2012 15:02:31 +0000"  >&lt;p&gt;What should happen in the case of &amp;lt;escape&amp;gt;CRLF?&lt;br/&gt;
I presume only the CR should be subject to the escape.&lt;br/&gt;
If an application wants to include CRLF in a field, then the application should generate &amp;lt;escape&amp;gt;CR&amp;lt;escape&amp;gt;LF.&lt;/p&gt;</comment>
                            <comment id="13241295" author="sebb@apache.org" created="Thu, 29 Mar 2012 15:13:32 +0000"  >&lt;p&gt;The Lexer does currently (r1036896) handle &amp;lt;esc&amp;gt;LF and &amp;lt;esc&amp;gt;CR.&lt;/p&gt;

&lt;p&gt;The code currently treats &amp;lt;esc&amp;gt;CRLF as &amp;lt;esc&amp;gt;CR followed by LF. The LF is handled as EOL.&lt;/p&gt;</comment>
                            <comment id="13691677" author="garydgregory" created="Mon, 24 Jun 2013 03:09:47 +0000"  >&lt;p&gt;So, can this issue be closed?&lt;/p&gt;</comment>
                            <comment id="13691965" author="ebourg" created="Mon, 24 Jun 2013 13:45:12 +0000"  >&lt;p&gt;Not sure. What is the effect of &amp;lt;esc&amp;gt;CRLF? Does it end the current record?&lt;/p&gt;</comment>
                            <comment id="13692015" author="sebb@apache.org" created="Mon, 24 Jun 2013 14:20:43 +0000"  >&lt;p&gt;Yes - see my comment dated 29/Mar/12 16:13.&lt;/p&gt;

&lt;p&gt;i.e. the escape char only affects the subsequent character.&lt;/p&gt;

&lt;p&gt;I suppose &amp;lt;esc&amp;gt;CRLF could be special-cased if it is likely to be needed.&lt;/p&gt;

&lt;p&gt;However how does one then support the current behaviour - again, if there is a user-case for it?&lt;br/&gt;
There could be switchable option, but that would only work for the complete file.&lt;/p&gt;</comment>
                            <comment id="13695422" author="ebourg" created="Fri, 28 Jun 2013 12:45:03 +0000"  >&lt;p&gt;I rechecked the output of MySQL and it does indeed produce &amp;lt;esc&amp;gt;CRLF and not &amp;lt;esc&amp;gt;CR&amp;lt;esc&amp;gt;LF. I think we should handle that case and extend the escaping to the second new line character.&lt;/p&gt;</comment>
                            <comment id="13696333" author="sebb@apache.org" created="Sun, 30 Jun 2013 13:58:48 +0000"  >&lt;p&gt;As already noted, this would require special-casing, and will mean there is no way to represent &amp;lt;esc&amp;gt;CR followed by plain LF.&lt;/p&gt;

&lt;p&gt;At the very least, this needs to be carefully documented to avoid suprises (and complaints).&lt;/p&gt;</comment>
                            <comment id="13726343" author="britter" created="Thu, 1 Aug 2013 11:13:26 +0000"  >&lt;p&gt;Do we ant to &quot;fix&quot; the parsing behavior for MySQL exports? I think we don&apos;t need to fix this for 1.0. MySQL is just one format among many.&lt;/p&gt;</comment>
                            <comment id="13877129" author="garydgregory" created="Tue, 21 Jan 2014 02:57:12 +0000"  >&lt;p&gt;So, not addressing this means that we cannot deal with MySQL exports? That seems harsh (for users).&lt;/p&gt;

&lt;p&gt;It sounds like, for users, the way to tell &lt;span class=&quot;error&quot;&gt;&amp;#91;csv&amp;#93;&lt;/span&gt; about this is with a withMySQLEol(boolean) option? Which would be a special case as Sebb mentioned.&lt;/p&gt;</comment>
                            <comment id="13877640" author="sebb@apache.org" created="Tue, 21 Jan 2014 17:33:11 +0000"  >&lt;p&gt;I would be OK with adding an option to support this, but it should not be called anything to do with MySQL.&lt;/p&gt;

&lt;p&gt;It so happens that MySQL is known to generate the escape sequence, but other CSV exports may do so as well, so I think the option name should relate only to the functionality. The Javadoc can mention that the option may be needed for MySQL parsing.&lt;/p&gt;

&lt;p&gt;For example the option could be called:   withEscapeCRLF(boolean).&lt;br/&gt;
Default should be false (i.e. only escape the CR).&lt;/p&gt;</comment>
                            <comment id="13879796" author="ebourg" created="Thu, 23 Jan 2014 09:41:00 +0000"  >&lt;p&gt;I attached two files exported from MySQL 5.1. The source table contains 3 columns.&lt;/p&gt;

&lt;p&gt;In the first file the records are terminated by LF. If a field contains CRLF MySQL generates CR&amp;lt;escape&amp;gt;LF. The file was created with this query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * INTO OUTFILE &lt;span class=&quot;code-quote&quot;&gt;&apos;/mysql-export-line-terminated-by-lf.csv&apos;&lt;/span&gt; FIELDS TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;;&apos;&lt;/span&gt; ESCAPED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; LINES TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;\n&apos;&lt;/span&gt; FROM test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;In the second file the records are terminated by CRLF. If a field contains CRLF MySQL generates &amp;lt;escape&amp;gt;CRLF (the whole sequence is escaped only once). The file was created with this query:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;SELECT * INTO OUTFILE &lt;span class=&quot;code-quote&quot;&gt;&apos;/mysql-export-line-terminated-by-crlf.csv&apos;&lt;/span&gt; FIELDS TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;;&apos;&lt;/span&gt; ESCAPED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;\\&apos;&lt;/span&gt; LINES TERMINATED BY &lt;span class=&quot;code-quote&quot;&gt;&apos;\r\n&apos;&lt;/span&gt; FROM test
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13879966" author="sebb@apache.org" created="Thu, 23 Jan 2014 14:48:13 +0000"  >&lt;p&gt;Interesting.&lt;br/&gt;
Do you have to tell MySQL what the EOL is when reloading from the CSV file?&lt;br/&gt;
Or does it work this out for itself? This could be tricky if there are CR/LF at the end of the record.&lt;/p&gt;

&lt;p&gt;So long as the CSV code knows whether to treat LF or CRLF as the (only) line terminator it should be easy to parse this format.&lt;/p&gt;

&lt;p&gt;For EOL=LF, only LF needs to be escaped on output, and only an unescaped LF acts as an EOL on parse.&lt;br/&gt;
For EOL=CRLF, in theory either (or both) need to be escaped on output; only if CR and LF are both unescaped is EOL detected on parse.&lt;/p&gt;

&lt;p&gt;However, if one wants to support a variable EOL - or the EOL is not known at the start - it quickly becomes very tricky to parse.&lt;/p&gt;

&lt;p&gt;It would be interesting to know how MySQL handles \CR\LF  and LF\CR as input in the CRLF case.&lt;/p&gt;

&lt;p&gt;Also, how does it handle a bare CR on output?&lt;/p&gt;</comment>
                            <comment id="13949990" author="garydgregory" created="Thu, 27 Mar 2014 21:51:53 +0000"  >&lt;p&gt;This looks to me like the main serious issue remaining before 1.0. There is also &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-58&quot; title=&quot;Unescape handling needs rethinking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-58&quot;&gt;CSV-58&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;Handling MySQL exports sounds pretty basic. We already have &lt;tt&gt;CSVFormat.MYSQL&lt;/tt&gt;, so we are telling the world we know how to do MySQL...&lt;/p&gt;

&lt;p&gt;Gary&lt;/p&gt;</comment>
                            <comment id="14033891" author="tn" created="Tue, 17 Jun 2014 15:09:20 +0000"  >&lt;p&gt;Right now the lexer does not use the record separator(s) specified in the format to be parsed.&lt;/p&gt;

&lt;p&gt;In the mysql example, &quot;\n&quot; or LF is the record separator.&lt;/p&gt;

&lt;p&gt;The record looks as follows:&lt;/p&gt;
&lt;div class=&quot;preformatted panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;preformattedContent panelContent&quot;&gt;
&lt;pre&gt;3;Value\r
\\nwith a line break,c\n
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;the CRLF sequence is escaped so that \n is not used as record separator, but the second \n then finished the record.&lt;/p&gt;

&lt;p&gt;So I would suggest that:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;support multiple record separators for a format, e.g. \n, \r, or \r\n&lt;/li&gt;
	&lt;li&gt;the lexer uses the record separators defined for the format&lt;/li&gt;
	&lt;li&gt;an escape character indicates that the following character can not be used as record separator&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14033941" author="garydgregory" created="Tue, 17 Jun 2014 15:52:11 +0000"  >&lt;p&gt;It seems like a bug not to use the format&apos;s record separator.&lt;/p&gt;</comment>
                            <comment id="14034404" author="sebb@apache.org" created="Tue, 17 Jun 2014 21:33:49 +0000"  >&lt;p&gt;Gary: I suspect the record separator was originally intended as output only&lt;/p&gt;

&lt;p&gt;Thomas: I agree. &lt;br/&gt;
However there is a possibility that the record separator (RS) could contain the escape character.&lt;br/&gt;
How should it handle that case?&lt;br/&gt;
I suspect this should be disallowed, as it will cause issues.&lt;/p&gt;

&lt;p&gt;In the case of the MySQL examples:&lt;br/&gt;
If the escape char is set to &apos;\&apos; , then if the input is unescaped before checking for the RS, it would be possible to parse the input OK, by choosing RS=LF or RS=CRLF. i.e. there is no need to use the escape character in the RS because the unescaping is done first. This should of course be tested ...&lt;/p&gt;

&lt;p&gt;If one checks for RS before unescaping, then it would not be possible to escape the RS sequence.&lt;/p&gt;</comment>
                            <comment id="14035551" author="tn" created="Wed, 18 Jun 2014 10:18:02 +0000"  >&lt;p&gt;The attached patch fixes the lexer to use the record separator defined for the format to parse.&lt;/p&gt;

&lt;p&gt;With this patch all unit tests still pass and I have added a new one which resembles the mysql output.&lt;/p&gt;</comment>
                            <comment id="14035579" author="tn" created="Wed, 18 Jun 2014 11:12:36 +0000"  >&lt;p&gt;This issue is related to &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-102&quot; title=&quot;Commons CSV does not properly handle record separators&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-102&quot;&gt;CSV-102&lt;/a&gt;.&lt;br/&gt;
The patch there adds support for custom record separators when parsing, similar to my patch.&lt;/p&gt;

&lt;p&gt;Although I think that the ExtendedBufferedReader should not be changed, as CR/LF is used there to get the actual line number of the parsed file for error handling / debug information only.&lt;/p&gt;</comment>
                            <comment id="14047217" author="britter" created="Sun, 29 Jun 2014 19:26:40 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tn&quot; class=&quot;user-hover&quot; rel=&quot;tn&quot;&gt;tn&lt;/a&gt; go ahead an commit the patch yourself &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/wink.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;/p&gt;</comment>
                            <comment id="14047460" author="tillmann gaida" created="Mon, 30 Jun 2014 08:13:55 +0000"  >&lt;p&gt;I added a patch &quot;commons-csv &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-35&quot; title=&quot;Escaped line separators are not supported&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-35&quot;&gt;CSV-35&lt;/a&gt; escapeCRLFOnce[ test].patch&quot;, which introduces a CSVFormat setting &quot;escapeCRLFOnce&quot;, which enables the desired behaviour in Lexer. It is false by default and I did not change CSVFormat.MYSQL, which might be approprate. I am not exactly happy with the naming of the setting. Consider renaming it if you happen to build upon the patch.&lt;/p&gt;

&lt;p&gt;EDIT: clarity&lt;/p&gt;

&lt;p&gt;EDIT: This is a very specific setting. A cleaner solution would probably be to allow escaping of record separators by a single escape char. However it appears that the MYSQL format uses LF as a record separator, so we would need to have multiple record separators, which in this case would not be actual record separators.&lt;/p&gt;

&lt;p&gt;I&apos;d argue that CRLF is special enough to have an individual setting, but I would also agree with having a cleaner CSVFormat. The only real alternative would be having a way to individually specify character sequences and a replacement if they are preceded by the escape char.&lt;/p&gt;</comment>
                            <comment id="14053910" author="britter" created="Mon, 7 Jul 2014 17:48:19 +0000"  >&lt;p&gt;I&apos;ve asked the ML to to comment on this fix.&lt;/p&gt;</comment>
                            <comment id="14057789" author="britter" created="Thu, 10 Jul 2014 18:31:32 +0000"  >&lt;p&gt;As discussed on the ML, I&apos;m moving this to 1.x, so we can release 1.0. &lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;I&apos;ve implemented logic that makes sure only record separators, we can handle are used.&lt;/p&gt;

&lt;p&gt;&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt; &lt;a href=&quot;http://markmail.org/message/2ba52lsduzc5jisr&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://markmail.org/message/2ba52lsduzc5jisr&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12677474">CSV-102</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12651101" name="CSV-35.patch" size="4921" author="tn" created="Wed, 18 Jun 2014 10:18:02 +0000"/>
                            <attachment id="12653111" name="commons-csv CSV-35 escapeCRLFOnce test.patch" size="1303" author="Tillmann Gaida" created="Mon, 30 Jun 2014 08:13:55 +0000"/>
                            <attachment id="12653112" name="commons-csv CSV-35 escapeCRLFOnce.patch" size="12169" author="Tillmann Gaida" created="Mon, 30 Jun 2014 08:13:55 +0000"/>
                            <attachment id="12624763" name="mysql-export-line-terminated-by-crlf.csv" size="244" author="ebourg" created="Thu, 23 Jan 2014 09:41:00 +0000"/>
                            <attachment id="12624762" name="mysql-export-line-terminated-by-lf.csv" size="236" author="ebourg" created="Thu, 23 Jan 2014 09:41:00 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>5.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>230823</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0au7r:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61168</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>