<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:43:08 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-107] CSVFormat.EXCEL.parse should handle byte order marks</title>
                <link>https://issues.apache.org/jira/browse/CSV-107</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;The CSVFormat.EXCEL.parse should consider the byte order marks when reading the input stream. Files with a byte order mark fail to properly parse.&lt;/p&gt;

&lt;p&gt;In my example, I have a starting byte order mark before my headers in a CVS file. The parse fails when trying to get the header via the CSVRecord.get call.&lt;/p&gt;

&lt;p&gt;I marked this as critical because many users will interact with Windows user which will most likely have BOM files.&lt;/p&gt;</description>
                <environment></environment>
        <key id="12701765">CSV-107</key>
            <summary>CSVFormat.EXCEL.parse should handle byte order marks</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="4" iconUrl="https://issues.apache.org/jira/images/icons/priorities/minor.svg">Minor</priority>
                        <status id="4" iconUrl="https://issues.apache.org/jira/images/icons/statuses/reopened.png" description="This issue was once resolved, but the resolution was deemed incorrect. From here issues are either marked assigned or resolved.">Reopened</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="kenzley">Kenzley Alphonse</reporter>
                        <labels>
                    </labels>
                <created>Sun, 16 Mar 2014 19:13:37 +0000</created>
                <updated>Thu, 28 Aug 2014 17:04:47 +0000</updated>
                                                            <fixVersion>1.x</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>5</watches>
                                    <workratio workratioPercent="0"/>
                                    <progress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="0">
                                    <originalProgress>
                                                    <row percentage="100" backgroundColor="#89afd7"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="0" backgroundColor="#51a825"/>
                                                    <row percentage="100" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                    <timeoriginalestimate seconds="10800">3h</timeoriginalestimate>
                            <timeestimate seconds="10800">3h</timeestimate>
                                        <comments>
                            <comment id="13937317" author="ggregory" created="Sun, 16 Mar 2014 19:56:15 +0000"  >&lt;p&gt;Can you attach a sample file and tell us how you created it?&lt;/p&gt;</comment>
                            <comment id="13937338" author="kenzley" created="Sun, 16 Mar 2014 21:26:43 +0000"  >&lt;p&gt;I used this url to fetch the content:&lt;br/&gt;
&lt;a href=&quot;http://finance.google.com/finance/historical?q=nasdaq:goog&amp;amp;output=csv&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://finance.google.com/finance/historical?q=nasdaq:goog&amp;amp;output=csv&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;which produced the vod.csv file.&lt;/p&gt;</comment>
                            <comment id="13937346" author="kenzley" created="Sun, 16 Mar 2014 21:37:06 +0000"  >&lt;p&gt;At least, it should minimally detect the BOM character and skip it.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/input/BOMInputStream.html&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-io/apidocs/org/apache/commons/io/input/BOMInputStream.html&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13937347" author="ggregory" created="Sun, 16 Mar 2014 21:38:14 +0000"  >&lt;p&gt;The url gives me an error fwiw.&lt;/p&gt;</comment>
                            <comment id="13937353" author="kenzley" created="Sun, 16 Mar 2014 21:58:51 +0000"  >&lt;p&gt;Yeah, that&apos;s odd. I can programmatically hit it but not directly using the browser. I used apache http commons to get the url. Nonetheless, the file should be sufficient. Let me know if you also need the code. I can create a small test case.&lt;/p&gt;</comment>
                            <comment id="13937369" author="ebourg" created="Sun, 16 Mar 2014 23:11:45 +0000"  >&lt;p&gt;Handling the BOMs is outside the scope of commons-csv IMHO. The BOMs should be checked ahead of the CSVParser to build a proper input Reader (using &lt;tt&gt;BOMInputStream&lt;/tt&gt; for example. We should probably add a BOM aware InputStreamReader in common-io btw).&lt;/p&gt;</comment>
                            <comment id="13937379" author="kenzley" created="Sun, 16 Mar 2014 23:52:24 +0000"  >&lt;p&gt;I would beg to differ. This will be problematic when trying to read from a file with a BOM character and without wrapping it with BOMInputStream. Your user will not know why it failed and this will lead to confusion.&lt;/p&gt;

&lt;p&gt;Example code:&lt;br/&gt;
Reader in = new FileReader(&quot;&amp;lt;path to&amp;gt;&lt;br class=&quot;atl-forced-newline&quot; /&gt;vod.csv&quot;);&lt;br/&gt;
// in.read(new char&lt;span class=&quot;error&quot;&gt;&amp;#91;1&amp;#93;&lt;/span&gt;); // works if we skip the BOM character, fails otherwise.&lt;br/&gt;
Iterable&amp;lt;CSVRecord&amp;gt; records = CSVFormat.EXCEL.withHeader().parse(in);&lt;br/&gt;
for (CSVRecord record: records) {&lt;br/&gt;
	System.out.println(&quot;date: &quot; + record.get(&quot;Date&quot;));&lt;br/&gt;
}&lt;/p&gt;

&lt;p&gt;A lot of other libraries account for BOM characters naively, namely:&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://code.google.com/p/google-gson/source/browse/trunk/gson/src/main/java/com/google/gson/stream/JsonReader.java#1266&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://code.google.com/p/google-gson/source/browse/trunk/gson/src/main/java/com/google/gson/stream/JsonReader.java#1266&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;http://grepcode.com/file/repo1.maven.org/maven2/org.glassfish/javax.json/1.0/org/glassfish/json/UnicodeDetectingInputStream.java#128&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://grepcode.com/file/repo1.maven.org/maven2/org.glassfish/javax.json/1.0/org/glassfish/json/UnicodeDetectingInputStream.java#128&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Simply, detecting the BOM character before you begin parsing and skipping it if present is sufficient. Plus, it saves debugging and headaches for your developers.&lt;/p&gt;</comment>
                            <comment id="13937397" author="garydgregory" created="Mon, 17 Mar 2014 01:09:41 +0000"  >&lt;p&gt;I&apos;ve added the workaround as a new test: &lt;tt&gt;org.apache.commons.csv.CSVParserTest.testBOMInputStream()&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;This takes care of all five possible BOMs.&lt;/p&gt;

&lt;p&gt;The simplest solution is for users to use Apcahe Commons IO&apos;s &lt;tt&gt;BOMInputStream&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;Adding a dependency to Apcahe Commons IO just for that seems too heavy. Note that the tests already depend on Apcahe Commons IO and that&apos;s OK.&lt;/p&gt;</comment>
                            <comment id="13937528" author="ebourg" created="Mon, 17 Mar 2014 07:51:04 +0000"  >&lt;p&gt;A byte order mark is not a character, but a byte sequence at the beginning of the binary stream. &lt;tt&gt;CSVFormat.parse()&lt;/tt&gt; works on a Reader which is a character stream, it&apos;s too late to analyze the BOM at this point.&lt;/p&gt;</comment>
                            <comment id="13949955" author="garydgregory" created="Thu, 27 Mar 2014 21:30:58 +0000"  >&lt;p&gt;Changing to minor as there is a workaround in &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-107?focusedCommentId=13937397&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13937397&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CSV-107?focusedCommentId=13937397&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13937397&lt;/a&gt;&lt;/p&gt;</comment>
                            <comment id="13949959" author="garydgregory" created="Thu, 27 Mar 2014 21:34:40 +0000"  >&lt;p&gt;Workaround: &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-107?focusedCommentId=13937397&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13937397&quot; class=&quot;external-link&quot; rel=&quot;nofollow&quot;&gt;https://issues.apache.org/jira/browse/CSV-107?focusedCommentId=13937397&amp;amp;page=com.atlassian.jira.plugin.system.issuetabpanels:comment-tabpanel#comment-13937397&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;We could simply depend on Commons IO and reuse the BOMInputStream for all stream processing.&lt;/p&gt;</comment>
                            <comment id="14035780" author="tn" created="Wed, 18 Jun 2014 14:39:09 +0000"  >&lt;p&gt;Another option would be to do the same as suggested here: &lt;a href=&quot;http://stackoverflow.com/questions/1835430/byte-order-mark-screws-up-file-reading-in-java&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://stackoverflow.com/questions/1835430/byte-order-mark-screws-up-file-reading-in-java&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;It&apos;s basically a unicode reader that skips the BOM at the beginning of the stream if one is detected.&lt;/p&gt;</comment>
                            <comment id="14035789" author="garydgregory" created="Wed, 18 Jun 2014 14:53:23 +0000"  >&lt;p&gt;We could eat out own dog food and reuse Commons IO&apos;s &lt;tt&gt;BOMInputStream&lt;/tt&gt;.&lt;/p&gt;</comment>
                            <comment id="14035792" author="tn" created="Wed, 18 Jun 2014 14:58:31 +0000"  >&lt;p&gt;Sure, the UnicodeReader solution is just a little bit smaller, but I do not have a preference.&lt;/p&gt;

&lt;p&gt;I agree with the OP that this could be a serious problem for potential users processing certain files and if there is a simple way to avoid these problems, then we should do it imho.&lt;/p&gt;</comment>
                            <comment id="14035869" author="garydgregory" created="Wed, 18 Jun 2014 15:57:22 +0000"  >&lt;p&gt;Adds full BOM support via copies of Commons IO classes (I&apos;d rather depend on Commons IO). TODO: Unit tests AND adding withByteOrderMark(ByteOrderMark...) to CSVFormat or should all BOMs be detected?&lt;/p&gt;</comment>
                            <comment id="14035927" author="garydgregory" created="Wed, 18 Jun 2014 16:47:55 +0000"  >&lt;p&gt;BOM processing seems pretty important since Excel is an important data source.&lt;/p&gt;

&lt;p&gt;So we need consider:&lt;/p&gt;

&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;Should a Charset passed in the API override the BOM?&lt;/li&gt;
	&lt;li&gt;Should we simply depend on Commons IO for BOM processing since 3 classes are needed.&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14037111" author="tn" created="Thu, 19 Jun 2014 08:25:40 +0000"  >&lt;p&gt;I think the API should provide two versions of the respective parse methods:&lt;/p&gt;

&lt;ul&gt;
	&lt;li&gt;with Charset: do not use the BOMInputStream and force to use the given Charset for the reader&lt;/li&gt;
	&lt;li&gt;without Charset: use a BOMInputStream and create a reader with the detected Charset&lt;/li&gt;
&lt;/ul&gt;
</comment>
                            <comment id="14037461" author="sebb@apache.org" created="Thu, 19 Jun 2014 16:07:19 +0000"  >&lt;blockquote&gt;&lt;p&gt;BOM processing seems pretty important since Excel is an important data source.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Does Excel always generate a BOM? If so, I&apos;ve not noticed this.&lt;/p&gt;</comment>
                            <comment id="14037464" author="sebb@apache.org" created="Thu, 19 Jun 2014 16:10:32 +0000"  >&lt;p&gt;I agree with Thomas that if we do include BOM processing, it should be tied to the Charset.&lt;/p&gt;</comment>
                            <comment id="14047220" author="britter" created="Sun, 29 Jun 2014 19:28:33 +0000"  >&lt;p&gt;Has this been fixed in &lt;a href=&quot;http://svn.apache.org/r1602901&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1602901&lt;/a&gt; ?&lt;/p&gt;</comment>
                            <comment id="14047226" author="sebb@apache.org" created="Sun, 29 Jun 2014 19:42:54 +0000"  >&lt;p&gt;I don&apos;t think that is related.&lt;br/&gt;
But I thought we had agreed that BOM processing was out of scope.&lt;/p&gt;

&lt;p&gt;It&apos;s also quite easy to handle the processing externally; there is no need to embed it within the parser.&lt;br/&gt;
That just increases the complexitiy and maintainance issues.&lt;/p&gt;</comment>
                            <comment id="14047232" author="britter" created="Sun, 29 Jun 2014 19:53:26 +0000"  >&lt;blockquote&gt;&lt;p&gt;But I thought we had agreed that BOM processing was out of scope.&lt;/p&gt;&lt;/blockquote&gt;

&lt;p&gt;Agreed, fix as Won&apos;t fix?&lt;/p&gt;</comment>
                            <comment id="14047239" author="sebb@apache.org" created="Sun, 29 Jun 2014 20:07:32 +0000"  >&lt;p&gt;OK by me&lt;/p&gt;</comment>
                            <comment id="14047308" author="garydgregory" created="Mon, 30 Jun 2014 01:43:32 +0000"  >&lt;p&gt;I&apos;m OK with no code changes for 1.0 and adding docs, which I just did. See the site xdocs and feel free to move/change.&lt;/p&gt;</comment>
                            <comment id="14113970" author="sebb@apache.org" created="Thu, 28 Aug 2014 17:04:47 +0000"  >&lt;p&gt;The fix is documented at&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://commons.apache.org/proper/commons-csv/user-guide.html#Handling_Byte_Order_Marks&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://commons.apache.org/proper/commons-csv/user-guide.html#Handling_Byte_Order_Marks&lt;/a&gt;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12736197">CSV-127</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12651175" name="csv-bom.diff" size="32333" author="ggregory" created="Wed, 18 Jun 2014 15:57:22 +0000"/>
                            <attachment id="12635013" name="vod.csv" size="11767" author="kenzley" created="Sun, 16 Mar 2014 21:26:21 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>2.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380110</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 12 weeks, 2 days ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i1thrr:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>380394</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>