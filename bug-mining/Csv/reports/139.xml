<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:44:24 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-318] CSVPrinter.printRecord(Stream) hangs if given a parallel stream</title>
                <link>https://issues.apache.org/jira/browse/CSV-318</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.csv.CSVFormat;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.apache.commons.csv.CSVPrinter;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; org.junit.jupiter.api.Test;

&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.ByteArrayOutputStream;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.IOException;
&lt;span class=&quot;code-keyword&quot;&gt;import&lt;/span&gt; java.io.PrintWriter;

&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;code-keyword&quot;&gt;class &lt;/span&gt;CommonsCsvTest {

   @Test
    void testWithParStream() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(CSVPrinter printer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVPrinter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(baos), CSVFormat.DEFAULT)){
            printer.printRecord(java.util.stream.Stream.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;col a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col c&quot;&lt;/span&gt;).parallel());
        }
    }

    @Test
    void testWithSeqStream() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; IOException {
        ByteArrayOutputStream baos = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; ByteArrayOutputStream();
        &lt;span class=&quot;code-keyword&quot;&gt;try&lt;/span&gt;(CSVPrinter printer = &lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; CSVPrinter(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; PrintWriter(baos), CSVFormat.DEFAULT)){
            printer.printRecord(java.util.stream.Stream.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;col a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col c&quot;&lt;/span&gt;));
        }
    }


}
 &lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;A simple workaround is to call&#160;sequential() on any passed in Stream.&lt;/p&gt;

&lt;p&gt;I don&apos;t know why this is happening.&#160; At first I thought it must be a problem with the underlying Stream implementation but this code has no problem:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
@Test
void testJavaStream(){
    java.util.stream.Stream.of(&lt;span class=&quot;code-quote&quot;&gt;&quot;col a&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col b&quot;&lt;/span&gt;, &lt;span class=&quot;code-quote&quot;&gt;&quot;col c&quot;&lt;/span&gt;).parallel()
            .forEachOrdered(&lt;span class=&quot;code-object&quot;&gt;System&lt;/span&gt;.out::println);
}&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</description>
                <environment>&lt;p&gt;&lt;font color=&quot;#000000&quot;&gt;openjdk version &quot;21.0.6&quot; 2025-01-21&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; &lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;OpenJDK Runtime Environment (Red_Hat-21.0.6.0.7-1) (build 21.0.6+7)&lt;/font&gt;&lt;font color=&quot;#000000&quot;&gt; &lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt;OpenJDK 64-Bit Server VM (Red_Hat-21.0.6.0.7-1) (build 21.0.6+7, mixed mode, sharing)&lt;/font&gt;&lt;br/&gt;
&lt;font color=&quot;#000000&quot;&gt; &lt;/font&gt;&lt;/p&gt;</environment>
        <key id="13617166">CSV-318</key>
            <summary>CSVPrinter.printRecord(Stream) hangs if given a parallel stream</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="ggregory">Gary D. Gregory</assignee>
                                    <reporter username="tupari">Joseph Shraibman</reporter>
                        <labels>
                    </labels>
                <created>Mon, 5 May 2025 18:04:39 +0000</created>
                <updated>Thu, 21 Aug 2025 08:48:41 +0000</updated>
                            <resolved>Tue, 6 May 2025 21:48:17 +0000</resolved>
                                    <version>1.14.0</version>
                                    <fixVersion>1.14.1</fixVersion>
                                    <component>Printer</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="17949826" author="garydgregory" created="Tue, 6 May 2025 19:27:52 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tupari&quot; class=&quot;user-hover&quot; rel=&quot;tupari&quot;&gt;tupari&lt;/a&gt;&#160;&lt;/p&gt;

&lt;p&gt;Thank you for your report.&lt;/p&gt;

&lt;p&gt;The deadlock occurs because &lt;tt&gt;CSVPrinter.print(Object)&lt;/tt&gt; is synchronized and the parallel stream uses the fork-join framework.&lt;/p&gt;

&lt;p&gt;Please see &lt;tt&gt;JiraCsv318Test&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;I&apos;ll need to think about this one some more...&lt;/p&gt;</comment>
                            <comment id="17949840" author="garydgregory" created="Tue, 6 May 2025 21:48:17 +0000"  >&lt;p&gt;&lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tupari&quot; class=&quot;user-hover&quot; rel=&quot;tupari&quot;&gt;tupari&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;This issue is now fixed in git master and snapshot builds in &lt;a href=&quot;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-csv/1.14.1-SNAPSHOT/&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://repository.apache.org/content/repositories/snapshots/org/apache/commons/commons-csv/1.14.1-SNAPSHOT/&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;Please test your use case and report back here.&lt;/p&gt;

&lt;p&gt;TY!&lt;/p&gt;</comment>
                            <comment id="17949871" author="tupari" created="Wed, 7 May 2025 01:47:16 +0000"  >&lt;p&gt;My test case passes with the snapshot.  Thanks for the quick turnaround!&lt;/p&gt;

&lt;p&gt;BTW all synchronized code should be converted to use ReentrantLock (or ReentrantReadWriteLock) because synchronized doesn&apos;t play nice with Project Loom.&lt;/p&gt;</comment>
                            <comment id="17949955" author="garydgregory" created="Wed, 7 May 2025 10:29:17 +0000"  >&lt;p&gt;YW.&lt;/p&gt;

&lt;p&gt;From the JavaOne 2025 (or whatever it&apos;s called now) talk I&apos;ve seen on YouTube, the pinning issues have been resolved.&lt;/p&gt;

&lt;p&gt;I&apos;ll update the other methods to use the same lock.&lt;/p&gt;</comment>
                            <comment id="17951083" author="tupari" created="Tue, 13 May 2025 02:16:52 +0000"  >&lt;p&gt;Can you please share that video?  I haven&apos;t been able to find it.&lt;/p&gt;</comment>
                            <comment id="17952228" author="garydgregory" created="Fri, 16 May 2025 16:22:43 +0000"  >&lt;p&gt;Hello &lt;a href=&quot;https://issues.apache.org/jira/secure/ViewProfile.jspa?name=tupari&quot; class=&quot;user-hover&quot; rel=&quot;tupari&quot;&gt;tupari&lt;/a&gt;&lt;/p&gt;

&lt;p&gt;The topic was one of many in a long-form video, from JavaOne 2025, or specifically for the Java 24 release (or 25 WIP), or even maybe a Devoxx video. I spent 15 minutes poking around but could not find it, sorry.&lt;/p&gt;</comment>
                            <comment id="17952288" author="tupari" created="Fri, 16 May 2025 21:09:56 +0000"  >&lt;p&gt;Found it: &lt;a href=&quot;https://openjdk.org/jeps/491&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://openjdk.org/jeps/491&lt;/a&gt;, which is included in Java 24.  Of course the problem for library authors is that since they have to support Java versions 21-23 they&apos;ll still have to get rid of their synchronized usages until Java 21 is EOL.&lt;/p&gt;</comment>
                    </comments>
                    <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            25 weeks ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z1votk:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>