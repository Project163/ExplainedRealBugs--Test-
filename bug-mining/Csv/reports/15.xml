<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:42:52 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-58] Unescape handling needs rethinking</title>
                <link>https://issues.apache.org/jira/browse/CSV-58</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;The current escape parsing converts &amp;lt;esc&amp;gt;&amp;lt;char&amp;gt; to plain &amp;lt;char&amp;gt; if the &amp;lt;char&amp;gt; is not one of the special characters to be escaped.&lt;/p&gt;

&lt;p&gt;This can affect unicode escapes if the &amp;lt;esc&amp;gt; character is backslash.&lt;/p&gt;

&lt;p&gt;One way round this is to specifically check for &amp;lt;char&amp;gt; == &apos;u&apos;, but it seems wrong to only do this for &apos;u&apos;.&lt;/p&gt;

&lt;p&gt;Another solution would be to leave &amp;lt;esc&amp;gt;&amp;lt;char&amp;gt; as is unless the &amp;lt;char&amp;gt; is one of the special characters.&lt;/p&gt;

&lt;p&gt;There are several possible ways to treat unrecognised escapes:&lt;/p&gt;
&lt;ul class=&quot;alternate&quot; type=&quot;square&quot;&gt;
	&lt;li&gt;treat it as if the escape char had not been present (current behaviour)&lt;/li&gt;
	&lt;li&gt;leave the escape char as is&lt;/li&gt;
	&lt;li&gt;throw an exception&lt;/li&gt;
&lt;/ul&gt;
</description>
                <environment></environment>
        <key id="12546408">CSV-58</key>
            <summary>Unescape handling needs rethinking</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="1" iconUrl="https://issues.apache.org/jira/images/icons/statuses/open.png" description="The issue is open and ready for the assignee to start work on it.">Open</status>
                    <statusCategory id="2" key="new" colorName="blue-gray"/>
                                    <resolution id="-1">Unresolved</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="sebb">Sebb</reporter>
                        <labels>
                    </labels>
                <created>Wed, 14 Mar 2012 15:37:25 +0000</created>
                <updated>Thu, 10 Jul 2014 19:43:03 +0000</updated>
                                                            <fixVersion>Patch Needed</fixVersion>
                    <fixVersion>1.x</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                                                                                <comments>
                            <comment id="13229365" author="ebourg" created="Wed, 14 Mar 2012 17:10:54 +0000"  >&lt;p&gt;Are you sure? The unicode escape sequences are transformed before reaching the parser.&lt;/p&gt;</comment>
                            <comment id="13229415" author="sebb@apache.org" created="Wed, 14 Mar 2012 17:39:42 +0000"  >&lt;p&gt;If unicode parsing is not selected, the unicode sequences lose their escape character so cannot then be parsed later.&lt;/p&gt;

&lt;p&gt;This is really about more than just unicode escape sequences, though that is what alerted me to the issue.&lt;/p&gt;

&lt;p&gt;The whole business of escape handling needs to be very carefully documented (and tested!) to ensure predictable behaviour.&lt;/p&gt;</comment>
                            <comment id="13229762" author="ebourg" created="Wed, 14 Mar 2012 23:39:03 +0000"  >&lt;p&gt;Understood. The whole escaping logic is dubious, there are a lot of corner cases. I&apos;m trying to understand who actually use unicode and control character escapes in CSV files. It seems at least HSQLDB accept them when reading, but prefers using quotes when writing.&lt;/p&gt;</comment>
                            <comment id="13231924" author="sebb@apache.org" created="Sat, 17 Mar 2012 11:30:52 +0000"  >&lt;p&gt;I think the default should be to retain the original source characters if the escape sequence is not recognised.&lt;br/&gt;
This will allow the application to take further action if necessary.&lt;/p&gt;

&lt;p&gt;Failing that, throw an exception. Silently dropping the escape character seems the worst choice as the default.&lt;/p&gt;

&lt;p&gt;There&apos;s also the issue of what meta-characters should be de-escaped.&lt;br/&gt;
It seems reasonable to include the encapsulator and CR, LF, possibly also the delimiter.&lt;/p&gt;

&lt;p&gt;But should any escapes - apart from the encapsulator itself - be processed in an encapsulated token?&lt;br/&gt;
There&apos;s no need to do so.&lt;/p&gt;

&lt;p&gt;Maybe escape handling should be overrideable by the user.&lt;/p&gt;</comment>
                            <comment id="13401180" author="anirudha13" created="Tue, 26 Jun 2012 05:24:06 +0000"  >&lt;p&gt;I came across a concrete use case for rethinking the escape handling in Commons CSV. MySQL out format represents NULL as \N. This is a special character that should be retained as is. In this regard, I have made an attempt to modify the escape handling in the Commons CSV parser. I have not made corresponding changes to CSV writer and will submit a patch in that regards soon to. Looking forward to thoughts.&lt;/p&gt;</comment>
                            <comment id="13401182" author="anirudha13" created="Tue, 26 Jun 2012 05:26:47 +0000"  >&lt;p&gt;Patch consisting of changes to expand escape handling in CSV Parser&lt;/p&gt;</comment>
                            <comment id="13611681" author="britter" created="Sat, 23 Mar 2013 11:47:35 +0000"  >&lt;p&gt;I agree with Sebb. If we find an escape character we should only change the content of the token being parsed, if there is a special character (defined by the CSVFormat) that needs escaping. Otherwise we should let the character sequence unchanged.&lt;/p&gt;

&lt;p&gt;Anirudha, I&apos;m having troubles appling your patch. It seem&apos;s to contain a lot of white space changes. Please try to create diffs only for lines that are actually affected &lt;img class=&quot;emoticon&quot; src=&quot;https://issues.apache.org/jira/images/icons/emoticons/smile.png&quot; height=&quot;16&quot; width=&quot;16&quot; align=&quot;absmiddle&quot; alt=&quot;&quot; border=&quot;0&quot;/&gt;&lt;br/&gt;
I have only looked thourgh the diff file. It looks like you are defining an additional collection of escape characters. I don&apos;t understand this. IIUC it is sufficient to tweak the Lexer so that is just doesn&apos;t remove escape characters if nothing follows that has to be escaped.&lt;/p&gt;</comment>
                            <comment id="13611686" author="britter" created="Sat, 23 Mar 2013 12:08:01 +0000"  >&lt;p&gt;I have attached a new test for CSVLexer that shows how the handling of escapes could work.&lt;/p&gt;

&lt;p&gt;EDIT: got a bit confused with the escape handling, so removing my patch.&lt;/p&gt;</comment>
                            <comment id="13611715" author="britter" created="Sat, 23 Mar 2013 13:20:00 +0000"  >&lt;p&gt;I just got aware of another problem. If one escapes a simple character that can also be part of a special character, this sequence will be replaced by the special character. So the following will fail:&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;@Test
&lt;span class=&quot;code-keyword&quot;&gt;public&lt;/span&gt; void testEscaping2() &lt;span class=&quot;code-keyword&quot;&gt;throws&lt;/span&gt; Exception {
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; &lt;span class=&quot;code-object&quot;&gt;String&lt;/span&gt; code = &lt;span class=&quot;code-quote&quot;&gt;&quot;plain,&quot;&lt;/span&gt; +
            &lt;span class=&quot;code-quote&quot;&gt;&quot;character!rEscaped&quot;&lt;/span&gt;;
    &lt;span class=&quot;code-keyword&quot;&gt;final&lt;/span&gt; Lexer lexer = getLexer(code, CSVFormat.newBuilder().withEscape(&lt;span class=&quot;code-quote&quot;&gt;&apos;!&apos;&lt;/span&gt;).build());
    assertTokenEquals(TOKEN, &lt;span class=&quot;code-quote&quot;&gt;&quot;plain&quot;&lt;/span&gt;, lexer.nextToken(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Token()));
    assertTokenEquals(EOF, &lt;span class=&quot;code-quote&quot;&gt;&quot;character!rEscaped&quot;&lt;/span&gt;, lexer.nextToken(&lt;span class=&quot;code-keyword&quot;&gt;new&lt;/span&gt; Token()));
}
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Reason:&lt;/p&gt;
&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;org.junit.ComparisonFailure: Token content expected:&amp;lt;character[!r]Escaped&amp;gt; but was:&amp;lt;character[
]Escaped&amp;gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;</comment>
                            <comment id="13648084" author="sebb@apache.org" created="Fri, 3 May 2013 01:08:45 +0000"  >&lt;p&gt;That test is wrong: if the escape char is !, then !r should be converted to CR just as \r is converted to CR when the escape char is \.&lt;/p&gt;</comment>
                            <comment id="13648088" author="sebb@apache.org" created="Fri, 3 May 2013 01:14:09 +0000"  >&lt;p&gt;URL: &lt;a href=&quot;http://svn.apache.org/r1478621&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;http://svn.apache.org/r1478621&lt;/a&gt;&lt;br/&gt;
Log:&lt;br/&gt;
&lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-58&quot; title=&quot;Unescape handling needs rethinking&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-58&quot;&gt;CSV-58&lt;/a&gt; Unescape handling needs rethinking&lt;br/&gt;
Fixed up most issues.&lt;br/&gt;
TODO should TAB, FF and BACKSPACE be un/escaped?&lt;/p&gt;

&lt;p&gt;Modified:&lt;br/&gt;
    commons/proper/csv/trunk/src/main/java/org/apache/commons/csv/CSVLexer.java&lt;br/&gt;
    commons/proper/csv/trunk/src/main/java/org/apache/commons/csv/Lexer.java&lt;br/&gt;
    commons/proper/csv/trunk/src/test/java/org/apache/commons/csv/CSVLexerTest.java&lt;/p&gt;</comment>
                            <comment id="13648094" author="sebb@apache.org" created="Fri, 3 May 2013 01:23:37 +0000"  >&lt;p&gt;Note: the code now leaves invalid escape sequences unchanged, which is a better default than just dropping the escape character.&lt;/p&gt;</comment>
                            <comment id="13726347" author="britter" created="Thu, 1 Aug 2013 11:18:01 +0000"  >&lt;p&gt;What about TAB FF and BACKSPACE? Do we want to change parsing behavior or can we just open a new issue for 1.x to think about it again?&lt;/p&gt;</comment>
                            <comment id="13726410" author="sebb@apache.org" created="Thu, 1 Aug 2013 13:03:18 +0000"  >&lt;p&gt;If the behaviour is symmetric, I think we can leave it as it is for now.&lt;/p&gt;

&lt;p&gt;By symmetric, I mean that if the format escapes TAB FF and BACKSPACE it should unescape them as well.&lt;br/&gt;
Also if the format does not escape them, then they should not be unescaped either.&lt;/p&gt;</comment>
                            <comment id="13728513" author="britter" created="Sat, 3 Aug 2013 11:14:24 +0000"  >&lt;p&gt;Hm, I&apos;m not sure I&apos;m getting what you mean...&lt;br/&gt;
I&apos;ve added some more tests to CSVLexerTest to document the current behavior. Can you comment on this?&lt;/p&gt;</comment>
                            <comment id="13728516" author="sebb@apache.org" created="Sat, 3 Aug 2013 12:01:24 +0000"  >&lt;p&gt;Those tests only check the unescaping, i.e. the parsing.&lt;/p&gt;

&lt;p&gt;What happens when the same format is used to create a new record?&lt;/p&gt;

&lt;p&gt;The format should be symmetric, i.e. it should be able to do round-trip conversion.&lt;/p&gt;</comment>
                            <comment id="14034470" author="sebb@apache.org" created="Tue, 17 Jun 2014 22:13:21 +0000"  >&lt;p&gt;I now think that only meta-characters (and the record-separator) should be unescaped, because only meta-characters need to be unescaped on output. All other escapes should be left as-is, and should be handled separately (probably by the application).&lt;/p&gt;

&lt;p&gt;However, this may cause some issues with multi-char record separators - needs further investigation.&lt;br/&gt;
More complications may occur if the RS can be specified as a list of strings.&lt;br/&gt;
It may be necessary to restrict the RS to a single string.&lt;/p&gt;</comment>
                            <comment id="14057848" author="britter" created="Thu, 10 Jul 2014 19:43:03 +0000"  >&lt;p&gt;Moved to 1.x&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                                                <inwardlinks description="is related to">
                                        <issuelink>
            <issuekey id="12546116">CSV-56</issuekey>
        </issuelink>
                            </inwardlinks>
                                    </issuelinktype>
                    </issuelinks>
                <attachments>
                            <attachment id="12533439" name="commons-csv.diff" size="35985" author="anirudha13" created="Tue, 26 Jun 2012 05:26:47 +0000"/>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>1.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>231566</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            11 years, 19 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|i0au6v:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>61164</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>