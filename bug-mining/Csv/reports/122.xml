<!-- 
RSS generated by JIRA (8.20.10#820010-sha1:ace47f9899e9ee25d7157d59aa17ab06aee30d3d) at Sat Nov 08 17:44:11 UTC 2025

It is possible to restrict the fields that are returned in this document by specifying the 'field' parameter in your request.
For example, to request only the issue key and summary append 'field=key&field=summary' to the URL of your request.
-->
<rss version="0.92" >
<channel>
    <title>ASF JIRA</title>
    <link>https://issues.apache.org/jira</link>
    <description>This file is an XML representation of an issue</description>
    <language>en-uk</language>    <build-info>
        <version>8.20.10</version>
        <build-number>820010</build-number>
        <build-date>22-06-2022</build-date>
    </build-info>


<item>
            <title>[CSV-264] Duplicate empty header names are allowed even with `.withAllowDuplicateHeaderNames(false)`</title>
                <link>https://issues.apache.org/jira/browse/CSV-264</link>
                <project id="12313222" key="CSV">Commons CSV</project>
                    <description>&lt;p&gt;I&apos;m trying to parse to parse a csv like this:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;CSVFormat.DEFAULT&lt;/tt&gt;&lt;br/&gt;
{{ .withHeader()}}&lt;br/&gt;
{{ .withAllowDuplicateHeaderNames(false)}}&lt;br/&gt;
{{ .withAllowMissingColumnNames()}}&lt;br/&gt;
{{ .parse(InputStreamReader(FileInputStream(fl)))}}&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;One would expect this code to throw an error if the following csv is given as input:&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&quot;&quot;,&quot;a&quot;,&quot;&quot;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&quot;1&quot;,&quot;X&quot;,&quot;3&quot;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&lt;tt&gt;&quot;3&quot;,&quot;Y&quot;,&quot;4&quot;&lt;/tt&gt;&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;

&lt;p&gt;But it doesn&apos;t, and asking for `record.get(&quot;&quot;)` gives the value from the second column. The first column is ignored.&lt;/p&gt;</description>
                <environment></environment>
        <key id="13321978">CSV-264</key>
            <summary>Duplicate empty header names are allowed even with `.withAllowDuplicateHeaderNames(false)`</summary>
                <type id="1" iconUrl="https://issues.apache.org/jira/secure/viewavatar?size=xsmall&amp;avatarId=21133&amp;avatarType=issuetype">Bug</type>
                                            <priority id="3" iconUrl="https://issues.apache.org/jira/images/icons/priorities/major.svg">Major</priority>
                        <status id="5" iconUrl="https://issues.apache.org/jira/images/icons/statuses/resolved.png" description="A resolution has been taken, and it is awaiting verification by reporter. From here issues are either reopened, or are closed.">Resolved</status>
                    <statusCategory id="3" key="done" colorName="green"/>
                                    <resolution id="1">Fixed</resolution>
                                        <assignee username="-1">Unassigned</assignee>
                                    <reporter username="fctorial">Sagar Tiwari</reporter>
                        <labels>
                    </labels>
                <created>Tue, 11 Aug 2020 10:16:02 +0000</created>
                <updated>Fri, 28 Oct 2022 12:48:26 +0000</updated>
                            <resolved>Sat, 19 Feb 2022 17:13:57 +0000</resolved>
                                    <version>1.8</version>
                                    <fixVersion>1.10.0</fixVersion>
                                    <component>Parser</component>
                        <due></due>
                            <votes>0</votes>
                                    <watches>3</watches>
                                                    <progress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </progress>
                                    <aggregateprogress percentage="100">
                                    <originalProgress>
                                                    <row percentage="0" backgroundColor="#89afd7"/>
                                                    <row percentage="100" backgroundColor="transparent"/>
                                            </originalProgress>
                                                    <currentProgress>
                                                    <row percentage="100" backgroundColor="#51a825"/>
                                                    <row percentage="0" backgroundColor="#ec8e00"/>
                                            </currentProgress>
                            </aggregateprogress>
                                            <timeestimate seconds="0">0h</timeestimate>
                            <timespent seconds="16200">4.5h</timespent>
                                <comments>
                            <comment id="17206389" author="sethi" created="Fri, 2 Oct 2020 18:17:00 +0000"  >&lt;p&gt;It looks to me like this is intentional. &lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;https://github.com/apache/commons-csv/blob/master/src/main/java/org/apache/commons/csv/CSVParser.java#L506&quot; class=&quot;external-link&quot; target=&quot;_blank&quot; rel=&quot;nofollow noopener&quot;&gt;https://github.com/apache/commons-csv/blob/master/src/main/java/org/apache/commons/csv/CSVParser.java#L506&lt;/a&gt;&lt;/p&gt;

&lt;div class=&quot;code panel&quot; style=&quot;border-width: 1px;&quot;&gt;&lt;div class=&quot;codeContent panelContent&quot;&gt;
&lt;pre class=&quot;code-java&quot;&gt;
&lt;span class=&quot;code-comment&quot;&gt;// Note: This will always allow a duplicate header &lt;span class=&quot;code-keyword&quot;&gt;if&lt;/span&gt; the header is empty&lt;/span&gt;
&lt;/pre&gt;
&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A possible reason for this could be the following:&lt;/p&gt;

&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;A&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;B&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;&amp;nbsp;&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;C&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;D&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;1&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;2&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&amp;nbsp;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;3&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;4&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;I don&apos;t think it would be user-friendly to make this a failure, but it has duplicate column names if we consider the empty headers which are left for formatting. Granted I do think it&apos;d be silly essentially store a bunch of empty cells as well.&lt;/p&gt;

&lt;p&gt;&amp;#8212;&lt;/p&gt;

&lt;p&gt;I can think of a couple of ways this issue could be solved:&lt;/p&gt;
&lt;ol&gt;
	&lt;li&gt;Simply count empty header names towards duplicates, but documents like above that use gaps for formatting purposes will have to enable withAllowDuplicateHeaderNames, I don&apos;t think this is ideal.&lt;/li&gt;
	&lt;li&gt;Check the entire column when parsing the document, and if it contains values in a non-header row, then it counts towards the duplicate. This would avoid empty headers because for formatting, but this sounds like it could get heavy, though.&lt;/li&gt;
	&lt;li&gt;Create a new option which allows empty duplicates, but I don&apos;t think this option makes much sense as it&apos;s too similar and conflicts with withAllowDuplicateHeaderNames.&lt;/li&gt;
	&lt;li&gt;Change the withAllowDuplicateHeaderNames boolean to a withDuplicateHeaderRule enum with the values &quot;ALLOW_ALL_DUPLICATES&quot;, &quot;ALLOW_EMPTY_DUPLICATES&quot;, &quot;DISALLOW_DUPLICATES&quot;.&lt;/li&gt;
&lt;/ol&gt;


&lt;p&gt;I was going to PR #1, but I don&apos;t think it&apos;s a good solution.&lt;/p&gt;

&lt;p&gt;If a maintainer could say what they think of this, I&apos;d gladly try to submit the patch for it. I&apos;m just unsure on the ideal solution, or if this is considered a non-issue. &lt;/p&gt;

</comment>
                            <comment id="17495011" author="garydgregory" created="Sat, 19 Feb 2022 17:13:57 +0000"  >&lt;p&gt;In git master, please verify and close.&lt;/p&gt;</comment>
                            <comment id="17625598" author="alexherbert" created="Fri, 28 Oct 2022 10:51:28 +0000"  >&lt;p&gt;Some inconsistency between the handling of duplicate headers between the CSVFormat and CSVParser has been corrected in git master. The CSVParser uses more settings to control validation. Validation is less strict in the CSVFormat as the settings are used for both parsing and writing data.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;CSVParser&quot;&gt;&lt;/a&gt;CSVParser&lt;/h2&gt;

&lt;p&gt;The CSVFormat has a flag &lt;tt&gt;allowMissingColumnNames&lt;/tt&gt;. This is only used by the CSVParser. If this is false then any column header that is null, the empty string &quot;&quot;, or a whitespace string (blank) is identified as &quot;missing&quot; and an exception raised if the flag is false. Thus missing column names have historically been defined as any null or blank string in previous release versions. Note that in the CSVParser this behaviour occurs irrespective of the DuplicateHeaderMode. To activate DuplicateHeaderMode.ALLOW_EMPTY for parsing requires setting &lt;tt&gt;allowMissingColumnNames=true&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;If allow duplicates is set to DISALLOW then any duplicate header will raise an exception. In the case of &quot;missing&quot; headers all variations of &quot;missing&quot; are considered the same. Thus an exception can be raised for null and &quot;&quot; as these are considered the same header for the purpose of duplicate checks.&lt;/p&gt;

&lt;p&gt;If allow duplicates is set to ALLOW_EMPTY then any missing header will be allowed. This allows whitespace headers to be used to pad columns for formatting purposes. A side effect is a possible many-to-one mapping created by the CSVParser header map as multiple empty headers using the same string (e.g. &quot;&quot;) will map to the last column in the input with this empty header. This is noted in the method javadoc for CSVParser.getHeaderMap().&lt;/p&gt;

&lt;p&gt;The CSVFormat has a flag &lt;tt&gt;ignoreHeaderCase&lt;/tt&gt;. This is only used by the CSVParser. A header of &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;A&amp;quot;, &amp;quot;a&amp;quot;&amp;#93;&lt;/span&gt; with &lt;tt&gt;ignoreHeaderCase=true&lt;/tt&gt; and &lt;tt&gt;duplicateHeaderMode=DISALLOW&lt;/tt&gt; will raise an exception in the CSVParser.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;CSVFormat&quot;&gt;&lt;/a&gt;CSVFormat&lt;/h2&gt;

&lt;p&gt;The CSVFormat validation is less strict than the CSVParser. It does not use the values for the flags &lt;tt&gt;allowMissingColumnNames&lt;/tt&gt; or &lt;tt&gt;ignoreHeaderCase&lt;/tt&gt;. The validation behaviour of CSVFormat matches that of CSVParser when &lt;tt&gt;allowMissingColumnNames=true and ignoreHeaderCase=false&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;A header of &lt;span class=&quot;error&quot;&gt;&amp;#91;&amp;quot;A&amp;quot;, &amp;quot;a&amp;quot;&amp;#93;&lt;/span&gt; with &lt;tt&gt;ignoreHeaderCase=true&lt;/tt&gt; and &lt;tt&gt;duplicateHeaderMode=DISALLOW&lt;/tt&gt; will not raise an exception in the CSVFormat.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;BehaviouralCompatibility&quot;&gt;&lt;/a&gt;Behavioural Compatibility&lt;/h2&gt;

&lt;p&gt;The &lt;tt&gt;DuplicateHeaderMode&lt;/tt&gt; enum replaces the flag &lt;tt&gt;allowDuplicateHeaders&lt;/tt&gt;. For behavioural compatibility &lt;tt&gt;allowDuplicateHeaders=false&lt;/tt&gt; will still allow duplicate empty headers:&lt;/p&gt;
&lt;div class=&apos;table-wrap&apos;&gt;
&lt;table class=&apos;confluenceTable&apos;&gt;&lt;tbody&gt;
&lt;tr&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;allowDuplicateHeaders (deprecated)&lt;/th&gt;
&lt;th class=&apos;confluenceTh&apos;&gt;DuplicateHeaderMode&lt;/th&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;true&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ALLOW_ALL&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;false&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;ALLOW_EMPTY&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;&#160;&lt;/td&gt;
&lt;td class=&apos;confluenceTd&apos;&gt;DISALLOW&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;/div&gt;


&lt;p&gt;This behaviour to allow duplicate empty headers dates back to CSV v1.0. To control empty headers the flag &lt;tt&gt;ignoreEmptyHeaders&lt;/tt&gt; was added at the same time (see &lt;a href=&quot;https://issues.apache.org/jira/browse/CSV-121&quot; title=&quot;IllegalArgumentException thrown when the header contains duplicate names when the column names are empty.&quot; class=&quot;issue-link&quot; data-issue-key=&quot;CSV-121&quot;&gt;&lt;del&gt;CSV-121&lt;/del&gt;&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;Supporting this legacy behaviour means that CSVFormat validation, which does not use the &lt;tt&gt;ignoreEmptyHeaders&lt;/tt&gt; flag, must use &lt;tt&gt;DuplicateHeaderMode.DISALLOW&lt;/tt&gt; instead of &lt;tt&gt;allowDuplicateHeaders=false&lt;/tt&gt; to check for duplicate empty headers. Validation of any missing headers is not currently possible in CSVFormat.&lt;/p&gt;
&lt;h2&gt;&lt;a name=&quot;Summary&quot;&gt;&lt;/a&gt;Summary&lt;/h2&gt;
&lt;ul&gt;
	&lt;li&gt;Missing column headers are any of: null; &quot;&quot;; or blank strings.&lt;/li&gt;
	&lt;li&gt;All missing column headers are considered the same for duplicate checks&lt;/li&gt;
	&lt;li&gt;CSVParser must enable &lt;tt&gt;allowMissingColumnNames&lt;/tt&gt; to be able to use the &lt;tt&gt;DuplicateHeaderMode.ALLOW_EMPTY&lt;/tt&gt; behaviour.&lt;/li&gt;
	&lt;li&gt;CSVParser respects&#160; the &lt;tt&gt;ignoreHeaderCase&lt;/tt&gt; flag when checking for duplicates.&lt;/li&gt;
&lt;/ul&gt;


&lt;p&gt;All current behaviour is tested in &lt;tt&gt;CSVDuplicateHeaderTest&lt;/tt&gt;.&lt;/p&gt;

&lt;p&gt;&#160;&lt;/p&gt;</comment>
                    </comments>
                <issuelinks>
                            <issuelinktype id="10030">
                    <name>Reference</name>
                                            <outwardlinks description="relates to">
                                        <issuelink>
            <issuekey id="13477641">CSV-302</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                            <issuelinktype id="12310051">
                    <name>Supercedes</name>
                                            <outwardlinks description="supercedes">
                                        <issuelink>
            <issuekey id="13212912">CSV-236</issuekey>
        </issuelink>
                            </outwardlinks>
                                                        </issuelinktype>
                    </issuelinks>
                <attachments>
                    </attachments>
                <subtasks>
                    </subtasks>
                <customfields>
                                                                            <customfield id="customfield_12310310" key="com.atlassian.jira.toolkit:attachments">
                        <customfieldname>Attachment count</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0.0</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        <customfield id="customfield_12314020" key="com.atlassian.jira.plugins.jira-development-integration-plugin:devsummary">
                        <customfieldname>Development</customfieldname>
                        <customfieldvalues>
                            
                        </customfieldvalues>
                    </customfield>
                                                                                                                        <customfield id="customfield_12313422" key="com.atlassian.jirafisheyeplugin:jobcheckbox">
                        <customfieldname>Enable Automatic Patch Review</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue><![CDATA[false]]></customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                <customfield id="customfield_12310420" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Global Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                        <customfield id="customfield_12312521" key="com.atlassian.jira.toolkit:LastCommentDate">
                        <customfieldname>Last public comment date</customfieldname>
                        <customfieldvalues>
                            3 years, 2 weeks, 1 day ago
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                <customfield id="customfield_12311820" key="com.pyxis.greenhopper.jira:gh-lexo-rank">
                        <customfieldname>Rank</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>0|z0hnag:</customfieldvalue>

                        </customfieldvalues>
                    </customfield>
                                                                <customfield id="customfield_12310920" key="com.pyxis.greenhopper.jira:gh-global-rank">
                        <customfieldname>Rank (Obsolete)</customfieldname>
                        <customfieldvalues>
                            <customfieldvalue>9223372036854775807</customfieldvalue>
                        </customfieldvalues>
                    </customfield>
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            </customfields>
    </item>
</channel>
</rss>