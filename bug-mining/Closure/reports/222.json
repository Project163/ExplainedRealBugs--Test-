{"id":777,"status":"Fixed","summary":"closure-compiler breaks js code","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":4,"comments":[{"id":0,"commenterId":-8445718534107208055,"content":"I have js function:\r\n{{{\r\nfunction __Z25ShowSelectStationIfNeeded16CommandContainer8TileArea($cmd, $ta) {\r\n    var tempParam$s2;\r\n    var __stackBase__ \u003d STACKTOP;\r\n    STACKTOP +\u003d 8;\r\n    var tempParam \u003d $cmd, tempParam$s2 \u003d tempParam \u0026gt;\u0026gt; 2;\r\n    $cmd \u003d STACKTOP;\r\n    STACKTOP +\u003d 148;\r\n    for (var $$src \u003d tempParam$s2, $$dest \u003d $cmd \u0026gt;\u0026gt; 2, $$stop \u003d $$src + 37; $$src \u0026lt; $$stop; $$src++, $$dest++) {\r\n\tHEAP32[$$dest] \u003d HEAP32[$$src];\r\n    }\r\n    var tempParam \u003d $ta, tempParam$s2 \u003d tempParam \u0026gt;\u0026gt; 2;\r\n    $ta \u003d STACKTOP;\r\n    STACKTOP +\u003d 8;\r\n    HEAP32[$ta \u0026gt;\u0026gt; 2] \u003d HEAP32[tempParam$s2];\r\n    HEAP32[$ta + 4 \u0026gt;\u0026gt; 2] \u003d HEAP32[tempParam$s2 + 1];\r\n    var $1 \u003d __stackBase__;\r\n    var $2 \u003d $ta;\r\n    var $3 \u003d $1;\r\n    var $4$0 \u003d HEAP32[$2 \u0026gt;\u0026gt; 2];\r\n    var $4$1 \u003d HEAP32[$2 + 4 \u0026gt;\u0026gt; 2];\r\n    HEAP32[$3 \u0026gt;\u0026gt; 2] \u003d $4$0;\r\n    HEAP32[$3 + 4 \u0026gt;\u0026gt; 2] \u003d $4$1;\r\n//    __Z29ShowSelectBaseStationIfNeededI7StationEv16CommandContainer8TileArea($cmd, $1);\r\n    STACKTOP \u003d __stackBase__;\r\n    return;\r\n    return;\r\n}\r\n}}}\r\nAnd after closure it is look like:\r\n{{{\r\nfunction __Z25ShowSelectStationIfNeeded16CommandContainer8TileArea(d, b) {\r\n  var a, e \u003d STACKTOP, d \u003d STACKTOP +\u003d 8;\r\n  STACKTOP +\u003d 148;\r\n  a \u003d d \u0026gt;\u0026gt; 2;\r\n  for(var c \u003d d \u0026gt;\u0026gt; 2, f \u003d a + 37;a \u0026lt; f;a++, c++) {\r\n    HEAP32[c] \u003d HEAP32[a]\r\n  }\r\n  a \u003d b \u0026gt;\u0026gt; 2;\r\n  b \u003d STACKTOP;\r\n  STACKTOP +\u003d 8;\r\n  HEAP32[b \u0026gt;\u0026gt; 2] \u003d HEAP32[a];\r\n  HEAP32[b + 4 \u0026gt;\u0026gt; 2] \u003d HEAP32[a + 1];\r\n  a \u003d b;\r\n  c \u003d HEAP32[a + 4 \u0026gt;\u0026gt; 2];\r\n  HEAP32[e \u0026gt;\u0026gt; 2] \u003d HEAP32[a \u0026gt;\u0026gt; 2];\r\n  HEAP32[e + 4 \u0026gt;\u0026gt; 2] \u003d c;\r\n  STACKTOP \u003d e\r\n}\r\n}}}\r\n\r\nLook at $$src variable in source js. It initial value is $cmd \u0026gt;\u0026gt; 2. But after closure it initial value is (STACKTOP + 8) \u0026gt;\u0026gt; 2. Looks like closure is not respect order of assignment variables.","timestamp":1342368939,"attachments":[{"id":7770000000,"fileName":"test.js","fileSize":935},{"id":7770000001,"fileName":"test-c.js","fileSize":461}]},{"id":1,"commenterId":-8445718534107208055,"content":"I run closure with command:\r\njava -Xmx1024m -jar compiler.jar --compilation_level SIMPLE_OPTIMIZATIONS --formatting PRETTY_PRINT --js test.js --js_output_file test-c.js","timestamp":1342456816,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"thanks for the report. I can repro as well.","timestamp":1342540289,"attachments":[]},{"id":3,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r2093.","timestamp":1342736092,"attachments":[]}]}