{"id":166,"status":"Fixed","summary":"re-defining exception parameter in catch block throws runtime exception","labels":["Type-Defect","Priority-Medium"],"stars":1,"commentCount":6,"comments":[{"id":0,"commenterId":-7267556781732960606,"content":"We were attempting to compile some external libraries and came across this issue, it\u0027s bad \r\njavascript and easily fixed, but here\u0027s a reduced version of the js that triggers the error if it\u0027s \r\nsomething you guys are interested in fixing:\r\n\r\n\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n\r\n1. compile this code at simple or advanced level: (http://gist.github.com/416406)\r\nfoo \u003d function() {\r\n  try{\r\n    var a \u003d 0;\r\n  }catch(e){\r\n    var e \u003d 1;\r\n  }\r\n};\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\njava.lang.RuntimeException: java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\n\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\ncurrent version up on http://closure-compiler.appspot.com/home and the version I downloaded \r\ntoday (5/27/10) can\u0027t find a version number)\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\nIf you simply reassign the parameter it works fine.\r\n","timestamp":1274997952,"attachments":[]},{"id":1,"commenterId":-5060162230523776870,"content":"Here is the relevant portion of the stack trace:\r\n\r\n23: java.lang.RuntimeException: INTERNAL COMPILER ERROR.\r\nPlease report this problem.\r\nnull\r\n  Node(FUNCTION ): Input_0:1:14\r\nfoo \u003d function() {\r\n  Parent(ASSIGN): Input_0:1:4\r\nfoo \u003d function() {\r\n\r\n\tat com.google.common.base.Preconditions.checkState(Preconditions.java:131)\r\n\tat\r\ncom.google.javascript.jscomp.Normalize$DuplicateDeclarationHandler.onRedeclaration(Normalize.java:549)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.declareVar(SyntacticScopeCreator.java:246)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:129)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:171)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:157)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:171)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:171)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanVars(SyntacticScopeCreator.java:171)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.scanRoot(SyntacticScopeCreator.java:108)\r\n\tat\r\ncom.google.javascript.jscomp.SyntacticScopeCreator.createScope(SyntacticScopeCreator.java:76)\r\n\tat com.google.javascript.jscomp.NodeTraversal.getScope(NodeTraversal.java:576)\r\n\tat\r\ncom.google.javascript.jscomp.Normalize$ScopeTicklingCallback.enterScope(Normalize.java:621)\r\n\tat com.google.javascript.jscomp.NodeTraversal.pushScope(NodeTraversal.java:540)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseFunction(NodeTraversal.java:498)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:462)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:470)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:470)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:470)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:470)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverse(NodeTraversal.java:253)\r\n\tat\r\ncom.google.javascript.jscomp.Normalize.removeDuplicateDeclarations(Normalize.java:529)\r\n\tat com.google.javascript.jscomp.Normalize.process(Normalize.java:103)\r\n\tat com.google.javascript.jscomp.Compiler.process(Compiler.java:712)\r\n\tat com.google.javascript.jscomp.Compiler.normalize(Compiler.java:1475)\r\n\tat com.google.javascript.jscomp.Compiler.optimize(Compiler.java:1421)\r\n\tat com.google.javascript.jscomp.Compiler.compileInternal(Compiler.java:605)","timestamp":1275091028,"attachments":[]},{"id":2,"commenterId":1948758734812428220,"content":"Something has to do with name normalization. Mind taking a look, John?","timestamp":1275136881,"attachments":[]},{"id":3,"commenterId":-5060162230523776870,"content":"This is a bit tricky as our scope modeling cheats a bit on catch expression modeling,\r\nat the very least we would need to report a \"we don\u0027t support this error\".  But I\u0027ll\r\nsee if I can fix it first.","timestamp":1275407509,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r237.","timestamp":1275487840,"attachments":[]},{"id":5,"commenterId":-5060162230523776870,"content":"I had to go with the \"we don\u0027t support this\" error message (specifically \"The use of\r\nscope variable {0} is not allowed within a catch block with a catch exception of the\r\nsame name.\").  More details are available in the source code.","timestamp":1275490469,"attachments":[]}]}