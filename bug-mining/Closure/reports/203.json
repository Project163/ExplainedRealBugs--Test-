{"id":718,"status":"Fixed","summary":"Using --charset \u0027utf-8\u0027, \\u2028 and \\u2029 are not escaped.","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":11,"comments":[{"id":0,"commenterId":1442667876655034575,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n1. echo \u0027alert(\u0026quot;\\u2028\\u2029\u0026quot;)\u0027 | java -jar compiler.jar --charset \u0027utf-8\u0027\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\nI expect `alert(\u0026quot;\\u2028\\u2029\u0026quot;)`, but instead I get `alert(\u0026quot;  \u0026quot;)` (a literal \\u2028 and \\u2029 character).\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\nbrad:~/Downloads$ java -jar compiler.jar --version\r\nClosure Compiler (http://code.google.com/closure/compiler)\r\nVersion: 20120430 (revision 1918)\r\nBuilt on: 2012/04/30 18:02","timestamp":1335957736,"attachments":[]},{"id":1,"commenterId":1442667876655034575,"content":"brad:~/Downloads$ java -version\r\njava version \"1.6.0_31\"\r\nJava(TM) SE Runtime Environment (build 1.6.0_31-b04-415-11M3635)\r\nJava HotSpot(TM) 64-Bit Server VM (build 20.6-b01-415, mixed mode)\r\n\r\nUsing OSX 10.7.3","timestamp":1335957805,"attachments":[]},{"id":2,"commenterId":1442667876655034575,"content":"Note:  This is only with --charset \u0027utf-8\u0027 and does not manifest when not using that flag.","timestamp":1335957882,"attachments":[]},{"id":3,"commenterId":1442667876655034575,"content":"Proposed fix:\r\n\r\n\r\ndiff --git a/src/com/google/javascript/jscomp/CodeGenerator.java b/src/com/google/javascript/jscomp/CodeGenerator.java\r\nindex 4143577..49699b0 100644\r\n--- a/src/com/google/javascript/jscomp/CodeGenerator.java\r\n+++ b/src/com/google/javascript/jscomp/CodeGenerator.java\r\n@@ -1019,6 +1019,8 @@ class CodeGenerator {\r\n         case \u0027\\\\\u0027: sb.append(backslashEscape); break;\r\n         case \u0027\\\"\u0027: sb.append(doublequoteEscape); break;\r\n         case \u0027\\\u0027\u0027: sb.append(singlequoteEscape); break;\r\n+        case \u0027\\u2028\u0027: sb.append(\"\\\\u2028\"); break;\r\n+        case \u0027\\u2029\u0027: sb.append(\"\\\\u2029\"); break;\r\n         case \u0027\u003e\u0027:                       // Break --\u003e into --\\\u003e or ]]\u003e into ]]\\\u003e\r\n           if (i \u003e\u003d 2 \u0026\u0026\r\n               ((s.charAt(i - 1) \u003d\u003d \u0027-\u0027 \u0026\u0026 s.charAt(i - 2) \u003d\u003d \u0027-\u0027) ||\r\n","timestamp":1335960050,"attachments":[]},{"id":4,"commenterId":1442667876655034575,"content":"One more note:  The reason for the patch is that \\u2028 and \\u2029 cannot be included in javascript string literals since they are valid line terminators.  This cropped up in an issue reported to underscorejs in which a string literal containing these was not escaped and caused a syntax error in compiled code.  Relevant links below.\r\n\r\nhttp://es5.github.com/#x7.3\r\nhttps://github.com/documentcloud/underscore/issues/579","timestamp":1335965660,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"thanks for the report! have you filled out a CLA? see:\r\nhttp://code.google.com/p/closure-compiler/source/browse/trunk/CONTRIBUTORS","timestamp":1335983833,"attachments":[]},{"id":6,"commenterId":1442667876655034575,"content":"I have now.  :)","timestamp":1335990994,"attachments":[]},{"id":7,"commenterId":1328304962299559429,"content":"This issue was closed by revision r1947.","timestamp":1336067839,"attachments":[]},{"id":8,"commenterId":1442667876655034575,"content":"Fantastic!  Thanks Nicholas!","timestamp":1336069068,"attachments":[]},{"id":9,"commenterId":8173196008570380122,"content":"Issue 761 has been merged into this issue.","timestamp":1340367323,"attachments":[]},{"id":10,"commenterId":-7699928860083865744,"content":"Issue 761 has been merged into this issue.","timestamp":1340379202,"attachments":[]}]}