{"id":980,"status":"Duplicate","summary":"Add a warning when implicitly converting a function to a boolean","labels":["Type-Defect","Priority-Medium","Restrict-AddIssueComment-Nobody"],"stars":0,"commentCount":11,"comments":[{"id":0,"commenterId":1711074370877082584,"content":"Compile the following code:\r\n\r\n  goog.require(\u0027goog.structs.Map\u0027);\r\n\r\n  var main \u003d function() {\r\n    var map \u003d new goog.structs.Map();\r\n    if (map.isEmpty) { // \u0026lt;-- *\r\n      alert(\u0027empty\u0027);\r\n    }\r\n  };\r\n\r\n  main();\r\n\r\nWhat is the expected output?\r\nA warning that says something like \u0026quot;Warning: map.isEmpty is a function. Did you mean \u0026quot;map.isEmpty()\u0026quot;?\r\n\r\nWhat do you see instead?\r\nNo warning.","timestamp":1366075007,"attachments":[]},{"id":1,"commenterId":-5511873792362522702,"content":"This has come up before. The counter-argument is that this is a very common pattern in JS\r\nif (element.chromeMagic) {\r\n  element.chromeMagic()\r\n}","timestamp":1366080117,"attachments":[]},{"id":2,"commenterId":8173196008570380122,"content":"This is used widely. This problem is made worse by the fact that property renaming invalidates the following pattern:\r\n\r\nif (\u0027getContext\u0027 in element) {\r\n  element.getContext(\u00272d\u0027);\r\n}\r\n\r\nI could see such a warning being part of a diagnostic group that wasn\u0027t enabled by default.","timestamp":1366117533,"attachments":[]},{"id":3,"commenterId":-7699928860083865744,"content":"maybe we can check if the function is called inside the conditional block, and warn if it\u0027s not? i can imagine cases where this heuristic would fall down, but maybe it will be good enough. ","timestamp":1366126522,"attachments":[]},{"id":4,"commenterId":8173196008570380122,"content":"It\u0027ll have to be a little smarter than that...\r\n\r\nHere\u0027s an IE event model fallback example:\r\n\r\nif (!element.addEventListener) {\r\n  element.attachEvent(\u0027onclick\u0027, function(){});\r\n}","timestamp":1366135704,"attachments":[]},{"id":5,"commenterId":1711074370877082584,"content":"I think the \u0027chromeMagic\u0027 example and the addEventListener example would always apply to things that are built into the browser -- that is, things defined in the externs. However, for things like my example (goog.structs.Map) the function is actually defined *in the source code*. Maybe that would be a good way to distinguish the two cases: externs vs source.\r\n\r\nOr, if someone wanted to use this heuristic, they could rewrite it as: if (goog.isDef(element.chromeMagic)) which is arguably better because it\u0027s more explicit.\r\n\r\nIf I have some time in the near-ish future, I\u0027d like to implement this check and see whether it mostly catches real bugs, or mostly flags false positives.","timestamp":1366136183,"attachments":[]},{"id":6,"commenterId":8173196008570380122,"content":"And here\u0027s another:\r\n\r\nif(!document.getElementsByClassName) {\r\n  document.getElementsByClassName \u003d function(name) {}\r\n}","timestamp":1366136577,"attachments":[]},{"id":7,"commenterId":8173196008570380122,"content":"I can see Nick\u0027s suggestion combined with only warning about functions defined in source (as opposed to externs) as possibly working. I can still come up with failure cases, but they are much rarer.","timestamp":1366137241,"attachments":[]},{"id":8,"commenterId":6454800031398885070,"content":"We could encourage \"!\u003d undefined\" for these special cases. The check, I think is worthwhile.","timestamp":1366166423,"attachments":[]},{"id":9,"commenterId":-8769171937076622550,"content":"Issue tracking has been migrated to github. Please make any further comments on this issue through https://github.com/google/closure-compiler/issues","timestamp":1398969110,"attachments":[]},{"id":10,"commenterId":-8769171937076622550,"content":"","timestamp":1398969252,"attachments":[]}]}