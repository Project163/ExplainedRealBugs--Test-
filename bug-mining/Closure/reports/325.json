{"id":1173,"status":"Fixed","summary":"calling hasOwnProperty on an object should prevent property trimming similar to using [] as an accessor","labels":["Type-Defect","Priority-Low"],"stars":0,"commentCount":10,"comments":[{"id":0,"commenterId":-7004155707233751928,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\nCompile the following code with advanced optimizations:\r\n// \u003d\u003dClosureCompiler\u003d\u003d\r\n// @compilation_level ADVANCED_OPTIMIZATIONS\r\n// @output_file_name default.js\r\n// \u003d\u003d/ClosureCompiler\u003d\u003d\r\n\r\n// ADD YOUR CODE HERE\r\nvar foo \u003d {\u0027a\u0027: true, \u0027b\u0027: true }\r\n\r\nconsole.log(foo.hasOwnProperty(\u0027a\u0027));\r\n\r\n// Uncomment the following to get the properties of foo to stick.\r\n//console.log(foo[\u0027a\u0027]);\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\nExpected:\r\nEither something highly optimized like the [] accessor only version of the code above: console.log(!0);, or at least accurate like:\r\nconsole.log({a:!0,b:!0}.hasOwnProperty(\u0026quot;a\u0026quot;));\r\n\r\nActual:\r\nconsole.log({}.hasOwnProperty(\u0026quot;a\u0026quot;));\r\n\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n","timestamp":1386789585,"attachments":[]},{"id":1,"commenterId":6454800031398885070,"content":"Looks like CollapseProperties is not respecting quoted properties.","timestamp":1386803388,"attachments":[]},{"id":2,"commenterId":6454800031398885070,"content":"Using the \"safe\" version of hasOwnProperties will work:\r\n\r\nObject.prototype.hasOwnProperty.call(foo, \u0027a\u0027);\r\n\r\nand protects against a property called \"hasOwnProperty\"","timestamp":1386805269,"attachments":[]},{"id":3,"commenterId":4865484112040790759,"content":"In the Object.prototype.hasOwnProperty case, foo is passed as an argument and the compiler doesn\u0027t know if the callee will use foo\u0027s properties, so it doesn\u0027t remove them. For example, the same happens if you write\r\n\r\nvar foo \u003d {\u0027a\u0027: true, \u0027b\u0027: true }\r\nfunction app(obj, method, arg) { return obj[method](arg); }\r\nconsole.log(app(foo, \u0027hasOwnProperty\u0027, \u0027a\u0027));","timestamp":1388387169,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"I don\u0027t think the compiler should ever be removing individual quoted properties. That\u0027s why they\u0027re quoted.","timestamp":1388500196,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"I posted a fix here:\r\nhttps://codereview.appspot.com/47530043/","timestamp":1388766476,"attachments":[]},{"id":6,"commenterId":-7699928860083865744,"content":"This issue was closed by revision 16f7df6d709b.","timestamp":1389163570,"attachments":[]},{"id":7,"commenterId":-7699928860083865744,"content":"This issue was closed by revision 70c40cc148e4.","timestamp":1389291469,"attachments":[]},{"id":8,"commenterId":-7699928860083865744,"content":"This issue was closed by revision 16f7df6d709b.","timestamp":1389758021,"attachments":[]},{"id":9,"commenterId":-8769171937076622550,"content":"This issue was closed by revision 70c40cc148e4.","timestamp":1389758022,"attachments":[]}]}