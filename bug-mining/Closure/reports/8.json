{"id":81,"status":"Fixed","summary":"eval function replaced with eval operator","labels":["Type-Defect","Priority-Medium"],"stars":1,"commentCount":8,"comments":[{"id":0,"commenterId":102554887883123445,"content":"The inputs\r\n\r\nwindow[\u0027a\u0027] \u003d \u0027Hello, World!\u0027;\r\nwindow[\u0027f\u0027] \u003d function f() {\r\n  var a \u003d \u0027Howdy!\u0027;\r\n  var ev \u003d eval;\r\n  ev(\u0027alert(a)\u0027);\r\n};\r\n\r\nand\r\n\r\nwindow[\u0027a\u0027] \u003d \u0027Hello, World!\u0027;\r\nwindow[\u0027f\u0027] \u003d function f() {\r\n  var a \u003d \u0027Howdy!\u0027;\r\n  eval(\u0027alert(a)\u0027);\r\n};\r\n\r\nin advanced mode both compile to\r\n\r\nwindow.a\u003d\u0026quot;Hello, World!\u0026quot;;window.f\u003dfunction(){eval(\u0026quot;alert(a)\u0026quot;)};\r\n\r\n\r\nbut according to section 15.1.2.1.1 of EcmaScript 5 the first should alert \r\n\u0026quot;Hello, World!\u0026quot;, and the second should alert \u0026quot;Howdy!\u0026quot;.\r\n\r\n15.1.2.1.1 Direct Call to Eval \r\nA direct call to the eval function is one that is expressed as a \r\nCallExpression that meets the following two \r\nconditions: \r\nThe Reference that is the result of evaluating the MemberExpression in the \r\nCallExpression has an environment \r\nrecord as its base value and its reference name is \u0026quot;eval\u0026quot;. \r\nThe result of calling the abstract operation GetValue with that Reference as \r\nthe argument is the standard built- \r\nin function defined in 15.1.2.1. \r\n\r\nAccording to ES5, since the name of the function called in the input is \u0026quot;ev\u0026quot; \r\nthe call has the effect of binding \u0026quot;a\u0026quot; in the global environment, whereas \r\nwhen the name of the function called is \u0026quot;eval\u0026quot;, \u0026quot;a\u0026quot; is bound to the local \r\nvariable.\r\n\r\nChanging a use of the eval function to the eval operator is problematic \r\nunless you can prove that the body of the evaled text does not contain any \r\nreferences to non-global variables.","timestamp":1261856839,"attachments":[]},{"id":1,"commenterId":-7699928860083865744,"content":"tangentially, does anyone keep a master table of which js interpreters implement which \r\nparts of ES5, just so that people know how to repro issues like this?","timestamp":1261933158,"attachments":[]},{"id":2,"commenterId":102554887883123445,"content":"This thread is relevant to ES5 implementations:\r\nhttps://mail.mozilla.org/pipermail/es-discuss/2009-December/010472.html","timestamp":1261954985,"attachments":[]},{"id":3,"commenterId":-5060162230523776870,"content":"Is this a useful difference, or would an error on aliasing eval be sufficient?","timestamp":1262308330,"attachments":[]},{"id":4,"commenterId":102554887883123445,"content":"I don\u0027t think it\u0027s possible to tell whether eval is aliased.\r\nUnless your function types include parameter name info, you can\u0027t make accurate \r\naliasing decisions around parameters.\r\nConsider:\r\n\r\nfunction f(e, x) { return e(x); }\r\nfunction g(eval, x) { return eval(x); }\r\n(Math.random() \u003c 0.5 ? f : g)(eval, \u00271 + 1);\r\n\r\nYou would have to be more restrictive and not just prevent aliasing, but prevent its \r\nuse as a first-class function.\r\n\r\nOnce you\u0027ve done that, you\u0027re basically mandating that it be used as the eval \r\noperator, and then for all uses, renaming would be bad because it would again \r\nconvert from eval operator to eval function.","timestamp":1262311573,"attachments":[]},{"id":5,"commenterId":-5060162230523776870,"content":"Yes, restricting it to be just the eval operator is what I was suggesting.  Which may \r\nnot be appropriate for safe mode, but might be for advanced mode.  The question is how \r\nburdensome would this restriction be.","timestamp":1262414746,"attachments":[]},{"id":6,"commenterId":102554887883123445,"content":"Ah.\r\n\r\n(0, eval)(foo) does something quite similar to (new Function(foo))() with a few \r\ndifferences.  So not having the eval function does not severely limit the set of \r\nexpressible programs.","timestamp":1262454205,"attachments":[]},{"id":7,"commenterId":-7699928860083865744,"content":"should be fixed in r79","timestamp":1264641795,"attachments":[]}]}