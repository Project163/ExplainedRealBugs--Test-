{"id":1205,"status":"Fixed","summary":"Source map locations are wrong when using goog.scope","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":5,"comments":[{"id":0,"commenterId":-2761451945267698014,"content":"\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\nClosure Compiler (http://code.google.com/closure/compiler)\r\nVersion: v20140110\r\nBuilt on: 2014/01/14 16:25\r\n\r\nDebian GNU/Linux Xfce\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\nConsider this simple assert module:\r\n\r\n  goog.provide(\u0026quot;log\u0026quot;)\r\n\r\n  log.assert \u003d function (x) {\r\n    if (!x) {\r\n      throw new Error(\u0026quot;Assertion failed\u0026quot;)\r\n    }\r\n  }\r\n\r\nNow consider this simple program that uses the assert module:\r\n\r\n  goog.provide(\u0026quot;foo\u0026quot;)\r\n  goog.require(\u0026quot;log\u0026quot;)\r\n\r\n  foo.init \u003d function () {\r\n    log.assert(false)\r\n    log.assert(false)\r\n  }\r\n\r\n  foo.init()\r\n\r\nIf you compile the above with ADVANCED_OPTIMIZATIONS and generate a source map, the error will correctly point to foo.js, line 5. Now, if you shorten the assert form, like so...\r\n\r\n  goog.provide(\u0026quot;foo\u0026quot;)\r\n  goog.require(\u0026quot;log\u0026quot;)\r\n\r\n  var assert \u003d log.assert\r\n\r\n  foo.init \u003d function () {\r\n    assert(false)\r\n    assert(false)\r\n  }\r\n\r\n  foo.init()\r\n\r\nIt correctly shows foo.js, line 7. But if you wrap it in goog.scope...\r\n\r\n  goog.provide(\u0026quot;foo\u0026quot;)\r\n  goog.require(\u0026quot;log\u0026quot;)\r\n\r\n  goog.scope(function () {\r\n    var assert \u003d log.assert\r\n  \r\n    foo.init \u003d function () {\r\n      assert(false)\r\n      assert(false)\r\n    }\r\n  })\r\n\r\n  foo.init()\r\n\r\nIt then INCORRECTLY shows foo.js, line 5.\r\n\r\nIt appears that when the compiler does the goog.scope aliasing, it uses the line/column of the \u0026quot;var assert \u003d ...\u0026quot; rather than the \u0026quot;assert(...)\u0026quot;","timestamp":1390549077,"attachments":[]},{"id":1,"commenterId":-7699928860083865744,"content":"thanks for the report","timestamp":1390666715,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"fix posted here:\r\nhttps://codereview.appspot.com/53630044/","timestamp":1390667599,"attachments":[]},{"id":3,"commenterId":-7699928860083865744,"content":"This issue was closed by revision 10e65e9a6fae.","timestamp":1390687426,"attachments":[]},{"id":4,"commenterId":-2761451945267698014,"content":"Thank you very much! That will help out a *lot* when debugging the minified source code.","timestamp":1390695642,"attachments":[]}]}