{"id":64,"status":"Fixed","summary":"try ... catch is sometimes optimized away when it shouldn\u0027t be","labels":["Type-Defect","Priority-Medium"],"stars":4,"commentCount":13,"comments":[{"id":0,"commenterId":-2383702226191207389,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\nThis program does nothing and raises no error (provided that \u0027a\u0027 isn\u0027t \r\ndefined, so accessing it raises a ReferenceError)\r\n\r\ntry { while(a); } catch(_){}\r\n\r\nAfter compilation, we get:\r\nfor (;a;);\r\n\r\nwhich throws an error which is not caught.\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\nr15\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\nFound using the next version of fuzz-test :)","timestamp":1259536907,"attachments":[]},{"id":1,"commenterId":-7699928860083865744,"content":"Ha. Inside Google, we\u0027ve forced all variables to be explicitly declared for a few \r\nyears, so we haven\u0027t looked at plain ReferenceErrors for a long time. (in the stand-\r\nalone jar, you\u0027ll get a compiler error with --warning_level\u003dVERBOSE).\r\n\r\nI\u0027m not really sure how we want to handle cases like this. We could mark every extern \r\nvariable access as HAS_SIDE_EFFECTS, but that\u0027s not much fun.\r\n\r\nThoughts?","timestamp":1259618325,"attachments":[]},{"id":2,"commenterId":1948758734812428220,"content":"Seems reasonable. I guess people who would want to benefit from the side effect + dead \r\ncode elimination passes would need to make sure they declare all their variables.","timestamp":1259618666,"attachments":[]},{"id":3,"commenterId":5466112693174441437,"content":"Marking external variable access as HAS_SIDE_EFFECTS unless it is specifically\r\nannotated with @nosideeffects would be my preference.","timestamp":1259621610,"attachments":[]},{"id":4,"commenterId":-2383702226191207389,"content":"Could you clarify what you mean by an external variable here?  Specifically, are variables declared in an externs \r\nfile external?\r\n\r\nMy understanding is that if the variable is declared in an externs file, then it can be assumed to exist and there \r\nisn\u0027t any worry of throwing a ReferenceError.","timestamp":1259632904,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"So the compiler recognizes\r\n1) Normal, declared variables\r\n2) External variables (stuff inside the externs that must be declared)\r\n3) Synthesized external variables (stuff not declared anywhere, so we assume it\u0027s\r\ndeclared externally)\r\n\r\nThe easiest way to fix this would to just not do any dead-code elimination at all if\r\nthere are any variables of type (3). I\u0027m not sure how effort we want to spend\r\nactually supporting case (3).\r\n\r\nI assigned the bug to Alan, mostly because everyone disagrees with me on this issue,\r\nand he trust he\u0027ll figure out the right action to take on it.","timestamp":1259811497,"attachments":[]},{"id":6,"commenterId":-5060162230523776870,"content":"Issue 223 has been merged into this issue.","timestamp":1285957736,"attachments":[]},{"id":7,"commenterId":-8276488392613077848,"content":"I have tried:\r\n    try {\r\n      while(a){\r\n        alert(true);\r\n      }\r\n    } catch(_){\r\n    }\r\n\r\nAnd I received:\r\n    try {\r\n        for (; a;) alert(!0)\r\n    } catch (b) {};\r\n\r\nSeems that problem was solved for now. :)","timestamp":1302571520,"attachments":[]},{"id":8,"commenterId":7510432710494597669,"content":"#7, that wasn\u0027t the original test case.  The original case still fails, as does the case in Issue 223, which has been merged into this one.","timestamp":1302627868,"attachments":[]},{"id":9,"commenterId":8173196008570380122,"content":"Issue 451 has been merged into this issue.","timestamp":1305493758,"attachments":[]},{"id":10,"commenterId":-5205599355437290890,"content":"Issue 506 has been merged into this issue.","timestamp":1309958618,"attachments":[]},{"id":11,"commenterId":-215138502632663007,"content":"#7 was probably \u0027fixed\u0027 by the alert which can have sideeffect / exception","timestamp":1310061390,"attachments":[]},{"id":12,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1725.","timestamp":1326821337,"attachments":[]}]}