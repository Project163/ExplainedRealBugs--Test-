{"id":567,"status":"Fixed","summary":"Ant: support \u003cdefine/\u003e replacements","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":5,"comments":[{"id":0,"commenterId":3892267362573158838,"content":"My patch for issue 533 has been working fine for us up until now.  Slight background...  I was using @define with a DEBUG variable that could be used to optimize away debug code (like console logging, test features, etc) when the code is compiled.\r\n\r\nFast-forward to now, and my colleagues would not like a way to have both a \u0026quot;shipped\u0026quot; version and a debug version of the same compiled source.  The debug version is also useful for things like pretty-print, so we can test the compiler\u0027s reductions, but still be able to find where an error is occurring, because it\u0027s not all on one line.\r\n\r\nWell, the fix in issue 533 uses project properties to do the @define replacements, and Ant properties are generally immutable, so it became difficult to perform the same compilation twice, with two different values for the @define.  Note, there is still a workaround even for the above case, by overriding the \u0026quot;replacePropertiesPrefix\u0026quot; attribute for each invocation.\r\n\r\nAll that said, it makes sense to be able to set @define values individually as well, using a new \u0026lt;define /\u0026gt; nested element.  The element is implemented using the org.apache.tools.ant.types.Parameter class, so it supports \u0026quot;name\u0026quot; and \u0026quot;value\u0026quot; attributes.  The \u0026quot;type\u0026quot; attribute is ignored currently, since we have to coerce the value to a proper closure type anyway.\r\n\r\nExample usage:\r\n\r\n  \u0026lt;target name\u003d\u0026quot;app.js\u0026quot; description\u003d\u0026quot;Compile JS files\u0026quot;\u0026gt;\r\n    \u0026lt;compile-js destfile\u003d\u0026quot;${APP_CORE_JS_MIN}\u0026quot;\u0026gt;\r\n      \u0026lt;path refid\u003d\u0026quot;app.js.files\u0026quot; /\u0026gt;\r\n      \u0026lt;!-- Works exactly like:\r\n           $ java -jar compiler.jar -D DEBUG\u003dfalse ...\r\n        --\u0026gt;\r\n      \u0026lt;define name\u003d\u0026quot;DEBUG\u0026quot; value\u003d\u0026quot;false\u0026quot; /\u0026gt;\r\n    \u0026lt;/compile-js\u0026gt;\r\n  \u0026lt;/target\u0026gt;\r\n\r\n  \u0026lt;target name\u003d\u0026quot;app.debug.js\u0026quot; description\u003d\u0026quot;Compile Debug version of JS files\u0026quot;\u0026gt;\r\n    \u0026lt;compile-js destfile\u003d\u0026quot;${APP_CORE_JS_DEBUG}\u0026quot; prettyPrint\u003d\u0026quot;true\u0026quot; debug\u003d\u0026quot;true\u0026quot;\u0026gt;\r\n      \u0026lt;path refid\u003d\u0026quot;app.js.files\u0026quot; /\u0026gt;\r\n      \u0026lt;!-- Works exactly like:\r\n           $ java -jar compiler.jar -D DEBUG\u003dtrue ...\r\n        --\u0026gt;\r\n      \u0026lt;define name\u003d\u0026quot;DEBUG\u0026quot; value\u003d\u0026quot;true\u0026quot; /\u0026gt;\r\n    \u0026lt;/compile-js\u0026gt;\r\n  \u0026lt;/target\u0026gt;\r\n\r\n(note compile-js is an internal \u0026lt;macrodef/\u0026gt; wrapper around the jscomp task)\r\n\r\nThis patch does not affect the existing project property replacement that is supported by the issue 533 patch, and I find both implementations equally useful.","timestamp":1317416899,"attachments":[{"id":5670000000,"fileName":"create-define.patch","fileSize":5375}]},{"id":1,"commenterId":-7699928860083865744,"content":"thanks for the patch!","timestamp":1317928247,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"Bolin, do you mind reviewing this? I put the review up here\r\nhttp://codereview.appspot.com/5215043","timestamp":1317928354,"attachments":[]},{"id":3,"commenterId":5106879473510389208,"content":"Reviewed: LGTM!","timestamp":1317942035,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1500.","timestamp":1318023285,"attachments":[]}]}