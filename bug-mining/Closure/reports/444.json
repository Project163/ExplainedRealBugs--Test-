{"id":40,"status":"Fixed","summary":"Access to `arguments` members is replaced with access to actual arguments.","labels":["Type-Defect","Priority-Medium"],"stars":3,"commentCount":12,"comments":[{"id":0,"commenterId":9068139705218233249,"content":"An example of changed behavior before and after munging:\r\n\r\n  (function() {\r\n    alert(arguments[0] + \u0027; \u0027 + arguments[\u0027callee\u0027].length);\r\n  })();\r\n\r\nmunges to:\r\n\r\n  (function(a){alert(a+\u0026quot;; \u0026quot;+arguments.callee.length)})();","timestamp":1258314257,"attachments":[]},{"id":1,"commenterId":1948758734812428220,"content":"Seems like that\u0027s currently done:\r\n\r\n// \u003d\u003dClosureCompiler\u003d\u003d\r\n// @compilation_level SIMPLE_OPTIMIZATIONS\r\n// \u003d\u003d/ClosureCompiler\u003d\u003d\r\nfunction hello() {alert(\u0027Hello, \u0027 + arguments[0])}\r\nhello(\u0027New user\u0027);\r\n\r\nyields:\r\n\r\nfunction hello(a){alert(\"Hello, \"+a)}hello(\"New user\");","timestamp":1258417708,"attachments":[]},{"id":2,"commenterId":9068139705218233249,"content":"Yes, it is currently done, which is why there\u0027s a problem.","timestamp":1258419074,"attachments":[]},{"id":3,"commenterId":1948758734812428220,"content":"Oops. Sorry. I read it as a feature request. You are right this is a bug.","timestamp":1258419357,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"","timestamp":1258746982,"attachments":[]},{"id":5,"commenterId":9068139705218233249,"content":"Why doesn\u0027t `eval` force this optimization to back out?\r\n\r\n(function() {\r\n  alert(arguments[0] + \u0027;\u0027 + eval(\u0027arguments.callee.length\u0027));\r\n})();","timestamp":1259517652,"attachments":[]},{"id":6,"commenterId":-7699928860083865744,"content":"From:\r\nhttp://code.google.com/closure/compiler/docs/compilation_levels.html\r\n\"Compilation with SIMPLE_OPTIMIZATIONS always preserves the functionality of \r\nsyntactically valid JavaScript, provided that the code does not access local \r\nvariables using string names (by using eval() statements, for example).\"\r\n\r\nIn general, we do not support uses of eval() that read/write from variables outside \r\nof the eval().\r\n\r\n","timestamp":1259520998,"attachments":[]},{"id":7,"commenterId":9068139705218233249,"content":"Shouldn\u0027t use of `eval` result in warning then?\r\n\r\nBut stepping away from eval issue, the premise of translation preserving\r\nfunctionality is still not fulfilled. When substituting numeric argument properties\r\nwith formal parameters, there\u0027s a difference in reference\u0027s base object (which can be\r\nclearly seen if parameter/argument references, say, function):\r\n\r\n  var getBase \u003d function(){ return this; };\r\n  (function(x,y){ alert(arguments[0]()); })(getBase);\r\n\r\ntranslates to:\r\n\r\n  var getBase\u003dfunction(){return this};(function(a){alert(a())})(getBase);\r\n\r\nand obviously results in a different behavior.","timestamp":1259526655,"attachments":[]},{"id":8,"commenterId":-7699928860083865744,"content":"There are many valid uses of eval--for example, for parsing JSON.\r\n\r\nBy the same token, in C, you could use the [] operator to index directly into the \r\nstack and overwrite variables. But I don\u0027t think it would be reasonable to expect the \r\nC compiler to respect that use case, or for the C compiler to give you a warning \r\nevery time you used the [] operator.\r\n\r\nThanks for finding the second bug. Alan, would you be willing to take that one on \r\ntoo?","timestamp":1259528252,"attachments":[]},{"id":9,"commenterId":1948758734812428220,"content":"That is fixed and checked in. The next release should pick that up.","timestamp":1259612975,"attachments":[]},{"id":10,"commenterId":9068139705218233249,"content":"@acleung What exactly is fixed? base object augmentation or evaling? I still see both\r\nissues in rev16.","timestamp":1259677913,"attachments":[]},{"id":11,"commenterId":1948758734812428220,"content":"var getBase \u003d function(){ return this; };\r\n  (function(x,y){ alert(arguments[0]()); })(getBase);\r\n\r\nis fixed. It was just pushed with r17.\r\n\r\neval() won\u0027t be fixed. In general, that is a not computable problem.\r\n\r\nJohn is working on emitting warnings for with and eval.\r\n\r\n","timestamp":1259691215,"attachments":[]}]}