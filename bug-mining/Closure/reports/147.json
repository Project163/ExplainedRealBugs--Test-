{"id":534,"status":"Fixed","summary":"OutOfMemoryError on ammo.js","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":7,"comments":[{"id":0,"commenterId":-6707734872858247061,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n1. Run closure compiler with advanced optimizations on the attached file.\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\nIt hits an exception:\r\n\r\njava.lang.RuntimeException: java.lang.OutOfMemoryError: GC overhead limit exceeded\r\n\tat com.google.javascript.jscomp.Compiler.runCallable(Compiler.java:629)\r\n\tat com.google.javascript.jscomp.Compiler.runInCompilerThread(Compiler.java:574)\r\n\tat com.google.javascript.jscomp.Compiler.compile(Compiler.java:556)\r\n\tat com.google.javascript.jscomp.Compiler.compile(Compiler.java:515)\r\n\tat com.google.javascript.jscomp.AbstractCommandLineRunner.doRun(AbstractCommandLineRunner.java:662)\r\n\tat com.google.javascript.jscomp.AbstractCommandLineRunner.run(AbstractCommandLineRunner.java:295)\r\n\tat com.google.javascript.jscomp.CommandLineRunner.main(CommandLineRunner.java:758)\r\nCaused by: java.lang.OutOfMemoryError: GC overhead limit exceeded\r\n\tat com.google.javascript.jscomp.SimpleDefinitionFinder$UseSiteGatheringCallback.visit(SimpleDefinitionFinder.java:286)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:480)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseFunction(NodeTraversal.java:518)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:465)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverseBranch(NodeTraversal.java:473)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverse(NodeTraversal.java:259)\r\n\tat com.google.javascript.jscomp.NodeTraversal.traverse(NodeTraversal.java:437)\r\n\tat com.google.javascript.jscomp.SimpleDefinitionFinder.process(SimpleDefinitionFinder.java:110)\r\n\tat com.google.javascript.jscomp.PureFunctionIdentifier$Driver.process(PureFunctionIdentifier.java:1099)\r\n\tat com.google.javascript.jscomp.PhaseOptimizer$PassFactoryDelegate.processInternal(PhaseOptimizer.java:273)\r\n\tat com.google.javascript.jscomp.PhaseOptimizer$NamedPass.process(PhaseOptimizer.java:250)\r\n\tat com.google.javascript.jscomp.PhaseOptimizer.process(PhaseOptimizer.java:168)\r\n\tat com.google.javascript.jscomp.Compiler.optimize(Compiler.java:1634)\r\n\tat com.google.javascript.jscomp.Compiler.compileInternal(Compiler.java:664)\r\n\tat com.google.javascript.jscomp.Compiler.access$000(Compiler.java:70)\r\n\tat com.google.javascript.jscomp.Compiler$1.call(Compiler.java:559)\r\n\tat com.google.javascript.jscomp.Compiler$1.call(Compiler.java:556)\r\n\tat com.google.javascript.jscomp.Compiler$2.run(Compiler.java:601)\r\n\tat java.lang.Thread.run(Thread.java:636)\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\nRev. 1348 on 32-bit Ubuntu 10.10. This machine has 3GB of RAM.\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\nThe attachment is ammo.js, the Bullet physics library compiled into JavaScript. Compiled without LLVM optimizations it is 22MB and closure compiler optimizes it very well, but with LLVM optimizations it is 36MB and fails as described above. The LLVM optimizations can potentially make it very fast, so it would be great if closure could run on that too.\r\n","timestamp":1313854797,"attachments":[{"id":5340000000,"fileName":"ammo.ta2.js.tar.bz2","fileSize":2522380}]},{"id":1,"commenterId":-7699928860083865744,"content":"it\u0027s worth pointing out that even if your machine has 3GB of ram, the JVM has a much lower default memory limit. can you try upping your memory limit to something like\r\n\r\njava -Xmx1024m -jar ...\r\n?","timestamp":1313857297,"attachments":[]},{"id":2,"commenterId":-6707734872858247061,"content":"Thanks, I\u0027m not a Java hacker and didn\u0027t know that...\r\n\r\nWith that flag, it doesn\u0027t hit out of memory, but after leaving it running for several hours it still hasn\u0027t completed. Perhaps it\u0027s in an infinite loop? Or just very slow for some reason?\r\n","timestamp":1313958745,"attachments":[]},{"id":3,"commenterId":2220700227557109852,"content":"See Issues 435 and 446.","timestamp":1313964881,"attachments":[]},{"id":4,"commenterId":-6707734872858247061,"content":"Ok, thanks, I guess this issue can be closed then.\r\n","timestamp":1313967461,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"","timestamp":1314044122,"attachments":[]},{"id":6,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1374.","timestamp":1314121021,"attachments":[]}]}