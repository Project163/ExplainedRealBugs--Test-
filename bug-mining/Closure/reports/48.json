{"id":224,"status":"Fixed","summary":"Add option to specify output encoding","labels":["Type-Defect","Priority-Medium"],"stars":2,"commentCount":13,"comments":[{"id":0,"commenterId":8620613773088119088,"content":"Currently when input contains a lot of Unicode characters, like:\r\n\r\nalert(\u0026quot;Не знаю, что выйдет из моего старшего внука.\u0026quot;);\r\n\r\nThe Closure compiler replaces all those characters with \\uXXXX:\r\n\r\nalert(\u0026quot;\\u041d\\u0435 \\u0437\\u043d\\u0430\\u044e, \\u0447\\u0442\\u043e \\u0432\\u044b\\u0439\\u0434\\u0435\\u0442 \\u0438\\u0437 \\u043c\\u043e\\u0435\\u0433\\u043e \\u0441\\u0442\\u0430\\u0440\\u0448\\u0435\\u0433\\u043e \\u0432\\u043d\\u0443\\u043a\\u0430.\u0026quot;);\r\n\r\nThe result is that when you have a lot of Unicode characters inside your JavaScript, the Closure compiler (despite all it\u0027s clever code optimizations) produces larger output than YUI compressor.\r\n\r\nI understand that there are reasons why Google prefers all it\u0027s JavaScript to be in plain ASCII, but not everyone thinks that this is the right compromise to make.\r\n\r\n","timestamp":1282727114,"attachments":[]},{"id":1,"commenterId":6454800031398885070,"content":"Is the --charset option not working for you?","timestamp":1282754462,"attachments":[]},{"id":2,"commenterId":1948758734812428220,"content":"I tried a few days ago and it wasn\u0027t doing what I was expecting.\r\n\r\nAlso we should have a simpler flag.","timestamp":1282756475,"attachments":[]},{"id":3,"commenterId":8620613773088119088,"content":"The --charset specifies input encoding, not output.","timestamp":1282759129,"attachments":[]},{"id":4,"commenterId":-6098463528315836415,"content":"--charset specifies both input and output. there is a bug in the released compiler where it doesn\u0027t work correctly for UTF-8, but this is fixed at trunk.","timestamp":1282760304,"attachments":[]},{"id":5,"commenterId":8620613773088119088,"content":"First, thanks for the good suggestion.\r\n\r\nI downloaded the latest version from trunk (revision 382), compiled it into JAR and tried the --charset option.\r\n\r\nThe --charset now indeed effects the output, but in an \"interesting\" way.\r\n\r\nWhen I call the compiler like so:\r\n\r\n$ java -jar compiler.jar --charset utf8 --js test.js \u003e out.js\r\n\r\nThen it takes my input file, which is encoded in UTF-8 and outputs a file encoded in ISO-8859-1! When the input contains characters that can\u0027t be converted to ISO-8859-1, then these are just replaced with question marks.\r\n\r\nBut all hope is not lost :)\r\n\r\nWhen I call the compiler like so:\r\n\r\n$ java -jar compiler.jar --charset utf8 --js test.js --js_output_file out.js\r\n\r\nThen output is indeed UTF-8 and nothing is mangled up.","timestamp":1282764968,"attachments":[]},{"id":6,"commenterId":-6098463528315836415,"content":"Ah, yeah. you have to output to a file.\r\n\r\nI\u0027m pretty sure that the encoding of standard-out is entirely controlled by your terminal application. I don\u0027t think that we can change the encoding of your terminal once it\u0027s already open (though i\u0027m not an expert in these things, and maybe there\u0027s some way to do this).","timestamp":1282771269,"attachments":[]},{"id":7,"commenterId":8620613773088119088,"content":"No, the encoding of STDOUT is clearly not dependent of my terminal. The terminal might render the characters wrong, but it doesn\u0027t change them inside files.\r\n\r\nThe Shell however might mess with characters when I pipe stuff from one program to another. I have experienced that with Windows PowerShell that tends to replace \\n with \\n\\r - and I tell you, it\u0027s not a wise idea for a shell to do such thing - good luck with piping any binary file from one program to another in PowerShell. But I\u0027m using Bash under Free BSD, and I\u0027ve never seen it alter files unless I explicitly ask some program to do it.\r\n\r\nIt might be that Java is to blame here, but even if JRE does some stupid things with STDOUT, there has to be a way to deal with it, after all YUI Compressor writes UTF-8 to STDOUT just fine.","timestamp":1282805521,"attachments":[]},{"id":8,"commenterId":-6098463528315836415,"content":"yep, you are right. i told you i didn\u0027t know much about this stuff. there will be a fix shortly :)","timestamp":1282933680,"attachments":[]},{"id":9,"commenterId":-7699928860083865744,"content":"","timestamp":1282933732,"attachments":[]},{"id":10,"commenterId":-7699928860083865744,"content":"OK, code review here:\r\n http://codereview.appspot.com/2047042\r\n\r\nJohn, do you have time to take a look please?","timestamp":1282937754,"attachments":[{"id":-6440416907032456044,"fileName":"better_output_encoding.diff","fileSize":5617}]},{"id":11,"commenterId":-7699928860083865744,"content":"better patch","timestamp":1282941028,"attachments":[{"id":6592154166771451512,"fileName":"better_output_encoding.diff","fileSize":6027}]},{"id":12,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r394.","timestamp":1283210215,"attachments":[]}]}