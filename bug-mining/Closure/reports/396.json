{"id":1288,"status":"Duplicate","summary":"Change @nosideeffects to @throws on RegExp constructor extern","labels":["Type-Defect","Priority-Medium","Restrict-AddIssueComment-Nobody"],"stars":0,"commentCount":6,"comments":[{"id":0,"commenterId":2274928582343029865,"content":"Observe https://code.google.com/p/closure-compiler/source/browse/externs/es3.js#1889\r\n\r\nAs per http://www.ecma-international.org/ecma-262/5.1/#sec-15.10.4.1 , the constructor of the RegExp object may throw TypeError or SyntaxError (and therefore should not be @nosideeffects).\r\n\r\nRecommend replacing this directive with @throws{(SyntaxError|TypeError)}\r\n\r\nChange addresses code-stripping in the following usage pattern (the compiler will strip the \u0026quot;var unused\u0026quot; line, even though the RegExp constructor could throw as a side-effect):\r\n\r\nfunction verifyOnClientAndSendRegexpToServer(pattern) {\r\n  // Check client-side to save the round-trip. This will throw\r\n  // if the pattern is not a valid RegExp. \r\n  var unused \u003d new RegExp(pattern);\r\n  sendRegexpToServer(pattern);\r\n}","timestamp":1395695111,"attachments":[]},{"id":1,"commenterId":1948758734812428220,"content":"We should avoid unsounded optimizations as much as possible so in this case, I propose this:\r\n\r\n1. Make compiler understand @nosideeffect should be dropped with @throw\r\n2. Make a special pass that runs the regex checker to see if the pattern is valid. If so, optimze it like it is sideeffect free","timestamp":1395695254,"attachments":[]},{"id":2,"commenterId":2274928582343029865,"content":"As per the directions at https://code.google.com/p/closure-compiler/wiki/Contributors, I\u0027ve attached the patch below.\r\n\r\n(Note: If there\u0027s a unit test to add, I\u0027d be happy to, but I didn\u0027t find any section of the unit tests that validates the extern type annotations on the Javascript core itself).\r\n\r\nDiff generated via \u0027git diff ^HEAD HEAD\u0027 on my clone of the project.","timestamp":1397054139,"attachments":[{"id":12880002000,"fileName":"closure-patch.txt","fileSize":439}]},{"id":3,"commenterId":-5060162230523776870,"content":"As a googler you can also prepare a CL internally, which is easier to consume as it can be tested against our internal code base.","timestamp":1397089617,"attachments":[]},{"id":4,"commenterId":-8769171937076622550,"content":"Issue tracking has been migrated to github. Please make any further comments on this issue through https://github.com/google/closure-compiler/issues","timestamp":1398969111,"attachments":[]},{"id":5,"commenterId":-8769171937076622550,"content":"","timestamp":1398969253,"attachments":[]}]}