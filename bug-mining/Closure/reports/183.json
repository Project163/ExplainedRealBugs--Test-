{"id":651,"status":"Fixed","summary":"Make common JS module functionality publicly visible","labels":["Type-Defect","Priority-Medium","Patch"],"stars":0,"commentCount":11,"comments":[{"id":0,"commenterId":1087854357883684208,"content":"I want to call ProcessCommonJSModules.toModuleName and access ProcessCommonJSModules.DEFAULT_FILENAME_PREFIX just as the CommandLineRunner is doing, but cannot with the current visibility.  (I\u0027m building compiler integration for the Play Framework and want to invoke the compiler, but on incoming HTTP requests rather than from the command line.)","timestamp":1327827913,"attachments":[]},{"id":1,"commenterId":1087854357883684208,"content":"Patched version of ProcessCommonJSModules attached","timestamp":1327861311,"attachments":[{"id":6510001000,"fileName":"ProcessCommonJSModules.java","fileSize":9212}]},{"id":2,"commenterId":-5060162230523776870,"content":"","timestamp":1327943242,"attachments":[]},{"id":3,"commenterId":-5060162230523776870,"content":"","timestamp":1327993188,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"i\u0027m confused. we usually don\u0027t make individual passes publicly visible. what does this buy you?\r\n\r\nalso, for future reference, it\u0027s 2x easier to consume a patch if it\u0027s expressed as a diff, rather than a copy of the whole file","timestamp":1328587516,"attachments":[]},{"id":5,"commenterId":-7699928860083865744,"content":"(I\u0027m pretty sure DEFAULT_FILENAME_PREFIX is the default option. In theory, CommandLineRunner doesn\u0027t have a strong reason to set it explicitly)","timestamp":1328587643,"attachments":[]},{"id":6,"commenterId":1087854357883684208,"content":"I don\u0027t care much about DEFAULT_FILENAME_PREFIX.  But I think ProcessCommonJSModules.toModuleName should be public.  The logic the user uses to convert to a module name must match what ProcessCommonJSModules does.  One of the Play Framework developers created a Closure Compiler integration and you can see that he had to copy paste that method from the ProcessCommonJSModules source into his class:\r\nhttps://github.com/playframework/Play20/blob/009e48319c36c20b89ae43c226f1e4d086dac7cd/framework/src/sbt-plugin/src/main/scala/jscompile/JavascriptCompiler.scala\r\n\r\nIn addition to being unnecessary code duplication, if the implementation of ProcessCommonJSModules.toModuleName were ever to change then his code would break.  If there\u0027s a desire to keep ProcessCommonJSModules private then how about refactoring that method out into a class that is public?\r\n\r\nBtw, my patch was just marking the class as public, so no need to open it even.","timestamp":1328589503,"attachments":[]},{"id":7,"commenterId":-95491614018402395,"content":"Actually to be honest, I don\u0027t really need this method to be public. This naming is indeed internal stuff. What I really need is, for CommonJS, a way to pass the entry point filename.\r\n\r\nAdditionally, if you activate CommonJS processing but don\u0027t set an entry point, you get a NullPointerException.\r\n\r\nSo I suggest to pass the entry point directly in the call activating the CommonJS modules processing. That way we prevent people from activating CommonJS processing without entry points, and we don\u0027t need to expose a clearly internal method.\r\n","timestamp":1328604368,"attachments":[{"id":6510007000,"fileName":"commonjs-651.diff","fileSize":1126}]},{"id":8,"commenterId":-8954577291022023435,"content":"Essentially you want to make an operation like the CommandLineRunner does here\r\nhttp://code.google.com/p/closure-compiler/source/browse/trunk/src/com/google/javascript/jscomp/CommandLineRunner.java#656\r\nright?\r\n\r\nThat kinda makes sense :)","timestamp":1328629448,"attachments":[]},{"id":9,"commenterId":-95491614018402395,"content":"exactly!","timestamp":1328630127,"attachments":[]},{"id":10,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r1768.","timestamp":1328640177,"attachments":[]}]}