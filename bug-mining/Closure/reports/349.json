{"id":1238,"status":"Fixed","summary":"Global Constructors are not always properties of the global (window)","labels":["Type-Defect","Priority-Medium"],"stars":0,"commentCount":9,"comments":[{"id":0,"commenterId":-3899125346144604410,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\nCompile the following code using Advanced Optimizations -\r\nif (window.FileReader) console.log(new window.FileReader());\r\n\r\nWhat is the expected output?\r\nwindow.FileReader\u0026amp;\u0026amp;console.log(new window.FileReader());\r\n\r\nWhat do you see instead?\r\nwindow.a\u0026amp;\u0026amp;console.log(new window.a);\r\n\r\nWhat version of the product are you using?\r\nClosure Compiler v20140110.\r\n\r\nOn what operating system?\r\nWindows 7 Enterprise 64 bit, Java(TM) SE Runtime Environment (build 1.7.0_51-b13).\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\nI expect any global constructor (or variable, or whatever) to also be defined on window, since it is the global in browsers.\r\nIf you want Closure Compiler to be node.js compatible (or any other ECMAScript based environment), a --browser flag can be added (or --global window, or whatever).\r\n\r\nI see that some externs define stuff as global variables as well as properties of Window and some are not. I cannot think of a reason for which this duplication is even needed and not automatically assumed at the compiler level.","timestamp":1392329394,"attachments":[]},{"id":1,"commenterId":4865484112040790759,"content":"\u003e I cannot think of a reason for which this duplication is even needed and not automatically assumed at the compiler level.\r\n\r\nIt\u0027s not needed, it just happens to be how the compiler is working now. We\u0027d like to make all global variables in externs properties of the global object automatically, but until then, feel free to submit patches duplicating the definitions for the ones you care about.","timestamp":1392332531,"attachments":[]},{"id":2,"commenterId":-4842505769460693046,"content":"Would it be acceptable if I create patches for all of the externs files that essentially duplicate everything?\r\n\r\nI had a production bug due to this issue, the point of this issue is to eliminate such bugs before the fact.","timestamp":1392332701,"attachments":[]},{"id":3,"commenterId":4865484112040790759,"content":"\u003e Would it be acceptable if I create patches for all of the externs files that essentially duplicate everything?\r\n\r\nNo, just create a patch for the specific properties you\u0027re interested in. To avoid excessive duplication, see how this patch avoids duplicating all properties of HTMLCanvasElement.\r\nhttps://code.google.com/p/closure-compiler/source/detail?r\u003deb8f02b6e06b8dab5817c2704602c1b9b905d7a5\r\n\r\nIf you would like the proper fix to happen ASAP, you can try submitting a patch for that.","timestamp":1392334073,"attachments":[]},{"id":4,"commenterId":-8769171937076622550,"content":"This issue was closed by revision 0c1cce2e43c9.","timestamp":1394580537,"attachments":[]},{"id":5,"commenterId":-3899125346144604410,"content":"Thank you very much!\r\n\r\nI wish I could already use with this version, though (I have tried building the JAR file and it did not work...).","timestamp":1394609982,"attachments":[]},{"id":6,"commenterId":4865484112040790759,"content":"The option is off by default and there is no command-line flag for it; it\u0027s only available from the Java API. (We do plan to eventually have it on by default.)\r\n\r\nhttps://code.google.com/p/closure-compiler/source/detail?r\u003d0c1cce2e43c911aadd6f0d059889e804297aa240#\r\n\r\nIf you want to use the compiler from the command line with the option on, go to the file  CompilerOptions.java and change this line\r\ndeclaredGlobalExternsOnWindow \u003d false;\r\n\r\nto:\r\ndeclaredGlobalExternsOnWindow \u003d true;\r\n\r\nand rebuild the compiler.\r\n\r\n","timestamp":1394642410,"attachments":[]},{"id":7,"commenterId":-4842505769460693046,"content":"Thank you for the guidance. Like I wrote, I could not even build the compiler in the first place when I tried it a few months ago.\r\nI was using the Android SDK provided Eclipse, though.\r\n\r\nSorry, this is not a support group, so feel free to ignore. :)","timestamp":1394644181,"attachments":[]},{"id":8,"commenterId":4865484112040790759,"content":"Feel free to try again from the command line. Instructions here:\r\nhttps://code.google.com/p/closure-compiler/source/browse/README\r\n\r\nBasically, \"ant jar\" should be all you need.","timestamp":1394645020,"attachments":[]}]}