{"id":388,"status":"Invalid","summary":"Bad optimization resulting in a\u003da\u003dsomething ","labels":["Type-Defect","Priority-Medium"],"stars":1,"commentCount":3,"comments":[{"id":0,"commenterId":3712838058768891028,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n\r\nBelow is a test function:\r\n\r\nfunction test(p0, p1) {\r\n  var i, foo, bar, ndx;\r\n\r\n  foo \u003d Math.max(1, p1 - 8);\r\n  bar \u003d Math.min(p0, foo + 16);\r\n  foo \u003d Math.max(1, bar - 16);\r\n\r\n  for(i \u003d foo, ndx \u003d []; i \u0026lt;\u003d bar; i++) {\r\n    ndx.push(i);\r\n  }\r\n\r\n  return ndx;\r\n}\r\n\r\nWe compile it with SIMPLE_OPTIMIZATIONS:\r\n\r\njava -jar /path/to/compiler.jar --compilation_level SIMPLE_OPTIMIZATIONS --js test.js --js_output_file test.min.js\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\nOutput:\r\n\r\nfunction test(d,e){var a,b,c;a\u003dMath.max(1,e-8);b\u003dMath.min(d,a+16);a\u003da\u003dMath.max(1,b-16);for(c\u003d[];a\u0026lt;\u003db;a++)c.push(a);return c};\r\n\r\nUnexpected code: \u0026quot;a\u003da\u003d...\u0026quot;\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\nVersion: 20100917 (revision 440)\r\nBuilt on: 2010/09/17 17:55\r\nWindows 7 Pro / 64-bit\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\nMy guess: Closure Compiler moved the \u0026quot;i \u003d foo\u0026quot; out of the for loop but failed to notice that the same temporary variable is used for both \u0027foo\u0027 and \u0027i\u0027. So it did the assignment twice. Hence the \u0026quot;a\u003da\u003d...\u0026quot;.","timestamp":1300806939,"attachments":[]},{"id":1,"commenterId":3712838058768891028,"content":"[UPDATE] This problem *does not* occur with the latest stable version (revision 706), at least with this test function. So it may have been already fixed.","timestamp":1300808389,"attachments":[]},{"id":2,"commenterId":-5060162230523776870,"content":"Fixed in a prior release.","timestamp":1300841960,"attachments":[]}]}