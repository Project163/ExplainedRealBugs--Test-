{"id":840,"status":"Duplicate","summary":"@export functionality does not work with --transform_amd_modules","labels":["Type-Defect","Priority-Medium","Restrict-AddIssueComment-Nobody"],"stars":0,"commentCount":3,"comments":[{"id":0,"commenterId":-5697700909281489174,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n\r\n1. Create an AMD module and annotate some symbols with @export\r\n\r\nFind the attached amd.zip as usual.\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\n\r\nProperly compiled library code with @exported symbols preserved is expected, instead the following error occurs:\r\n\r\njava -jar ../../../../build/tool/gccompiler/compiler.jar --common_js_entry_module\u003dFoo.js --compilation_level\u003dADVANCED_OP\r\nTIMIZATIONS --generate_exports --process_common_js_modules --transform_amd_modules --warning_level\u003dVERBOSE --js\u003dFoo.js -\r\n-js\u003dlib/Bar.js --js\u003dlib/Baz.js \u0026gt; out.js\r\nFoo.js:9: ERROR - variable goog is undeclared\r\n  var Foo \u003d function() {\r\n  ^\r\n\r\n1 error(s), 0 warning(s)\r\nmake: *** [out.js] Error 1\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\n\r\nGJSCC r2256, Win7 x64\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\n1. Adding --process_closure_primitives does not help\r\n2. Adding goog/base.js as a source file does not help\r\n3. Changing --warning_level from VERBOSE to DEFAULT produces the following output:\r\n\r\nvar a\u003d[];function b(g){return function(){return a[g].apply(this,arguments)}};var c\u003d{};function d(){}d.prototype\u003d{};d.prototype.b\u003db(1);c.a\u003d{c:d};c.a\u0026amp;\u0026amp;(c\u003dc.a);var e\u003d{};function f(){}f.prototype\u003d{};f.prototype.b\u003db(0);e.a\u003d{d:f};e.a\u0026amp;\u0026amp;(e\u003de.a);function h(g,l){return a[g]\u003dl}d.prototype.b\u003dh(1,function(){return\u0026quot;Hello\u0026quot;});f.prototype.b\u003dh(0,function(){return\u0026quot;Goodbye\u0026quot;});var i\u003d{},j\u003dc.c;function k(){}goog.g(\u0026quot;Foo$$module$Foo\u0026quot;,k);k.prototype\u003dObject.create(j.prototype);k.prototype.b\u003dfunction(){return j.prototype.b.call(this)+\u0026quot;, World!\u0026quot;};goog.f(k.prototype,\u0026quot;foo\u0026quot;,k.prototype.b);i.a\u003d{e:k};i.a\u0026amp;\u0026amp;(i\u003di.a);\r\n\r\n3a. Generated symbol for Foo constructor seems to be mangled\r\n3b. Export functions goog.g/d are not defined in the source\r\n3c. Adding goog/base.js to the sources does not help\r\n\r\nPerhaps in case of AMD modules compiler could generate export function definitions.\r\n","timestamp":1350399855,"attachments":[{"id":8400000000,"fileName":"amd.zip","fileSize":1214}]},{"id":1,"commenterId":-8769171937076622550,"content":"Issue tracking has been migrated to github. Please make any further comments on this issue through https://github.com/google/closure-compiler/issues","timestamp":1398969110,"attachments":[]},{"id":2,"commenterId":-8769171937076622550,"content":"","timestamp":1398969252,"attachments":[]}]}