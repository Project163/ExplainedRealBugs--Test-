{"id":25,"status":"Fixed","summary":"ant test fails to run all tests, sometimes gives OOM error","labels":["Type-Defect","Priority-Medium"],"stars":1,"commentCount":3,"comments":[{"id":0,"commenterId":-2383702226191207389,"content":"\u003cb\u003eWhat steps will reproduce the problem?\u003c/b\u003e\n1. svn checkout http://closure-compiler.googlecode.com/svn/trunk/ closure-compiler-read-only\r\n2. cd closure-compiler-read-only\r\n3. ant clean \u0026amp;\u0026amp; ant test\r\n\r\n\u003cb\u003eWhat is the expected output? What do you see instead?\u003c/b\u003e\nExpected: all tests to run\r\n\r\nInstead: the tests begin running, until:\r\n    [junit] Testcase: testIndividualPasses took 0.105 sec\r\n    [junit] Testcase: testCombinedPasses took 0 sec\r\n    [junit] Testcase: testScopes took 0.039 sec\r\n    [junit] Testsuite: com.google.javascript.jscomp.CompilerOptionsTest\r\n    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.007 sec\r\n    [junit] \r\n    [junit] Testcase: testDefines took 0.007 sec\r\n    [junit] Testsuite: com.google.javascript.jscomp.CompilerRunnerTest\r\njava.lang.OutOfMemoryError: PermGen space\r\n\tat org.apache.tools.ant.DefaultLogger.getBuildFailedMessage(DefaultLogger.java:175)\r\n\tat org.apache.tools.ant.DefaultLogger.buildFinished(DefaultLogger.java:146)\r\n\tat org.apache.tools.ant.Project.fireBuildFinished(Project.java:2008)\r\n\tat org.apache.tools.ant.Main.runBuild(Main.java:718)\r\n\tat org.apache.tools.ant.Main.startAnt(Main.java:199)\r\n\tat org.apache.tools.ant.launch.Launcher.run(Launcher.java:257)\r\n\tat org.apache.tools.ant.launch.Launcher.main(Launcher.java:104)\r\nPermGen space\r\n\r\n\u003cb\u003eWhat version of the product are you using? On what operating system?\u003c/b\u003e\nRevision 4 of Closure Compiler\r\n\r\nApache Ant version 1.7.0 compiled on July 20 2009\r\n\r\njava version \u0026quot;1.6.0_15\u0026quot;\r\nJava(TM) SE Runtime Environment (build 1.6.0_15-b03-219)\r\nJava HotSpot(TM) 64-Bit Server VM (build 14.1-b02-90, mixed mode)\r\n\r\n\r\n\u003cb\u003ePlease provide any additional information below.\u003c/b\u003e\n\r\nIf I run ant test again without running ant clean the output ends with\r\n    [junit] Testcase: testIndividualPasses took 0.154 sec\r\n    [junit] Testcase: testCombinedPasses took 0.001 sec\r\n    [junit] Testcase: testScopes took 0.04 sec\r\n    [junit] Testsuite: com.google.javascript.jscomp.CompilerOptionsTest\r\n    [junit] Tests run: 1, Failures: 0, Errors: 0, Time elapsed: 0.007 sec\r\n    [junit] \r\n    [junit] Testcase: testDefines took 0.007 sec\r\n    [junit] Testsuite: com.google.javascript.jscomp.CompilerRunnerTest\r\n0 error(s), 1 warning(s), \r\n\r\nand an exit code of 1","timestamp":1257843454,"attachments":[]},{"id":1,"commenterId":-2383702226191207389,"content":"So it seems like there\u0027s a space leak (in ant?  ant/junit?).  A PermGen space error is an \r\nerror indicating that the permanent generation has gotten full, meaning that there \r\nare too many long lived objects.  There are two simple solutions, one is for the user \r\nto increase the limits set by the jvm:\r\n\r\nANT_OPTS\u003d\"-Xmx2048m -XX:MaxPermSize\u003d1024m\"; ant clean \u0026\u0026 time ant test\r\n\r\nThe other is to fork for each test, so in build.xml:\r\n-    \u003cjunit\u003e\r\n+    \u003cjunit fork\u003d\"true\" \u003e\r\n\r\nForking has a speed penalty, so running all tests goes from ~60 seconds to ~140 \r\nseconds.  On the other hand, I don\u0027t see any way to set JVM arguments to ant once \r\nyou\u0027re in ant.","timestamp":1257965376,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"fixed as of revision 21. thanks for the hint!","timestamp":1260316241,"attachments":[]}]}