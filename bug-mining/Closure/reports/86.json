{"id":353,"status":"Fixed","summary":"Make CommandLineRunner more extensible","labels":["Type-Defect","Priority-Medium"],"stars":1,"commentCount":10,"comments":[{"id":0,"commenterId":762579343125227761,"content":"To make Google closure compiler easier to integrate with other libraries, it would be good to change the accessibility of some methods of the AbstractCommandLineRunner which is the main entry point.\r\nIt will be particularly helpful to update the methods who deals with how to retrieve and write the JS contents.\r\n\r\nI\u0027m working currently on the integration of the closure compiler with Jawr (http://jawr.java.net/), and these modifications will greatly help me to achieve it.\r\n\r\nI\u0027ve attached a patch of the AbstractCommandLineRunner to this issue.\r\n\r\nThere is no particular test to make as it\u0027s only the update of the accessibility of some methods.\r\n","timestamp":1298471849,"attachments":[{"id":8615291696011697948,"fileName":"AbstractCommandLineRunner-patch.txt","fileSize":3354}]},{"id":1,"commenterId":-5060162230523776870,"content":"I\u0027m not clear what you are trying to accomplish, the command line runner is intended to be used with the command-line.  If you are using the Java API, I would expect you to be using the interfaces that the AbstractCommandLineRunner uses.\r\n\r\nCan you explain how these changes are helpful?","timestamp":1298488564,"attachments":[]},{"id":2,"commenterId":762579343125227761,"content":"Yes, it\u0027s true that the command line runner is inteded to be used with the command line.\r\nBut the fact is that this is also where you add new options to the compiler using arguments.\r\nI\u0027ve choosen to override the Command Line Runner, because I would like to allow the user to pass argument through my custom config to the Command Line Runner.\r\nIn that case, if the user wants to add a new option which was not available when my project was released, he will be able to do so without a new release of my project.\r\nIt helps me to decouple the version of my project used from the version of the closure compiler.\r\n\r\nDon\u0027t hesitate to tell me if you need more clarifications.","timestamp":1298489134,"attachments":[]},{"id":3,"commenterId":762579343125227761,"content":"So here I\u0027ve explained you why I use the AbstractCommandLineRunner instead of the API directly.\r\n\r\nFor the changes which I\u0027ve made, it\u0027s primarily to have an abstraction on the content handling.\r\nFor instance, if in the arguments, I have --js comp.js, I would be able to handle where to find the resource the comp.js resource.\r\nWhith the modification which I\u0027ve made, A custom CommandLineRunner would be able to retrieve comp.js from a jar file, over the network or anywhere else.\r\nAnd with the same idea in mind, I can define where I want to write the generated contents.","timestamp":1298489736,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"so i think i\u0027m ok with some of this, but not other parts. for example, it seems surprising that you would override checkModuleName or streamToOutputWriter?\r\n\r\nI think the \"right\" API might be to have:\r\n1) protected final methods for code that\u0027s genuinely re-usable, but that you don\u0027t want to override\r\n2) high-level methods for every input and output source. So there\u0027d be a createInputs, createSourceMapOutput, etc., and all of these would return Writers. We\u0027d encourage people to override these.\r\n\r\nI think that might be a bit easier for others to use and understand.\r\n\r\nwdyt?\r\n\r\nit might be worthwhile to set up a code review at codereview.appspot.com, because we may need to do some give-and-take to figure out what works best for you.","timestamp":1298593762,"attachments":[]},{"id":5,"commenterId":762579343125227761,"content":"Hi,\r\n\r\nI\u0027m totally agree with you.\r\nIn fact, I wanted to make the less changes in the code, this is why I didn\u0027t introduce new methods.\r\n\r\nI definitely think that we can introduce a cleaner API for this.\r\n\r\nAbout the new checkModuleName method, in fact, I\u0027ve found it a little bit to strict the format of the JS module names allowed.\r\nIn the current implementation you only accept JS identifiers, while there are just IDs. I think that any string should be allowed.\r\nIn some of my module I use some special characters like \u0027@\u0027. And in that case, with the current implementation the module name is not correct.\r\n\r\nFor the override of streamToOutputWriter, I have made it protected because in the current implementation of fileNameToOutputWriter, a call is made to streamToOutputWriter to define a writer with the correct charset.\r\nWhen I have overridden the fileNameToOutputWriter to protected, I had to make streamToOutputWriter protected also tobe able to have the same functionality.\r\n\r\nI\u0027ll clean up a little bit the implementation and I\u0027ll set up a code review at codereview.appspot.com.\r\n\r\nI\u0027ll let you know when it\u0027ll be done.\r\n\r\n","timestamp":1298630572,"attachments":[]},{"id":6,"commenterId":-7699928860083865744,"content":"Also, if you haven\u0027t already, you should sign a CLA, which basically says that we didn\u0027t steal your code. for more info, see:\r\nhttp://code.google.com/p/closure-compiler/source/browse/trunk/CONTRIBUTORS","timestamp":1298650605,"attachments":[]},{"id":7,"commenterId":762579343125227761,"content":"I\u0027ve just signed the CLA.","timestamp":1298652925,"attachments":[]},{"id":8,"commenterId":-7699928860083865744,"content":"This issue was closed by revision r823.","timestamp":1298682500,"attachments":[]},{"id":9,"commenterId":762579343125227761,"content":"Hi,\r\n\r\nI\u0027ve just noticed that the name of the method is not consistent with the method which creates an output writer.\r\n\r\nThe method which creates the writer is :\r\n\r\nprivate Writer fileNameToOutputWriter(String fileName) \r\n\r\nWhile the new one is\r\n\r\nprotected OutputStream filenameToOutputStream(String fileName)\r\n\r\nIn the first method, the \u0027N\u0027 character of \u0027name\u0027 is capitalized while it\u0027s not in the second one.\r\nI think that it would be good to rename the new method as: \r\n\r\nprotected OutputStream fileNameToOutputStream(String fileName)\r\n\r\nSorry, I should have seen that before.","timestamp":1298713042,"attachments":[]}]}