{"id":180,"status":"Duplicate","summary":"function call mis-optimized to method call ","labels":["Type-Defect","Priority-Medium","Restrict-AddIssueComment-Nobody"],"stars":3,"commentCount":8,"comments":[{"id":0,"commenterId":102554887883123445,"content":"Given\r\n    (0, foo[i])(\u0027bar\u0027)\r\nclosure compiler optimizes this to\r\n    foo[i](\u0027bar\u0027)\r\n\r\nThis is semantics breaking because now foo[i] is called with \u0026quot;this\u0026quot; being foo instead of the global object.\r\n\r\nConsider the listener code below\r\n  function EventDispatcher() {\r\n    var listeners \u003d [];\r\n    this.addListener \u003d function (listener) {\r\n      listeners[listeners.length] \u003d listener;\r\n    };\r\n    this.fire \u003d function (event) {\r\n      for (var i \u003d 0, n \u003d listeners.length; i \u0026lt; n; ++i) {\r\n        (0, listeners[i])(event);\r\n      }\r\n    };\r\n  }\r\n\r\nEach listener now has access to all the other listeners violating EventDispatcher\u0027s ability to keep its privates private.","timestamp":1276728819,"attachments":[]},{"id":1,"commenterId":102554887883123445,"content":"There is another instance of this problem.\r\n\r\nGiven\r\n(function () {\r\n    var x \u003d foo[i];\r\n    x(\u0027bar\u0027)\r\n})()\r\nclosure compiler optimizes this to\r\n    (function(){foo[i](\"bar\")})();\r\n\r\nThis is semantics breaking in the same way as the latter if fire is rewritten to:\r\n\r\n    this.fire \u003d function (event) {\r\n      for (var i \u003d 0, n \u003d listeners.length; i \u003c n; ++i) {\r\n        var listener \u003d listeners[i];\r\n        listener(event);\r\n      }\r\n    };\r\n","timestamp":1276729010,"attachments":[]},{"id":2,"commenterId":-7699928860083865744,"content":"i think i have a good idea on how to fix these in a comprehensive way. thanks for letting us know.","timestamp":1276736615,"attachments":[]},{"id":3,"commenterId":6454800031398885070,"content":"I was considering adding an attribute to the function calls early (something like NO_THIS) and having the code generator output convert (foo[i])() to (0, foo[i])() on output.\r\n\r\nI also think we could convert foo.f.call(null,...) or foo.f.call(undefined,...) into (0, foo.f)(), if we cared.","timestamp":1276752464,"attachments":[]},{"id":4,"commenterId":-7699928860083865744,"content":"wow! great minds think alike!\r\n\r\nanother weird idea i had was to separate CALL into two distinct tokens: RECEIVED_CALL and FREE_CALL (Bolin\u0027s book calls \"this\" the \"receiver\", which I think is a nice name for it). But admittedly, this idea would require much more work and might break people.","timestamp":1276753063,"attachments":[]},{"id":5,"commenterId":-5060162230523776870,"content":"A basic fix as introduced in r282, additional testing is required to confirm no new CALL sites are created without taking the \"Free call\" annotation into consideration.","timestamp":1279648990,"attachments":[]},{"id":6,"commenterId":-8769171937076622550,"content":"Issue tracking has been migrated to github. Please make any further comments on this issue through https://github.com/google/closure-compiler/issues","timestamp":1398969109,"attachments":[]},{"id":7,"commenterId":-8769171937076622550,"content":"","timestamp":1398969251,"attachments":[]}]}