diff --git a/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java b/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java
index e2e102c66..5a398a567 100644
--- a/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java
+++ b/src/com/google/javascript/jscomp/AbstractCommandLineRunner.java
@@ -22,6 +22,7 @@ import com.google.common.base.Function;
 import com.google.common.base.Joiner;
 import com.google.common.base.Preconditions;
 import com.google.common.base.Supplier;
+import com.google.common.base.Throwables;
 import com.google.common.collect.ImmutableList;
 import com.google.common.collect.Lists;
 import com.google.common.collect.Maps;
@@ -34,6 +35,7 @@ import java.io.BufferedWriter;
 import java.io.Closeable;
 import java.io.File;
 import java.io.FileOutputStream;
+import java.io.Flushable;
 import java.io.IOException;
 import java.io.OutputStream;
 import java.io.OutputStreamWriter;
@@ -88,7 +90,7 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
 
   private final CommandLineConfig config;
 
-  private Appendable out;
+  private Appendable jsOutput;
   private final PrintStream err;
   private A compiler;
 
@@ -114,8 +116,8 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
 
   AbstractCommandLineRunner(PrintStream out, PrintStream err) {
     this.config = new CommandLineConfig();
-    this.out = out;
-    this.err = err;
+    this.jsOutput = Preconditions.checkNotNull(out);
+    this.err = Preconditions.checkNotNull(err);
   }
 
   /**
@@ -288,6 +290,14 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
       runTimeStats.outputBestPhaseOrdering();
     }
 
+    try {
+      if (jsOutput instanceof Closeable) {
+        ((Closeable) jsOutput).close();
+      }
+    } catch (IOException e) {
+      throw Throwables.propagate(e);
+    }
+
     if (testMode) {
       exitCodeReceiverForTesting.apply(result);
     } else {
@@ -605,9 +615,9 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
 
     boolean writeOutputToFile = !options.jsOutputFile.isEmpty();
     if (writeOutputToFile) {
-      out = fileNameToOutputWriter(options.jsOutputFile);
-    } else if (out instanceof OutputStream) {
-      out = streamToOutputWriter((OutputStream) out);
+      jsOutput = fileNameToOutputWriter(options.jsOutputFile);
+    } else if (jsOutput instanceof OutputStream) {
+      jsOutput = streamToOutputWriter((OutputStream) jsOutput);
     }
 
     List<String> jsFiles = config.js;
@@ -621,9 +631,11 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
     }
 
     int errCode = processResults(result, modules, options);
-    // Close the output if we are writing to a file.
-    if (out instanceof Closeable) {
-      ((Closeable) out).close();
+    // Flush the output if we are writing to a file.
+    // We can't close yet, because we may need to write phase ordering
+    // info to it later.
+    if (jsOutput instanceof Flushable) {
+      ((Flushable) jsOutput).flush();
     }
     return errCode;
   }
@@ -641,8 +653,9 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
       if (compiler.getRoot() == null) {
         return 1;
       } else {
-        out.append(DotFormatter.toDot(compiler.getPassConfig().getPassGraph()));
-        out.append('\n');
+        jsOutput.append(
+            DotFormatter.toDot(compiler.getPassConfig().getPassGraph()));
+        jsOutput.append('\n');
         return 0;
       }
     }
@@ -652,26 +665,28 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
         return 1;
       } else {
         ControlFlowGraph<Node> cfg = compiler.computeCFG();
-        DotFormatter.appendDot(compiler.getRoot().getLastChild(), cfg, out);
-        out.append('\n');
+        DotFormatter.appendDot(
+            compiler.getRoot().getLastChild(), cfg, jsOutput);
+        jsOutput.append('\n');
         return 0;
       }
     }
 
     if (config.printTree) {
       if (compiler.getRoot() == null) {
-        out.append("Code contains errors; no tree was generated.\n");
+        jsOutput.append("Code contains errors; no tree was generated.\n");
         return 1;
       } else {
-        compiler.getRoot().appendStringTree(out);
-        out.append("\n");
+        compiler.getRoot().appendStringTree(jsOutput);
+        jsOutput.append("\n");
         return 0;
       }
     }
 
     if (result.success) {
       if (modules == null) {
-        writeOutput(out, compiler, compiler.toSource(), config.outputWrapper,
+        writeOutput(
+            jsOutput, compiler, compiler.toSource(), config.outputWrapper,
             OUTPUT_WRAPPER_MARKER);
 
         // Output the source map if requested.
@@ -1209,12 +1224,13 @@ abstract class AbstractCommandLineRunner<A extends Compiler,
      */
     private void outputBestPhaseOrdering() {
       try {
-        out.append("Best time: " + bestRunTime + "\n");
-        out.append("Worst time: " + worstRunTime + "\n");
+        jsOutput.append("Best time: " + bestRunTime + "\n");
+        jsOutput.append("Worst time: " + worstRunTime + "\n");
 
         int i = 1;
         for (List<String> loop : loopedPassesInBestRun) {
-          out.append("\nLoop " + i + ":\n" + Joiner.on("\n").join(loop)+ "\n");
+          jsOutput.append(
+              "\nLoop " + i + ":\n" + Joiner.on("\n").join(loop)+ "\n");
           i++;
         }
       } catch (IOException e) {
diff --git a/src/com/google/javascript/jscomp/CommandLineRunner.java b/src/com/google/javascript/jscomp/CommandLineRunner.java
index b1a7472ae..b48e20065 100644
--- a/src/com/google/javascript/jscomp/CommandLineRunner.java
+++ b/src/com/google/javascript/jscomp/CommandLineRunner.java
@@ -105,12 +105,6 @@ public class CommandLineRunner extends
         usage = "Prints out the parse tree and exits")
     private boolean print_tree = false;
 
-    @Option(name = "--compute_phase_ordering",
-        handler = BooleanOptionHandler.class,
-        usage = "Runs the compile job many times, then prints out the " +
-        "best phase ordering from this run")
-    private boolean compute_phase_ordering = false;
-
     @Option(name = "--print_ast",
         handler = BooleanOptionHandler.class,
         usage = "Prints a dot file describing the internal abstract syntax"
@@ -574,7 +568,6 @@ public class CommandLineRunner extends
     } else {
       getCommandLineConfig()
           .setPrintTree(flags.print_tree)
-          .setComputePhaseOrdering(flags.compute_phase_ordering)
           .setPrintAst(flags.print_ast)
           .setPrintPassGraph(flags.print_pass_graph)
           .setJscompDevMode(flags.jscomp_dev_mode)
