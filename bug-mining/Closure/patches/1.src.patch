diff --git a/javadoc/com/google/javascript/jscomp/ClosureCodingConvention.html b/javadoc/com/google/javascript/jscomp/ClosureCodingConvention.html
index 46a4b4e88..d5f01e1ea 100644
--- a/javadoc/com/google/javascript/jscomp/ClosureCodingConvention.html
+++ b/javadoc/com/google/javascript/jscomp/ClosureCodingConvention.html
@@ -307,7 +307,7 @@ This describes the Closure-specific JavaScript coding conventions.
 <TH ALIGN="left"><B>Methods inherited from class com.google.javascript.jscomp.<A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A></B></TH>
 </TR>
 <TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#applyDelegateRelationship(com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.FunctionType, com.google.javascript.rhino.jstype.FunctionType)">applyDelegateRelationship</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#defineDelegateProxyProperties(com.google.javascript.rhino.jstype.JSTypeRegistry, com.google.javascript.jscomp.Scope, java.util.Map)">defineDelegateProxyProperties</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#getDelegateRelationship(com.google.javascript.rhino.Node)">getDelegateRelationship</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#getDelegateSuperclassName()">getDelegateSuperclassName</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isConstant(java.lang.String)">isConstant</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isExported(java.lang.String)">isExported</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isPrivate(java.lang.String)">isPrivate</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isValidEnumKey(java.lang.String)">isValidEnumKey</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></CODE></TD>
+<TD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#applyDelegateRelationship(com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.ObjectType, com.google.javascript.rhino.jstype.FunctionType, com.google.javascript.rhino.jstype.FunctionType)">applyDelegateRelationship</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#defineDelegateProxyProperties(com.google.javascript.rhino.jstype.JSTypeRegistry, com.google.javascript.jscomp.Scope, java.util.Map)">defineDelegateProxyProperties</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#getDelegateRelationship(com.google.javascript.rhino.Node)">getDelegateRelationship</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#getDelegateSuperclassName()">getDelegateSuperclassName</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isConstant(java.lang.String)">isConstant</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isExported(java.lang.String)">isExported</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isPrivate(java.lang.String)">isPrivate</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isValidEnumKey(java.lang.String)">isValidEnumKey</A>, <A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></CODE></TD>
 </TR>
 </TABLE>
 &nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
diff --git a/javadoc/com/google/javascript/jscomp/CodingConvention.html b/javadoc/com/google/javascript/jscomp/CodingConvention.html
index 1247fbcb0..099b62e7b 100644
--- a/javadoc/com/google/javascript/jscomp/CodingConvention.html
+++ b/javadoc/com/google/javascript/jscomp/CodingConvention.html
@@ -349,7 +349,7 @@ CodingConvention defines a set of hooks to customize the behavior of the
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter name should be treated as an
@@ -391,8 +391,7 @@ CodingConvention defines a set of hooks to customize the behavior of the
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                   <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter should be treated as a marker
@@ -442,10 +441,10 @@ boolean <B>isValidEnumKey</B>(<A HREF="http://java.sun.com/javase/6/docs/api/jav
 </DL>
 <HR>
 
-<A NAME="isOptionalParameter(java.lang.String)"><!-- --></A><H3>
+<A NAME="isOptionalParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isOptionalParameter</H3>
 <PRE>
-boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</PRE>
+boolean <B>isOptionalParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
 <DD>This checks whether a given parameter name should be treated as an
  optional parameter as far as type checking or function call arg count
@@ -454,25 +453,24 @@ boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/docs/ap
  declared type and Undefined.
 <P>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameterName</CODE> - potentially optional parameter name
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as an optional
  parameter.</DL>
 </DD>
 </DL>
 <HR>
 
-<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><!-- --></A><H3>
+<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isVarArgsParameter</H3>
 <PRE>
-boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                           <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</PRE>
+boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
 <DD>This checks whether a given parameter should be treated as a marker
  for a variable argument list function. A VarArgs parameter must be the
  last parameter in a function declaration.
 <P>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node, or null if none.<DD><CODE>name</CODE> - The name, in case we don't have a node.
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as a variable
  length parameter.</DL>
 </DD>
diff --git a/javadoc/com/google/javascript/jscomp/DefaultCodingConvention.html b/javadoc/com/google/javascript/jscomp/DefaultCodingConvention.html
index 8b91ab512..9203a7a8a 100644
--- a/javadoc/com/google/javascript/jscomp/DefaultCodingConvention.html
+++ b/javadoc/com/google/javascript/jscomp/DefaultCodingConvention.html
@@ -346,7 +346,7 @@ CodingConvention defines a set of hooks to customize the behavior of the
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter name should be treated as an
@@ -388,8 +388,7 @@ CodingConvention defines a set of hooks to customize the behavior of the
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                   <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter should be treated as a marker
@@ -473,12 +472,12 @@ public boolean <B>isValidEnumKey</B>(<A HREF="http://java.sun.com/javase/6/docs/
 </DL>
 <HR>
 
-<A NAME="isOptionalParameter(java.lang.String)"><!-- --></A><H3>
+<A NAME="isOptionalParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isOptionalParameter</H3>
 <PRE>
-public boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</PRE>
+public boolean <B>isOptionalParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
-<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(java.lang.String)">CodingConvention</A></CODE></B></DD>
+<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">CodingConvention</A></CODE></B></DD>
 <DD>This checks whether a given parameter name should be treated as an
  optional parameter as far as type checking or function call arg count
  checking is concerned. Note that an optional function parameter may be
@@ -486,32 +485,31 @@ public boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/
  declared type and Undefined.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE></DL>
+<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE></DL>
 </DD>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameterName</CODE> - potentially optional parameter name
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as an optional
  parameter.</DL>
 </DD>
 </DL>
 <HR>
 
-<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><!-- --></A><H3>
+<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isVarArgsParameter</H3>
 <PRE>
-public boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                                  <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</PRE>
+public boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
-<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">CodingConvention</A></CODE></B></DD>
+<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">CodingConvention</A></CODE></B></DD>
 <DD>This checks whether a given parameter should be treated as a marker
  for a variable argument list function. A VarArgs parameter must be the
  last parameter in a function declaration.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE></DL>
+<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE></DL>
 </DD>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node, or null if none.<DD><CODE>name</CODE> - The name, in case we don't have a node.
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as a variable
  length parameter.</DL>
 </DD>
diff --git a/javadoc/com/google/javascript/jscomp/GoogleCodingConvention.html b/javadoc/com/google/javascript/jscomp/GoogleCodingConvention.html
index 135d9a7d3..2fc51e21e 100644
--- a/javadoc/com/google/javascript/jscomp/GoogleCodingConvention.html
+++ b/javadoc/com/google/javascript/jscomp/GoogleCodingConvention.html
@@ -176,7 +176,7 @@ This describes the Google-specific JavaScript coding conventions.
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/GoogleCodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/GoogleCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter name should be treated as an
@@ -202,8 +202,7 @@ This describes the Google-specific JavaScript coding conventions.
 <TR BGCOLOR="white" CLASS="TableRowColor">
 <TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
 <CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/GoogleCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                   <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</CODE>
+<TD><CODE><B><A HREF="../../../../com/google/javascript/jscomp/GoogleCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</CODE>
 
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;This checks whether a given parameter should be treated as a marker
@@ -328,10 +327,10 @@ public boolean <B>isValidEnumKey</B>(<A HREF="http://java.sun.com/javase/6/docs/
 </DL>
 <HR>
 
-<A NAME="isOptionalParameter(java.lang.String)"><!-- --></A><H3>
+<A NAME="isOptionalParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isOptionalParameter</H3>
 <PRE>
-public boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;parameterName)</PRE>
+public boolean <B>isOptionalParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
 <DD>This checks whether a given parameter name should be treated as an
  optional parameter as far as type checking or function call arg count
@@ -343,32 +342,31 @@ public boolean <B>isOptionalParameter</B>(<A HREF="http://java.sun.com/javase/6/
  treated as optional arguments.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(java.lang.String)">isOptionalParameter</A></CODE> in class <CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A></CODE></DL>
+<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)">isOptionalParameter</A></CODE> in class <CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A></CODE></DL>
 </DD>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameterName</CODE> - potentially optional parameter name
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as an optional
  parameter.</DL>
 </DD>
 </DL>
 <HR>
 
-<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><!-- --></A><H3>
+<A NAME="isVarArgsParameter(com.google.javascript.rhino.Node)"><!-- --></A><H3>
 isVarArgsParameter</H3>
 <PRE>
-public boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter,
-                                  <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;name)</PRE>
+public boolean <B>isVarArgsParameter</B>(<A HREF="../../../../com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>&nbsp;parameter)</PRE>
 <DL>
-<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">CodingConvention</A></CODE></B></DD>
+<DD><B>Description copied from interface: <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">CodingConvention</A></CODE></B></DD>
 <DD>This checks whether a given parameter should be treated as a marker
  for a variable argument list function. A VarArgs parameter must be the
  last parameter in a function declaration.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)">isVarArgsParameter</A></CODE> in class <CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A></CODE></DL>
+<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></CODE> in interface <CODE><A HREF="../../../../com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A></CODE><DT><B>Overrides:</B><DD><CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)">isVarArgsParameter</A></CODE> in class <CODE><A HREF="../../../../com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A></CODE></DL>
 </DD>
 <DD><DL>
-<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node, or null if none.<DD><CODE>name</CODE> - The name, in case we don't have a node.
+<DT><B>Parameters:</B><DD><CODE>parameter</CODE> - The parameter's node.
 <DT><B>Returns:</B><DD><code>true</code> if the parameter should be treated as a variable
  length parameter.</DL>
 </DD>
diff --git a/javadoc/index-all.html b/javadoc/index-all.html
index 2d99c4081..f7923eb1d 100644
--- a/javadoc/index-all.html
+++ b/javadoc/index-all.html
@@ -3970,15 +3970,15 @@ Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhi
 <DT><A HREF="./com/google/javascript/rhino/Node.html#isOptionalArg()"><B>isOptionalArg()</B></A> - 
 Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>
 <DD>Returns whether this node is an optional argument node.
-<DT><A HREF="./com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(java.lang.String)"><B>isOptionalParameter(String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/CodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)"><B>isOptionalParameter(Node)</B></A> - 
 Method in interface com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A>
 <DD>This checks whether a given parameter name should be treated as an
  optional parameter as far as type checking or function call arg count
  checking is concerned.
-<DT><A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(java.lang.String)"><B>isOptionalParameter(String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)"><B>isOptionalParameter(Node)</B></A> - 
 Method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html#isOptionalParameter(java.lang.String)"><B>isOptionalParameter(String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html#isOptionalParameter(com.google.javascript.rhino.Node)"><B>isOptionalParameter(Node)</B></A> - 
 Method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html" title="class in com.google.javascript.jscomp">GoogleCodingConvention</A>
 <DD>This checks whether a given parameter name should be treated as an
  optional parameter as far as type checking or function call arg count
@@ -4212,14 +4212,14 @@ Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhi
 <DT><A HREF="./com/google/javascript/rhino/Node.html#isVarArgs()"><B>isVarArgs()</B></A> - 
 Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Node.html" title="class in com.google.javascript.rhino">Node</A>
 <DD>Returns whether this node is a variable length argument node.
-<DT><A HREF="./com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><B>isVarArgsParameter(Node, String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/CodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)"><B>isVarArgsParameter(Node)</B></A> - 
 Method in interface com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/CodingConvention.html" title="interface in com.google.javascript.jscomp">CodingConvention</A>
 <DD>This checks whether a given parameter should be treated as a marker
  for a variable argument list function.
-<DT><A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><B>isVarArgsParameter(Node, String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)"><B>isVarArgsParameter(Node)</B></A> - 
 Method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/DefaultCodingConvention.html" title="class in com.google.javascript.jscomp">DefaultCodingConvention</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node, java.lang.String)"><B>isVarArgsParameter(Node, String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html#isVarArgsParameter(com.google.javascript.rhino.Node)"><B>isVarArgsParameter(Node)</B></A> - 
 Method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/GoogleCodingConvention.html" title="class in com.google.javascript.jscomp">GoogleCodingConvention</A>
 <DD>&nbsp;
 <DT><A HREF="./com/google/javascript/rhino/jstype/JSType.html#isVoidType()"><B>isVoidType()</B></A> - 
diff --git a/lib/google_common_deploy.jar b/lib/google_common_deploy.jar
index eadc6c013..46d7efa34 100755
Binary files a/lib/google_common_deploy.jar and b/lib/google_common_deploy.jar differ
diff --git a/src/com/google/javascript/jscomp/CodingConvention.java b/src/com/google/javascript/jscomp/CodingConvention.java
index 7db14a415..a70181900 100644
--- a/src/com/google/javascript/jscomp/CodingConvention.java
+++ b/src/com/google/javascript/jscomp/CodingConvention.java
@@ -59,23 +59,22 @@ public interface CodingConvention {
    * declared as a simple type and is automatically converted to a union of the
    * declared type and Undefined.
    *
-   * @param parameterName potentially optional parameter name
+   * @param parameter The parameter's node.
    * @return {@code true} if the parameter should be treated as an optional
    * parameter.
    */
-  public boolean isOptionalParameter(String parameterName);
+  public boolean isOptionalParameter(Node parameter);
 
   /**
    * This checks whether a given parameter should be treated as a marker
    * for a variable argument list function. A VarArgs parameter must be the
    * last parameter in a function declaration.
    *
-   * @param parameter The parameter's node, or null if none.
-   * @param name The name, in case we don't have a node.
+   * @param parameter The parameter's node.
    * @return {@code true} if the parameter should be treated as a variable
    * length parameter.
    */
-  public boolean isVarArgsParameter(Node parameter, String name);
+  public boolean isVarArgsParameter(Node parameter);
 
   /**
    * Checks whether a global variable or function name should be treated as
diff --git a/src/com/google/javascript/jscomp/CodingConventionAnnotator.java b/src/com/google/javascript/jscomp/CodingConventionAnnotator.java
index 9fad5b00b..4caa22863 100644
--- a/src/com/google/javascript/jscomp/CodingConventionAnnotator.java
+++ b/src/com/google/javascript/jscomp/CodingConventionAnnotator.java
@@ -82,11 +82,11 @@ class CodingConventionAnnotator extends NodeTraversal.AbstractPostOrderCallback
           JSTypeExpression typeExpr = fnInfo == null ?
               null : fnInfo.getParameterType(argName);
 
-          if (convention.isOptionalParameter(argName) ||
+          if (convention.isOptionalParameter(arg) ||
               typeExpr != null && typeExpr.isOptionalArg()) {
             arg.putBooleanProp(Node.IS_OPTIONAL_PARAM, true);
           }
-          if (convention.isVarArgsParameter(arg, argName) ||
+          if (convention.isVarArgsParameter(arg) ||
               typeExpr != null && typeExpr.isVarArgs()) {
             arg.putBooleanProp(Node.IS_VAR_ARGS_PARAM, true);
           }
diff --git a/src/com/google/javascript/jscomp/DefaultCodingConvention.java b/src/com/google/javascript/jscomp/DefaultCodingConvention.java
index 98986105d..11103c045 100644
--- a/src/com/google/javascript/jscomp/DefaultCodingConvention.java
+++ b/src/com/google/javascript/jscomp/DefaultCodingConvention.java
@@ -43,15 +43,16 @@ public class DefaultCodingConvention implements CodingConvention {
   }
 
   @Override
-  public boolean isOptionalParameter(String parameterName) {
-    return true; // be as lax as possible
+  public boolean isOptionalParameter(Node parameter) {
+    // be as lax as possible, but this must be mutually exclusive from
+    // var_args parameters.
+    return !isVarArgsParameter(parameter);
   }
 
   @Override
-  public boolean isVarArgsParameter(Node parameter, String name) {
+  public boolean isVarArgsParameter(Node parameter) {
     // be as lax as possible
-    return parameter != null &&
-        parameter.getParent().getLastChild() == parameter;
+    return parameter.getParent().getLastChild() == parameter;
   }
 
   @Override
diff --git a/src/com/google/javascript/jscomp/FunctionTypeBuilder.java b/src/com/google/javascript/jscomp/FunctionTypeBuilder.java
index ed39845e2..95850ab42 100644
--- a/src/com/google/javascript/jscomp/FunctionTypeBuilder.java
+++ b/src/com/google/javascript/jscomp/FunctionTypeBuilder.java
@@ -20,14 +20,13 @@ import static com.google.javascript.jscomp.TypeCheck.BAD_IMPLEMENTED_TYPE;
 import static com.google.javascript.rhino.jstype.JSTypeNative.FUNCTION_FUNCTION_TYPE;
 import static com.google.javascript.rhino.jstype.JSTypeNative.UNKNOWN_TYPE;
 
-import javax.annotation.Nullable;
 import com.google.common.base.Preconditions;
-import com.google.common.collect.ImmutableList;
 import com.google.common.collect.Lists;
 import com.google.common.collect.Sets;
 import com.google.javascript.rhino.JSDocInfo;
 import com.google.javascript.rhino.JSTypeExpression;
 import com.google.javascript.rhino.Node;
+import com.google.javascript.rhino.Token;
 import com.google.javascript.rhino.jstype.FunctionParamBuilder;
 import com.google.javascript.rhino.jstype.FunctionType;
 import com.google.javascript.rhino.jstype.InstanceObjectType;
@@ -39,6 +38,7 @@ import java.util.Iterator;
 import java.util.List;
 import java.util.Set;
 
+import javax.annotation.Nullable;
 
 /**
  * A builder for FunctionTypes, because FunctionTypes are so
@@ -176,13 +176,12 @@ final class FunctionTypeBuilder {
         if (oldParams.hasNext()) {
           paramBuilder.newParameterFromNode(oldParams.next());
         } else {
-          String name = currentParam.getString();
           warnedAboutArgList |= addParameter(
               paramBuilder,
               typeRegistry.getNativeType(UNKNOWN_TYPE),
               warnedAboutArgList,
-              codingConvention.isOptionalParameter(name),
-              codingConvention.isVarArgsParameter(currentParam, name));
+              codingConvention.isOptionalParameter(currentParam),
+              codingConvention.isVarArgsParameter(currentParam));
         }
       }
       parametersNode = paramBuilder.build();
@@ -308,39 +307,33 @@ final class FunctionTypeBuilder {
     return this;
   }
 
-  /**
-   * Infer the parameter types from the list of arguments in the AST.
-   */
-  FunctionTypeBuilder inferParameterTypes(Node argsParent,
-      @Nullable JSDocInfo info) {
-    if (argsParent == null) {
-      return inferParameterTypes(info);
-    }
-
-    List<String> argsList = ImmutableList.of();
-    if (argsParent.getFirstChild() != null) {
-      argsList = Lists.newArrayList();
-      for (Node n : argsParent.children()) {
-        argsList.add(n.getString());
-      }
-    }
-
-    return inferParameterTypes(argsList, info);
-  }
-
   /**
    * Infer the parameter types from the doc info alone.
    */
   FunctionTypeBuilder inferParameterTypes(JSDocInfo info) {
-    return inferParameterTypes(info.getParameterNames(), info);
+    // Create a fake args parent.
+    Node lp = new Node(Token.LP);
+    for (String name : info.getParameterNames()) {
+      lp.addChildToBack(Node.newString(Token.NAME, name));
+    }
+
+    return inferParameterTypes(lp, info);
   }
 
   /**
    * Infer the parameter types from the list of argument names and
    * the doc info.
    */
-  private FunctionTypeBuilder inferParameterTypes(Iterable<String> argList,
+  FunctionTypeBuilder inferParameterTypes(@Nullable Node argsParent,
       @Nullable JSDocInfo info) {
+    if (argsParent == null) {
+      if (info == null) {
+        return this;
+      } else {
+        return inferParameterTypes(info);
+      }
+    }
+
     // arguments
     FunctionParamBuilder builder = new FunctionParamBuilder(typeRegistry);
     boolean warnedAboutArgList = false;
@@ -348,7 +341,8 @@ final class FunctionTypeBuilder {
         Sets.<String>newHashSet() :
         Sets.newHashSet(info.getParameterNames());
     boolean foundTemplateType = false;
-    for (String argumentName : argList) {
+    for (Node arg : argsParent.children()) {
+      String argumentName = arg.getString();
       allJsDocParams.remove(argumentName);
 
       // type from JSDocInfo
@@ -365,8 +359,8 @@ final class FunctionTypeBuilder {
       }
       warnedAboutArgList |= addParameter(
           builder, parameterType, warnedAboutArgList,
-          isOptionalParameter(argumentName, info),
-          isVarArgsParameter(argumentName, info));
+          isOptionalParameter(arg, info),
+          isVarArgsParameter(arg, info));
     }
 
     if (templateTypeName != null && !foundTemplateType) {
@@ -374,9 +368,7 @@ final class FunctionTypeBuilder {
     }
 
     for (String inexistentName : allJsDocParams) {
-      if (!isVarArgsParameter(inexistentName, info)) {
-        reportWarning(INEXISTANT_PARAM, inexistentName, fnName);
-      }
+      reportWarning(INEXISTANT_PARAM, inexistentName, fnName);
     }
 
     parametersNode = builder.build();
@@ -387,27 +379,27 @@ final class FunctionTypeBuilder {
    * @return Whether the given param is an optional param.
    */
   private boolean isOptionalParameter(
-      String paramName, @Nullable JSDocInfo info) {
-    if (codingConvention.isOptionalParameter(paramName)) {
+      Node param, @Nullable JSDocInfo info) {
+    if (codingConvention.isOptionalParameter(param)) {
       return true;
     }
 
+    String paramName = param.getString();
     return info != null && info.hasParameterType(paramName) &&
         info.getParameterType(paramName).isOptionalArg();
   }
 
   /**
-   * Determine whether this is a var args parameter from just the name and
-   * annotation. This is the case where we have a stub declaration, with
-   * no function literal.
+   * Determine whether this is a var args parameter.
    * @return Whether the given param is a var args param.
    */
   private boolean isVarArgsParameter(
-      String paramName, @Nullable JSDocInfo info) {
-    if (codingConvention.isVarArgsParameter(null, paramName)) {
+      Node param, @Nullable JSDocInfo info) {
+    if (codingConvention.isVarArgsParameter(param)) {
       return true;
     }
 
+    String paramName = param.getString();
     return info != null && info.hasParameterType(paramName) &&
         info.getParameterType(paramName).isVarArgs();
   }
diff --git a/src/com/google/javascript/jscomp/GoogleCodingConvention.java b/src/com/google/javascript/jscomp/GoogleCodingConvention.java
index 139d28ed7..551027672 100644
--- a/src/com/google/javascript/jscomp/GoogleCodingConvention.java
+++ b/src/com/google/javascript/jscomp/GoogleCodingConvention.java
@@ -105,13 +105,13 @@ public class GoogleCodingConvention extends ClosureCodingConvention {
    * treated as optional arguments.
    */
   @Override
-  public boolean isOptionalParameter(String parameterName) {
-    return parameterName.startsWith(OPTIONAL_ARG_PREFIX);
+  public boolean isOptionalParameter(Node parameter) {
+    return parameter.getString().startsWith(OPTIONAL_ARG_PREFIX);
   }
 
   @Override
-  public boolean isVarArgsParameter(Node parameter, String name) {
-    return VAR_ARGS_NAME.equals(name);
+  public boolean isVarArgsParameter(Node parameter) {
+    return VAR_ARGS_NAME.equals(parameter.getString());
   }
 
   /**
diff --git a/src/com/google/javascript/jscomp/Normalize.java b/src/com/google/javascript/jscomp/Normalize.java
index cadcadcff..1e5e6379d 100644
--- a/src/com/google/javascript/jscomp/Normalize.java
+++ b/src/com/google/javascript/jscomp/Normalize.java
@@ -257,8 +257,11 @@ class Normalize implements CompilerPass, Callback {
       extractForInitializer(n, null, null);
       splitVarDeclarations(n);
     }
-  }
 
+    if (n.getType() == Token.FUNCTION) {
+      moveNamedFunctions(n.getLastChild());
+    }
+  }
 
   /**
    * Bring the initializers out of FOR loops.  These need to be placed
@@ -333,6 +336,58 @@ class Normalize implements CompilerPass, Callback {
     }
   }
 
+  /**
+   * Move all the functions that are valid at the execution of the first
+   * statement of the function to the beginning of the function definition.
+   */
+  private void moveNamedFunctions(Node functionBody) {
+    Preconditions.checkState(
+        functionBody.getParent().getType() == Token.FUNCTION);
+    Node previous = null;
+    Node current = functionBody.getFirstChild();
+    // Skip any declarations at the beginning of the function body, they
+    // are already in the right place.
+    while (current != null && NodeUtil.isFunctionDeclaration(current)) {
+      previous = current;
+      current = current.getNext();
+    }
+
+    // Find any remaining declarations and move them.
+    Node insertAfter = previous;
+    while (current != null) {
+      // Save off the next node as the current node maybe removed.
+      Node next = current.getNext();
+      if (NodeUtil.isFunctionDeclaration(current)) {
+        // Remove the declaration from the body.
+        Preconditions.checkNotNull(previous);
+        functionBody.removeChildAfter(previous);
+
+        // Readd the function at the top of the function body (after any
+        // previous declarations).
+        insertAfter = addToFront(functionBody, current, insertAfter);
+        compiler.reportCodeChange();
+      } else {
+        // Update the previous only if the current node hasn't been moved.
+        previous = current;
+      }
+      current = next;
+    }
+  }
+
+  /**
+   * @param after The child node to insert the newChild after, or null if
+   *     newChild should be added to the front of parent's child list.
+   * @return The inserted child node.
+   */
+  private Node addToFront(Node parent, Node newChild, Node after) {
+    if (after == null) {
+      parent.addChildToFront(newChild);
+    } else {
+      parent.addChildAfter(newChild, after);
+    }
+    return newChild;
+  }
+
   /**
    * Remove duplicate VAR declarations.
    */
diff --git a/src/com/google/javascript/jscomp/ProcessClosurePrimitives.java b/src/com/google/javascript/jscomp/ProcessClosurePrimitives.java
index 15c047514..19370ec38 100644
--- a/src/com/google/javascript/jscomp/ProcessClosurePrimitives.java
+++ b/src/com/google/javascript/jscomp/ProcessClosurePrimitives.java
@@ -314,6 +314,8 @@ class ProcessClosurePrimitives extends AbstractNodeTypePruningCallback
       // Record this provide created on a previous pass.
       providedNodes.put(name, new ProvidedNode(
           parent, parent.getParent(), t.getModule()));
+      // Make sure it has the proper prefixes.
+      maybeProvidePrefixes(parent, parent.getParent(), name);
     } else {
       // Remove this provide (from a previous pass) since we have an
       // replacement already.
diff --git a/test/com/google/javascript/jscomp/ClosureCodingConventionTest.java b/test/com/google/javascript/jscomp/ClosureCodingConventionTest.java
index 593cf0a42..87202a926 100644
--- a/test/com/google/javascript/jscomp/ClosureCodingConventionTest.java
+++ b/test/com/google/javascript/jscomp/ClosureCodingConventionTest.java
@@ -32,10 +32,19 @@ public class ClosureCodingConventionTest extends TestCase {
     Node args = new Node(Token.LP,
         Node.newString(Token.NAME, "a"),
         Node.newString(Token.NAME, "b"));
-    assertFalse(conv.isVarArgsParameter(args.getFirstChild(), "a"));
-    assertTrue(conv.isVarArgsParameter(args.getLastChild(), "b"));
-    assertTrue(conv.isOptionalParameter("a"));
-    assertTrue(conv.isOptionalParameter("opt_a"));
+    Node optArgs = new Node(Token.LP,
+        Node.newString(Token.NAME, "opt_a"),
+        Node.newString(Token.NAME, "opt_b"));
+
+    assertFalse(conv.isVarArgsParameter(args.getFirstChild()));
+    assertTrue(conv.isVarArgsParameter(args.getLastChild()));
+    assertFalse(conv.isVarArgsParameter(optArgs.getFirstChild()));
+    assertTrue(conv.isVarArgsParameter(optArgs.getLastChild()));
+
+    assertTrue(conv.isOptionalParameter(args.getFirstChild()));
+    assertFalse(conv.isOptionalParameter(args.getLastChild()));
+    assertTrue(conv.isOptionalParameter(optArgs.getFirstChild()));
+    assertFalse(conv.isOptionalParameter(optArgs.getLastChild()));
   }
 
   public void testInlineName() {
diff --git a/test/com/google/javascript/jscomp/CompilerTestCase.java b/test/com/google/javascript/jscomp/CompilerTestCase.java
index 2a192a647..594916f47 100644
--- a/test/com/google/javascript/jscomp/CompilerTestCase.java
+++ b/test/com/google/javascript/jscomp/CompilerTestCase.java
@@ -312,7 +312,7 @@ public abstract class CompilerTestCase extends TestCase  {
   public void test(JSSourceFile[] externs, String js, String expected,
                    DiagnosticType error,
                    DiagnosticType warning, String description) {
-    Compiler compiler = new Compiler();
+    Compiler compiler = createCompiler();
     lastCompiler = compiler;
 
     BaseJSTypeTestCase.addNativeProperties(compiler.getTypeRegistry());
@@ -378,7 +378,7 @@ public abstract class CompilerTestCase extends TestCase  {
    */
   public void test(String[] js, String[] expected, DiagnosticType error,
                    DiagnosticType warning, String description) {
-    Compiler compiler = new Compiler();
+    Compiler compiler = createCompiler();
     lastCompiler = compiler;
 
     JSSourceFile[] inputs = new JSSourceFile[js.length];
@@ -424,7 +424,7 @@ public abstract class CompilerTestCase extends TestCase  {
    */
   public void test(JSModule[] modules, String[] expected,
                    DiagnosticType error, DiagnosticType warning) {
-    Compiler compiler = new Compiler();
+    Compiler compiler = createCompiler();
     lastCompiler = compiler;
 
     compiler.init(externsInputs, modules, getOptions());
@@ -761,7 +761,7 @@ public abstract class CompilerTestCase extends TestCase  {
    * Parses expected js inputs and returns the root of the parse tree.
    */
   private Node parseExpectedJs(String[] expected) {
-    Compiler compiler = new Compiler();
+    Compiler compiler = createCompiler();
     JSSourceFile[] inputs = new JSSourceFile[expected.length];
     for (int i = 0; i < expected.length; i++) {
       inputs[i] = JSSourceFile.fromCode("expected" + i, expected[i]);
@@ -833,4 +833,14 @@ public abstract class CompilerTestCase extends TestCase  {
     @Override
     public void printSummary() {}
   }
+
+  private Compiler createCompiler() {
+    Compiler compiler = new Compiler();
+    compiler.setCodingConvention(getCodingConvention());
+    return compiler;
+  }
+
+  protected CodingConvention getCodingConvention() {
+    return new GoogleCodingConvention();
+  }
 }
diff --git a/test/com/google/javascript/jscomp/GoogleCodingConventionTest.java b/test/com/google/javascript/jscomp/GoogleCodingConventionTest.java
index fdbbb8847..e084c8881 100644
--- a/test/com/google/javascript/jscomp/GoogleCodingConventionTest.java
+++ b/test/com/google/javascript/jscomp/GoogleCodingConventionTest.java
@@ -28,15 +28,23 @@ import junit.framework.TestCase;
 public class GoogleCodingConventionTest extends TestCase {
   private GoogleCodingConvention conv = new GoogleCodingConvention();
 
-
   public void testVarAndOptionalParams() {
     Node args = new Node(Token.LP,
         Node.newString(Token.NAME, "a"),
         Node.newString(Token.NAME, "b"));
-    assertFalse(conv.isVarArgsParameter(args.getFirstChild(), "a"));
-    assertFalse(conv.isVarArgsParameter(args.getLastChild(), "b"));
-    assertFalse(conv.isOptionalParameter("a"));
-    assertTrue(conv.isOptionalParameter("opt_a"));
+    Node optArgs = new Node(Token.LP,
+        Node.newString(Token.NAME, "opt_a"),
+        Node.newString(Token.NAME, "opt_b"));
+
+    assertFalse(conv.isVarArgsParameter(args.getFirstChild()));
+    assertFalse(conv.isVarArgsParameter(args.getLastChild()));
+    assertFalse(conv.isVarArgsParameter(optArgs.getFirstChild()));
+    assertFalse(conv.isVarArgsParameter(optArgs.getLastChild()));
+
+    assertFalse(conv.isOptionalParameter(args.getFirstChild()));
+    assertFalse(conv.isOptionalParameter(args.getLastChild()));
+    assertTrue(conv.isOptionalParameter(optArgs.getFirstChild()));
+    assertTrue(conv.isOptionalParameter(optArgs.getLastChild()));
   }
 
   public void testInlineName() {
diff --git a/test/com/google/javascript/jscomp/NormalizeTest.java b/test/com/google/javascript/jscomp/NormalizeTest.java
index 8ea72cb7d..7db152dca 100644
--- a/test/com/google/javascript/jscomp/NormalizeTest.java
+++ b/test/com/google/javascript/jscomp/NormalizeTest.java
@@ -106,6 +106,29 @@ public class NormalizeTest extends CompilerTestCase {
          "for(; c < b;) foo()");
   }
 
+  public void testMoveFunctions1() throws Exception {
+    test("function f() { if (x) return; foo(); function foo() {} }",
+         "function f() {function foo() {} if (x) return; foo(); }");
+    test("function f() { " +
+            "function foo() {} " +
+            "if (x) return;" +
+            "foo(); " +
+            "function bar() {} " +
+         "}",
+         "function f() {" +
+           "function foo() {}" +
+           "function bar() {}" +
+           "if (x) return;" +
+           "foo();" +
+         "}");
+  }
+
+  public void testMoveFunctions2() throws Exception {
+    testSame("function f() { function foo() {} }");
+    testSame("function f() { f(); a:function bar() {} }");
+    testSame("function f() { f(); {function bar() {}}}");
+    testSame("function f() { f(); if (true) {function bar() {}}}");
+  }
 
   public void testMakeLocalNamesUnique() {
     if (!Normalize.MAKE_LOCAL_NAMES_UNIQUE) {
diff --git a/test/com/google/javascript/jscomp/ProcessClosurePrimitivesTest.java b/test/com/google/javascript/jscomp/ProcessClosurePrimitivesTest.java
index d424757e0..d3972171a 100644
--- a/test/com/google/javascript/jscomp/ProcessClosurePrimitivesTest.java
+++ b/test/com/google/javascript/jscomp/ProcessClosurePrimitivesTest.java
@@ -38,10 +38,12 @@ import static com.google.javascript.jscomp.ProcessClosurePrimitives.XMODULE_REQU
 public class ProcessClosurePrimitivesTest extends CompilerTestCase {
   private String additionalCode;
   private String additionalEndCode;
+  private boolean addAdditionalNamespace;
 
   @Override protected void setUp() {
     additionalCode = null;
     additionalEndCode = null;
+    addAdditionalNamespace = false;
   }
 
   @Override public CompilerPass getProcessor(final Compiler compiler) {
@@ -60,6 +62,10 @@ public class ProcessClosurePrimitivesTest extends CompilerTestCase {
                 JSSourceFile.fromCode("additionalcode", additionalCode);
             Node scriptNode = root.getFirstChild();
             Node newScriptNode = new CompilerInput(file).getAstRoot(compiler);
+            if (addAdditionalNamespace) {
+              newScriptNode.getFirstChild()
+                  .putBooleanProp(Node.IS_NAMESPACE, true);
+            }
             while (newScriptNode.getLastChild() != null) {
               Node lastChild = newScriptNode.getLastChild();
               newScriptNode.removeChild(lastChild);
@@ -73,6 +79,10 @@ public class ProcessClosurePrimitivesTest extends CompilerTestCase {
                 JSSourceFile.fromCode("additionalendcode", additionalEndCode);
             Node scriptNode = root.getFirstChild();
             Node newScriptNode = new CompilerInput(file).getAstRoot(compiler);
+            if (addAdditionalNamespace) {
+              newScriptNode.getFirstChild()
+                  .putBooleanProp(Node.IS_NAMESPACE, true);
+            }
             while (newScriptNode.getFirstChild() != null) {
               Node firstChild = newScriptNode.getFirstChild();
               newScriptNode.removeChild(firstChild);
@@ -437,6 +447,23 @@ public class ProcessClosurePrimitivesTest extends CompilerTestCase {
          "var a={};a.A={};");
   }
 
+  // Tests a case where code is reordered after processing provides and then
+  // provides are processed again.
+  public void testReorderedProvides() {
+    additionalCode = "a.B = {};";  // as if a.B was after a.A originally
+    addAdditionalNamespace = true;
+    test("goog.provide('a.A'); a.A = {};",
+         "var a={};a.B={};a.A={};");
+  }
+
+  // Another version of above.
+  public void testReorderedProvides2() {
+    additionalEndCode = "a.B = {};";
+    addAdditionalNamespace = true;
+    test("goog.provide('a.A'); a.A = {};",
+         "var a={};a.A={};a.B={};");
+  }
+
   public void testInvalidProvide() {
     test("goog.provide('a.class');", null, INVALID_PROVIDE_ERROR);
   }
diff --git a/test/com/google/javascript/jscomp/TypeCheckFunctionCheckTest.java b/test/com/google/javascript/jscomp/TypeCheckFunctionCheckTest.java
index e64ad6d10..fc9ba094d 100644
--- a/test/com/google/javascript/jscomp/TypeCheckFunctionCheckTest.java
+++ b/test/com/google/javascript/jscomp/TypeCheckFunctionCheckTest.java
@@ -29,6 +29,8 @@ import com.google.javascript.rhino.Node;
  */
 public class TypeCheckFunctionCheckTest extends CompilerTestCase {
 
+  private CodingConvention convention = null;
+
   public TypeCheckFunctionCheckTest() {
     parseTypeInfo = true;
     enableTypeCheck(CheckLevel.ERROR);
@@ -40,6 +42,11 @@ public class TypeCheckFunctionCheckTest extends CompilerTestCase {
     };
   }
 
+  @Override
+  protected CodingConvention getCodingConvention() {
+    return convention;
+  }
+
   @Override
   protected int getNumRepetitions() {
     // TypeCheck will only run once, regardless of what this returns.
@@ -47,6 +54,12 @@ public class TypeCheckFunctionCheckTest extends CompilerTestCase {
     return 1;
   }
 
+  @Override
+  public void setUp() throws Exception {
+    super.setUp();
+    convention = new GoogleCodingConvention();
+  }
+
   public void testFunctionAritySimple() {
     assertOk("", "");
     assertOk("a", "'a'");
@@ -126,6 +139,13 @@ public class TypeCheckFunctionCheckTest extends CompilerTestCase {
              WRONG_ARGUMENT_COUNT);
   }
 
+  public void testFunctionWithDefaultCodingConvention() {
+    convention = new DefaultCodingConvention();
+    testSame("var foo = function(x) {}; foo(1, 2);");
+    testSame("var foo = function(opt_x) {}; foo(1, 2);");
+    testSame("var foo = function(var_args) {}; foo(1, 2);");
+  }
+
   public void assertOk(String params, String arguments) {
     assertWarning(params, arguments, null);
   }
