diff --git a/src/com/google/javascript/jscomp/CompilerInput.java b/src/com/google/javascript/jscomp/CompilerInput.java
index 0bb3d043e..0570e8472 100644
--- a/src/com/google/javascript/jscomp/CompilerInput.java
+++ b/src/com/google/javascript/jscomp/CompilerInput.java
@@ -237,8 +237,9 @@ public class CompilerInput
         // this to generate deps files. (We're only using it for
         // symbol dependencies.)
         DependencyInfo info =
-            (new JsFileParser(compiler.getErrorManager())).parseFile(
-                getName(), getName(), getCode());
+            (new JsFileParser(compiler.getErrorManager()))
+            .setIncludeGoogBase(true)
+            .parseFile(getName(), getName(), getCode());
 
         provides.addAll(info.getProvides());
         requires.addAll(info.getRequires());
diff --git a/src/com/google/javascript/jscomp/deps/JsFileParser.java b/src/com/google/javascript/jscomp/deps/JsFileParser.java
index 3c14231f7..5a2eef678 100644
--- a/src/com/google/javascript/jscomp/deps/JsFileParser.java
+++ b/src/com/google/javascript/jscomp/deps/JsFileParser.java
@@ -43,12 +43,19 @@ public class JsFileParser extends JsFileLineParser {
   private static final Pattern GOOG_PROVIDE_REQUIRE_PATTERN = Pattern.compile(
       "(?:^|;)\\s*goog\\.(provide|require)\\s*\\((.*?)\\)");
 
+  /** The first non-comment line of base.js */
+  private static final String BASE_JS_START = "var COMPILED = false;";
+
   /** Matchers used in the parsing. */
   private Matcher googMatcher = GOOG_PROVIDE_REQUIRE_PATTERN.matcher("");
 
   /** The info for the file we are currently parsing. */
   private List<String> provides;
   private List<String> requires;
+  private boolean fileHasProvidesOrRequires;
+
+  /** Whether to provide/require the root namespace. */
+  private boolean includeGoogBase = false;
 
   /**
    * Constructor
@@ -59,6 +66,24 @@ public class JsFileParser extends JsFileLineParser {
     super(errorManager);
   }
 
+  /**
+   * Sets whether we should create implicit provides and requires of the
+   * root namespace.
+   *
+   * When generating deps files, you do not want this behavior. Deps files
+   * need base.js to run anyway, so they don't need information about it.
+   *
+   * When generating abstract build graphs, you probably do want this behavior.
+   * It will create an implicit dependency of all files with provides/requires
+   * on base.js.
+   *
+   * @return this for easy chaining.
+   */
+  public JsFileParser setIncludeGoogBase(boolean include) {
+    includeGoogBase = include;
+    return this;
+  }
+
   /**
    * Parses the given file and returns the dependency information that it
    * contained.
@@ -94,6 +119,7 @@ public class JsFileParser extends JsFileLineParser {
       String closureRelativePath, Reader fileContents) {
     provides = Lists.newArrayList();
     requires = Lists.newArrayList();
+    fileHasProvidesOrRequires = false;
 
     logger.fine("Parsing Source: " + filePath);
     doParse(filePath, fileContents);
@@ -110,7 +136,7 @@ public class JsFileParser extends JsFileLineParser {
    */
   @Override
   protected boolean parseLine(String line) throws ParseException {
-    boolean hasProvidesOrRequires = false;
+    boolean lineHasProvidesOrRequires = false;
 
     // Quick sanity check that will catch most cases. This is a performance
     // win for people with a lot of JS.
@@ -119,7 +145,12 @@ public class JsFileParser extends JsFileLineParser {
       // Iterate over the provides/requires.
       googMatcher.reset(line);
       while (googMatcher.find()) {
-        hasProvidesOrRequires = true;
+        lineHasProvidesOrRequires = true;
+
+        if (includeGoogBase && !fileHasProvidesOrRequires) {
+          fileHasProvidesOrRequires = true;
+          requires.add("goog");
+        }
 
         // See if it's a require or provide.
         boolean isRequire = googMatcher.group(1).charAt(0) == 'r';
@@ -138,9 +169,11 @@ public class JsFileParser extends JsFileLineParser {
           provides.add(arg);
         }
       }
+    } else if (includeGoogBase && line.startsWith(BASE_JS_START)) {
+      provides.add("goog");
     }
 
-    return !shortcutMode || hasProvidesOrRequires ||
+    return !shortcutMode || lineHasProvidesOrRequires ||
         CharMatcher.WHITESPACE.matchesAllOf(line);
   }
 }
diff --git a/test/com/google/javascript/jscomp/CommandLineRunnerTest.java b/test/com/google/javascript/jscomp/CommandLineRunnerTest.java
index a2a89ad19..2143181f6 100644
--- a/test/com/google/javascript/jscomp/CommandLineRunnerTest.java
+++ b/test/com/google/javascript/jscomp/CommandLineRunnerTest.java
@@ -684,9 +684,11 @@ public class CommandLineRunnerTest extends TestCase {
           "goog.provide('beer');\ngoog.require('hops');\nvar beerProvided = 1;",
           "goog.provide('hops'); var hopsProvided = 1;",
           "goog.provide('scotch'); var scotchProvided = 1;",
-          "var includeFileWithoutProvides = 1;"
+          "var includeFileWithoutProvides = 1;",
+          "/** This is base.js */\nvar COMPILED = false;",
          },
          new String[] {
+           "var COMPILED = !1;",
            "var hops = {}, hopsProvided = 1;",
            "var beer = {}, beerProvided = 1;"
          });
diff --git a/test/com/google/javascript/jscomp/deps/JsFileParserTest.java b/test/com/google/javascript/jscomp/deps/JsFileParserTest.java
index 0b84b937a..01e081bc4 100644
--- a/test/com/google/javascript/jscomp/deps/JsFileParserTest.java
+++ b/test/com/google/javascript/jscomp/deps/JsFileParserTest.java
@@ -51,7 +51,7 @@ public class JsFileParserTest extends TestCase {
    *  -Correct recording of what was parsed.
    */
   public void testParseFile() {
-    final String CONTENTS = "/*"
+    String contents = "/*"
       + "goog.provide('no1');*//*\n"
       + "goog.provide('no2');\n"
       + "*/goog.provide('yes1');\n"
@@ -61,72 +61,92 @@ public class JsFileParserTest extends TestCase {
       + "goog.require(\"bar.data.SuperstarAddStarThreadActionRequestDelegate\"); "
       + "//no new line at eof";
 
-    DependencyInfo EXPECTED = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
         ImmutableList.of("yes1", "yes2"),
         ImmutableList.of("yes3", "bar.data.SuperstarAddStarThreadActionRequestDelegate"));
 
-    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, CONTENTS);
+    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, contents);
 
-    assertEquals(EXPECTED, result);
-    assertEquals(0, errorManager.getErrorCount());
-    assertEquals(0, errorManager.getWarningCount());
+    assertDeps(expected, result);
   }
 
   public void testMultiplePerLine() {
-    final String CONTENTS = "goog.provide('yes1');goog.provide('yes2');/*"
+    String contents = "goog.provide('yes1');goog.provide('yes2');/*"
         + "goog.provide('no1');*/goog.provide('yes3');//goog.provide('no2');";
 
-    DependencyInfo EXPECTED = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
         ImmutableList.of("yes1", "yes2", "yes3"), Collections.<String>emptyList());
 
-    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, CONTENTS);
+    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, contents);
 
-    assertEquals(EXPECTED, result);
-    assertEquals(0, errorManager.getErrorCount());
-    assertEquals(0, errorManager.getWarningCount());
+    assertDeps(expected, result);
   }
 
   public void testShortcutMode1() {
     // For efficiency reasons, we stop reading after the ctor.
-    final String CONTENTS = " // hi ! \n /* this is a comment */ "
+    String contents = " // hi ! \n /* this is a comment */ "
         + "goog.provide('yes1');\n /* and another comment */ \n"
         + "goog.provide('yes2'); // include this\n"
         + "function foo() {}\n"
         + "goog.provide('no1');";
 
-    DependencyInfo EXPECTED = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
         ImmutableList.of("yes1", "yes2"), Collections.<String>emptyList());
-    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, CONTENTS);
+    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, contents);
 
-    assertEquals(EXPECTED, result);
-    assertEquals(0, errorManager.getErrorCount());
-    assertEquals(0, errorManager.getWarningCount());
+    assertDeps(expected, result);
   }
 
   public void testShortcutMode2() {
-    final String CONTENTS = "/** goog.provide('no1'); \n" +
+    String contents = "/** goog.provide('no1'); \n" +
         " * goog.provide('no2');\n */\n"
         + "goog.provide('yes1');\n";
 
-    DependencyInfo EXPECTED = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
         ImmutableList.of("yes1"), Collections.<String>emptyList());
-    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, CONTENTS);
+    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, contents);
 
-    assertEquals(EXPECTED, result);
-    assertEquals(0, errorManager.getErrorCount());
-    assertEquals(0, errorManager.getWarningCount());
+    assertDeps(expected, result);
   }
 
   public void testShortcutMode3() {
-    final String CONTENTS = "/**\n" +
+    String contents = "/**\n" +
         " * goog.provide('no1');\n */\n"
         + "goog.provide('yes1');\n";
 
-    DependencyInfo EXPECTED = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
         ImmutableList.of("yes1"), Collections.<String>emptyList());
-    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, CONTENTS);
+    DependencyInfo result = parser.parseFile(SRC_PATH, CLOSURE_PATH, contents);
+
+    assertDeps(expected, result);
+  }
+
+  public void testIncludeGoog1() {
+    String contents = "/**\n" +
+        " * the first constant in base.js\n" +
+        " */\n" +
+        "var COMPILED = false;\n";
+
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+        ImmutableList.of("goog"), Collections.<String>emptyList());
+    DependencyInfo result = parser.setIncludeGoogBase(true).parseFile(
+        SRC_PATH, CLOSURE_PATH, contents);
+    assertDeps(expected, result);
+  }
+
+  public void testIncludeGoog2() {
+    String contents = "goog.require('bar');";
+
+    DependencyInfo expected = new SimpleDependencyInfo(CLOSURE_PATH, SRC_PATH,
+        ImmutableList.<String>of(), ImmutableList.of("goog", "bar"));
+    DependencyInfo result = parser.setIncludeGoogBase(true).parseFile(
+        SRC_PATH, CLOSURE_PATH, contents);
+    assertDeps(expected, result);
+  }
 
-    assertEquals(EXPECTED, result);
+  /** Asserts the deps match without errors */
+  private void assertDeps(DependencyInfo expected, DependencyInfo actual) {
+    assertEquals(expected, actual);
     assertEquals(0, errorManager.getErrorCount());
     assertEquals(0, errorManager.getWarningCount());
   }
