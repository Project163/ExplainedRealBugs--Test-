diff --git a/javadoc/allclasses-frame.html b/javadoc/allclasses-frame.html
index 7cbfd76a2..1ed308036 100644
--- a/javadoc/allclasses-frame.html
+++ b/javadoc/allclasses-frame.html
@@ -217,8 +217,6 @@ All Classes (Compiler)
 <BR>
 <A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps" target="classFrame">JsFileLineParser</A>
 <BR>
-<A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps" target="classFrame">JsFileLineParser.ParseException</A>
-<BR>
 <A HREF="com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps" target="classFrame">JsFileParser</A>
 <BR>
 <A HREF="com/google/javascript/jscomp/JSModule.html" title="class in com.google.javascript.jscomp" target="classFrame">JSModule</A>
diff --git a/javadoc/allclasses-noframe.html b/javadoc/allclasses-noframe.html
index b74962c8e..4a26692b5 100644
--- a/javadoc/allclasses-noframe.html
+++ b/javadoc/allclasses-noframe.html
@@ -217,8 +217,6 @@ All Classes (Compiler)
 <BR>
 <A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
 <BR>
-<A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A>
-<BR>
 <A HREF="com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps">JsFileParser</A>
 <BR>
 <A HREF="com/google/javascript/jscomp/JSModule.html" title="class in com.google.javascript.jscomp">JSModule</A>
diff --git a/javadoc/com/google/javascript/jscomp/deps/DepsFileParser.html b/javadoc/com/google/javascript/jscomp/deps/DepsFileParser.html
index 51586f6a7..69833c24a 100644
--- a/javadoc/com/google/javascript/jscomp/deps/DepsFileParser.html
+++ b/javadoc/com/google/javascript/jscomp/deps/DepsFileParser.html
@@ -73,7 +73,7 @@ function windowTitle()
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">NESTED</A>&nbsp;|&nbsp;<A HREF="#fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
 DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
@@ -108,44 +108,7 @@ A parser that can extract dependency information from existing deps.js files.
 <HR>
 
 <P>
-<!-- ======== NESTED CLASS SUMMARY ======== -->
 
-<A NAME="nested_class_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Nested Class Summary</B></FONT></TH>
-</TR>
-</TABLE>
-&nbsp;<A NAME="nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Nested classes/interfaces inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;
-<!-- =========== FIELD SUMMARY =========== -->
-
-<A NAME="field_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Field Summary</B></FONT></TH>
-</TR>
-</TABLE>
-&nbsp;<A NAME="fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Fields inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#errorManager">errorManager</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#filePath">filePath</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#lineNum">lineNum</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseSucceeded">parseSucceeded</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;
 <!-- ======== CONSTRUCTOR SUMMARY ======== -->
 
 <A NAME="constructor_summary"><!-- --></A>
@@ -206,7 +169,7 @@ A parser that can extract dependency information from existing deps.js files.
 <TH ALIGN="left"><B>Methods inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
 </TR>
 <TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#didParseSucceed()">didParseSucceed</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#doParse(java.lang.String, java.lang.String)">doParse</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseJsString(java.lang.String)">parseJsString</A></CODE></TD>
+<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#didParseSucceed()">didParseSucceed</A></CODE></TD>
 </TR>
 </TABLE>
 &nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
@@ -291,21 +254,21 @@ public <A HREF="http://java.sun.com/javase/6/docs/api/java/util/List.html?is-ext
 parseLine</H3>
 <PRE>
 protected void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;line)
-                  throws <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></PRE>
+                  throws com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</PRE>
 <DL>
 <DD>Extracts dependency information from lines that look like
    goog.addDependency('pathRelativeToClosure', ['provides'], ['requires']);
  Adds the dependencies to depInfos.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseLine(java.lang.String)">parseLine</A></CODE> in class <CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></CODE></DL>
+</DL>
 </DD>
 <DD><DL>
 <DT><B>Parameters:</B><DD><CODE>line</CODE> - The line to parse.
 <DT><B>Throws:</B>
 <DD><CODE>ParseException</CODE> - Thrown if the given line has a malformed
      goog.addDependency().
-<DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE></DL>
+<DD><CODE>com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</CODE></DL>
 </DD>
 </DL>
 <!-- ========= END OF CLASS DATA ========= -->
@@ -359,7 +322,7 @@ protected void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/j
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">NESTED</A>&nbsp;|&nbsp;<A HREF="#fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
 DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
diff --git a/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html b/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html
deleted file mode 100644
index e2fe75e01..000000000
--- a/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html
+++ /dev/null
@@ -1,329 +0,0 @@
-<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
-<!--NewPage-->
-<HTML>
-<HEAD>
-<TITLE>
-JsFileLineParser.ParseException (Compiler)
-</TITLE>
-
-
-<LINK REL ="stylesheet" TYPE="text/css" HREF="../../../../../dev_javadoc.css" TITLE="Style">
-
-<SCRIPT type="text/javascript">
-function windowTitle()
-{
-    if (location.href.indexOf('is-external=true') == -1) {
-        parent.document.title="JsFileLineParser.ParseException (Compiler)";
-    }
-}
-</SCRIPT>
-<NOSCRIPT>
-</NOSCRIPT>
-
-</HEAD>
-
-<BODY BGCOLOR="white" onload="windowTitle();">
-<HR>
-
-
-<!-- ========= START OF TOP NAVBAR ======= -->
-<A NAME="navbar_top"><!-- --></A>
-<A HREF="#skip-navbar_top" title="Skip navigation links"></A>
-<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
-<TR>
-<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
-<A NAME="navbar_top_firstrow"><!-- --></A>
-<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
-  <TR ALIGN="center" VALIGN="top">
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
-  </TR>
-</TABLE>
-</TD>
-<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
-</EM>
-</TD>
-</TR>
-
-<TR>
-<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
-<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-  <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" target="_top"><B>FRAMES</B></A>  &nbsp;
-&nbsp;<A HREF="JsFileLineParser.ParseException.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
-&nbsp;<SCRIPT type="text/javascript">
-  <!--
-  if(window==top) {
-    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
-  }
-  //-->
-</SCRIPT>
-<NOSCRIPT>
-  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
-</NOSCRIPT>
-
-
-</FONT></TD>
-</TR>
-<TR>
-<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
-<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
-</TR>
-</TABLE>
-<A NAME="skip-navbar_top"></A>
-<!-- ========= END OF TOP NAVBAR ========= -->
-
-<HR>
-<!-- ======== START OF CLASS DATA ======== -->
-<H2>
-<FONT SIZE="-1">
-com.google.javascript.jscomp.deps</FONT>
-<BR>
-Class JsFileLineParser.ParseException</H2>
-<PRE>
-<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">java.lang.Object</A>
-  <IMG SRC="../../../../../resources/inherit.gif" ALT="extended by "><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">java.lang.Throwable</A>
-      <IMG SRC="../../../../../resources/inherit.gif" ALT="extended by "><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">java.lang.Exception</A>
-          <IMG SRC="../../../../../resources/inherit.gif" ALT="extended by "><B>com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</B>
-</PRE>
-<DL>
-<DT><B>All Implemented Interfaces:</B> <DD><A HREF="http://java.sun.com/javase/6/docs/api/java/io/Serializable.html?is-external=true" title="class or interface in java.io">Serializable</A></DD>
-</DL>
-<DL>
-<DT><B>Enclosing class:</B><DD><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></DD>
-</DL>
-<HR>
-<DL>
-<DT><PRE>protected static class <B>JsFileLineParser.ParseException</B><DT>extends <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</A></DL>
-</PRE>
-
-<P>
-Thrown by base classes to signify a problem parsing a line.
-<P>
-
-<P>
-<DL>
-<DT><B>See Also:</B><DD><A HREF="../../../../../serialized-form.html#com.google.javascript.jscomp.deps.JsFileLineParser.ParseException">Serialized Form</A></DL>
-<HR>
-
-<P>
-<!-- =========== FIELD SUMMARY =========== -->
-
-<A NAME="field_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Field Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>static&nbsp;long</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#serialVersionUID">serialVersionUID</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
-</TR>
-</TABLE>
-&nbsp;
-<!-- ======== CONSTRUCTOR SUMMARY ======== -->
-
-<A NAME="constructor_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Constructor Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#JsFileLineParser.ParseException(java.lang.String, boolean)">JsFileLineParser.ParseException</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;message,
-                                boolean&nbsp;fatal)</CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Constructor.</TD>
-</TR>
-</TABLE>
-&nbsp;
-<!-- ========== METHOD SUMMARY =========== -->
-
-<A NAME="method_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Method Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>&nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#isFatal()">isFatal</A></B>()</CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
-</TR>
-</TABLE>
-&nbsp;<A NAME="methods_inherited_from_class_java.lang.Throwable"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang">Throwable</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#fillInStackTrace()" title="class or interface in java.lang">fillInStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#getCause()" title="class or interface in java.lang">getCause</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#getLocalizedMessage()" title="class or interface in java.lang">getLocalizedMessage</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#getMessage()" title="class or interface in java.lang">getMessage</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#getStackTrace()" title="class or interface in java.lang">getStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#initCause(java.lang.Throwable)" title="class or interface in java.lang">initCause</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#printStackTrace()" title="class or interface in java.lang">printStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#printStackTrace(java.io.PrintStream)" title="class or interface in java.lang">printStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#printStackTrace(java.io.PrintWriter)" title="class or interface in java.lang">printStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#setStackTrace(java.lang.StackTraceElement[])" title="class or interface in java.lang">setStackTrace</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true#toString()" title="class or interface in java.lang">toString</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Methods inherited from class java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true" title="class or interface in java.lang">Object</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#clone()" title="class or interface in java.lang">clone</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#equals(java.lang.Object)" title="class or interface in java.lang">equals</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#finalize()" title="class or interface in java.lang">finalize</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#getClass()" title="class or interface in java.lang">getClass</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#hashCode()" title="class or interface in java.lang">hashCode</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notify()" title="class or interface in java.lang">notify</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#notifyAll()" title="class or interface in java.lang">notifyAll</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait()" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long)" title="class or interface in java.lang">wait</A>, <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Object.html?is-external=true#wait(long, int)" title="class or interface in java.lang">wait</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;
-<P>
-
-<!-- ============ FIELD DETAIL =========== -->
-
-<A NAME="field_detail"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
-<B>Field Detail</B></FONT></TH>
-</TR>
-</TABLE>
-
-<A NAME="serialVersionUID"><!-- --></A><H3>
-serialVersionUID</H3>
-<PRE>
-public static final long <B>serialVersionUID</B></PRE>
-<DL>
-<DL>
-<DT><B>See Also:</B><DD><A HREF="../../../../../constant-values.html#com.google.javascript.jscomp.deps.JsFileLineParser.ParseException.serialVersionUID">Constant Field Values</A></DL>
-</DL>
-
-<!-- ========= CONSTRUCTOR DETAIL ======== -->
-
-<A NAME="constructor_detail"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
-<B>Constructor Detail</B></FONT></TH>
-</TR>
-</TABLE>
-
-<A NAME="JsFileLineParser.ParseException(java.lang.String, boolean)"><!-- --></A><H3>
-JsFileLineParser.ParseException</H3>
-<PRE>
-public <B>JsFileLineParser.ParseException</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;message,
-                                       boolean&nbsp;fatal)</PRE>
-<DL>
-<DD>Constructor.
-<P>
-<DL>
-<DT><B>Parameters:</B><DD><CODE>message</CODE> - A description of what caused the exception.<DD><CODE>fatal</CODE> - Whether the exception is recoverable.</DL>
-</DL>
-
-<!-- ============ METHOD DETAIL ========== -->
-
-<A NAME="method_detail"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
-<B>Method Detail</B></FONT></TH>
-</TR>
-</TABLE>
-
-<A NAME="isFatal()"><!-- --></A><H3>
-isFatal</H3>
-<PRE>
-public boolean <B>isFatal</B>()</PRE>
-<DL>
-<DD><DL>
-</DL>
-</DD>
-</DL>
-<!-- ========= END OF CLASS DATA ========= -->
-<HR>
-
-
-<!-- ======= START OF BOTTOM NAVBAR ====== -->
-<A NAME="navbar_bottom"><!-- --></A>
-<A HREF="#skip-navbar_bottom" title="Skip navigation links"></A>
-<TABLE BORDER="0" WIDTH="100%" CELLPADDING="1" CELLSPACING="0" SUMMARY="">
-<TR>
-<TD COLSPAN=2 BGCOLOR="#EEEEFF" CLASS="NavBarCell1">
-<A NAME="navbar_bottom_firstrow"><!-- --></A>
-<TABLE BORDER="0" CELLPADDING="0" CELLSPACING="3" SUMMARY="">
-  <TR ALIGN="center" VALIGN="top">
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../overview-summary.html"><FONT CLASS="NavBarFont1"><B>Overview</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-summary.html"><FONT CLASS="NavBarFont1"><B>Package</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#FFFFFF" CLASS="NavBarCell1Rev"> &nbsp;<FONT CLASS="NavBarFont1Rev"><B>Class</B></FONT>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="package-tree.html"><FONT CLASS="NavBarFont1"><B>Tree</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../deprecated-list.html"><FONT CLASS="NavBarFont1"><B>Deprecated</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../index-all.html"><FONT CLASS="NavBarFont1"><B>Index</B></FONT></A>&nbsp;</TD>
-  <TD BGCOLOR="#EEEEFF" CLASS="NavBarCell1">    <A HREF="../../../../../help-doc.html"><FONT CLASS="NavBarFont1"><B>Help</B></FONT></A>&nbsp;</TD>
-  </TR>
-</TABLE>
-</TD>
-<TD ALIGN="right" VALIGN="top" ROWSPAN=3><EM>
-</EM>
-</TD>
-</TR>
-
-<TR>
-<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
-<TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-  <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" target="_top"><B>FRAMES</B></A>  &nbsp;
-&nbsp;<A HREF="JsFileLineParser.ParseException.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
-&nbsp;<SCRIPT type="text/javascript">
-  <!--
-  if(window==top) {
-    document.writeln('<A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>');
-  }
-  //-->
-</SCRIPT>
-<NOSCRIPT>
-  <A HREF="../../../../../allclasses-noframe.html"><B>All Classes</B></A>
-</NOSCRIPT>
-
-
-</FONT></TD>
-</TR>
-<TR>
-<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
-<TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
-</TR>
-</TABLE>
-<A NAME="skip-navbar_bottom"></A>
-<!-- ======== END OF BOTTOM NAVBAR ======= -->
-
-<HR>
-
-        <div id="footer">
-          <div id="footerlogo">
-            <img src="http://www.google.com/images/art.gif"
-                 alt="Google colored balls">
-          </div>
-
-          <div id="copyright">
-          <p>&copy; 2009 Google -
-            <a href="http://www.google.com/privacy.html">Privacy Policy</a> -
-            <a href="http://www.google.com/terms_of_service.html">Terms and Conditions</a> -
-            <a href="http://www.google.com/about.html">About Google</a>
-          </p>
-          </div>
-        </div>
-      
-      
-</BODY>
-</HTML>
diff --git a/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.html b/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.html
index c1e092ff3..0bb0f5044 100644
--- a/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.html
+++ b/javadoc/com/google/javascript/jscomp/deps/JsFileLineParser.html
@@ -53,7 +53,7 @@ function windowTitle()
 <TR>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
 &nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/DepsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
+&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
   <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileLineParser.html" target="_top"><B>FRAMES</B></A>  &nbsp;
 &nbsp;<A HREF="JsFileLineParser.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
@@ -73,9 +73,9 @@ function windowTitle()
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
+DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
 </TABLE>
 <A NAME="skip-navbar_top"></A>
@@ -109,65 +109,7 @@ Base class for classes that parse Javascript sources on a line-by-line basis. St
 <HR>
 
 <P>
-<!-- ======== NESTED CLASS SUMMARY ======== -->
 
-<A NAME="nested_class_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Nested Class Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected static&nbsp;class</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Thrown by base classes to signify a problem parsing a line.</TD>
-</TR>
-</TABLE>
-&nbsp;<!-- =========== FIELD SUMMARY =========== -->
-
-<A NAME="field_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Field Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;<A HREF="../../../../../com/google/javascript/jscomp/ErrorManager.html" title="interface in com.google.javascript.jscomp">ErrorManager</A></CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#errorManager">errorManager</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Handles error messages.</TD>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A></CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#filePath">filePath</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Path of the file currently being parsed.</TD>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;int</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#lineNum">lineNum</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;The line number of the line currently being parsed.</TD>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;boolean</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseSucceeded">parseSucceeded</A></B></CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Did our parse succeed.</TD>
-</TR>
-</TABLE>
-&nbsp;
 <!-- ======== CONSTRUCTOR SUMMARY ======== -->
 
 <A NAME="constructor_summary"><!-- --></A>
@@ -200,31 +142,6 @@ Base class for classes that parse Javascript sources on a line-by-line basis. St
 <BR>
 &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</TD>
 </TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;void</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#doParse(java.lang.String, java.lang.String)">doParse</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;filePath,
-        <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;fileContents)</CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Performs the line-by-line parsing of the given fileContents.</TD>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected &nbsp;<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A></CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseJsString(java.lang.String)">parseJsString</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;jsStringLiteral)</CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Parses a JS string literal.</TD>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD ALIGN="right" VALIGN="top" WIDTH="1%"><FONT SIZE="-1">
-<CODE>protected abstract &nbsp;void</CODE></FONT></TD>
-<TD><CODE><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseLine(java.lang.String)">parseLine</A></B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;line)</CODE>
-
-<BR>
-&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Called for each line of the file being parsed.</TD>
-</TR>
 </TABLE>
 &nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
 <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
@@ -238,63 +155,6 @@ Base class for classes that parse Javascript sources on a line-by-line basis. St
 &nbsp;
 <P>
 
-<!-- ============ FIELD DETAIL =========== -->
-
-<A NAME="field_detail"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
-<B>Field Detail</B></FONT></TH>
-</TR>
-</TABLE>
-
-<A NAME="filePath"><!-- --></A><H3>
-filePath</H3>
-<PRE>
-protected <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A> <B>filePath</B></PRE>
-<DL>
-<DD>Path of the file currently being parsed.
-<P>
-<DL>
-</DL>
-</DL>
-<HR>
-
-<A NAME="lineNum"><!-- --></A><H3>
-lineNum</H3>
-<PRE>
-protected int <B>lineNum</B></PRE>
-<DL>
-<DD>The line number of the line currently being parsed.
-<P>
-<DL>
-</DL>
-</DL>
-<HR>
-
-<A NAME="errorManager"><!-- --></A><H3>
-errorManager</H3>
-<PRE>
-protected <A HREF="../../../../../com/google/javascript/jscomp/ErrorManager.html" title="interface in com.google.javascript.jscomp">ErrorManager</A> <B>errorManager</B></PRE>
-<DL>
-<DD>Handles error messages.
-<P>
-<DL>
-</DL>
-</DL>
-<HR>
-
-<A NAME="parseSucceeded"><!-- --></A><H3>
-parseSucceeded</H3>
-<PRE>
-protected boolean <B>parseSucceeded</B></PRE>
-<DL>
-<DD>Did our parse succeed.
-<P>
-<DL>
-</DL>
-</DL>
-
 <!-- ========= CONSTRUCTOR DETAIL ======== -->
 
 <A NAME="constructor_detail"><!-- --></A>
@@ -335,56 +195,6 @@ public boolean <B>didParseSucceed</B>()</PRE>
 </DL>
 </DD>
 </DL>
-<HR>
-
-<A NAME="doParse(java.lang.String, java.lang.String)"><!-- --></A><H3>
-doParse</H3>
-<PRE>
-protected void <B>doParse</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;filePath,
-                       <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;fileContents)</PRE>
-<DL>
-<DD>Performs the line-by-line parsing of the given fileContents. This method
- strips out Javascript comments and then uses the abstract parseLine()
- method to do the line parsing.
-<P>
-<DD><DL>
-<DT><B>Parameters:</B><DD><CODE>filePath</CODE> - The path to the file being parsed. Used for reporting parse
-     exceptions.<DD><CODE>fileContents</CODE> - The contents of the file.</DL>
-</DD>
-</DL>
-<HR>
-
-<A NAME="parseLine(java.lang.String)"><!-- --></A><H3>
-parseLine</H3>
-<PRE>
-protected abstract void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;line)
-                           throws <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></PRE>
-<DL>
-<DD>Called for each line of the file being parsed.
-<P>
-<DD><DL>
-<DT><B>Parameters:</B><DD><CODE>line</CODE> - The line to parse.
-<DT><B>Throws:</B>
-<DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE> - Should be thrown to signify a problem with the line.</DL>
-</DD>
-</DL>
-<HR>
-
-<A NAME="parseJsString(java.lang.String)"><!-- --></A><H3>
-parseJsString</H3>
-<PRE>
-protected <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A> <B>parseJsString</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;jsStringLiteral)
-                        throws <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></PRE>
-<DL>
-<DD>Parses a JS string literal.
-<P>
-<DD><DL>
-<DT><B>Parameters:</B><DD><CODE>jsStringLiteral</CODE> - The literal. Must look like "asdf" or 'asdf'
-<DT><B>Throws:</B>
-<DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE> - Thrown if there is a string literal that cannot be
-     parsed.</DL>
-</DD>
-</DL>
 <!-- ========= END OF CLASS DATA ========= -->
 <HR>
 
@@ -416,7 +226,7 @@ protected <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?i
 <TR>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
 &nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/DepsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
+&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
   <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileLineParser.html" target="_top"><B>FRAMES</B></A>  &nbsp;
 &nbsp;<A HREF="JsFileLineParser.html" target="_top"><B>NO FRAMES</B></A>  &nbsp;
@@ -436,9 +246,9 @@ protected <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?i
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_class_summary">NESTED</A>&nbsp;|&nbsp;<A HREF="#field_summary">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-DETAIL:&nbsp;<A HREF="#field_detail">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
+DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
 </TABLE>
 <A NAME="skip-navbar_bottom"></A>
diff --git a/javadoc/com/google/javascript/jscomp/deps/JsFileParser.html b/javadoc/com/google/javascript/jscomp/deps/JsFileParser.html
index f4637edbc..7c3895be1 100644
--- a/javadoc/com/google/javascript/jscomp/deps/JsFileParser.html
+++ b/javadoc/com/google/javascript/jscomp/deps/JsFileParser.html
@@ -52,7 +52,7 @@ function windowTitle()
 
 <TR>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
+&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
 &nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/SimpleDependencyInfo.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
   <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileParser.html" target="_top"><B>FRAMES</B></A>  &nbsp;
@@ -73,7 +73,7 @@ function windowTitle()
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">NESTED</A>&nbsp;|&nbsp;<A HREF="#fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
 DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
@@ -107,44 +107,7 @@ A parser that can extract goog.require() and goog.provide() dependency
 <HR>
 
 <P>
-<!-- ======== NESTED CLASS SUMMARY ======== -->
 
-<A NAME="nested_class_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Nested Class Summary</B></FONT></TH>
-</TR>
-</TABLE>
-&nbsp;<A NAME="nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Nested classes/interfaces inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;
-<!-- =========== FIELD SUMMARY =========== -->
-
-<A NAME="field_summary"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Field Summary</B></FONT></TH>
-</TR>
-</TABLE>
-&nbsp;<A NAME="fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left"><B>Fields inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#errorManager">errorManager</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#filePath">filePath</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#lineNum">lineNum</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseSucceeded">parseSucceeded</A></CODE></TD>
-</TR>
-</TABLE>
-&nbsp;
 <!-- ======== CONSTRUCTOR SUMMARY ======== -->
 
 <A NAME="constructor_summary"><!-- --></A>
@@ -206,7 +169,7 @@ A parser that can extract goog.require() and goog.provide() dependency
 <TH ALIGN="left"><B>Methods inherited from class com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></B></TH>
 </TR>
 <TR BGCOLOR="white" CLASS="TableRowColor">
-<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#didParseSucceed()">didParseSucceed</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#doParse(java.lang.String, java.lang.String)">doParse</A>, <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseJsString(java.lang.String)">parseJsString</A></CODE></TD>
+<TD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#didParseSucceed()">didParseSucceed</A></CODE></TD>
 </TR>
 </TABLE>
 &nbsp;<A NAME="methods_inherited_from_class_java.lang.Object"><!-- --></A>
@@ -294,18 +257,18 @@ public <A HREF="../../../../../com/google/javascript/jscomp/deps/DependencyInfo.
 parseLine</H3>
 <PRE>
 protected void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/String.html?is-external=true" title="class or interface in java.lang">String</A>&nbsp;line)
-                  throws <A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></PRE>
+                  throws com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</PRE>
 <DL>
 <DD>Parses a line of javascript, extracting goog.provide and goog.require
  information.
 <P>
 <DD><DL>
-<DT><B>Specified by:</B><DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html#parseLine(java.lang.String)">parseLine</A></CODE> in class <CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A></CODE></DL>
+</DL>
 </DD>
 <DD><DL>
 <DT><B>Parameters:</B><DD><CODE>line</CODE> - The line to parse.
 <DT><B>Throws:</B>
-<DD><CODE><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></CODE> - Should be thrown to signify a problem with the line.</DL>
+<DD><CODE>com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</CODE></DL>
 </DD>
 </DL>
 <!-- ========= END OF CLASS DATA ========= -->
@@ -338,7 +301,7 @@ protected void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/j
 
 <TR>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
-&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
+&nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>PREV CLASS</B></A>&nbsp;
 &nbsp;<A HREF="../../../../../com/google/javascript/jscomp/deps/SimpleDependencyInfo.html" title="class in com.google.javascript.jscomp.deps"><B>NEXT CLASS</B></A></FONT></TD>
 <TD BGCOLOR="white" CLASS="NavBarCell2"><FONT SIZE="-2">
   <A HREF="../../../../../index.html?com/google/javascript/jscomp/deps/JsFileParser.html" target="_top"><B>FRAMES</B></A>  &nbsp;
@@ -359,7 +322,7 @@ protected void <B>parseLine</B>(<A HREF="http://java.sun.com/javase/6/docs/api/j
 </TR>
 <TR>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
-  SUMMARY:&nbsp;<A HREF="#nested_classes_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">NESTED</A>&nbsp;|&nbsp;<A HREF="#fields_inherited_from_class_com.google.javascript.jscomp.deps.JsFileLineParser">FIELD</A>&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
+  SUMMARY:&nbsp;NESTED&nbsp;|&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_summary">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_summary">METHOD</A></FONT></TD>
 <TD VALIGN="top" CLASS="NavBarCell3"><FONT SIZE="-2">
 DETAIL:&nbsp;FIELD&nbsp;|&nbsp;<A HREF="#constructor_detail">CONSTR</A>&nbsp;|&nbsp;<A HREF="#method_detail">METHOD</A></FONT></TD>
 </TR>
diff --git a/javadoc/com/google/javascript/jscomp/deps/package-frame.html b/javadoc/com/google/javascript/jscomp/deps/package-frame.html
index d463a7083..d3ad98918 100644
--- a/javadoc/com/google/javascript/jscomp/deps/package-frame.html
+++ b/javadoc/com/google/javascript/jscomp/deps/package-frame.html
@@ -43,16 +43,5 @@ Classes</FONT>&nbsp;
 </TABLE>
 
 
-<TABLE BORDER="0" WIDTH="100%" SUMMARY="">
-<TR>
-<TD NOWRAP><FONT size="+1" CLASS="FrameHeadingFont">
-Exceptions</FONT>&nbsp;
-<FONT CLASS="FrameItemFont">
-<BR>
-<A HREF="JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps" target="classFrame">JsFileLineParser.ParseException</A></FONT></TD>
-</TR>
-</TABLE>
-
-
 </BODY>
 </HTML>
diff --git a/javadoc/com/google/javascript/jscomp/deps/package-summary.html b/javadoc/com/google/javascript/jscomp/deps/package-summary.html
index 163d8f4a1..2dfb2ff54 100644
--- a/javadoc/com/google/javascript/jscomp/deps/package-summary.html
+++ b/javadoc/com/google/javascript/jscomp/deps/package-summary.html
@@ -125,20 +125,6 @@ Analyzes information about dependencies between files.
 </TABLE>
 &nbsp;
 
-<P>
-
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Exception Summary</B></FONT></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<TD WIDTH="15%"><B><A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></B></TD>
-<TD>Thrown by base classes to signify a problem parsing a line.</TD>
-</TR>
-</TABLE>
-&nbsp;
-
 <P>
 <A NAME="package_description"><!-- --></A><H2>
 Package com.google.javascript.jscomp.deps Description
diff --git a/javadoc/com/google/javascript/jscomp/deps/package-tree.html b/javadoc/com/google/javascript/jscomp/deps/package-tree.html
index 9fa644d36..a7f491d63 100644
--- a/javadoc/com/google/javascript/jscomp/deps/package-tree.html
+++ b/javadoc/com/google/javascript/jscomp/deps/package-tree.html
@@ -92,11 +92,6 @@ Class Hierarchy
 <LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileLineParser</B></A><UL>
 <LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/DepsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>DepsFileParser</B></A><LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileParser</B></A></UL>
 <LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/SimpleDependencyInfo.html" title="class in com.google.javascript.jscomp.deps"><B>SimpleDependencyInfo</B></A> (implements com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/DependencyInfo.html" title="interface in com.google.javascript.jscomp.deps">DependencyInfo</A>)
-<LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang"><B>Throwable</B></A> (implements java.io.<A HREF="http://java.sun.com/javase/6/docs/api/java/io/Serializable.html?is-external=true" title="class or interface in java.io">Serializable</A>)
-<UL>
-<LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang"><B>Exception</B></A><UL>
-<LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="../../../../../com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileLineParser.ParseException</B></A></UL>
-</UL>
 </UL>
 </UL>
 <H2>
diff --git a/javadoc/constant-values.html b/javadoc/constant-values.html
index 9577da0d1..b51f3174f 100644
--- a/javadoc/constant-values.html
+++ b/javadoc/constant-values.html
@@ -281,24 +281,6 @@ com.google.*</FONT></TH>
 
 <P>
 
-<TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left" COLSPAN="3">com.google.javascript.jscomp.deps.<A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A></TH>
-</TR>
-<TR BGCOLOR="white" CLASS="TableRowColor">
-<A NAME="com.google.javascript.jscomp.deps.JsFileLineParser.ParseException.serialVersionUID"><!-- --></A><TD ALIGN="right"><FONT SIZE="-1">
-<CODE>public&nbsp;static&nbsp;final&nbsp;long</CODE></FONT></TD>
-<TD ALIGN="left"><CODE><A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#serialVersionUID">serialVersionUID</A></CODE></TD>
-<TD ALIGN="right"><CODE>1L</CODE></TD>
-</TR>
-</FONT></TD>
-</TR>
-</TABLE>
-
-<P>
-
-<P>
-
 <TABLE BORDER="1" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
 <TR BGCOLOR="#EEEEFF" CLASS="TableSubHeadingColor">
 <TH ALIGN="left" COLSPAN="3">com.google.javascript.jscomp.graph.<A HREF="com/google/javascript/jscomp/graph/FixedPointGraphTraversal.html" title="class in com.google.javascript.jscomp.graph">FixedPointGraphTraversal</A>&lt;<A HREF="com/google/javascript/jscomp/graph/FixedPointGraphTraversal.html" title="type parameter in FixedPointGraphTraversal">N</A>,<A HREF="com/google/javascript/jscomp/graph/FixedPointGraphTraversal.html" title="type parameter in FixedPointGraphTraversal">E</A>&gt;</TH>
diff --git a/javadoc/index-all.html b/javadoc/index-all.html
index 132e50ce5..5e3ee431e 100644
--- a/javadoc/index-all.html
+++ b/javadoc/index-all.html
@@ -1451,9 +1451,6 @@ Static variable in class com.google.javascript.rhino.<A HREF="./com/google/javas
 <DT><A HREF="./com/google/javascript/rhino/ObjToIntMap.Iterator.html#done()"><B>done()</B></A> - 
 Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/ObjToIntMap.Iterator.html" title="class in com.google.javascript.rhino">ObjToIntMap.Iterator</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#doParse(java.lang.String, java.lang.String)"><B>doParse(String, String)</B></A> - 
-Method in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Performs the line-by-line parsing of the given fileContents.
 <DT><A HREF="./com/google/javascript/rhino/Token.html#DOT"><B>DOT</B></A> - 
 Static variable in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Token.html" title="class in com.google.javascript.rhino">Token</A>
 <DD>&nbsp;
@@ -1652,10 +1649,7 @@ Variable in class com.google.javascript.rhino.testing.<A HREF="./com/google/java
 <DT><A HREF="./com/google/javascript/jscomp/CompilerOptions.html#errorFormat"><B>errorFormat</B></A> - 
 Variable in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/CompilerOptions.html" title="class in com.google.javascript.jscomp">CompilerOptions</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/ErrorFormat.html" title="enum in com.google.javascript.jscomp"><B>ErrorFormat</B></A> - Enum in <A HREF="./com/google/javascript/jscomp/package-summary.html">com.google.javascript.jscomp</A><DD>Error formats available.<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#errorManager"><B>errorManager</B></A> - 
-Variable in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Handles error messages.
-<DT><A HREF="./com/google/javascript/jscomp/ErrorManager.html" title="interface in com.google.javascript.jscomp"><B>ErrorManager</B></A> - Interface in <A HREF="./com/google/javascript/jscomp/package-summary.html">com.google.javascript.jscomp</A><DD>The error manager is in charge of storing, organizing and displaying
+<DT><A HREF="./com/google/javascript/jscomp/ErrorFormat.html" title="enum in com.google.javascript.jscomp"><B>ErrorFormat</B></A> - Enum in <A HREF="./com/google/javascript/jscomp/package-summary.html">com.google.javascript.jscomp</A><DD>Error formats available.<DT><A HREF="./com/google/javascript/jscomp/ErrorManager.html" title="interface in com.google.javascript.jscomp"><B>ErrorManager</B></A> - Interface in <A HREF="./com/google/javascript/jscomp/package-summary.html">com.google.javascript.jscomp</A><DD>The error manager is in charge of storing, organizing and displaying
  errors and warnings generated by the compiler.<DT><A HREF="./com/google/javascript/rhino/ErrorReporter.html" title="interface in com.google.javascript.rhino"><B>ErrorReporter</B></A> - Interface in <A HREF="./com/google/javascript/rhino/package-summary.html">com.google.javascript.rhino</A><DD>This is interface defines a protocol for the reporting of
  errors during JavaScript translation or execution.<DT><A HREF="./com/google/javascript/rhino/testing/BaseJSTypeTestCase.html#errorReporter"><B>errorReporter</B></A> - 
 Variable in class com.google.javascript.rhino.testing.<A HREF="./com/google/javascript/rhino/testing/BaseJSTypeTestCase.html" title="class in com.google.javascript.rhino.testing">BaseJSTypeTestCase</A>
@@ -1808,9 +1802,6 @@ Static variable in class com.google.javascript.rhino.<A HREF="./com/google/javas
 <DT><A HREF="./com/google/javascript/jscomp/DiagnosticGroups.html#FILEOVERVIEW_JSDOC"><B>FILEOVERVIEW_JSDOC</B></A> - 
 Static variable in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/DiagnosticGroups.html" title="class in com.google.javascript.jscomp">DiagnosticGroups</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#filePath"><B>filePath</B></A> - 
-Variable in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Path of the file currently being parsed.
 <DT><A HREF="./com/google/javascript/rhino/Token.html#FINALLY"><B>FINALLY</B></A> - 
 Static variable in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Token.html" title="class in com.google.javascript.rhino">Token</A>
 <DD>&nbsp;
@@ -4471,9 +4462,6 @@ Method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/js
 Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/JSDocInfo.html" title="class in com.google.javascript.rhino">JSDocInfo</A>
 <DD>Returns whether the <code>@externs</code> annotation is present on this
  <A HREF="./com/google/javascript/rhino/JSDocInfo.html" title="class in com.google.javascript.rhino"><CODE>JSDocInfo</CODE></A>.
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#isFatal()"><B>isFatal()</B></A> - 
-Method in exception com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A>
-<DD>&nbsp;
 <DT><A HREF="./com/google/javascript/rhino/jstype/JSTypeRegistry.html#isForwardDeclaredType(java.lang.String)"><B>isForwardDeclaredType(String)</B></A> - 
 Method in class com.google.javascript.rhino.jstype.<A HREF="./com/google/javascript/rhino/jstype/JSTypeRegistry.html" title="class in com.google.javascript.rhino.jstype">JSTypeRegistry</A>
 <DD>Whether this is a forward-declared type name.
@@ -5030,9 +5018,6 @@ Constructor for class com.google.javascript.rhino.<A HREF="./com/google/javascri
 <DT><A HREF="./com/google/javascript/jscomp/parsing/JsDocInfoParser.html" title="class in com.google.javascript.jscomp.parsing"><B>JsDocInfoParser</B></A> - Class in <A HREF="./com/google/javascript/jscomp/parsing/package-summary.html">com.google.javascript.jscomp.parsing</A><DD>A parser for JSDoc comments.<DT><A HREF="./com/google/javascript/jscomp/JSError.html" title="class in com.google.javascript.jscomp"><B>JSError</B></A> - Class in <A HREF="./com/google/javascript/jscomp/package-summary.html">com.google.javascript.jscomp</A><DD>Compile error description<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileLineParser</B></A> - Class in <A HREF="./com/google/javascript/jscomp/deps/package-summary.html">com.google.javascript.jscomp.deps</A><DD>Base class for classes that parse Javascript sources on a line-by-line basis.<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#JsFileLineParser(com.google.javascript.jscomp.ErrorManager)"><B>JsFileLineParser(ErrorManager)</B></A> - 
 Constructor for class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
 <DD>Constructor.
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileLineParser.ParseException</B></A> - Exception in <A HREF="./com/google/javascript/jscomp/deps/package-summary.html">com.google.javascript.jscomp.deps</A><DD>Thrown by base classes to signify a problem parsing a line.<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#JsFileLineParser.ParseException(java.lang.String, boolean)"><B>JsFileLineParser.ParseException(String, boolean)</B></A> - 
-Constructor for exception com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A>
-<DD>Constructor.
 <DT><A HREF="./com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileParser</B></A> - Class in <A HREF="./com/google/javascript/jscomp/deps/package-summary.html">com.google.javascript.jscomp.deps</A><DD>A parser that can extract goog.require() and goog.provide() dependency
  information from a .js file.<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileParser.html#JsFileParser(com.google.javascript.jscomp.ErrorManager)"><B>JsFileParser(ErrorManager)</B></A> - 
 Constructor for class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps">JsFileParser</A>
@@ -5175,9 +5160,6 @@ Static variable in class com.google.javascript.jscomp.<A HREF="./com/google/java
 <DT><A HREF="./com/google/javascript/jscomp/CompilerOptions.html#lineBreak"><B>lineBreak</B></A> - 
 Variable in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/CompilerOptions.html" title="class in com.google.javascript.jscomp">CompilerOptions</A>
 <DD>Line break the output a bit more aggressively
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#lineNum"><B>lineNum</B></A> - 
-Variable in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>The line number of the line currently being parsed.
 <DT><A HREF="./com/google/javascript/jscomp/JSError.html#lineNumber"><B>lineNumber</B></A> - 
 Variable in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/JSError.html" title="class in com.google.javascript.jscomp">JSError</A>
 <DD>Line number of the source
@@ -6036,17 +6018,11 @@ Static method in class com.google.javascript.jscomp.<A HREF="./com/google/javasc
 <DT><A HREF="./com/google/javascript/jscomp/Instrumentation.html#parseFrom(com.google.protobuf.CodedInputStream, com.google.protobuf.ExtensionRegistryLite)"><B>parseFrom(CodedInputStream, ExtensionRegistryLite)</B></A> - 
 Static method in class com.google.javascript.jscomp.<A HREF="./com/google/javascript/jscomp/Instrumentation.html" title="class in com.google.javascript.jscomp">Instrumentation</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#parseJsString(java.lang.String)"><B>parseJsString(String)</B></A> - 
-Method in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Parses a JS string literal.
 <DT><A HREF="./com/google/javascript/jscomp/deps/DepsFileParser.html#parseLine(java.lang.String)"><B>parseLine(String)</B></A> - 
 Method in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/DepsFileParser.html" title="class in com.google.javascript.jscomp.deps">DepsFileParser</A>
 <DD>Extracts dependency information from lines that look like
    goog.addDependency('pathRelativeToClosure', ['provides'], ['requires']);
  Adds the dependencies to depInfos.
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#parseLine(java.lang.String)"><B>parseLine(String)</B></A> - 
-Method in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Called for each line of the file being parsed.
 <DT><A HREF="./com/google/javascript/jscomp/deps/JsFileParser.html#parseLine(java.lang.String)"><B>parseLine(String)</B></A> - 
 Method in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileParser.html" title="class in com.google.javascript.jscomp.deps">JsFileParser</A>
 <DD>Parses a line of javascript, extracting goog.provide and goog.require
@@ -6057,10 +6033,7 @@ Constructor for class com.google.javascript.rhino.<A HREF="./com/google/javascri
 <DT><A HREF="./com/google/javascript/rhino/Parser.html#Parser(com.google.javascript.rhino.CompilerEnvirons, com.google.javascript.rhino.ErrorReporter)"><B>Parser(CompilerEnvirons, ErrorReporter)</B></A> - 
 Constructor for class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Parser.html" title="class in com.google.javascript.rhino">Parser</A>
 <DD>&nbsp;
-<DT><A HREF="./com/google/javascript/jscomp/parsing/ParserRunner.html" title="class in com.google.javascript.jscomp.parsing"><B>ParserRunner</B></A> - Class in <A HREF="./com/google/javascript/jscomp/parsing/package-summary.html">com.google.javascript.jscomp.parsing</A><DD>&nbsp;<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html#parseSucceeded"><B>parseSucceeded</B></A> - 
-Variable in class com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser</A>
-<DD>Did our parse succeed.
-<DT><A HREF="./com/google/javascript/jscomp/parsing/JsDocInfoParser.html#parseTypeString(java.lang.String)"><B>parseTypeString(String)</B></A> - 
+<DT><A HREF="./com/google/javascript/jscomp/parsing/ParserRunner.html" title="class in com.google.javascript.jscomp.parsing"><B>ParserRunner</B></A> - Class in <A HREF="./com/google/javascript/jscomp/parsing/package-summary.html">com.google.javascript.jscomp.parsing</A><DD>&nbsp;<DT><A HREF="./com/google/javascript/jscomp/parsing/JsDocInfoParser.html#parseTypeString(java.lang.String)"><B>parseTypeString(String)</B></A> - 
 Static method in class com.google.javascript.jscomp.parsing.<A HREF="./com/google/javascript/jscomp/parsing/JsDocInfoParser.html" title="class in com.google.javascript.jscomp.parsing">JsDocInfoParser</A>
 <DD>Parses a string containing a JsDoc type declaration, returning the
  type if the parsing succeeded or <code>null</code> if it failed.
@@ -6673,9 +6646,6 @@ Static variable in class com.google.javascript.rhino.<A HREF="./com/google/javas
 Static method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/Kit.html" title="class in com.google.javascript.rhino">Kit</A>
 <DD>Split string into array of strings using semicolon as string terminator
  (; after the last string is required).
-<DT><A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html#serialVersionUID"><B>serialVersionUID</B></A> - 
-Static variable in exception com.google.javascript.jscomp.deps.<A HREF="./com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">JsFileLineParser.ParseException</A>
-<DD>&nbsp;
 <DT><A HREF="./com/google/javascript/rhino/ObjArray.html#set(int, java.lang.Object)"><B>set(int, Object)</B></A> - 
 Method in class com.google.javascript.rhino.<A HREF="./com/google/javascript/rhino/ObjArray.html" title="class in com.google.javascript.rhino">ObjArray</A>
 <DD>&nbsp;
diff --git a/javadoc/overview-tree.html b/javadoc/overview-tree.html
index 8f3bd86f2..384363389 100644
--- a/javadoc/overview-tree.html
+++ b/javadoc/overview-tree.html
@@ -195,7 +195,7 @@ Class Hierarchy
 <LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Throwable.html?is-external=true" title="class or interface in java.lang"><B>Throwable</B></A> (implements java.io.<A HREF="http://java.sun.com/javase/6/docs/api/java/io/Serializable.html?is-external=true" title="class or interface in java.io">Serializable</A>)
 <UL>
 <LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang"><B>Exception</B></A><UL>
-<LI TYPE="circle">com.google.javascript.jscomp.deps.<A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps"><B>JsFileLineParser.ParseException</B></A><LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/RuntimeException.html?is-external=true" title="class or interface in java.lang"><B>RuntimeException</B></A><UL>
+<LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/RuntimeException.html?is-external=true" title="class or interface in java.lang"><B>RuntimeException</B></A><UL>
 <LI TYPE="circle">java.lang.<A HREF="http://java.sun.com/javase/6/docs/api/java/lang/IllegalArgumentException.html?is-external=true" title="class or interface in java.lang"><B>IllegalArgumentException</B></A><UL>
 <LI TYPE="circle">com.google.javascript.jscomp.<A HREF="com/google/javascript/jscomp/JSModuleGraph.ModuleDependenceException.html" title="class in com.google.javascript.jscomp"><B>JSModuleGraph.ModuleDependenceException</B></A></UL>
 <LI TYPE="circle">com.google.javascript.rhino.<A HREF="com/google/javascript/rhino/RhinoException.html" title="class in com.google.javascript.rhino"><B>RhinoException</B></A><UL>
diff --git a/javadoc/serialized-form.html b/javadoc/serialized-form.html
index 4e44db272..cedd29ce9 100644
--- a/javadoc/serialized-form.html
+++ b/javadoc/serialized-form.html
@@ -2338,44 +2338,6 @@ dependentModule</H3>
 </DL>
 <HR SIZE="4" NOSHADE>
 
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="center"><FONT SIZE="+2">
-<B>Package</B> <B>com.google.javascript.jscomp.deps</B></FONT></TH>
-</TR>
-</TABLE>
-
-<P>
-<A NAME="com.google.javascript.jscomp.deps.JsFileLineParser.ParseException"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableSubHeadingColor">
-<TH ALIGN="left" COLSPAN="2"><FONT SIZE="+2">
-<B>Class <A HREF="com/google/javascript/jscomp/deps/JsFileLineParser.ParseException.html" title="class in com.google.javascript.jscomp.deps">com.google.javascript.jscomp.deps.JsFileLineParser.ParseException</A> extends <A HREF="http://java.sun.com/javase/6/docs/api/java/lang/Exception.html?is-external=true" title="class or interface in java.lang">Exception</A> implements Serializable</B></FONT></TH>
-</TR>
-</TABLE>
-
-<P>
-<B>serialVersionUID:&nbsp;</B>1L
-
-<P>
-<A NAME="serializedForm"><!-- --></A>
-<TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
-<TR BGCOLOR="#CCCCFF" CLASS="TableHeadingColor">
-<TH ALIGN="left" COLSPAN="1"><FONT SIZE="+2">
-<B>Serialized Fields</B></FONT></TH>
-</TR>
-</TABLE>
-
-<H3>
-fatal</H3>
-<PRE>
-boolean <B>fatal</B></PRE>
-<DL>
-<DL>
-</DL>
-</DL>
-<HR SIZE="4" NOSHADE>
-
 <TABLE BORDER="1" WIDTH="100%" CELLPADDING="3" CELLSPACING="0" SUMMARY="">
 <TR BGCOLOR="#CCCCFF" CLASS="TableSubHeadingColor">
 <TH ALIGN="center"><FONT SIZE="+2">
diff --git a/src/com/google/javascript/jscomp/AmbiguateProperties.java b/src/com/google/javascript/jscomp/AmbiguateProperties.java
index 5f98d9e12..9a42e67f3 100644
--- a/src/com/google/javascript/jscomp/AmbiguateProperties.java
+++ b/src/com/google/javascript/jscomp/AmbiguateProperties.java
@@ -98,9 +98,6 @@ class AmbiguateProperties implements CompilerPass {
   /** Map from original property name to new name. */
   private final Map<String, String> renamingMap = Maps.newHashMap();
 
-  /** Map from color assigned by GraphColoring to new name. */
-  private final Map<Integer, String> colorMap = Maps.newHashMap();
-
   /**
    * Sorts Property objects by their count, breaking ties alphabetically to
    * ensure a deterministic total ordering.
@@ -221,6 +218,7 @@ class AmbiguateProperties implements CompilerPass {
 
     NameGenerator nameGen = new NameGenerator(
         reservedNames, "", reservedCharacters);
+    Map<Integer, String> colorMap = Maps.newHashMap();
     for (int i = 0; i < numNewPropertyNames; ++i) {
       colorMap.put(i, nameGen.generateNextName());
     }
@@ -258,7 +256,30 @@ class AmbiguateProperties implements CompilerPass {
     }
   }
 
-  /** Add supertypes of the type to its JSTypeBitSet of related types. */
+  /**
+   * Adds subtypes - and implementors, in the case of interfaces - of the type
+   * to its JSTypeBitSet of related types. Union types are decomposed into their
+   * alternative types.
+   *
+   * <p>The 'is related to' relationship is best understood graphically. Draw an
+   * arrow from each instance type to the prototype of each of its
+   * subclass. Draw an arrow from each prototype to its instance type. Draw an
+   * arrow from each interface to its implementors. A type is related to another
+   * if there is a directed path in the graph from the type to other. Thus, the
+   * 'is related to' relationship is reflexive and transitive.
+   *
+   * <p>Example with Foo extends Bar which extends Baz and Bar implements I:
+   * <pre>
+   * Foo -> Bar.prototype -> Bar -> Baz.prototype -> Baz
+   *                          ^
+   *                          |
+   *                          I
+   * </pre>
+   *
+   * <p>Note that we don't need to correctly handle the relationships between
+   * functions, because the function type is invalidating (i.e. its properties
+   * won't be ambiguated).
+   */
   private void computeRelatedTypes(JSType type) {
     if (type instanceof UnionType) {
       type = type.restrictByNotNullOrUndefined();
@@ -277,26 +298,45 @@ class AmbiguateProperties implements CompilerPass {
 
     JSTypeBitSet related = new JSTypeBitSet(intForType.size());
     relatedBitsets.put(type, related);
+    related.set(getIntForType(type));
 
-    ObjectType parentType = type.toObjectType();
-    while (parentType != null) {
-      related.set(getIntForType(parentType));
-      parentType = parentType.getImplicitPrototype();
+    // A prototype is related to its instance.
+    if (type instanceof FunctionPrototypeType) {
+      addRelatedInstance(
+          ((FunctionPrototypeType) type).getOwnerFunction(), related);
+      return;
     }
 
-    FunctionType constructor = null;
-    if (type instanceof FunctionType) {
-      constructor = (FunctionType) type;
-    } else if (type instanceof FunctionPrototypeType) {
-      constructor = ((FunctionPrototypeType) type).getOwnerFunction();
-    } else {
-      constructor = type.toObjectType().getConstructor();
-    }
-    if (constructor != null) {
-      for (ObjectType itype : constructor.getAllImplementedInterfaces()) {
-        related.set(getIntForType(itype));
+    // An instance is related to its subclasses.
+    FunctionType constructor = type.toObjectType().getConstructor();
+    if (constructor != null && constructor.getSubTypes() != null) {
+      for (FunctionType subType : constructor.getSubTypes()) {
+        addRelatedInstance(subType, related);
       }
     }
+
+    // An interface is related to its implementors.
+    for (FunctionType implementor : compiler.getTypeRegistry()
+        .getDirectImplementors(type.toObjectType())) {
+      addRelatedInstance(implementor, related);
+    }
+  }
+
+  /**
+   * Adds the instance of the given constructor, its implicit prototype and all
+   * its related types to the given bit set.
+   */
+  private void addRelatedInstance(
+      FunctionType constructor, JSTypeBitSet related) {
+    // TODO(user): A constructor which doesn't have an instance type
+    // (e.g. it's missing the @constructor annotation) should be an invalidating
+    // type which doesn't reach this code path.
+    if (constructor.hasInstanceType()) {
+      ObjectType instanceType = constructor.getInstanceType();
+      related.set(getIntForType(instanceType.getImplicitPrototype()));
+      computeRelatedTypes(instanceType);
+      related.or(relatedBitsets.get(instanceType));
+    }
   }
 
   class PropertyGraph implements AdjacencyGraph<Property, Void> {
@@ -332,37 +372,28 @@ class AmbiguateProperties implements CompilerPass {
   }
 
   /**
-   * A {@link SubGraph} that represents properties. The types of the properties
-   * are used to efficiently calculate adjacency information.
+   * A {@link SubGraph} that represents properties. The related types of
+   * the properties are used to efficiently calculate adjacency information.
    */
   class PropertySubGraph implements SubGraph<Property, Void> {
-    /** Types from which properties in this subgraph are referenced. */
-    JSTypeBitSet typesInSet = new JSTypeBitSet(intForType.size());
-
-    /** Types related to types in {@code typesInSet}. */
-    JSTypeBitSet typesRelatedToSet = new JSTypeBitSet(intForType.size());
+    /** Types related to properties referenced in this subgraph. */
+    JSTypeBitSet relatedTypes = new JSTypeBitSet(intForType.size());
 
     /**
-     * Returns true if prop is in an independent set from all properties in
-     * this sub graph.  That is, if none of its types is contained in the
-     * related types for this sub graph and if none if its related types is one
-     * of the types in the sub graph.
+     * Returns true if prop is in an independent set from all properties in this
+     * sub graph.  That is, if none of its related types intersects with the
+     * related types for this sub graph.
      */
     public boolean isIndependentOf(Property prop) {
-      if (typesRelatedToSet.intersects(prop.typesSet)) {
-        return false;
-      }
-      return !prop.relatedTypesSet.intersects(typesInSet);
+      return !relatedTypes.intersects(prop.relatedTypes);
     }
 
     /**
-     * Adds the node to the sub graph, adding all of its types to the set of
-     * types in the sub graph and all of its related types to the related types
-     * for the sub graph.
+     * Adds the node to the sub graph, adding all its related types to the
+     * related types for the sub graph.
      */
     public void addNode(Property prop) {
-      typesInSet.or(prop.typesSet);
-      typesRelatedToSet.or(prop.relatedTypesSet);
+      relatedTypes.or(prop.relatedTypes);
     }
   }
 
@@ -527,8 +558,7 @@ class AmbiguateProperties implements CompilerPass {
     String newName;
     int numOccurrences;
     boolean skipAmbiguating;
-    JSTypeBitSet typesSet = new JSTypeBitSet(intForType.size());
-    JSTypeBitSet relatedTypesSet = new JSTypeBitSet(intForType.size());
+    JSTypeBitSet relatedTypes = new JSTypeBitSet(intForType.size());
 
     Property(String name) {
       this.oldName = name;
@@ -565,11 +595,9 @@ class AmbiguateProperties implements CompilerPass {
         return;
       }
 
-      int typeInt = getIntForType(newType);
-      if (!typesSet.get(typeInt)) {
+      if (!relatedTypes.get(getIntForType(newType))) {
         computeRelatedTypes(newType);
-        typesSet.set(typeInt);
-        relatedTypesSet.or(getRelatedTypesOnNonUnion(newType));
+        relatedTypes.or(getRelatedTypesOnNonUnion(newType));
       }
     }
   }
diff --git a/src/com/google/javascript/jscomp/AnalyzePrototypeProperties.java b/src/com/google/javascript/jscomp/AnalyzePrototypeProperties.java
index 6b299c350..15678674b 100644
--- a/src/com/google/javascript/jscomp/AnalyzePrototypeProperties.java
+++ b/src/com/google/javascript/jscomp/AnalyzePrototypeProperties.java
@@ -230,18 +230,36 @@ class AnalyzePrototypeProperties implements CompilerPass {
       } else if (n.getType() == Token.NAME) {
         String name = n.getString();
 
-        // Only process global functions.
         Var var = t.getScope().getVar(name);
-        if (var != null && var.isGlobal() &&
-            var.getInitialValue() != null &&
-            var.getInitialValue().getType() == Token.FUNCTION) {
-          if (t.inGlobalScope()) {
-            if (!processGlobalFunctionDeclaration(t, n, parent,
-                    parent.getParent())) {
-              addGlobalUseOfSymbol(name, t.getModule(), VAR);
+        if (var != null) {
+          // Only process global functions.
+          if (var.isGlobal()) {
+            if (var.getInitialValue() != null &&
+                var.getInitialValue().getType() == Token.FUNCTION) {
+              if (t.inGlobalScope()) {
+                if (!processGlobalFunctionDeclaration(t, n, parent,
+                        parent.getParent())) {
+                  addGlobalUseOfSymbol(name, t.getModule(), VAR);
+                }
+              } else {
+                addSymbolUse(name, t.getModule(), VAR);
+              }
             }
+
+          // If it is not a global, it might be accessing a local of the outer
+          // scope. If that's the case the functions between the variable's
+          // declaring scope and the variable reference scope cannot be moved.
           } else {
-            addSymbolUse(name, t.getModule(), VAR);
+            int level = 0;
+            for (Scope s = t.getScope(); s != var.getScope();
+                s = s.getParent()) {
+              level++;
+            }
+            for (level = symbolStack.size() < level ?
+                symbolStack.size() : level; level != 0; level--) {
+              symbolStack.get(symbolStack.size() - level)
+                  .readClosureVariables = true;
+            }
           }
         }
       }
@@ -575,6 +593,10 @@ class AnalyzePrototypeProperties implements CompilerPass {
     private final Deque<Symbol> declarations = new ArrayDeque<Symbol>();
     private JSModule deepestCommonModuleRef = null;
 
+    // True if this property is a function that reads a variable from an
+    // outer scope which isn't the global scope.
+    private boolean readClosureVariables = false;
+
     /**
      * Constructs a new NameInfo.
      * @param name The name of the property that this represents. May be null
@@ -591,6 +613,11 @@ class AnalyzePrototypeProperties implements CompilerPass {
       return referenced;
     }
 
+    /** Determines whether it reads a closure variable. */
+    boolean readsClosureVariables() {
+      return readClosureVariables;
+    }
+
     /**
      * Mark a reference in a given module to this property name, and record
      * the deepest common module reference.
diff --git a/src/com/google/javascript/jscomp/CheckSideEffects.java b/src/com/google/javascript/jscomp/CheckSideEffects.java
index 59db883a0..a5557818e 100644
--- a/src/com/google/javascript/jscomp/CheckSideEffects.java
+++ b/src/com/google/javascript/jscomp/CheckSideEffects.java
@@ -99,7 +99,7 @@ final class CheckSideEffects extends AbstractPostOrderCallback {
       }
     }
     if (NodeUtil.isSimpleOperatorType(n.getType()) ||
-        !NodeUtil.mayHaveSideEffects(n)) {
+        !NodeUtil.mayHaveSideEffects(n, t.getCompiler())) {
       if (n.isQualifiedName() && n.getJSDocInfo() != null) {
         // This no-op statement was there so that JSDoc information could
         // be attached to the name. This check should not complain about it.
diff --git a/src/com/google/javascript/jscomp/CrossModuleMethodMotion.java b/src/com/google/javascript/jscomp/CrossModuleMethodMotion.java
index f020a096b..52a0de1b5 100644
--- a/src/com/google/javascript/jscomp/CrossModuleMethodMotion.java
+++ b/src/com/google/javascript/jscomp/CrossModuleMethodMotion.java
@@ -99,6 +99,10 @@ class CrossModuleMethodMotion implements CompilerPass {
         // deepestCommonModuleRef is null.
         continue;
       }
+      
+      if (nameInfo.readsClosureVariables()) {
+        continue;
+      }
 
       JSModule deepestCommonModuleRef = nameInfo.getDeepestCommonModuleRef();
       if(deepestCommonModuleRef == null) {
diff --git a/src/com/google/javascript/jscomp/DefaultPassConfig.java b/src/com/google/javascript/jscomp/DefaultPassConfig.java
index d60ba48fc..affb6dfb7 100644
--- a/src/com/google/javascript/jscomp/DefaultPassConfig.java
+++ b/src/com/google/javascript/jscomp/DefaultPassConfig.java
@@ -874,7 +874,7 @@ public class DefaultPassConfig extends PassConfig {
   };
 
   /** Rusn type inference. */
-  private final PassFactory inferTypes =
+  final PassFactory inferTypes =
       new PassFactory("inferTypes", false) {
     @Override
     protected CompilerPass createInternal(final AbstractCompiler compiler) {
diff --git a/src/com/google/javascript/jscomp/NodeUtil.java b/src/com/google/javascript/jscomp/NodeUtil.java
index 67ca01e78..64af48fff 100644
--- a/src/com/google/javascript/jscomp/NodeUtil.java
+++ b/src/com/google/javascript/jscomp/NodeUtil.java
@@ -19,6 +19,7 @@ package com.google.javascript.jscomp;
 import com.google.common.base.Preconditions;
 import com.google.common.base.Predicate;
 import com.google.common.base.Predicates;
+import com.google.common.collect.ImmutableSet;
 import com.google.common.collect.Maps;
 import com.google.javascript.rhino.FunctionNode;
 import com.google.javascript.rhino.JSDocInfo;
@@ -34,6 +35,8 @@ import java.util.List;
 import java.util.Map;
 import java.util.Set;
 
+import javax.annotation.Nullable;
+
 /**
  * NodeUtil contains utilities that get properties from the Node object.
  *
@@ -333,14 +336,22 @@ public final class NodeUtil {
    * @see <a href="http://www.xkcd.org/326/">XKCD Cartoon</a>
    */
   static boolean mayEffectMutableState(Node n) {
-    return checkForStateChangeHelper(n, true);
+    return mayEffectMutableState(n, null);
+  }
+
+  static boolean mayEffectMutableState(Node n, AbstractCompiler compiler) {
+    return checkForStateChangeHelper(n, true, compiler);
   }
 
   /**
    * Returns true if the node which may have side effects when executed.
    */
   static boolean mayHaveSideEffects(Node n) {
-    return checkForStateChangeHelper(n, false);
+    return mayHaveSideEffects(n, null);
+  }
+
+  static boolean mayHaveSideEffects(Node n, AbstractCompiler compiler) {
+    return checkForStateChangeHelper(n, false, compiler);
   }
 
   /**
@@ -350,7 +361,7 @@ public final class NodeUtil {
    * that they have no side effects.
    */
   private static boolean checkForStateChangeHelper(
-      Node n, boolean checkForNewObjects) {
+      Node n, boolean checkForNewObjects, AbstractCompiler compiler) {
     // Rather than id which ops may have side effects, id the ones
     // that we know to be safe
     switch (n.getType()) {
@@ -402,37 +413,21 @@ public final class NodeUtil {
         return !isFunctionAnonymous(n);
 
       case Token.NEW:
-        {
-          if (checkForNewObjects) {
-            return true;
-          }
-
-          // calls to constructors that have no side effects have the
-          // no side effect property set.
-          if (n.isNoSideEffectsCall()) {
-            break;
-          }
+        if (checkForNewObjects) {
+          return true;
+        }
 
-          // certain constructors are certified side effect free
-          Node constructor = n.getFirstChild();
-          if (Token.NAME == constructor.getType()) {
-            String className = constructor.getString();
-            if (CONSTRUCTORS_WITHOUT_SIDE_EFFECTS.contains(className)) {
-              // loop below will see if the constructor parameters have
-              // side-effects
-              break;
-            }
-          } else {
-            // the constructor could also be an expression like
-            // new (useArray ? Object : Array)();
-          }
+        if (!constructorCallHasSideEffects(n)) {
+          // loop below will see if the constructor parameters have
+          // side-effects
+          break;
         }
         return true;
 
       case Token.CALL:
         // calls to functions that have no side effects have the no
         // side effect property set.
-        if (n.isNoSideEffectsCall()) {
+        if (!functionCallHasSideEffects(n, compiler)) {
           // loop below will see if the function parameters have
           // side-effects
           break;
@@ -449,9 +444,9 @@ public final class NodeUtil {
           // b) The LHS has side effects, or
           // c) A name on the LHS will exist beyond the life of this statement.
           if (checkForStateChangeHelper(
-                  n.getFirstChild(), checkForNewObjects) ||
+                  n.getFirstChild(), checkForNewObjects, compiler) ||
               checkForStateChangeHelper(
-                  n.getLastChild(), checkForNewObjects)) {
+                  n.getLastChild(), checkForNewObjects, compiler)) {
             return true;
           }
 
@@ -469,7 +464,7 @@ public final class NodeUtil {
     }
 
     for (Node c = n.getFirstChild(); c != null; c = c.getNext()) {
-      if (checkForStateChangeHelper(c, checkForNewObjects)) {
+      if (checkForStateChangeHelper(c, checkForNewObjects, compiler)) {
         return true;
       }
     }
@@ -500,12 +495,30 @@ public final class NodeUtil {
     return true;
   }
 
+  private static final Set<String> REGEXP_METHODS =
+      ImmutableSet.of("test", "exec");
+  private static final Set<String> STRING_REGEXP_METHODS =
+      ImmutableSet.of("match", "replace", "search", "split");
+
   /**
    * Returns true if calls to this function have side effects.
    *
    * @param callNode - function call node
    */
-  static boolean functionCallHasSideEffects(Node callNode) {
+  static boolean functionCallHasSideEffects(
+      Node callNode) {
+    return functionCallHasSideEffects(callNode, null);
+  }
+
+  /**
+   * Returns true if calls to this function have side effects.
+   *
+   * @param callNode The call node to inspected.
+   * @param compiler A compiler object to provide program state changing
+   *     context information. Can be null.
+   */
+  static boolean functionCallHasSideEffects(
+      Node callNode, @Nullable AbstractCompiler compiler) {
     Preconditions.checkArgument(
         callNode.getType() == Token.CALL,
         "Expected CALL node, got " + Token.name(callNode.getType()));
@@ -522,14 +535,28 @@ public final class NodeUtil {
       if (name.equals("String")) {
         return false;
       }
-    }
+    } else if (nameNode.getType() == Token.GETPROP) {
+      // Functions in the "Math" namespace have no side effects.
+      if (nameNode.getFirstChild().getType() == Token.NAME) {
+        String namespaceName = nameNode.getFirstChild().getString();
+        if (namespaceName.equals("Math")) {
+          return false;
+        }
+      }
 
-    // Functions in the "Math" namespace have no side effects.
-    if (nameNode.getType() == Token.GETPROP &&
-        nameNode.getFirstChild().getType() == Token.NAME) {
-      String namespaceName = nameNode.getFirstChild().getString();
-      if (namespaceName.equals("Math")) {
-        return false;
+      if (compiler != null && !compiler.hasRegExpGlobalReferences()) {
+        if (nameNode.getFirstChild().getType() == Token.REGEXP
+            && REGEXP_METHODS.contains(nameNode.getLastChild().getString())) {
+          return false;
+        } else if (nameNode.getFirstChild().getType() == Token.STRING
+            && STRING_REGEXP_METHODS.contains(
+                nameNode.getLastChild().getString())) {
+          Node param = nameNode.getNext();
+          if (param != null &&
+              (param.getType() == Token.STRING
+                  || param.getType() == Token.REGEXP))
+          return false;
+        }
       }
     }
 
diff --git a/src/com/google/javascript/jscomp/PureFunctionIdentifier.java b/src/com/google/javascript/jscomp/PureFunctionIdentifier.java
index 894d65ba2..83cd41c20 100644
--- a/src/com/google/javascript/jscomp/PureFunctionIdentifier.java
+++ b/src/com/google/javascript/jscomp/PureFunctionIdentifier.java
@@ -282,21 +282,35 @@ class PureFunctionIdentifier implements CompilerPass {
       Node name = callNode.getFirstChild();
       Collection<Definition> defs =
           getCallableDefinitions(definitionProvider, name);
-      if (defs == null) {
-        continue;
+      boolean hasSideEffects = true;
+      if (defs != null) {
+        hasSideEffects = false;
+        for (Definition def : defs) {
+          FunctionInformation functionInfo =
+              functionSideEffectMap.get(def.getRValue());
+          Preconditions.checkNotNull(functionInfo);
+
+          if ((NodeUtil.isCall(callNode)
+                  && functionInfo.mayHaveSideEffects())
+               || (NodeUtil.isNew(callNode)
+                      && (functionInfo.mutatesGlobalState()
+                          || functionInfo.functionThrows()))) {
+            hasSideEffects = true;
+            break;
+          }
+        }
       }
 
-      boolean hasSideEffects = false;
-      for (Definition def : defs) {
-        FunctionInformation functionInfo =
-            functionSideEffectMap.get(def.getRValue());
-        Preconditions.checkNotNull(functionInfo);
-
-        if ((NodeUtil.isCall(callNode) && functionInfo.mayHaveSideEffects()) ||
-            (NodeUtil.isNew(callNode) && (functionInfo.mutatesGlobalState() ||
-                                          functionInfo.functionThrows()))) {
-          hasSideEffects = true;
-          break;
+      // Handle special cases (Math, RegEx)
+      if (NodeUtil.isCall(callNode)) {
+        Preconditions.checkState(compiler != null);
+        if (!NodeUtil.functionCallHasSideEffects(callNode, compiler)) {
+          hasSideEffects = false;
+        }
+      } else if (NodeUtil.isNew(callNode)) {
+        // Handle known cases now (Object, Date, RegExp, etc)
+        if (!NodeUtil.constructorCallHasSideEffects(callNode)) {
+          hasSideEffects = false;
         }
       }
 
@@ -420,6 +434,18 @@ class PureFunctionIdentifier implements CompilerPass {
      * Record information about a call site.
      */
     private void visitCall(FunctionInformation sideEffectInfo, Node node) {
+      // Handle special cases (Math, RegEx)
+      if (NodeUtil.isCall(node)
+          && !NodeUtil.functionCallHasSideEffects(node, compiler)) {
+        return;
+      }
+
+      // Handle known cases now (Object, Date, RegExp, etc)
+      if (NodeUtil.isNew(node)
+          && !NodeUtil.constructorCallHasSideEffects(node)) {
+        return;
+      }
+
       sideEffectInfo.appendCall(node);
     }
 
diff --git a/src/com/google/javascript/jscomp/TypedCodeGenerator.java b/src/com/google/javascript/jscomp/TypedCodeGenerator.java
index 167f75f6a..a3bc4e709 100644
--- a/src/com/google/javascript/jscomp/TypedCodeGenerator.java
+++ b/src/com/google/javascript/jscomp/TypedCodeGenerator.java
@@ -18,6 +18,7 @@ package com.google.javascript.jscomp;
 
 import com.google.javascript.rhino.Node;
 import com.google.javascript.rhino.Token;
+import com.google.javascript.rhino.jstype.FunctionPrototypeType;
 import com.google.javascript.rhino.jstype.FunctionType;
 import com.google.javascript.rhino.jstype.JSType;
 import com.google.javascript.rhino.jstype.ObjectType;
@@ -57,13 +58,13 @@ class TypedCodeGenerator extends CodeGenerator {
     super.add(n, context);
   }
 
-
   private String getTypeAnnotation(Node node) {
     JSType type = node.getJSType();
     if (type instanceof FunctionType) {
       return getFunctionAnnotation(node);
     } else if (type != null && !type.isUnknownType()
-        && !type.isEmptyType() && !type.isVoidType()) {
+        && !type.isEmptyType() && !type.isVoidType() &&
+        !type.isFunctionPrototypeType()) {
       return "/** @type {" + node.getJSType() + "} */\n";
     } else {
       return "";
@@ -76,9 +77,12 @@ class TypedCodeGenerator extends CodeGenerator {
   private String getFunctionAnnotation(Node node) {
     StringBuilder sb = new StringBuilder("/**\n");
 
-    if (node.getJSType().isUnknownType()) {
+    JSType type = node.getJSType();
+
+    if (type == null || type.isUnknownType()) {
       return "";
     }
+
     FunctionType funType = (FunctionType) node.getJSType();
 
     // We need to use the child nodes of the function as the nodes for the
@@ -113,10 +117,15 @@ class TypedCodeGenerator extends CodeGenerator {
 
     // Constructor/interface
     if (funType.isConstructor() || funType.isInterface()) {
-      ObjectType superInstance =
+      
+      FunctionType superConstructor = funType.getSuperClassConstructor();
+      
+      if (superConstructor != null) {
+        ObjectType superInstance =
           funType.getSuperClassConstructor().getInstanceType();
-      if (!superInstance.toString().equals("Object")) {
-        sb.append(" * @extends {"  + superInstance + "}\n");
+        if (!superInstance.toString().equals("Object")) {
+          sb.append(" * @extends {"  + superInstance + "}\n");
+        }
       }
 
       for (ObjectType interfaze : funType.getImplementedInterfaces()) {
diff --git a/src/com/google/javascript/jscomp/deps/JsFileLineParser.java b/src/com/google/javascript/jscomp/deps/JsFileLineParser.java
index f14cbfd1a..becaf601c 100644
--- a/src/com/google/javascript/jscomp/deps/JsFileLineParser.java
+++ b/src/com/google/javascript/jscomp/deps/JsFileLineParser.java
@@ -22,6 +22,10 @@ import com.google.javascript.jscomp.DiagnosticType;
 import com.google.javascript.jscomp.ErrorManager;
 import com.google.javascript.jscomp.JSError;
 
+import java.io.BufferedReader;
+import java.io.IOException;
+import java.io.Reader;
+import java.io.StringReader;
 import java.util.List;
 import java.util.regex.Matcher;
 import java.util.regex.Pattern;
@@ -42,7 +46,7 @@ public abstract class JsFileLineParser {
   /**
    * Thrown by base classes to signify a problem parsing a line.
    */
-  protected static class ParseException extends Exception {
+  static class ParseException extends Exception {
     public static final long serialVersionUID = 1L;
     private boolean fatal;
 
@@ -62,29 +66,35 @@ public abstract class JsFileLineParser {
     }
   }
 
-  /** Pattern for stripping JavaScript comments from source files. */
-  private static final Pattern STRIP_COMMENTS_PATTERN =
-      Pattern.compile("/\\*.*?\\*/" + // Multi-line comments
-          "|//.*?$" // Single-line comments.
-          , Pattern.DOTALL | Pattern.MULTILINE);
+  /** Patterns for stripping JavaScript comments from source files. */
+  private static final Pattern COMMENT = Pattern.compile(
+      "//.*" + // single-line comment
+      "|/\\*([^\\*]*(\\*+[^/\\*])?)*(\\*+/)?" // start of multi-line comment
+      );
+  private static final Pattern END_MULTILINE_COMMENT =
+      Pattern.compile(".*?\\*/");
 
   /** Pattern for matching JavaScript string literals. */
   private static final Pattern STRING_LITERAL_PATTERN = Pattern.compile(
       "\\s*(?:'((?:\\\\'|[^'])*?)'|\"((?:\\\\\"|[^\"])*?)\")\\s*");
 
-  /** Matcher used in the parsing comments. */
-  private Matcher stripCommentsMatcher = STRIP_COMMENTS_PATTERN.matcher("");
+  /** Matchers for comments. */
+  private Matcher commentMatcher = COMMENT.matcher("");
+
+  private Matcher endMultilineCommentMatcher =
+      END_MULTILINE_COMMENT.matcher("");
+
   /** Matcher used in the parsing string literals. */
   private Matcher valueMatcher = STRING_LITERAL_PATTERN.matcher("");
 
   /** Path of the file currently being parsed. */
-  protected String filePath;
+  String filePath;
   /** The line number of the line currently being parsed. */
-  protected int lineNum;
+  int lineNum;
   /** Handles error messages. */
-  protected ErrorManager errorManager;
+  ErrorManager errorManager;
   /** Did our parse succeed. */
-  protected boolean parseSucceeded;
+  boolean parseSucceeded;
 
   /**
    * Constructor.
@@ -99,6 +109,13 @@ public abstract class JsFileLineParser {
     return parseSucceeded;
   }
 
+  /**
+   * @see parseLine(String, Reader)
+   */
+  void doParse(String filePath, String fileContents) {
+    doParse(filePath, new StringReader(fileContents));
+  }
+
   /**
    * Performs the line-by-line parsing of the given fileContents. This method
    * strips out Javascript comments and then uses the abstract parseLine()
@@ -106,32 +123,68 @@ public abstract class JsFileLineParser {
    *
    * @param filePath The path to the file being parsed. Used for reporting parse
    *     exceptions.
-   * @param fileContents The contents of the file.
+   * @param fileContents A reader for the contents of the file.
    */
-  protected void doParse(String filePath, String fileContents) {
+  void doParse(String filePath, Reader fileContents) {
     this.filePath = filePath;
     parseSucceeded = true;
 
-    // Strip all comments.
-    stripCommentsMatcher.reset(fileContents);
-    // TODO(agrieve): Multi-line comments will be removed, causing line-number reporting
-    // to be wrong.
-    fileContents = stripCommentsMatcher.replaceAll("");
-    lineNum = 0;
+    BufferedReader lineBuffer = new BufferedReader(fileContents);
+
     // Parse all lines.
-    for (String line : fileContents.split("\n")) {
-      ++lineNum;
-      try {
-        parseLine(line);
-      } catch (ParseException e) {
-        // Inform the error handler of the exception.
-        errorManager.report(
-            e.isFatal() ? CheckLevel.ERROR : CheckLevel.WARNING,
-            JSError.make(filePath, lineNum, 0 /* char offset */,
-                e.isFatal() ? PARSE_ERROR : PARSE_WARNING,
-                e.getMessage(), line));
-        parseSucceeded = parseSucceeded && !e.isFatal();
+    String line = null;
+    lineNum = 0;
+    boolean inMultilineComment = false;
+
+    try {
+      while (null != (line = lineBuffer.readLine())) {
+        ++lineNum;
+        try {
+          String revisedLine = line;
+          if (inMultilineComment) {
+            endMultilineCommentMatcher.reset(line);
+            if (endMultilineCommentMatcher.lookingAt()) {
+              revisedLine = endMultilineCommentMatcher.replaceFirst("");
+              inMultilineComment = false;
+            } else {
+              revisedLine = "";
+            }
+          }
+
+          if (!inMultilineComment) {
+            commentMatcher.reset(line);
+            if (commentMatcher.find()) {
+              do {
+                if (// The last match hit a /**-style comment.
+                    commentMatcher.group(1) != null &&
+                    // The /**-style comment didn't close.
+                    commentMatcher.group(3) == null) {
+                  inMultilineComment = true;
+                }
+              } while (commentMatcher.find());
+
+              revisedLine = commentMatcher.replaceAll("");
+            }
+          }
+
+          if (!revisedLine.isEmpty()) {
+            parseLine(revisedLine);
+          }
+        } catch (ParseException e) {
+          // Inform the error handler of the exception.
+          errorManager.report(
+              e.isFatal() ? CheckLevel.ERROR : CheckLevel.WARNING,
+              JSError.make(filePath, lineNum, 0 /* char offset */,
+                  e.isFatal() ? PARSE_ERROR : PARSE_WARNING,
+                  e.getMessage(), line));
+          parseSucceeded = parseSucceeded && !e.isFatal();
+        }
       }
+    } catch (IOException e) {
+      errorManager.report(CheckLevel.ERROR,
+          JSError.make(filePath, 0, 0 /* char offset */,
+              PARSE_ERROR, "Error reading file: " + filePath));
+      parseSucceeded = false;
     }
   }
 
@@ -141,7 +194,7 @@ public abstract class JsFileLineParser {
    * @param line The line to parse.
    * @throws ParseException Should be thrown to signify a problem with the line.
    */
-  protected abstract void parseLine(String line) throws ParseException;
+  abstract void parseLine(String line) throws ParseException;
 
   /**
    * Parses a JS string literal.
@@ -150,7 +203,7 @@ public abstract class JsFileLineParser {
    * @throws ParseException Thrown if there is a string literal that cannot be
    *     parsed.
    */
-  protected String parseJsString(String jsStringLiteral) throws ParseException {
+  String parseJsString(String jsStringLiteral) throws ParseException {
     valueMatcher.reset(jsStringLiteral);
     if (!valueMatcher.matches()) {
       throw new ParseException("Syntax error in JS String literal", true /* fatal */);
diff --git a/test/com/google/javascript/jscomp/AmbiguatePropertiesTest.java b/test/com/google/javascript/jscomp/AmbiguatePropertiesTest.java
index 540cd7825..194801e3d 100644
--- a/test/com/google/javascript/jscomp/AmbiguatePropertiesTest.java
+++ b/test/com/google/javascript/jscomp/AmbiguatePropertiesTest.java
@@ -346,6 +346,24 @@ public class AmbiguatePropertiesTest extends CompilerTestCase {
          "Bar.prototype.a = function(){};");
   }
 
+  public void testStaticAndSubInstanceProperties() {
+    String js = ""
+        + "/** @constructor */ var Foo = function(){};\n"
+        + "Foo.x=0;\n"
+        + "/** @constructor \n @extends Foo */ var Bar = function(){};\n"
+        + "goog.inherits(Bar, Foo);\n"
+        + "Bar.y=0;\n"
+        + "Bar.prototype.z=0;\n";
+    String output = ""
+        + "/** @constructor */ var Foo = function(){};\n"
+        + "Foo.a=0;\n"
+        + "/** @constructor \n @extends Foo */ var Bar = function(){};\n"
+        + "goog.inherits(Bar, Foo);\n"
+        + "Bar.a=0;\n"
+        + "Bar.prototype.a=0;\n";
+    test(js, output);
+  }
+
   public void testTypeMismatch() {
     testSame(EXTERNS, "/** @constructor */var Foo = function(){};\n"
              + "/** @constructor */var Bar = function(){};\n"
@@ -430,4 +448,67 @@ public class AmbiguatePropertiesTest extends CompilerTestCase {
         + "function g(x) { x.a = 3; }";
     test(js, output);
   }
+
+  public void testImplementsAndExtends2() {
+    String js = ""
+        + "/** @interface */ function A() {}\n"
+        + "/**\n"
+        + " * @constructor\n"
+        + " */\n"
+        + "function C1(){}\n"
+        + "/**\n"
+        + " * @constructor\n"
+        + " * @extends {C1}\n"
+        + " * @implements {A}\n"
+        + " */\n"
+        + "function C2(){}\n"
+        + "/** @param {C1} x */ function f(x) { x.y = 3; }\n"
+        + "/** @param {A} x */ function g(x) { x.z = 3; }\n";
+    String output = ""
+        + "function A(){}\n"
+        + "function C1(){}\n"
+        + "function C2(){}\n"
+        + "function f(x) { x.a = 3; }\n"
+        + "function g(x) { x.b = 3; }\n";
+    test(js, output);
+  }
+
+  public void testExtendsInterface() {
+    String js = ""
+        + "/** @interface */ function A() {}\n"
+        + "/** @interface \n @extends {A} */ function B() {}\n"
+        + "/** @param {A} x */ function f(x) { x.y = 3; }\n"
+        + "/** @param {B} x */ function g(x) { x.z = 3; }\n";
+    String output = ""
+        + "function A(){}\n"
+        + "function B(){}\n"
+        + "function f(x) { x.a = 3; }\n"
+        + "function g(x) { x.b = 3; }\n";
+    test(js, output);
+  }
+
+  public void testFunctionSubType() {
+    String js = ""
+        + "Function.prototype.a = 1;\n"
+        + "function f() {}\n"
+        + "f.y = 2;\n";
+    String output = ""
+        + "Function.prototype.a = 1;\n"
+        + "function f() {}\n"
+        + "f.b = 2;\n";
+    test(js, output);
+  }
+
+  public void testFunctionSubType2() {
+    String js = ""
+        + "Function.prototype.a = 1;\n"
+        + "/** @constructor */ function F() {}\n"
+        + "F.y = 2;\n";
+    String output = ""
+        + "Function.prototype.a = 1;\n"
+        + "function F() {}\n"
+        + "F.b = 2;\n";
+    test(js, output);
+  }
+
 }
diff --git a/test/com/google/javascript/jscomp/CodePrinterTest.java b/test/com/google/javascript/jscomp/CodePrinterTest.java
index 0e89f519e..08272561e 100644
--- a/test/com/google/javascript/jscomp/CodePrinterTest.java
+++ b/test/com/google/javascript/jscomp/CodePrinterTest.java
@@ -34,12 +34,14 @@ public class CodePrinterTest extends TestCase {
     Node n = compiler.parseTestCode(js);
 
     if (checkTypes) {
-      CompilerPass typeResolver = new DefaultPassConfig(null)
-          .resolveTypes.create(compiler);
+      DefaultPassConfig passConfig = new DefaultPassConfig(null);
+      CompilerPass typeResolver = passConfig.resolveTypes.create(compiler);
       Node externs = new Node(Token.SCRIPT);
       Node externAndJsRoot = new Node(Token.BLOCK, externs, n);
       externAndJsRoot.setIsSyntheticBlock(true);
       typeResolver.process(externs, n);
+      CompilerPass inferTypes = passConfig.inferTypes.create(compiler);
+      inferTypes.process(externs, n);
     }
 
     assertEquals("Errors for: " + js, 0, compiler.getErrorCount());
@@ -395,7 +397,6 @@ public class CodePrinterTest extends TestCase {
             CodePrinter.DEFAULT_LINE_LENGTH_THRESHOLD));
   }
 
-
   public void testPrettyPrinter() {
     // Ensure that the pretty printer inserts line breaks at appropriate
     // places.
@@ -628,7 +629,7 @@ public class CodePrinterTest extends TestCase {
         + " * @return {number}\n"
         + " */\n"
         + "a.Foo.prototype.foo = function(foo) {\n};\n"
-        + "/** @type {(string|undefined)} */\n"
+        + "/** @type {string} */\n"
         + "a.Foo.prototype.bar = \"\"");
   }
 
@@ -697,6 +698,18 @@ public class CodePrinterTest extends TestCase {
         "/**\n * @constructor\n */\nvar x = function() {\n}");
   }
 
+  public void testTempConstructor() {
+    assertTypeAnnotations(
+        "var x = function() {\n/**\n * @constructor\n */\nfunction t1() {}\n" +
+        " /**\n * @constructor\n */\nfunction t2() {}\n" +
+        " t1.prototype = t2.prototype}",
+        "/**\n */\nvar x = function() {\n" +
+        "  /**\n * @constructor\n */\nfunction t1() {\n  }\n" +
+        "  /**\n * @constructor\n */\nfunction t2() {\n  }\n" +
+        "  t1.prototype = t2.prototype\n}"
+    );
+  }
+
   private void assertPrettyPrint(String js, String expected) {
     assertEquals(expected,
         parsePrint(js, true, false,
diff --git a/test/com/google/javascript/jscomp/CrossModuleMethodMotionTest.java b/test/com/google/javascript/jscomp/CrossModuleMethodMotionTest.java
index da04087ae..0b4e038c1 100644
--- a/test/com/google/javascript/jscomp/CrossModuleMethodMotionTest.java
+++ b/test/com/google/javascript/jscomp/CrossModuleMethodMotionTest.java
@@ -255,4 +255,133 @@ public class CrossModuleMethodMotionTest extends CompilerTestCase {
           "x();"
         });
   }
+  
+  // Read of closure variable disables method motions.
+  public void testClosureVariableReads1() {
+    testSame(createModuleChain(
+            "function Foo() {}" +
+            "(function() {" +
+            "var x = 'x';" +
+            "Foo.prototype.baz = function() {x};" +
+            "})();",
+            // Module 2
+            "var y = new Foo(); y.baz();"));
+  }
+  
+  // Read of global variable is fine.
+  public void testClosureVariableReads2() {
+    test(createModuleChain(
+            "function Foo() {}" +
+            "Foo.prototype.b1 = function() {" +
+            "  var x = 1;" +
+            "  Foo.prototype.b2 = function() {" +
+            "    Foo.prototype.b3 = function() {" +
+            "      x;" +
+            "    }" +
+            "  }" +
+            "};",
+            // Module 2
+            "var y = new Foo(); y.b1();",
+            // Module 3
+            "y = new Foo(); z.b2();",
+            // Module 4
+            "y = new Foo(); z.b3();"
+            ),
+         new String[] {
+           STUB_DECLARATIONS +
+           "function Foo() {}" +
+           "Foo.prototype.b1 = JSCompiler_stubMethod(0);",
+           // Module 2
+           "Foo.prototype.b1 = JSCompiler_unstubMethod(0, function() {" +
+           "  var x = 1;" +
+           "  Foo.prototype.b2 = function() {" +
+           "    Foo.prototype.b3 = function() {" +
+           "      x;" +
+           "    }" +
+           "  }" +
+           "});" +
+           "var y = new Foo(); y.b1();",
+           // Module 3
+           "y = new Foo(); z.b2();",
+           // Module 4
+           "y = new Foo(); z.b3();"
+        });
+  }
+  
+  public void testClosureVariableReads3() {
+    test(createModuleChain(
+            "function Foo() {}" +
+            "Foo.prototype.b1 = function() {" +
+            "  Foo.prototype.b2 = function() {" +
+            "    var x = 1;" +
+            "    Foo.prototype.b3 = function() {" +
+            "      x;" +
+            "    }" +
+            "  }" +
+            "};",
+            // Module 2
+            "var y = new Foo(); y.b1();",
+            // Module 3
+            "y = new Foo(); z.b2();",
+            // Module 4
+            "y = new Foo(); z.b3();"
+            ),
+         new String[] {
+           STUB_DECLARATIONS +
+           "function Foo() {}" +
+           "Foo.prototype.b1 = JSCompiler_stubMethod(0);",
+           // Module 2
+           "Foo.prototype.b1 = JSCompiler_unstubMethod(0, function() {" +
+           "  Foo.prototype.b2 = JSCompiler_stubMethod(1);" +
+           "});" +
+           "var y = new Foo(); y.b1();",
+           // Module 3
+           "Foo.prototype.b2 = JSCompiler_unstubMethod(1, function() {" +
+           "  var x = 1;" +
+           "  Foo.prototype.b3 = function() {" +
+           "    x;" +
+           "  }" +
+           "});" +
+           "y = new Foo(); z.b2();",
+           // Module 4
+           "y = new Foo(); z.b3();"
+        });
+  }
+  
+  // Read of global variable is fine.
+  public void testNoClosureVariableReads1() {
+    test(createModuleChain(
+            "function Foo() {}" +
+            "var x = 'x';" +
+            "Foo.prototype.baz = function(){x};",
+            // Module 2
+            "var y = new Foo(); y.baz();"),
+         new String[] {
+           STUB_DECLARATIONS +
+           "function Foo() {}" +
+           "var x = 'x';" +
+           "Foo.prototype.baz = JSCompiler_stubMethod(0);",
+           // Module 2             
+           "Foo.prototype.baz = JSCompiler_unstubMethod(0, function(){x});" +
+           "var y = new Foo(); y.baz();"
+        });
+  }
+  
+  // Read of a local is fine.
+  public void testNoClosureVariableReads2() {
+    test(createModuleChain(
+            "function Foo() {}" +
+            "Foo.prototype.baz = function(){var x = 1;x};",
+            // Module 2
+            "var y = new Foo(); y.baz();"),
+         new String[] {
+           STUB_DECLARATIONS +
+           "function Foo() {}" +
+           "Foo.prototype.baz = JSCompiler_stubMethod(0);",
+           // Module 2             
+           "Foo.prototype.baz = JSCompiler_unstubMethod(" + 
+           "    0, function(){var x = 1; x});" +
+           "var y = new Foo(); y.baz();"
+        });
+  }
 }
diff --git a/test/com/google/javascript/jscomp/NodeUtilTest.java b/test/com/google/javascript/jscomp/NodeUtilTest.java
index c1d29f24f..f0cab09b0 100644
--- a/test/com/google/javascript/jscomp/NodeUtilTest.java
+++ b/test/com/google/javascript/jscomp/NodeUtilTest.java
@@ -171,6 +171,13 @@ public class NodeUtilTest extends TestCase {
     assertEquals(se, NodeUtil.mayHaveSideEffects(n.getFirstChild()));
   }
 
+  private void assertSideEffect(boolean se, String js, boolean GlobalRegExp) {
+    Node n = parse(js);
+    Compiler compiler = new Compiler();
+    compiler.setHasRegExpGlobalReferences(GlobalRegExp);
+    assertEquals(se, NodeUtil.mayHaveSideEffects(n.getFirstChild(), compiler));
+  }
+
   public void testMayHaveSideEffects() {
     assertSideEffect(true, "i++");
     assertSideEffect(true, "[b, [a, i++]]");
@@ -234,6 +241,53 @@ public class NodeUtilTest extends TestCase {
     assertSideEffect(true, "([]).foo = bar()");
   }
 
+  public void testRegExpSideEffect() {
+    // A RegExp Object by itself doesn't have any side-effects
+    assertSideEffect(false, "/abc/gi", true);
+    assertSideEffect(false, "/abc/gi", false);
+
+    // RegExp instance methods have global side-effects, so whether they are
+    // considered side-effect free depends on whether the global properties
+    // are referenced.
+    assertSideEffect(true, "(/abc/gi).test('')", true);
+    assertSideEffect(false, "(/abc/gi).test('')", false);
+    assertSideEffect(true, "(/abc/gi).test(a)", true);
+    assertSideEffect(false, "(/abc/gi).test(b)", false);
+
+    assertSideEffect(true, "(/abc/gi).exec('')", true);
+    assertSideEffect(false, "(/abc/gi).exec('')", false);
+
+    // Some RegExp object method that may have side-effects.
+    assertSideEffect(true, "(/abc/gi).foo('')", true);
+    assertSideEffect(true, "(/abc/gi).foo('')", false);
+
+    // Try the string RegExp ops.
+    assertSideEffect(true, "''.match('a')", true);
+    assertSideEffect(false, "''.match('a')", false);
+    assertSideEffect(true, "''.match(/(a)/)", true);
+    assertSideEffect(false, "''.match(/(a)/)", false);
+
+    assertSideEffect(true, "''.replace('a')", true);
+    assertSideEffect(false, "''.replace('a')", false);
+
+    assertSideEffect(true, "''.search('a')", true);
+    assertSideEffect(false, "''.search('a')", false);
+
+    assertSideEffect(true, "''.split('a')", true);
+    assertSideEffect(false, "''.split('a')", false);
+
+    // Some non-RegExp string op that may have side-effects.
+    assertSideEffect(true, "''.foo('a')", true);
+    assertSideEffect(true, "''.foo('a')", false);
+
+    // 'a' might be a RegExp object with the 'g' flag, in which case 
+    // the state might change by running any of the string ops.
+    // Specifically, using these methods resets the "lastIndex" if used
+    // in combination with a RegExp instance "exec" method.
+    assertSideEffect(true, "''.match(a)", true);
+    assertSideEffect(true, "''.match(a)", false);
+  }
+
   private void assertMutableState(boolean se, String js) {
     Node n = parse(js);
     assertEquals(se, NodeUtil.mayEffectMutableState(n.getFirstChild()));
@@ -802,5 +856,4 @@ public class NodeUtilTest extends TestCase {
     assertFalse(secondBreak.hasChildren());
     assertFalse(NodeUtil.isLabelName(secondBreak.getFirstChild()));
   }
-
 }
diff --git a/test/com/google/javascript/jscomp/PureFunctionIdentifierTest.java b/test/com/google/javascript/jscomp/PureFunctionIdentifierTest.java
index a35ec60d1..74318a61e 100644
--- a/test/com/google/javascript/jscomp/PureFunctionIdentifierTest.java
+++ b/test/com/google/javascript/jscomp/PureFunctionIdentifierTest.java
@@ -33,6 +33,8 @@ import java.util.List;
  */
 public class PureFunctionIdentifierTest extends CompilerTestCase {
   List<String> noSideEffectCalls = Lists.newArrayList();
+  
+  boolean regExpHaveSideEffects = true;
 
   private static String kExterns =
       CompilerTypeTestCase.DEFAULT_EXTERNS +
@@ -89,6 +91,7 @@ public class PureFunctionIdentifierTest extends CompilerTestCase {
   protected void tearDown() throws Exception {
     super.tearDown();
     noSideEffectCalls.clear();
+    boolean regExpHaveSideEffects = true;
   }
 
   public void testAnnotationInExterns1() throws Exception {
@@ -654,6 +657,18 @@ public class PureFunctionIdentifierTest extends CompilerTestCase {
     checkMarkedCalls(source, ImmutableList.<String>of("(g : g)", "k"));
   }
 
+  public void testCallRegExpWithSideEffects() throws Exception {
+    String source = "var x = 0;\n" +
+        "function k(){(/a/).exec('')}\n" +
+        "k()";
+
+    regExpHaveSideEffects = true;
+    checkMarkedCalls(source, ImmutableList.<String>of());
+    regExpHaveSideEffects = false;
+    checkMarkedCalls(source, ImmutableList.<String>of(
+        "REGEXP STRING exec", "k"));
+  }
+
   public void testInvalidAnnotation1() throws Exception {
     test("/** @nosideeffects */ function foo() {}",
          null, INVALID_NO_SIDE_EFFECT_ANNOTATION);
@@ -706,6 +721,7 @@ public class PureFunctionIdentifierTest extends CompilerTestCase {
 
     @Override
     public void process(Node externs, Node root) {
+      compiler.setHasRegExpGlobalReferences(regExpHaveSideEffects);
       SimpleDefinitionFinder defFinder = new SimpleDefinitionFinder(compiler);
       defFinder.process(externs, root);
       PureFunctionIdentifier passUnderTest =
@@ -739,7 +755,12 @@ public class PureFunctionIdentifierTest extends CompilerTestCase {
         return "(" + generateNameString(node.getFirstChild().getNext()) +
             " : " + generateNameString(node.getLastChild()) + ")";
       } else {
-        return node.getQualifiedName();
+        String result = node.getQualifiedName();
+        if (result == null) {
+          result = node.getFirstChild().toString(false, false, false);
+          result += " " + node.getLastChild().toString(false, false, false);
+        }
+        return result;
       }
     }
   }
diff --git a/test/com/google/javascript/jscomp/deps/JsFileLineParserTest.java b/test/com/google/javascript/jscomp/deps/JsFileLineParserTest.java
new file mode 100644
index 000000000..6ac458451
--- /dev/null
+++ b/test/com/google/javascript/jscomp/deps/JsFileLineParserTest.java
@@ -0,0 +1,103 @@
+/*
+ * Copyright 2010 Google Inc.
+ *
+ * Licensed under the Apache License, Version 2.0 (the "License");
+ * you may not use this file except in compliance with the License.
+ * You may obtain a copy of the License at
+ *
+ *     http://www.apache.org/licenses/LICENSE-2.0
+ *
+ * Unless required by applicable law or agreed to in writing, software
+ * distributed under the License is distributed on an "AS IS" BASIS,
+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
+ * See the License for the specific language governing permissions and
+ * limitations under the License.
+ */
+
+package com.google.javascript.jscomp.deps;
+
+import com.google.common.collect.ImmutableList;
+import com.google.javascript.jscomp.ErrorManager;
+import com.google.javascript.jscomp.PrintStreamErrorManager;
+
+import junit.framework.TestCase;
+
+import java.util.Collections;
+
+/**
+ * Tests for {@link JsFileLineParser}.
+ *
+ * @author nicksantos@google.com (Nick Santos)
+ */
+public class JsFileLineParserTest extends TestCase {
+
+  TestParser parser;
+  private ErrorManager errorManager;
+
+  @Override
+  public void setUp() {
+    errorManager = new PrintStreamErrorManager(System.err);
+    parser = new TestParser(errorManager);
+  }
+
+  public void testSingleLine1() {
+    assertStrip("2", "// 1\n2");
+  }
+
+  public void testSingleLine2() {
+    assertStrip("2 ", "// 1\n2 // 3 // 4 \n");
+  }
+
+  public void testMultiLine1() {
+    assertStrip("1", "/* hi */\n1");
+  }
+
+  public void testMultiLine2() {
+    assertStrip("123", "1/* hi */2\n3");
+  }
+
+  public void testMultiLine3() {
+    assertStrip("14", "1/* hi 2\n3*/4");
+  }
+
+  public void testMultiLine4() {
+    assertStrip("15", "1/* hi x\ny\nz*/5");
+  }
+
+  public void testMultiLine5() {
+    assertStrip("1234", "1/* hi */2/**/3/*\n/** bye */4");
+  }
+
+  public void testMultiLine6() {
+    assertStrip("12", "1/*** hi *** 3 **/2");
+  }
+
+  public void testMixedLine1() {
+    assertStrip("14", "1// /** 2 **/ 3\n4");
+  }
+
+  public void testMixedLine2() {
+    assertStrip("1 34", "1/** // 2 **/ 3\n4");
+  }
+
+  private void assertStrip(String expected, String input) {
+    parser.doParse("file", input);
+    assertEquals(expected, parser.toString());
+  }
+
+  private static class TestParser extends JsFileLineParser {
+    StringBuffer sb = new StringBuffer();
+
+    TestParser(ErrorManager errorManager) {
+      super(errorManager);
+    }
+
+    void parseLine(String line) {
+      sb.append(line);
+    }
+
+    public String toString() {
+      return sb.toString();
+    }
+  }
+}
