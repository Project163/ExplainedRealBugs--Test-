[{"id":88602728,"node_id":"MDEzOkFzc2lnbmVkRXZlbnQ4ODYwMjcyOA==","url":"https://api.github.com/repos/redis/redis/issues/events/88602728","actor":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"assigned","commit_id":null,"commit_url":null,"created_at":"2014-01-25T15:02:59Z","assignee":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33290953","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33290953","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33290953,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkwOTUz","user":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:11:24Z","updated_at":"2014-01-25T15:11:24Z","body":"If your first solution will be used, please make sure this is properly documented. Right now most users come and ask whether KEYS / ARGV seperation is neccessary in their script or not. For simple scripts right now it makes no difference but with this fix it can affect behaviour\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33290953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291009","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33291009","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33291009,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkxMDA5","user":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:14:07Z","updated_at":"2014-01-25T15:14:07Z","body":"On second read I'm not even sure your proposed solution works for this case.\nIf I understand correctly when this script is executed on the master, the key is expired between the two if-conditions (resulting in just one `INCR` executed) whereas your proposed solution may remove the key BEFORE the script is executed (and thus `INCR` is never executed in the slave). Am I right here or did I not understand the problem in full?\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291068","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33291068","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33291068,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkxMDY4","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:16:39Z","updated_at":"2014-01-25T15:16:39Z","body":"@badboy Replying to your two comments:\n\n1) Definitely... keys are expired anyway even if KEYS is never populated, and even if some key is accessed only via this broken script not populating KEYS, since there is also the background expiring. However it is better to document this behavior and in general to document that people writing scripts SHOULD advertise the keys they are going to use if they want a consistent behavior from Redis, and if they want their scripts to be portable to Redis Cluster (at least in the case a single key is used in the script).\n\n2) After the fix, the key will be expired before the script, a DEL will be synthesized in the replication channel, and later EVAL will be send to the replication channel, so the slave will see DEL + EVAL, and the key will not be there for the slave as well.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":88603401,"node_id":"MDE0Ok1lbnRpb25lZEV2ZW50ODg2MDM0MDE=","url":"https://api.github.com/repos/redis/redis/issues/events/88603401","actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2014-01-25T15:16:39Z","performed_via_github_app":null},{"id":88603402,"node_id":"MDE1OlN1YnNjcmliZWRFdmVudDg4NjAzNDAy","url":"https://api.github.com/repos/redis/redis/issues/events/88603402","actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2014-01-25T15:16:39Z","performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291091","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33291091","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33291091,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkxMDkx","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:17:16Z","updated_at":"2014-01-25T15:17:16Z","body":"In short with the fix, Lua scripts become atomic from the point of view of the key expire process, as keys can no longer expire in the middle, making them very similar to any other command in this regard.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291134","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33291134","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33291134,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkxMTM0","user":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:19:41Z","updated_at":"2014-01-25T15:19:41Z","body":"Ah, so the `expireIfNeeded` is done on the master, now I get it. That makes sense. Thanks.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"badboy","id":2129,"node_id":"MDQ6VXNlcjIxMjk=","avatar_url":"https://avatars.githubusercontent.com/u/2129?v=4","gravatar_id":"","url":"https://api.github.com/users/badboy","html_url":"https://github.com/badboy","followers_url":"https://api.github.com/users/badboy/followers","following_url":"https://api.github.com/users/badboy/following{/other_user}","gists_url":"https://api.github.com/users/badboy/gists{/gist_id}","starred_url":"https://api.github.com/users/badboy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/badboy/subscriptions","organizations_url":"https://api.github.com/users/badboy/orgs","repos_url":"https://api.github.com/users/badboy/repos","events_url":"https://api.github.com/users/badboy/events{/privacy}","received_events_url":"https://api.github.com/users/badboy/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291302","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-33291302","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":33291302,"node_id":"MDEyOklzc3VlQ29tbWVudDMzMjkxMzAy","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2014-01-25T15:27:28Z","updated_at":"2014-01-25T15:27:28Z","body":"Two more things:\n- This issue also apply to AOF: reloading the AOF is not able to provide the same identical dataset if stuff expire in the middle of scripts execution.\n- After applying the following patch I verified that I can't trigger the issue again, at least in the specific example I provided above for reproduction:\n\n``` diff\ndiff --git a/src/db.c b/src/db.c\nindex b625fea..906acd4 100644\n--- a/src/db.c\n+++ b/src/db.c\n@@ -755,8 +755,13 @@ void propagateExpire(redisDb *db, robj *key) {\n }\n\n int expireIfNeeded(redisDb *db, robj *key) {\n-    long long when = getExpire(db,key);\n+    long long when;\n\n+    /* Don't expire keys during exection of Lua scripts: slaves /AOF\n+     * would not be able to replicate the script correctly otherwise. */\n+    if (server.lua_caller) return 0;\n+\n+    when = getExpire(db,key);\n     if (when < 0) return 0; /* No expire for this key */\n\n     /* Don't expire anything while loading. It will be done later. */\n```\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/33291302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"actor":{"login":"elukey","id":1536240,"node_id":"MDQ6VXNlcjE1MzYyNDA=","avatar_url":"https://avatars.githubusercontent.com/u/1536240?v=4","gravatar_id":"","url":"https://api.github.com/users/elukey","html_url":"https://github.com/elukey","followers_url":"https://api.github.com/users/elukey/followers","following_url":"https://api.github.com/users/elukey/following{/other_user}","gists_url":"https://api.github.com/users/elukey/gists{/gist_id}","starred_url":"https://api.github.com/users/elukey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elukey/subscriptions","organizations_url":"https://api.github.com/users/elukey/orgs","repos_url":"https://api.github.com/users/elukey/repos","events_url":"https://api.github.com/users/elukey/events{/privacy}","received_events_url":"https://api.github.com/users/elukey/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T13:08:33Z","updated_at":"2017-07-04T13:08:33Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/4103","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/4103/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/4103/comments","events_url":"https://api.github.com/repos/redis/redis/issues/4103/events","html_url":"https://github.com/redis/redis/issues/4103","id":240416118,"node_id":"MDU6SXNzdWUyNDA0MTYxMTg=","number":4103,"title":"Redis 2.8 inconsistent replication on multiple slaves","user":{"login":"elukey","id":1536240,"node_id":"MDQ6VXNlcjE1MzYyNDA=","avatar_url":"https://avatars.githubusercontent.com/u/1536240?v=4","gravatar_id":"","url":"https://api.github.com/users/elukey","html_url":"https://github.com/elukey","followers_url":"https://api.github.com/users/elukey/followers","following_url":"https://api.github.com/users/elukey/following{/other_user}","gists_url":"https://api.github.com/users/elukey/gists{/gist_id}","starred_url":"https://api.github.com/users/elukey/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elukey/subscriptions","organizations_url":"https://api.github.com/users/elukey/orgs","repos_url":"https://api.github.com/users/elukey/repos","events_url":"https://api.github.com/users/elukey/events{/privacy}","received_events_url":"https://api.github.com/users/elukey/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":2,"created_at":"2017-07-04T13:08:33Z","updated_at":"2018-02-09T09:13:43Z","closed_at":"2018-02-09T09:13:43Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-12-13T04:51:44Z","pushed_at":"2025-12-11T09:07:47Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":205841,"stargazers_count":72116,"watchers_count":72116,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24380,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24380,"open_issues":2735,"watchers":72116,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Hi everybody,\r\n\r\nI am working for the Wikimedia foundation and we are happy users of Redis (Debian Jessie version, 2.8.17). We use Redis as queueing system for all the Mediawiki async jobs, that gets pushed via application servers and executed later on by special workers called jobrunners. These jobs can be moved in various queues (implemented as Lists) and we leverage the atomicity of the LUA scripts execution to make change safely without risking inconsistent views from the clients. Those scripts are sometimes big and heavy (some examples in [1] and [2]) and they use various kind of constructs that can generate race conditions (like `if`). We are aware of the fact that we are probably misusing all the Redis power, but it has been working fine until we discovered a long standing weird inconsistency in our slaves.\r\n\r\nOur architecture is the following: each Redis master has two slaves, one in the same datacenter and the other one in a different one (~40ms lag using ping). We discovered that the two slaves have different values for some key data structures, like some job queues/lists, but the interesting part is that the slave on the same datacenter is in sync with the master, meanwhile the one in the other datacenter shows huge differences.\r\n\r\nWe added a daily restart for all the Redis slaves to force sync with the master, and we found out that the slave in the other DC gets out of sync quickly (1 or 2 hours maximum). \r\n\r\nWe checked several bugs that might be related but none of them seems to fit completely:\r\n\r\nhttps://github.com/antirez/redis/issues/187\r\nhttps://github.com/antirez/redis/issues/614\r\nhttps://github.com/antirez/redis/issues/558\r\nhttps://github.com/antirez/redis/issues/2999\r\nhttps://github.com/antirez/redis/issues/1525\r\n\r\nWe thought in the beginning that it was related to expiring TTLs for particular keys, but we are reasonably sure that they should not be the root cause of this problem because the data-structures that fall out of sync are not related.\r\n\r\nThese are the result of `INFO REPLICATION` for the master and two slaves:\r\n\r\nMaster\r\n```\r\n# Replication\r\nrole:master\r\nconnected_slaves:2\r\nslave0:ip=10.192.16.122,port=6380,state=online,offset=1085882179818,lag=0\r\nslave1:ip=10.64.16.183,port=6380,state=online,offset=1085883228241,lag=0\r\nmaster_repl_offset:1085882237236\r\nrepl_backlog_active:1\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:1085881188661\r\nrepl_backlog_histlen:1048576\r\n\r\n# Keyspace\r\ndb0:keys=9143109,expires=4438000,avg_ttl=1469527137\r\n```\r\n\r\nSlave in the same DC of the master:\r\n\r\n```\r\n# Replication\r\nrole:slave\r\nmaster_host:10.64.0.201\r\nmaster_port:6380\r\nmaster_link_status:up\r\nmaster_last_io_seconds_ago:0\r\nmaster_sync_in_progress:0\r\nslave_repl_offset:1085919408979\r\nslave_priority:100\r\nslave_read_only:0\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# Keyspace\r\ndb0:keys=9128164,expires=4423075,avg_ttl=0\r\n```\r\n\r\nSlave in a different DC (this slave also is replicated to another slave in the same DC, tried to remove it but I didn't observe any relevant change):\r\n\r\n```\r\n# Replication\r\nrole:slave\r\nmaster_host:10.64.0.201\r\nmaster_port:6380\r\nmaster_link_status:up\r\nmaster_last_io_seconds_ago:0\r\nmaster_sync_in_progress:0\r\nslave_repl_offset:1085876438756\r\nslave_priority:100\r\nslave_read_only:0\r\nconnected_slaves:1\r\nslave0:ip=10.192.16.123,port=6380,state=online,offset=3265663434,lag=1\r\nmaster_repl_offset:3265691776\r\nrepl_backlog_active:1\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:3264643201\r\nrepl_backlog_histlen:1048576\r\n\r\n# Keyspace\r\ndb0:keys=9128163,expires=4423109,avg_ttl=0\r\n```\r\n\r\nSince we can't easily replicate these settings elsewhere we have not had the opportunity to test a new Redis version and observe the differences. I checked the changelog for 2.8 to 3.0 and I can see tons of changes to the Replication logic, but I didn't find anything related to this particular case so I am wondering if you could point me to the right direction to figure out the origin of this inconsistency.\r\n\r\nThanks in advance!\r\n\r\nLuca\r\n\r\n\r\n[1]: https://github.com/wikimedia/mediawiki/blob/master/includes/jobqueue/JobQueueRedis.php (scripts marked by \"<<<LUA\")\r\n[2]: https://github.com/wikimedia/mediawiki-services-jobrunner/blob/master/redisJobChronService#L354","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/4103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/4103/timeline","performed_via_github_app":null,"state_reason":"completed"}},"event":"cross-referenced"},{"url":"https://api.github.com/repos/redis/redis/issues/comments/315532730","html_url":"https://github.com/redis/redis/issues/1525#issuecomment-315532730","issue_url":"https://api.github.com/repos/redis/redis/issues/1525","id":315532730,"node_id":"MDEyOklzc3VlQ29tbWVudDMxNTUzMjczMA==","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-15T13:04:10Z","updated_at":"2017-07-15T13:04:10Z","body":"This should be fixed now (for a long time) but the issue remained open. Actually there is even explicit mention of the issue in the source code, but nobody closed this:\r\n\r\n```\r\n   /* If we are in the context of a Lua script, we claim that time is\r\n     * blocked to when the Lua script started. This way a key can expire\r\n     * only the first time it is accessed and not in the middle of the\r\n     * script execution, making propagation to slaves / AOF consistent.\r\n     * See issue #1525 on Github for more information. */\r\n    now = server.lua_caller ? server.lua_time_start : mstime();\r\n```","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/315532730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":1165282861,"node_id":"MDExOkNsb3NlZEV2ZW50MTE2NTI4Mjg2MQ==","url":"https://api.github.com/repos/redis/redis/issues/events/1165282861","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2017-07-15T13:04:10Z","state_reason":null,"performed_via_github_app":null},{"actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T11:22:00Z","updated_at":"2022-01-10T11:22:00Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/10080","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/10080/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/10080/comments","events_url":"https://api.github.com/repos/redis/redis/issues/10080/events","html_url":"https://github.com/redis/redis/pull/10080","id":1097123686,"node_id":"PR_kwDOAAJhcs4wsips","number":10080,"title":"fix redis crached by using eval with access to volatile keys","user":{"login":"zeekling","id":17929800,"node_id":"MDQ6VXNlcjE3OTI5ODAw","avatar_url":"https://avatars.githubusercontent.com/u/17929800?v=4","gravatar_id":"","url":"https://api.github.com/users/zeekling","html_url":"https://github.com/zeekling","followers_url":"https://api.github.com/users/zeekling/followers","following_url":"https://api.github.com/users/zeekling/following{/other_user}","gists_url":"https://api.github.com/users/zeekling/gists{/gist_id}","starred_url":"https://api.github.com/users/zeekling/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zeekling/subscriptions","organizations_url":"https://api.github.com/users/zeekling/orgs","repos_url":"https://api.github.com/users/zeekling/repos","events_url":"https://api.github.com/users/zeekling/events{/privacy}","received_events_url":"https://api.github.com/users/zeekling/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":9,"created_at":"2022-01-09T07:08:59Z","updated_at":"2022-01-11T05:56:31Z","closed_at":"2022-01-11T05:56:31Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-12-13T04:51:44Z","pushed_at":"2025-12-11T09:07:47Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":205841,"stargazers_count":72116,"watchers_count":72116,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24380,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24380,"open_issues":2735,"watchers":72116,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/redis/redis/pulls/10080","html_url":"https://github.com/redis/redis/pull/10080","diff_url":"https://github.com/redis/redis/pull/10080.diff","patch_url":"https://github.com/redis/redis/pull/10080.patch","merged_at":"2022-01-11T05:56:31Z"},"body":"fix :https://github.com/redis/redis/issues/10079 \r\n\r\nAnd I passed my test in https://github.com/redis/redis/issues/10079 \r\n\r\nThis is a recent regression from the Redis Functions commits","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/10080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/10080/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5867635944,"node_id":"REFE_lADOAAJhcs4BkTfizwAAAAFdvQTo","url":"https://api.github.com/repos/redis/redis/issues/events/5867635944","actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0ac303acd6882ba8fb32d3ca65d473ee6e561332","commit_url":"https://api.github.com/repos/enjoy-binbin/redis/commits/0ac303acd6882ba8fb32d3ca65d473ee6e561332","created_at":"2022-01-10T17:27:25Z","performed_via_github_app":null},{"actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T17:27:59Z","updated_at":"2022-01-10T17:27:59Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/10096","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/10096/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/10096/comments","events_url":"https://api.github.com/repos/redis/redis/issues/10096/events","html_url":"https://github.com/redis/redis/pull/10096","id":1098178527,"node_id":"PR_kwDOAAJhcs4wv47B","number":10096,"title":"Add script tests to cover keys with expiration time set","user":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":2215208094,"node_id":"MDU6TGFiZWwyMjE1MjA4MDk0","url":"https://api.github.com/repos/redis/redis/labels/state:to-be-merged","name":"state:to-be-merged","color":"5585f4","default":false,"description":"The PR should be merged soon, even if not yet ready, this is used so that it won't be forgotten"}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":1,"created_at":"2022-01-10T17:27:59Z","updated_at":"2022-01-12T00:04:21Z","closed_at":"2022-01-11T20:43:18Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-12-13T04:51:44Z","pushed_at":"2025-12-11T09:07:47Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":205841,"stargazers_count":72116,"watchers_count":72116,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24380,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24380,"open_issues":2735,"watchers":72116,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/redis/redis/pulls/10096","html_url":"https://github.com/redis/redis/pull/10096","diff_url":"https://github.com/redis/redis/pull/10096.diff","patch_url":"https://github.com/redis/redis/pull/10096.patch","merged_at":"2022-01-11T20:43:18Z"},"body":"This commit adds some tests that the test cases will\r\naccess the keys with expiration time set in the script call.\r\nThere was no test case for this part before. See #10080\r\n\r\nAlso there is a test will cover #1525. we block the time so\r\nthat the key can not expire in the middle of the script execution.\r\n\r\nOther changes:\r\n1. Delete `evalTimeSnapshot` and just use `scriptTimeSnapshot` in it's place.\r\n2. Some cleanups to scripting.tcl.\r\n3. better names for tests that run in a loop to make them distinctable ","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/10096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/10096/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5876148295,"node_id":"REFE_lADOAAJhcs4BkTfizwAAAAFePuhH","url":"https://api.github.com/repos/redis/redis/issues/events/5876148295","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"e22146b07a8b5adc37e0153def1783406eb6d27c","commit_url":"https://api.github.com/repos/redis/redis/commits/e22146b07a8b5adc37e0153def1783406eb6d27c","created_at":"2022-01-11T20:43:32Z","performed_via_github_app":null},{"id":6000322819,"node_id":"REFE_lADOAAJhcs4BkTfizwAAAAFlpakD","url":"https://api.github.com/repos/redis/redis/issues/events/6000322819","actor":{"login":"panjf2000","id":7496278,"node_id":"MDQ6VXNlcjc0OTYyNzg=","avatar_url":"https://avatars.githubusercontent.com/u/7496278?v=4","gravatar_id":"","url":"https://api.github.com/users/panjf2000","html_url":"https://github.com/panjf2000","followers_url":"https://api.github.com/users/panjf2000/followers","following_url":"https://api.github.com/users/panjf2000/following{/other_user}","gists_url":"https://api.github.com/users/panjf2000/gists{/gist_id}","starred_url":"https://api.github.com/users/panjf2000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/panjf2000/subscriptions","organizations_url":"https://api.github.com/users/panjf2000/orgs","repos_url":"https://api.github.com/users/panjf2000/repos","events_url":"https://api.github.com/users/panjf2000/events{/privacy}","received_events_url":"https://api.github.com/users/panjf2000/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"ba4f5b6972eac187138ed0cf49dc6f3710b453a9","commit_url":"https://api.github.com/repos/panjf2000/redis/commits/ba4f5b6972eac187138ed0cf49dc6f3710b453a9","created_at":"2022-02-03T05:36:22Z","performed_via_github_app":null},{"actor":{"login":"soloestoy","id":24804835,"node_id":"MDQ6VXNlcjI0ODA0ODM1","avatar_url":"https://avatars.githubusercontent.com/u/24804835?v=4","gravatar_id":"","url":"https://api.github.com/users/soloestoy","html_url":"https://github.com/soloestoy","followers_url":"https://api.github.com/users/soloestoy/followers","following_url":"https://api.github.com/users/soloestoy/following{/other_user}","gists_url":"https://api.github.com/users/soloestoy/gists{/gist_id}","starred_url":"https://api.github.com/users/soloestoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soloestoy/subscriptions","organizations_url":"https://api.github.com/users/soloestoy/orgs","repos_url":"https://api.github.com/users/soloestoy/repos","events_url":"https://api.github.com/users/soloestoy/events{/privacy}","received_events_url":"https://api.github.com/users/soloestoy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-09T12:24:26Z","updated_at":"2023-02-09T12:24:26Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/11792","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/11792/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/11792/comments","events_url":"https://api.github.com/repos/redis/redis/issues/11792/events","html_url":"https://github.com/redis/redis/issues/11792","id":1577803234,"node_id":"I_kwDOAAJhcs5eC13i","number":11792,"title":"Sort out mess around propagation and lazy-expiration","user":{"login":"soloestoy","id":24804835,"node_id":"MDQ6VXNlcjI0ODA0ODM1","avatar_url":"https://avatars.githubusercontent.com/u/24804835?v=4","gravatar_id":"","url":"https://api.github.com/users/soloestoy","html_url":"https://github.com/soloestoy","followers_url":"https://api.github.com/users/soloestoy/followers","following_url":"https://api.github.com/users/soloestoy/following{/other_user}","gists_url":"https://api.github.com/users/soloestoy/gists{/gist_id}","starred_url":"https://api.github.com/users/soloestoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/soloestoy/subscriptions","organizations_url":"https://api.github.com/users/soloestoy/orgs","repos_url":"https://api.github.com/users/soloestoy/repos","events_url":"https://api.github.com/users/soloestoy/events{/privacy}","received_events_url":"https://api.github.com/users/soloestoy/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"open","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2023-02-09T12:24:26Z","updated_at":"2023-03-06T03:07:55Z","closed_at":null,"author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-12-13T04:51:44Z","pushed_at":"2025-12-11T09:07:47Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":205841,"stargazers_count":72116,"watchers_count":72116,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24380,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24380,"open_issues":2735,"watchers":72116,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"body":"Redis uses lazy-expiration to delete stale keys, that is when a command touches a expired key, it should delete the key and propagate the deletion at first.\r\n\r\nBut there are many bugs in past, present and maybe future... time is a too flexible variable.\r\n\r\n1. delete expired keys in EVAL may cause data inconsistency after replication, discussed in #1525, fixed\r\n2. time's change breaks command's atomicity and cause server crash in some commands like `SPOP` and `BRPOPLPUSH`, discussed in #6152, fixed in #6615 by introduce time snapshot\r\n3. wrapping expire-dels in a transaction to propagate but leads to CROSSSLOT replication in `SCAN` and `RANDOMKEY`, introduced in #9890 and fixed in #11788\r\n4. wrapping write command and expire-dels in a transaction to propagate, introduced in #9890, not fixed\r\n5. `SCAN` in `MULTI/EXEC` triggers expire-dels and expire-dels wrapped in a transaction to propagate, leads to CROSSSLOT replication, not fixed\r\n6. Modules + notifications may cause unwanted propagation #10014 not fixed\r\n7. maybe some other cases around scripts and module","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/11792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/11792/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"}]