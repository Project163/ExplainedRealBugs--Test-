[{"url":"https://api.github.com/repos/redis/redis/issues/comments/124459940","html_url":"https://github.com/redis/redis/issues/2694#issuecomment-124459940","issue_url":"https://api.github.com/repos/redis/redis/issues/2694","id":124459940,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNDQ1OTk0MA==","user":{"login":"GeorgeBJ","id":3961912,"node_id":"MDQ6VXNlcjM5NjE5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/3961912?v=4","gravatar_id":"","url":"https://api.github.com/users/GeorgeBJ","html_url":"https://github.com/GeorgeBJ","followers_url":"https://api.github.com/users/GeorgeBJ/followers","following_url":"https://api.github.com/users/GeorgeBJ/following{/other_user}","gists_url":"https://api.github.com/users/GeorgeBJ/gists{/gist_id}","starred_url":"https://api.github.com/users/GeorgeBJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GeorgeBJ/subscriptions","organizations_url":"https://api.github.com/users/GeorgeBJ/orgs","repos_url":"https://api.github.com/users/GeorgeBJ/repos","events_url":"https://api.github.com/users/GeorgeBJ/events{/privacy}","received_events_url":"https://api.github.com/users/GeorgeBJ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-24T09:57:00Z","updated_at":"2015-07-24T09:57:00Z","body":"I think in step 2 C should reset backlog, then D can only full sync with C.\n","author_association":"NONE","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/124459940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"GeorgeBJ","id":3961912,"node_id":"MDQ6VXNlcjM5NjE5MTI=","avatar_url":"https://avatars.githubusercontent.com/u/3961912?v=4","gravatar_id":"","url":"https://api.github.com/users/GeorgeBJ","html_url":"https://github.com/GeorgeBJ","followers_url":"https://api.github.com/users/GeorgeBJ/followers","following_url":"https://api.github.com/users/GeorgeBJ/following{/other_user}","gists_url":"https://api.github.com/users/GeorgeBJ/gists{/gist_id}","starred_url":"https://api.github.com/users/GeorgeBJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GeorgeBJ/subscriptions","organizations_url":"https://api.github.com/users/GeorgeBJ/orgs","repos_url":"https://api.github.com/users/GeorgeBJ/repos","events_url":"https://api.github.com/users/GeorgeBJ/events{/privacy}","received_events_url":"https://api.github.com/users/GeorgeBJ/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":367074652,"node_id":"MDEyOkxhYmVsZWRFdmVudDM2NzA3NDY1Mg==","url":"https://api.github.com/repos/redis/redis/issues/events/367074652","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-07-28T10:41:34Z","label":{"name":"critical bug","color":"e10c02"},"performed_via_github_app":null},{"id":367074653,"node_id":"MDEyOkxhYmVsZWRFdmVudDM2NzA3NDY1Mw==","url":"https://api.github.com/repos/redis/redis/issues/events/367074653","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2015-07-28T10:41:34Z","label":{"name":"replication","color":"d4c5f9"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/125587608","html_url":"https://github.com/redis/redis/issues/2694#issuecomment-125587608","issue_url":"https://api.github.com/repos/redis/redis/issues/2694","id":125587608,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNTU4NzYwOA==","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-28T12:43:03Z","updated_at":"2015-07-28T12:43:03Z","body":"Thanks for submitting, I think I found the cause for this issue. Working on a fix right now.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/125587608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/125605716","html_url":"https://github.com/redis/redis/issues/2694#issuecomment-125605716","issue_url":"https://api.github.com/repos/redis/redis/issues/2694","id":125605716,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNTYwNTcxNg==","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-28T13:28:10Z","updated_at":"2015-07-28T13:28:10Z","body":"Probably it will never be useful again, but given that I wrote it, we can use it to better document the bug for the future: here is the script to reproduce it easily:\n\n``` sh\n#!/bin/bash\nmkdir -p /tmp/a; rm -rf /tmp/a/*\nmkdir -p /tmp/b; rm -rf /tmp/b/*\nmkdir -p /tmp/c; rm -rf /tmp/c/*\nmkdir -p /tmp/d; rm -rf /tmp/d/*\nA=8888\nB=8889\nC=8810\nD=8811\nBIN=~/hack/redis/src/redis-server\n$BIN --logfile /tmp/a/redis.log --port $A &\n$BIN --logfile /tmp/b/redis.log --port $B &\n$BIN --logfile /tmp/c/redis.log --port $C &\n$BIN --logfile /tmp/d/redis.log --port $D &\n\nsleep 2\nredis-cli -p $A SLAVEOF NO ONE\nredis-cli -p $B SLAVEOF NO ONE\nredis-cli -p $C SLAVEOF NO ONE\nredis-cli -p $D SLAVEOF NO ONE\n\nredis-cli -p $A FLUSHALL\nredis-cli -p $B FLUSHALL\nredis-cli -p $C FLUSHALL\nredis-cli -p $D FLUSHALL\n\n# Setup A, B <- C <- D\nredis-cli -p $C SLAVEOF 127.0.0.1 $B\nredis-cli -p $D SLAVEOF 127.0.0.1 $C\n\n# Write the two keys\nredis-cli -p $A set a 1\nredis-cli -p $B set a 2\nsleep 2\n\n# Setup the SLEEP & RECONNECT condition for D\nredis-cli -p $D client list\n(echo -e \"multi\\nclient kill id 5\\ndebug sleep 5\\nexec\\n\" | redis-cli -p $D) &\n\n# Make B slave of A\nsleep 1\nredis-cli -p $B SLAVEOF 127.0.0.1 $A\n\nredis-cli -p $A ping\nredis-cli -p $B ping\nredis-cli -p $C ping\nredis-cli -p $D ping\n\n# Fetch the value\nsleep 6\necho \"The following value should be 1 but is 2 because of the bug:\"\nredis-cli -p $D get a\n\n# Kill servers\nredis-cli -p $A SHUTDOWN NOSAVE\nredis-cli -p $B SHUTDOWN NOSAVE\nredis-cli -p $C SHUTDOWN NOSAVE\nredis-cli -p $D SHUTDOWN NOSAVE\n```\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/125605716/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"url":"https://api.github.com/repos/redis/redis/issues/comments/125627997","html_url":"https://github.com/redis/redis/issues/2694#issuecomment-125627997","issue_url":"https://api.github.com/repos/redis/redis/issues/2694","id":125627997,"node_id":"MDEyOklzc3VlQ29tbWVudDEyNTYyNzk5Nw==","user":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2015-07-28T14:31:25Z","updated_at":"2015-07-28T14:31:25Z","body":"I wrote a first patch, than realized that this bug is just a manifestation of a deeper problem. Redis replication code used to do two things:\n1. When a slave lost connection with its master, disconnected the chained slaves ASAP. Which is not needed since after a successful PSYNC with the master, the slaves can continue and don't need to resync in turn.\n2. However after a failed PSYNC the replication backlog was not reset, so a slave was able to PSYNC successfully even if the instance did a full sync with its master, containing now an entirely different data set.\n\nSo I'm writing a different fix that only forces a full SYNC of the connected slaves once the slave has to full SYNC with its master.\n","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/125627997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":367297635,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM2NzI5NzYzNQ==","url":"https://api.github.com/repos/redis/redis/issues/events/367297635","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c1e94b6b9c6432ade2ec427dc8602189c19758e7","commit_url":"https://api.github.com/repos/redis/redis/commits/c1e94b6b9c6432ade2ec427dc8602189c19758e7","created_at":"2015-07-28T14:36:59Z","performed_via_github_app":null},{"id":387433890,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM4NzQzMzg5MA==","url":"https://api.github.com/repos/redis/redis/issues/events/387433890","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"912caa1c4244ea5740ddd50623f3092c997973bc","commit_url":"https://api.github.com/repos/redis/redis/commits/912caa1c4244ea5740ddd50623f3092c997973bc","created_at":"2015-08-20T08:23:47Z","performed_via_github_app":null},{"id":387433925,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM4NzQzMzkyNQ==","url":"https://api.github.com/repos/redis/redis/issues/events/387433925","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"4363fa1d76d8e41abfabd19f588141ec4b1ffeb0","commit_url":"https://api.github.com/repos/redis/redis/commits/4363fa1d76d8e41abfabd19f588141ec4b1ffeb0","created_at":"2015-08-20T08:23:49Z","performed_via_github_app":null},{"id":388795716,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDM4ODc5NTcxNg==","url":"https://api.github.com/repos/redis/redis/issues/events/388795716","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"194b7e218638c24850ee1d6c478e8528cf7599d7","commit_url":"https://api.github.com/repos/redis/redis/commits/194b7e218638c24850ee1d6c478e8528cf7599d7","created_at":"2015-08-21T13:32:40Z","performed_via_github_app":null},{"id":770173163,"node_id":"MDE1OlJlZmVyZW5jZWRFdmVudDc3MDE3MzE2Mw==","url":"https://api.github.com/repos/redis/redis/issues/events/770173163","actor":{"login":"JackieXie168","id":8347113,"node_id":"MDQ6VXNlcjgzNDcxMTM=","avatar_url":"https://avatars.githubusercontent.com/u/8347113?v=4","gravatar_id":"","url":"https://api.github.com/users/JackieXie168","html_url":"https://github.com/JackieXie168","followers_url":"https://api.github.com/users/JackieXie168/followers","following_url":"https://api.github.com/users/JackieXie168/following{/other_user}","gists_url":"https://api.github.com/users/JackieXie168/gists{/gist_id}","starred_url":"https://api.github.com/users/JackieXie168/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JackieXie168/subscriptions","organizations_url":"https://api.github.com/users/JackieXie168/orgs","repos_url":"https://api.github.com/users/JackieXie168/repos","events_url":"https://api.github.com/users/JackieXie168/events{/privacy}","received_events_url":"https://api.github.com/users/JackieXie168/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"c93a9d3460ecbac16717e1a05eeca859387b3f81","commit_url":"https://api.github.com/repos/JackieXie168/redis/commits/c93a9d3460ecbac16717e1a05eeca859387b3f81","created_at":"2016-08-29T02:51:35Z","performed_via_github_app":null},{"id":1165270186,"node_id":"MDExOkNsb3NlZEV2ZW50MTE2NTI3MDE4Ng==","url":"https://api.github.com/repos/redis/redis/issues/events/1165270186","actor":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2017-07-15T12:01:21Z","state_reason":null,"performed_via_github_app":null}]