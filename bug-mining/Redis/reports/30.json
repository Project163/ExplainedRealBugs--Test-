{"url":"https://api.github.com/repos/redis/redis/issues/3796","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/3796/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/3796/comments","events_url":"https://api.github.com/repos/redis/redis/issues/3796/events","html_url":"https://github.com/redis/redis/issues/3796","id":206074026,"node_id":"MDU6SXNzdWUyMDYwNzQwMjY=","number":3796,"title":"Redis 3.2.3 crashed by signal: 11","user":{"login":"damaru00","id":14049512,"node_id":"MDQ6VXNlcjE0MDQ5NTEy","avatar_url":"https://avatars.githubusercontent.com/u/14049512?v=4","gravatar_id":"","url":"https://api.github.com/users/damaru00","html_url":"https://github.com/damaru00","followers_url":"https://api.github.com/users/damaru00/followers","following_url":"https://api.github.com/users/damaru00/following{/other_user}","gists_url":"https://api.github.com/users/damaru00/gists{/gist_id}","starred_url":"https://api.github.com/users/damaru00/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/damaru00/subscriptions","organizations_url":"https://api.github.com/users/damaru00/orgs","repos_url":"https://api.github.com/users/damaru00/repos","events_url":"https://api.github.com/users/damaru00/events{/privacy}","received_events_url":"https://api.github.com/users/damaru00/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1198954,"node_id":"MDU6TGFiZWwxMTk4OTU0","url":"https://api.github.com/repos/redis/redis/labels/crash%20report","name":"crash report","color":"e10c02","default":false,"description":null},{"id":158983717,"node_id":"MDU6TGFiZWwxNTg5ODM3MTc=","url":"https://api.github.com/repos/redis/redis/labels/cluster","name":"cluster","color":"fbca04","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/redis/redis/milestones/8","html_url":"https://github.com/redis/redis/milestone/8","labels_url":"https://api.github.com/repos/redis/redis/milestones/8/labels","id":2193461,"node_id":"MDk6TWlsZXN0b25lMjE5MzQ2MQ==","number":8,"title":"Urgent","description":"Things that should be addressed ASAP","creator":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":6,"closed_issues":21,"state":"open","created_at":"2016-12-13T08:23:12Z","updated_at":"2021-12-24T12:29:51Z","due_on":null,"closed_at":null},"comments":20,"created_at":"2017-02-08T02:01:07Z","updated_at":"2017-07-11T13:17:36Z","closed_at":"2017-07-11T13:17:36Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"We have a big redis node in a cluster, and we're resharding it to other nodes. While doing that, we encountered many times the error reported below, which forced us to manually kill the instance using kill -9 and reload it.\r\n\r\nIn normal operation the node has been working for months without any problems. The only special thing about it is that there are some very big keys to migrate; for those usually we expected a timeout in the migration, but previously we didn't have this error which forces us to restart the node.\r\n\r\nresharding log:\r\nMoving slot 7929 from <source-node>:<port> to <target-node>:<port>: .................$\r\nMoving slot 7930 from <source-node>:<port> to <target-node>:<port>: .................$\r\nMoving slot 7931 from <source-node>:<port> to <target-node>:<port>: .................$\r\nMoving slot 7932 from <source-node>:<port> to <target-node>:<port>: .................$\r\n[ERR] Calling MIGRATE: Connection timed out\r\n\r\nredis log:\r\n\r\n```\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n29395:M 31 Jan 22:16:03.248 # Redis 3.2.3 crashed by signal: 11\r\n29395:M 31 Jan 22:16:03.248 # Crashed running the instuction at: 0x468d4d\r\n29395:M 31 Jan 22:16:03.248 # Accessing address: (nil)\r\n29395:M 31 Jan 22:16:03.248 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](migrateCloseSocket+0x5d)[0x468d4d]\r\n\r\nBacktrace:\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](logStackTrace+0x29)[0x45e699]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](sigsegvHandler+0xaa)[0x45ebca]\r\n/lib/x86_64-linux-gnu/libpthread.so.0(+0x10340)[0x7ffec32ce340]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](migrateCloseSocket+0x5d)[0x468d4d]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](migrateCommand+0x6d6)[0x469526]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](call+0x85)[0x426fb5]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](processCommand+0x367)[0x42a0e7]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](processInputBuffer+0x105)[0x436d05]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](aeProcessEvents+0x218)[0x421428]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](aeMain+0x2b)[0x4216db]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster](main+0x410)[0x41e690]\r\n/lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7ffec2f19ec5]\r\n/home/cybranding/redis-3.2.3/redis-stable/src/redis-server *:7010 [cluster][0x41e902]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:3.2.3\r\nredis_git_sha1:00000000\r\nredis_git_dirty:0\r\nredis_build_id:4992f89db2d932d\r\nredis_mode:cluster\r\nos:Linux 3.13.0-37-generic x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\ngcc_version:4.8.2\r\nprocess_id:29395\r\nrun_id:ea2b51c12beba3394b49febc23e62ddda85ddf7d\r\ntcp_port:7010\r\nuptime_in_seconds:218901\r\nuptime_in_days:2\r\nhz:10\r\nlru_clock:9505952\r\nexecutable:/home/cybranding/redis-3.2.3/redis-stable/src/redis-server\r\nconfig_file:/etc/redis_cluster_client2/redis-3.2.3/7010/redis.conf\r\n\r\n# Clients\r\nconnected_clients:7\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:252229967880\r\nused_memory_human:234.91G\r\nused_memory_rss:226196897792\r\nused_memory_rss_human:210.66G\r\nused_memory_peak:261549868192\r\nused_memory_peak_human:243.59G\r\ntotal_system_memory:405738954752\r\ntotal_system_memory_human:377.87G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:0.90\r\nmem_allocator:jemalloc-4.0.3\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:2441620072\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1485682059\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\naof_enabled:1\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_current_size:78198652011\r\naof_base_size:71141120009\r\naof_pending_rewrite:0\r\naof_buffer_length:0\r\naof_rewrite_buffer_length:0\r\naof_pending_bio_fsync:0\r\naof_delayed_fsync:0\r\n\r\n# Stats\r\ntotal_connections_received:50546\r\ntotal_commands_processed:56092302\r\ninstantaneous_ops_per_sec:470\r\ntotal_net_input_bytes:8820578118\r\ntotal_net_output_bytes:15465464075\r\ninstantaneous_input_kbps:65.53\r\ninstantaneous_output_kbps:39.50\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:70160\r\nevicted_keys:0\r\nkeyspace_hits:25360054\r\nkeyspace_misses:16707970\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:1\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:17440.44\r\nused_cpu_user:20364.37\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\ncmdstat_get:calls=3013601,usec=69399477,usec_per_call=23.03\r\ncmdstat_setex:calls=93465,usec=29887340,usec_per_call=319.77\r\ncmdstat_incr:calls=6164797,usec=48002289,usec_per_call=7.79\r\ncmdstat_sadd:calls=6404,usec=171138,usec_per_call=26.72\r\ncmdstat_sismember:calls=1920066,usec=57777586,usec_per_call=30.09\r\ncmdstat_zincrby:calls=29150890,usec=1841876323,usec_per_call=63.18\r\ncmdstat_zrevrange:calls=298356,usec=100612284,usec_per_call=337.22\r\ncmdstat_zscore:calls=2641113,usec=185788620,usec_per_call=70.34\r\ncmdstat_expire:calls=10839539,usec=70516036,usec_per_call=6.51\r\ncmdstat_ping:calls=69,usec=114,usec_per_call=1.65\r\ncmdstat_info:calls=50357,usec=8779396,usec_per_call=174.34\r\ncmdstat_cluster:calls=1034173,usec=262678023,usec_per_call=254.00\r\ncmdstat_migrate:calls=879469,usec=6675930023,usec_per_call=7590.86\r\ncmdstat_command:calls=3,usec=10340,usec_per_call=3446.67\r\n\r\n# Cluster\r\ncluster_enabled:1\r\n\r\n# Keyspace\r\ndb0:keys=141374638,expires=30371,avg_ttl=45048480\r\nhash_init_value: 1485278005\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=50534 addr=127.0.0.1:43431 fd=10 name= age=828 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=zincrby\r\nid=50535 addr=127.0.0.1:43432 fd=11 name= age=828 idle=7 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=sismember\r\nid=50541 addr=127.0.0.1:58608 fd=16 name= age=346 idle=49 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=get\r\nid=50108 addr=127.0.0.1:55292 fd=18 name= age=39041 idle=6 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=zrevrange\r\nid=50546 addr=127.0.0.1:50654 fd=19 name= age=108 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=migrate\r\nid=50543 addr=127.0.0.1:60246 fd=13 name= age=264 idle=264 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=info\r\nid=50544 addr=127.0.0.1:54748 fd=17 name= age=165 idle=159 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=0 obl=0 oll=0 omem=0 events=r cmd=cluster\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=50546 addr=127.0.0.1:50654 fd=19 name= age=108 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=migrate\r\nargv[0]: 'DEL'\r\nargv[1]: 'nht.tw.urls.dec:쩐다'\r\n\r\n------ REGISTERS ------\r\n29395:M 31 Jan 22:16:03.283 # \r\nRAX:00007fcc4d3f30e3 RBX:b8e0a2b8e097b8e0\r\nRCX:0000000000000002 RDX:0000000000000001\r\nRDI:00007fcc4d3f30f9 RSI:00000000004e7857\r\nRBP:00007fdf418f6430 RSP:00007fff08e86490\r\nR8 :0000000000000005 R9 :00007ffec2a0d5a0\r\nR10:0000000000000002 R11:00007ffec2c00180\r\nR12:0000000000000001 R13:00007fc0e9df1d40\r\nR14:0000000000000002 R15:0000000000000000\r\nRIP:0000000000468d4d EFL:0000000000010202\r\nCSGSFS:0000000000000033\r\n29395:M 31 Jan 22:16:03.283 # (00007fff08e8649f) -> 0000000000000058\r\n29395:M 31 Jan 22:16:03.283 # (00007fff08e8649e) -> 0000000004af8cbe\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e8649d) -> 0000000000000000\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e8649c) -> 00007fc07adec0f0\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e8649b) -> 0000000000000000\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e8649a) -> 00007ffec39f5690\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86499) -> 0000000100000000\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86498) -> 00007fc000000002\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86497) -> 00007fc0ee22c610\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86496) -> 00007fec6ad43fa0\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86495) -> 00007fc00000000a\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86494) -> 00007fc000000000\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86493) -> 0000000000469526\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86492) -> 0000000000000001\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86491) -> 00007fc07adec0f0\r\n29395:M 31 Jan 22:16:03.284 # (00007fff08e86490) -> 00007fc0e9df1d40\r\n\r\n------ FAST MEMORY TEST ------\r\n29395:M 31 Jan 22:16:03.284 # Bio thread for job type #0 terminated\r\n29395:M 31 Jan 22:16:03.285 # Bio thread for job type #1 terminated\r\n*** Preparing to test memory region 724000 (94208 bytes)\r\n*** Preparing to test memory region 1907000 (135168 bytes)\r\n*** Preparing to test memory region 7fc053400000 (268131368960 bytes)\r\n*** Preparing to test memory region 7ffec13ff000 (8388608 bytes)\r\n*** Preparing to test memory region 7ffec1c00000 (14680064 bytes)\r\n*** Preparing to test memory region 7ffec2a00000 (4194304 bytes)\r\n*** Preparing to test memory region 7ffec32b9000 (20480 bytes)\r\n*** Preparing to test memory region 7ffec34d8000 (16384 bytes)\r\n*** Preparing to test memory region 7ffec39f5000 (16384 bytes)\r\n*** Preparing to test memory region 7ffec3a01000 (4096 bytes)\r\n*** Preparing to test memory region 7ffec3a02000 (8192 bytes)\r\n*** Preparing to test memory region 7ffec3a06000 (4096 bytes)\r\n```","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/3796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/3796/timeline","performed_via_github_app":null,"state_reason":"completed"}