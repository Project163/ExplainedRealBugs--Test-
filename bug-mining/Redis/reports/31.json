{"url":"https://api.github.com/repos/redis/redis/issues/3637","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/3637/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/3637/comments","events_url":"https://api.github.com/repos/redis/redis/issues/3637/events","html_url":"https://github.com/redis/redis/issues/3637","id":191705542,"node_id":"MDU6SXNzdWUxOTE3MDU1NDI=","number":3637,"title":"MEMORY USAGE <custom type key> crashes","user":{"login":"saginoam","id":5208841,"node_id":"MDQ6VXNlcjUyMDg4NDE=","avatar_url":"https://avatars.githubusercontent.com/u/5208841?v=4","gravatar_id":"","url":"https://api.github.com/users/saginoam","html_url":"https://github.com/saginoam","followers_url":"https://api.github.com/users/saginoam/followers","following_url":"https://api.github.com/users/saginoam/following{/other_user}","gists_url":"https://api.github.com/users/saginoam/gists{/gist_id}","starred_url":"https://api.github.com/users/saginoam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saginoam/subscriptions","organizations_url":"https://api.github.com/users/saginoam/orgs","repos_url":"https://api.github.com/users/saginoam/repos","events_url":"https://api.github.com/users/saginoam/events{/privacy}","received_events_url":"https://api.github.com/users/saginoam/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":1198954,"node_id":"MDU6TGFiZWwxMTk4OTU0","url":"https://api.github.com/repos/redis/redis/labels/crash%20report","name":"crash report","color":"e10c02","default":false,"description":null},{"id":388324057,"node_id":"MDU6TGFiZWwzODgzMjQwNTc=","url":"https://api.github.com/repos/redis/redis/labels/modules%20system","name":"modules system","color":"0052cc","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":{"url":"https://api.github.com/repos/redis/redis/milestones/7","html_url":"https://github.com/redis/redis/milestone/7","labels_url":"https://api.github.com/repos/redis/redis/milestones/7/labels","id":2155973,"node_id":"MDk6TWlsZXN0b25lMjE1NTk3Mw==","number":7,"title":"4.0 final","description":"","creator":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"open_issues":5,"closed_issues":10,"state":"open","created_at":"2016-11-24T13:05:00Z","updated_at":"2024-03-18T04:12:14Z","due_on":null,"closed_at":null},"comments":1,"created_at":"2016-11-25T13:46:16Z","updated_at":"2017-01-12T08:49:08Z","closed_at":"2017-01-12T08:49:08Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"memory usage on custom type crashes redis.\r\n\r\nredis crash output: \r\n\r\n=== REDIS BUG REPORT START: Cut & paste starting from here ===\r\n9197:M 25 Nov 15:44:22.529 # ------------------------------------------------\r\n9197:M 25 Nov 15:44:22.529 # !!! Software Failure. Press left mouse button to continue\r\n9197:M 25 Nov 15:44:22.529 # Guru Meditation: \"Unknown object type\" #object.c:790\r\n9197:M 25 Nov 15:44:22.529 # (forcing SIGSEGV in order to print the stack trace)\r\n9197:M 25 Nov 15:44:22.529 # ------------------------------------------------\r\n9197:M 25 Nov 15:44:22.529 # Redis 999.999.999 crashed by signal: 11\r\n9197:M 25 Nov 15:44:22.529 # Crashed running the instuction at: 0x46269a\r\n9197:M 25 Nov 15:44:22.529 # Accessing address: 0xffffffffffffffff\r\n9197:M 25 Nov 15:44:22.529 # Failed assertion: <no assertion failed> (<no file>:0)\r\n\r\n------ STACK TRACE ------\r\nEIP:\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(_serverPanic+0x7a)[0x46269a]\r\n\r\nBacktrace:\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(logStackTrace+0x29)[0x463e59]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(sigsegvHandler+0xac)[0x4644fc]\r\n/lib64/libpthread.so.0(+0xf100)[0x7f5289d5e100]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(_serverPanic+0x7a)[0x46269a]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(objectComputeSize+0x663)[0x43c683]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(memoryCommand+0x3f9)[0x43d2d9]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(call+0x9e)[0x42a27e]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(processCommand+0x367)[0x42a937]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(processInputBuffer+0x105)[0x439625]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(aeProcessEvents+0x218)[0x424c18]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(aeMain+0x2b)[0x424ecb]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379(main+0x41d)[0x421ead]\r\n/lib64/libc.so.6(__libc_start_main+0xf5)[0x7f52899afb15]\r\n/mnt/disk/training/redis/redis.my/src/redis-server *:6379[0x422125]\r\n\r\n------ INFO OUTPUT ------\r\n# Server\r\nredis_version:999.999.999\r\nredis_git_sha1:b399288f\r\nredis_git_dirty:0\r\nredis_build_id:49318827da5757af\r\nredis_mode:standalone\r\nos:Linux 3.10.0-123.el7.x86_64 x86_64\r\narch_bits:64\r\nmultiplexing_api:epoll\r\ngcc_version:4.8.5\r\nprocess_id:9197\r\nrun_id:ce94458747a2768b1c650d193b41f7e45a111529\r\ntcp_port:6379\r\nuptime_in_seconds:2998\r\nuptime_in_days:0\r\nhz:10\r\nlru_clock:3686454\r\nexecutable:/mnt/disk/training/redis/redis.my/src/redis-server\r\nconfig_file:\r\n\r\n# Clients\r\nconnected_clients:1\r\nclient_longest_output_list:0\r\nclient_biggest_input_buf:0\r\nblocked_clients:0\r\n\r\n# Memory\r\nused_memory:926336\r\nused_memory_human:904.62K\r\nused_memory_rss:3371008\r\nused_memory_rss_human:3.21M\r\nused_memory_peak:946096\r\nused_memory_peak_human:923.92K\r\nused_memory_peak_perc:97.91%\r\nused_memory_overhead:538806\r\nused_memory_startup:487080\r\nused_memory_dataset:387530\r\nused_memory_dataset_perc:88.22%\r\ntotal_system_memory:11672150016\r\ntotal_system_memory_human:10.87G\r\nused_memory_lua:37888\r\nused_memory_lua_human:37.00K\r\nmaxmemory:0\r\nmaxmemory_human:0B\r\nmaxmemory_policy:noeviction\r\nmem_fragmentation_ratio:3.64\r\nmem_allocator:jemalloc-4.0.3\r\nlazyfree_pending_objects:0\r\n\r\n# Persistence\r\nloading:0\r\nrdb_changes_since_last_save:325\r\nrdb_bgsave_in_progress:0\r\nrdb_last_save_time:1480078464\r\nrdb_last_bgsave_status:ok\r\nrdb_last_bgsave_time_sec:-1\r\nrdb_current_bgsave_time_sec:-1\r\nrdb_last_cow_size:0\r\naof_enabled:0\r\naof_rewrite_in_progress:0\r\naof_rewrite_scheduled:0\r\naof_last_rewrite_time_sec:-1\r\naof_current_rewrite_time_sec:-1\r\naof_last_bgrewrite_status:ok\r\naof_last_write_status:ok\r\naof_last_cow_size:0\r\n\r\n# Stats\r\ntotal_connections_received:19\r\ntotal_commands_processed:473664\r\ninstantaneous_ops_per_sec:0\r\ntotal_net_input_bytes:49451658\r\ntotal_net_output_bytes:2409677\r\ninstantaneous_input_kbps:0.00\r\ninstantaneous_output_kbps:0.00\r\nrejected_connections:0\r\nsync_full:0\r\nsync_partial_ok:0\r\nsync_partial_err:0\r\nexpired_keys:0\r\nevicted_keys:0\r\nkeyspace_hits:0\r\nkeyspace_misses:0\r\npubsub_channels:0\r\npubsub_patterns:0\r\nlatest_fork_usec:0\r\nmigrate_cached_sockets:0\r\n\r\n# Replication\r\nrole:master\r\nconnected_slaves:0\r\nmaster_repl_offset:0\r\nrepl_backlog_active:0\r\nrepl_backlog_size:1048576\r\nrepl_backlog_first_byte_offset:0\r\nrepl_backlog_histlen:0\r\n\r\n# CPU\r\nused_cpu_sys:8.61\r\nused_cpu_user:5.68\r\nused_cpu_sys_children:0.00\r\nused_cpu_user_children:0.00\r\n\r\n# Commandstats\r\ncmdstat_del:calls=252,usec=365,usec_per_call=1.45\r\ncmdstat_hmset:calls=73,usec=617,usec_per_call=8.45\r\ncmdstat_keys:calls=23,usec=446,usec_per_call=19.39\r\ncmdstat_info:calls=46,usec=1030,usec_per_call=22.39\r\ncmdstat_debug:calls=8,usec=245,usec_per_call=30.62\r\ncmdstat_memory:calls=3,usec=7,usec_per_call=2.33\r\n\r\n# Cluster\r\ncluster_enabled:0\r\n\r\n# Keyspace\r\ndb0:keys=40,expires=0,avg_ttl=0\r\nhash_init_value: 1480235497\r\n\r\n------ CLIENT LIST OUTPUT ------\r\nid=2 addr=127.0.0.1:49221 fd=6 name= age=2982 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=memory\r\n\r\n------ CURRENT CLIENT INFO ------\r\nid=2 addr=127.0.0.1:49221 fd=6 name= age=2982 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=0 oll=0 omem=0 events=r cmd=memory\r\nargv[0]: 'memory'\r\nargv[1]: 'usage'\r\nargv[2]: 'pytsbench_user_id_7_device_id_7_pages_visited'\r\n\r\n------ REGISTERS ------\r\n9197:M 25 Nov 15:44:22.529 # \r\nRAX:0000000000000000 RBX:00000000004ebca0\r\nRCX:000000007fffffb2 RDX:0000000000000000\r\nRDI:00007f5289d49400 RSI:00007f5289d4aa10\r\nRBP:00000000004ebc00 RSP:00007fff62268200\r\nR8 :00007f528a674780 R9 :000000000000004d\r\nR10:0000000000000030 R11:0000000000000000\r\nR12:0000000000000316 R13:00007f5282ece318\r\nR14:0000000000000003 R15:000000000000000f\r\nRIP:000000000046269a EFL:0000000000010206\r\nCSGSFS:0000000000000033\r\n9197:M 25 Nov 15:44:22.529 # (00007fff6226820f) -> 0000000382ece328\r\n9197:M 25 Nov 15:44:22.530 # (00007fff6226820e) -> 0000000000000000\r\n9197:M 25 Nov 15:44:22.530 # (00007fff6226820d) -> 000000000043d2d9\r\n9197:M 25 Nov 15:44:22.530 # (00007fff6226820c) -> 000000000000000f\r\n9197:M 25 Nov 15:44:22.530 # (00007fff6226820b) -> 0000000000000003\r\n9197:M 25 Nov 15:44:22.530 # (00007fff6226820a) -> 00007f5282ece318\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268209) -> 0000000000000000\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268208) -> 00007f5282e1b253\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268207) -> 00007f5282ed8f40\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268206) -> 00007f5282ece318\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268205) -> 0000000000000000\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268204) -> 00007f5282e17920\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268203) -> 000000000043c683\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268202) -> 0000000000000000\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268201) -> 0000000000000005\r\n9197:M 25 Nov 15:44:22.530 # (00007fff62268200) -> 00007f5282e6e890\r\n\r\n------ FAST MEMORY TEST ------\r\n9197:M 25 Nov 15:44:22.530 # Bio thread for job type #0 terminated\r\n9197:M 25 Nov 15:44:22.530 # Bio thread for job type #1 terminated\r\n9197:M 25 Nov 15:44:22.530 # Bio thread for job type #2 terminated\r\n*** Preparing to test memory region 735000 (98304 bytes)\r\n*** Preparing to test memory region 14a1000 (135168 bytes)\r\n*** Preparing to test memory region 7f52815e4000 (102400 bytes)\r\n*** Preparing to test memory region 7f52815fe000 (8388608 bytes)\r\n*** Preparing to test memory region 7f5281dff000 (8388608 bytes)\r\n*** Preparing to test memory region 7f5282600000 (10485760 bytes)\r\n*** Preparing to test memory region 7f5289600000 (2097152 bytes)\r\n*** Preparing to test memory region 7f5289d4a000 (20480 bytes)\r\n*** Preparing to test memory region 7f5289f67000 (16384 bytes)\r\n*** Preparing to test memory region 7f528a674000 (16384 bytes)\r\n*** Preparing to test memory region 7f528a68f000 (12288 bytes)\r\n*** Preparing to test memory region 7f528a694000 (4096 bytes)\r\n.O.O.O.O.O.O.O.O.O.O.O.O\r\nFast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\r\n\r\n------ DUMPING CODE AROUND EIP ------\r\nSymbol: _serverPanic (base: 0x462620)\r\nModule: /mnt/disk/training/redis/redis.my/src/redis-server *:6379 (base 0x400000)\r\n$ xxd -r -p /tmp/dump.hex /tmp/dump.bin\r\n$ objdump --adjust-vma=0x462620 -D -b binary -m i386:x86-64 /tmp/dump.bin\r\n------\r\n9197:M 25 Nov 15:44:22.635 # dump of function (hexdump of 250 bytes):\r\n41548b053c482d004189d4554889f585c0534889fb7505e894f9ffffbeb0334f00bf0300000031c0e8d35afcffbee8334f00bf0300000031c0e8c25afcff4589e04889e94889dabe28424f00bf0300000031c0e8a85afcffbe28344f00bf0300000031c0e8975afcffbeb0334f00bf0300000031c0e8865afcffc60425ffffffff785b5d415cc3660f1f840000000000415741564155415455534881ec4801000048c7070000000048c7470800000000c74710000000008b050b432d0048897c241085c00f8e3008000048c744242800000000c744242400000000488dac24c0000000eb1e0f1f0083442424014883442428388b4424243905cb\r\nFunction at 0x428120 is serverLog\r\n\r\n=== REDIS BUG REPORT END. Make sure to include from START to END. ===","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/3637/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/3637/timeline","performed_via_github_app":null,"state_reason":"completed"}