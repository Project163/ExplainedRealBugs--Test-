[{"url":"https://api.github.com/repos/redis/redis/issues/comments/1007746163","html_url":"https://github.com/redis/redis/issues/10070#issuecomment-1007746163","issue_url":"https://api.github.com/repos/redis/redis/issues/10070","id":1007746163,"node_id":"IC_kwDOAAJhcs48EPxz","user":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-07T21:15:33Z","updated_at":"2022-01-07T21:15:33Z","body":"Thanks @zyingp - verified.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/1007746163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5860014238,"node_id":"MEE_lADOAAJhcs5BWHhfzwAAAAFdSLie","url":"https://api.github.com/repos/redis/redis/issues/events/5860014238","actor":{"login":"zyingp","id":3783832,"node_id":"MDQ6VXNlcjM3ODM4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/3783832?v=4","gravatar_id":"","url":"https://api.github.com/users/zyingp","html_url":"https://github.com/zyingp","followers_url":"https://api.github.com/users/zyingp/followers","following_url":"https://api.github.com/users/zyingp/following{/other_user}","gists_url":"https://api.github.com/users/zyingp/gists{/gist_id}","starred_url":"https://api.github.com/users/zyingp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyingp/subscriptions","organizations_url":"https://api.github.com/users/zyingp/orgs","repos_url":"https://api.github.com/users/zyingp/repos","events_url":"https://api.github.com/users/zyingp/events{/privacy}","received_events_url":"https://api.github.com/users/zyingp/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-07T21:15:33Z","performed_via_github_app":null},{"id":5860014242,"node_id":"SE_lADOAAJhcs5BWHhfzwAAAAFdSLii","url":"https://api.github.com/repos/redis/redis/issues/events/5860014242","actor":{"login":"zyingp","id":3783832,"node_id":"MDQ6VXNlcjM3ODM4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/3783832?v=4","gravatar_id":"","url":"https://api.github.com/users/zyingp","html_url":"https://github.com/zyingp","followers_url":"https://api.github.com/users/zyingp/followers","following_url":"https://api.github.com/users/zyingp/following{/other_user}","gists_url":"https://api.github.com/users/zyingp/gists{/gist_id}","starred_url":"https://api.github.com/users/zyingp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyingp/subscriptions","organizations_url":"https://api.github.com/users/zyingp/orgs","repos_url":"https://api.github.com/users/zyingp/repos","events_url":"https://api.github.com/users/zyingp/events{/privacy}","received_events_url":"https://api.github.com/users/zyingp/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-07T21:15:33Z","performed_via_github_app":null},{"id":5860014883,"node_id":"LE_lADOAAJhcs5BWHhfzwAAAAFdSLsj","url":"https://api.github.com/repos/redis/redis/issues/events/5860014883","actor":{"login":"itamarhaber","id":6059516,"node_id":"MDQ6VXNlcjYwNTk1MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6059516?v=4","gravatar_id":"","url":"https://api.github.com/users/itamarhaber","html_url":"https://github.com/itamarhaber","followers_url":"https://api.github.com/users/itamarhaber/followers","following_url":"https://api.github.com/users/itamarhaber/following{/other_user}","gists_url":"https://api.github.com/users/itamarhaber/gists{/gist_id}","starred_url":"https://api.github.com/users/itamarhaber/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itamarhaber/subscriptions","organizations_url":"https://api.github.com/users/itamarhaber/orgs","repos_url":"https://api.github.com/users/itamarhaber/repos","events_url":"https://api.github.com/users/itamarhaber/events{/privacy}","received_events_url":"https://api.github.com/users/itamarhaber/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-07T21:15:44Z","label":{"name":"crash report","color":"e10c02"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/1007872266","html_url":"https://github.com/redis/redis/issues/10070#issuecomment-1007872266","issue_url":"https://api.github.com/repos/redis/redis/issues/10070","id":1007872266,"node_id":"IC_kwDOAAJhcs48EukK","user":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-08T02:48:16Z","updated_at":"2022-01-08T03:28:55Z","body":"It looks like every command ending with `|` (or contains it, split(\"|\"), then length == 2) will crash (unstable branch)\r\n```\r\n127.0.0.1:6379> scard|\r\nError: Server closed the connection\r\n127.0.0.1:6379> set|\r\nError: Server closed the connection\r\n127.0.0.1:6379> get|\r\nError: Server closed the connection\r\nnot connected> get|set\r\nError: Server closed the connection\r\n```\r\n\r\nin normal way, we need to return ASAP with `(error) ERR unknown command` error, like\r\n```\r\n127.0.0.1:6379> getaaa\r\n(error) ERR unknown command 'getaaa', with args beginning with:\r\n127.0.0.1:6379> get|anything|aaa\r\n(error) ERR unknown command 'get|anything|aaa', with args beginning with:\r\n```\r\n\r\nit pass `(error) ERR unknown command` check, and finally crash in here, `c->argv[1]` is NULL\r\n```\r\naddReplySubcommandSyntaxError\r\n    addReplyErrorFormat(c,\r\n        \"Unknown subcommand or wrong number of arguments for '%s'. Try %s HELP.\",\r\n        (char*)c->argv[1]->ptr,cmd);\r\n```\r\n\r\nintroduced in #9504 \r\n`get|` or `get|anythings` sdssplitlen make argv[0] became a valid command name, and then need to checks the subscommand\r\n```\r\nstruct redisCommand *lookupCommandBySdsLogic(dict *commands, sds s) {\r\n    int argc, j;\r\n    sds *strings = sdssplitlen(s,sdslen(s),\"|\",1,&argc);           ->>>>>>>>>>> here\r\n    if (strings == NULL)\r\n        return NULL;\r\n    if (argc > 2) {\r\n        /* Currently we support just one level of subcommands */\r\n        sdsfreesplitres(strings,argc);\r\n        return NULL;\r\n    }\r\n\r\n    robj objects[argc];\r\n    robj *argv[argc];\r\n    for (j = 0; j < argc; j++) {\r\n        initStaticStringObject(objects[j],strings[j]);\r\n        argv[j] = &objects[j];\r\n    }\r\n\r\n    struct redisCommand *cmd = lookupCommandLogic(commands,argv,argc);\r\n    sdsfreesplitres(strings,argc);\r\n    return cmd;\r\n}\r\n```\r\n\r\nSo i think a easy(quick) way to fix it is:\r\n```\r\n127.0.0.1:6379> get|set\r\n(error) ERR unknown command 'get|set'.\r\n\r\ndiff:\r\n void addReplySubcommandSyntaxError(client *c) {\r\n     sds cmd = sdsnew((char*) c->argv[0]->ptr);\r\n     sdstoupper(cmd);\r\n-    addReplyErrorFormat(c,\r\n-        \"Unknown subcommand or wrong number of arguments for '%s'. Try %s HELP.\",\r\n-        (char*)c->argv[1]->ptr,cmd);\r\n+    if (c->argc == 1) {\r\n+        addReplyErrorFormat(c, \"unknown command '%s'.\", (char*)c->argv[0]->ptr);\r\n+    } else {\r\n+        addReplyErrorFormat(c,\r\n+             \"Unknown subcommand or wrong number of arguments for '%s'. Try %s HELP.\",\r\n+             (char*)c->argv[1]->ptr,cmd);\r\n+    }\r\n     sdsfree(cmd);\r\n }\r\n```\r\n\r\nneeded @oranagra @guybe7 check it again.","author_association":"CONTRIBUTOR","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/1007872266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5860781211,"node_id":"MEE_lADOAAJhcs5BWHhfzwAAAAFdVGyb","url":"https://api.github.com/repos/redis/redis/issues/events/5860781211","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-08T03:19:50Z","performed_via_github_app":null},{"id":5860781212,"node_id":"SE_lADOAAJhcs5BWHhfzwAAAAFdVGyc","url":"https://api.github.com/repos/redis/redis/issues/events/5860781212","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-08T03:19:50Z","performed_via_github_app":null},{"id":5860781214,"node_id":"MEE_lADOAAJhcs5BWHhfzwAAAAFdVGye","url":"https://api.github.com/repos/redis/redis/issues/events/5860781214","actor":{"login":"guybe7","id":19590683,"node_id":"MDQ6VXNlcjE5NTkwNjgz","avatar_url":"https://avatars.githubusercontent.com/u/19590683?v=4","gravatar_id":"","url":"https://api.github.com/users/guybe7","html_url":"https://github.com/guybe7","followers_url":"https://api.github.com/users/guybe7/followers","following_url":"https://api.github.com/users/guybe7/following{/other_user}","gists_url":"https://api.github.com/users/guybe7/gists{/gist_id}","starred_url":"https://api.github.com/users/guybe7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guybe7/subscriptions","organizations_url":"https://api.github.com/users/guybe7/orgs","repos_url":"https://api.github.com/users/guybe7/repos","events_url":"https://api.github.com/users/guybe7/events{/privacy}","received_events_url":"https://api.github.com/users/guybe7/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-08T03:19:50Z","performed_via_github_app":null},{"id":5860781215,"node_id":"SE_lADOAAJhcs5BWHhfzwAAAAFdVGyf","url":"https://api.github.com/repos/redis/redis/issues/events/5860781215","actor":{"login":"guybe7","id":19590683,"node_id":"MDQ6VXNlcjE5NTkwNjgz","avatar_url":"https://avatars.githubusercontent.com/u/19590683?v=4","gravatar_id":"","url":"https://api.github.com/users/guybe7","html_url":"https://github.com/guybe7","followers_url":"https://api.github.com/users/guybe7/followers","following_url":"https://api.github.com/users/guybe7/following{/other_user}","gists_url":"https://api.github.com/users/guybe7/gists{/gist_id}","starred_url":"https://api.github.com/users/guybe7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guybe7/subscriptions","organizations_url":"https://api.github.com/users/guybe7/orgs","repos_url":"https://api.github.com/users/guybe7/repos","events_url":"https://api.github.com/users/guybe7/events{/privacy}","received_events_url":"https://api.github.com/users/guybe7/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-08T03:19:50Z","performed_via_github_app":null},{"id":5861979950,"node_id":"LE_lADOAAJhcs5BWHhfzwAAAAFdZrcu","url":"https://api.github.com/repos/redis/redis/issues/events/5861979950","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"labeled","commit_id":null,"commit_url":null,"created_at":"2022-01-09T06:40:26Z","label":{"name":"7.0-must-have","color":"528D20"},"performed_via_github_app":null},{"url":"https://api.github.com/repos/redis/redis/issues/comments/1008240855","html_url":"https://github.com/redis/redis/issues/10070#issuecomment-1008240855","issue_url":"https://api.github.com/repos/redis/redis/issues/10070","id":1008240855,"node_id":"IC_kwDOAAJhcs48GIjX","user":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-09T06:48:45Z","updated_at":"2022-01-09T06:48:45Z","body":"@zyingp for reporting.\r\n@enjoy-binbin your fix seems ok, maybe i would also limit the length of the reply, in case argv[1] is too long.\r\nhowever, i also wonder why at all we need to reach that function in this case.\r\n```c\r\n    c->cmd = c->lastcmd = lookupCommand(c->argv,c->argc);\r\n    if (!c->cmd) {\r\n        if (lookupCommandBySds(c->argv[0]->ptr)) {\r\n            /* If we can't find the command but argv[0] by itself is a command\r\n             * it means we're dealing with an invalid subcommand. Print Help. */\r\n            addReplySubcommandSyntaxError(c);\r\n            return C_OK;\r\n        }\r\n```\r\n1. i don't think in this case we need to split the string with `|`, but rather just look in the commands dict to find if `argv[0]` is a container command (not `lookupCommandBySds`).\r\n2. i think we may prefer to error using `rejectCommand` (important in case we're inside a transaction)\r\n\r\nplease make a PR.","author_association":"MEMBER","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/comments/1008240855/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null,"event":"commented","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false}},{"id":5861984220,"node_id":"MEE_lADOAAJhcs5BWHhfzwAAAAFdZsfc","url":"https://api.github.com/repos/redis/redis/issues/events/5861984220","actor":{"login":"zyingp","id":3783832,"node_id":"MDQ6VXNlcjM3ODM4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/3783832?v=4","gravatar_id":"","url":"https://api.github.com/users/zyingp","html_url":"https://github.com/zyingp","followers_url":"https://api.github.com/users/zyingp/followers","following_url":"https://api.github.com/users/zyingp/following{/other_user}","gists_url":"https://api.github.com/users/zyingp/gists{/gist_id}","starred_url":"https://api.github.com/users/zyingp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyingp/subscriptions","organizations_url":"https://api.github.com/users/zyingp/orgs","repos_url":"https://api.github.com/users/zyingp/repos","events_url":"https://api.github.com/users/zyingp/events{/privacy}","received_events_url":"https://api.github.com/users/zyingp/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-09T06:48:45Z","performed_via_github_app":null},{"id":5861984221,"node_id":"SE_lADOAAJhcs5BWHhfzwAAAAFdZsfd","url":"https://api.github.com/repos/redis/redis/issues/events/5861984221","actor":{"login":"zyingp","id":3783832,"node_id":"MDQ6VXNlcjM3ODM4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/3783832?v=4","gravatar_id":"","url":"https://api.github.com/users/zyingp","html_url":"https://github.com/zyingp","followers_url":"https://api.github.com/users/zyingp/followers","following_url":"https://api.github.com/users/zyingp/following{/other_user}","gists_url":"https://api.github.com/users/zyingp/gists{/gist_id}","starred_url":"https://api.github.com/users/zyingp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyingp/subscriptions","organizations_url":"https://api.github.com/users/zyingp/orgs","repos_url":"https://api.github.com/users/zyingp/repos","events_url":"https://api.github.com/users/zyingp/events{/privacy}","received_events_url":"https://api.github.com/users/zyingp/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-09T06:48:45Z","performed_via_github_app":null},{"id":5861984222,"node_id":"MEE_lADOAAJhcs5BWHhfzwAAAAFdZsfe","url":"https://api.github.com/repos/redis/redis/issues/events/5861984222","actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"mentioned","commit_id":null,"commit_url":null,"created_at":"2022-01-09T06:48:45Z","performed_via_github_app":null},{"id":5861984223,"node_id":"SE_lADOAAJhcs5BWHhfzwAAAAFdZsff","url":"https://api.github.com/repos/redis/redis/issues/events/5861984223","actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"subscribed","commit_id":null,"commit_url":null,"created_at":"2022-01-09T06:48:45Z","performed_via_github_app":null},{"id":5862108910,"node_id":"REFE_lADOAAJhcs5BWHhfzwAAAAFdaK7u","url":"https://api.github.com/repos/redis/redis/issues/events/5862108910","actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0d48ae459119ff31cedda35c3e60ee3229d3cc44","commit_url":"https://api.github.com/repos/enjoy-binbin/redis/commits/0d48ae459119ff31cedda35c3e60ee3229d3cc44","created_at":"2022-01-09T09:39:41Z","performed_via_github_app":null},{"actor":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-09T09:40:01Z","updated_at":"2022-01-09T09:40:01Z","source":{"type":"issue","issue":{"url":"https://api.github.com/repos/redis/redis/issues/10082","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/10082/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/10082/comments","events_url":"https://api.github.com/repos/redis/redis/issues/10082/events","html_url":"https://github.com/redis/redis/pull/10082","id":1097149879,"node_id":"PR_kwDOAAJhcs4wsnSD","number":10082,"title":"Fix crash when error [sub]command name contains |","user":{"login":"enjoy-binbin","id":22811481,"node_id":"MDQ6VXNlcjIyODExNDgx","avatar_url":"https://avatars.githubusercontent.com/u/22811481?v=4","gravatar_id":"","url":"https://api.github.com/users/enjoy-binbin","html_url":"https://github.com/enjoy-binbin","followers_url":"https://api.github.com/users/enjoy-binbin/followers","following_url":"https://api.github.com/users/enjoy-binbin/following{/other_user}","gists_url":"https://api.github.com/users/enjoy-binbin/gists{/gist_id}","starred_url":"https://api.github.com/users/enjoy-binbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/enjoy-binbin/subscriptions","organizations_url":"https://api.github.com/users/enjoy-binbin/orgs","repos_url":"https://api.github.com/users/enjoy-binbin/repos","events_url":"https://api.github.com/users/enjoy-binbin/events{/privacy}","received_events_url":"https://api.github.com/users/enjoy-binbin/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":0,"created_at":"2022-01-09T09:40:00Z","updated_at":"2022-01-13T02:44:41Z","closed_at":"2022-01-09T11:06:52Z","author_association":"CONTRIBUTOR","type":null,"active_lock_reason":null,"draft":false,"repository":{"id":156018,"node_id":"MDEwOlJlcG9zaXRvcnkxNTYwMTg=","name":"redis","full_name":"redis/redis","private":false,"owner":{"login":"redis","id":1529926,"node_id":"MDEyOk9yZ2FuaXphdGlvbjE1Mjk5MjY=","avatar_url":"https://avatars.githubusercontent.com/u/1529926?v=4","gravatar_id":"","url":"https://api.github.com/users/redis","html_url":"https://github.com/redis","followers_url":"https://api.github.com/users/redis/followers","following_url":"https://api.github.com/users/redis/following{/other_user}","gists_url":"https://api.github.com/users/redis/gists{/gist_id}","starred_url":"https://api.github.com/users/redis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redis/subscriptions","organizations_url":"https://api.github.com/users/redis/orgs","repos_url":"https://api.github.com/users/redis/repos","events_url":"https://api.github.com/users/redis/events{/privacy}","received_events_url":"https://api.github.com/users/redis/received_events","type":"Organization","user_view_type":"public","site_admin":false},"html_url":"https://github.com/redis/redis","description":"For developers, who are building real-time data-driven applications, Redis is the preferred, fastest, and most feature-rich cache, data structure server, and document and vector query engine.","fork":false,"url":"https://api.github.com/repos/redis/redis","forks_url":"https://api.github.com/repos/redis/redis/forks","keys_url":"https://api.github.com/repos/redis/redis/keys{/key_id}","collaborators_url":"https://api.github.com/repos/redis/redis/collaborators{/collaborator}","teams_url":"https://api.github.com/repos/redis/redis/teams","hooks_url":"https://api.github.com/repos/redis/redis/hooks","issue_events_url":"https://api.github.com/repos/redis/redis/issues/events{/number}","events_url":"https://api.github.com/repos/redis/redis/events","assignees_url":"https://api.github.com/repos/redis/redis/assignees{/user}","branches_url":"https://api.github.com/repos/redis/redis/branches{/branch}","tags_url":"https://api.github.com/repos/redis/redis/tags","blobs_url":"https://api.github.com/repos/redis/redis/git/blobs{/sha}","git_tags_url":"https://api.github.com/repos/redis/redis/git/tags{/sha}","git_refs_url":"https://api.github.com/repos/redis/redis/git/refs{/sha}","trees_url":"https://api.github.com/repos/redis/redis/git/trees{/sha}","statuses_url":"https://api.github.com/repos/redis/redis/statuses/{sha}","languages_url":"https://api.github.com/repos/redis/redis/languages","stargazers_url":"https://api.github.com/repos/redis/redis/stargazers","contributors_url":"https://api.github.com/repos/redis/redis/contributors","subscribers_url":"https://api.github.com/repos/redis/redis/subscribers","subscription_url":"https://api.github.com/repos/redis/redis/subscription","commits_url":"https://api.github.com/repos/redis/redis/commits{/sha}","git_commits_url":"https://api.github.com/repos/redis/redis/git/commits{/sha}","comments_url":"https://api.github.com/repos/redis/redis/comments{/number}","issue_comment_url":"https://api.github.com/repos/redis/redis/issues/comments{/number}","contents_url":"https://api.github.com/repos/redis/redis/contents/{+path}","compare_url":"https://api.github.com/repos/redis/redis/compare/{base}...{head}","merges_url":"https://api.github.com/repos/redis/redis/merges","archive_url":"https://api.github.com/repos/redis/redis/{archive_format}{/ref}","downloads_url":"https://api.github.com/repos/redis/redis/downloads","issues_url":"https://api.github.com/repos/redis/redis/issues{/number}","pulls_url":"https://api.github.com/repos/redis/redis/pulls{/number}","milestones_url":"https://api.github.com/repos/redis/redis/milestones{/number}","notifications_url":"https://api.github.com/repos/redis/redis/notifications{?since,all,participating}","labels_url":"https://api.github.com/repos/redis/redis/labels{/name}","releases_url":"https://api.github.com/repos/redis/redis/releases{/id}","deployments_url":"https://api.github.com/repos/redis/redis/deployments","created_at":"2009-03-21T22:32:25Z","updated_at":"2025-12-13T04:51:44Z","pushed_at":"2025-12-11T09:07:47Z","git_url":"git://github.com/redis/redis.git","ssh_url":"git@github.com:redis/redis.git","clone_url":"https://github.com/redis/redis.git","svn_url":"https://github.com/redis/redis","homepage":"http://redis.io","size":205841,"stargazers_count":72116,"watchers_count":72116,"language":"C","has_issues":true,"has_projects":true,"has_downloads":true,"has_wiki":false,"has_pages":false,"has_discussions":true,"forks_count":24380,"mirror_url":null,"archived":false,"disabled":false,"open_issues_count":2735,"license":{"key":"other","name":"Other","spdx_id":"NOASSERTION","url":null,"node_id":"MDc6TGljZW5zZTA="},"allow_forking":true,"is_template":false,"web_commit_signoff_required":false,"topics":["cache","caching","database","distributed-systems","in-memory","in-memory-database","json","key-value","key-value-store","message-broker","message-queue","no-sql","nosql","open-source","real-time","realtime","redis","time-series","vector-databases","vector-search"],"visibility":"public","forks":24380,"open_issues":2735,"watchers":72116,"default_branch":"unstable","permissions":{"admin":false,"maintain":false,"push":false,"triage":false,"pull":true}},"pull_request":{"url":"https://api.github.com/repos/redis/redis/pulls/10082","html_url":"https://github.com/redis/redis/pull/10082","diff_url":"https://github.com/redis/redis/pull/10082.diff","patch_url":"https://github.com/redis/redis/pull/10082.patch","merged_at":"2022-01-09T11:06:52Z"},"body":"The following error commands will crash redis-server:\r\n```\r\n> get|\r\nError: Server closed the connection\r\n> get|set\r\nError: Server closed the connection\r\n> get|other\r\n```\r\n\r\nThe reason is in #9504, we use `lookupCommandBySds` for find the\r\ncontainer command. And it split the command (argv[0]) with `|`.\r\nIf we input something like `get|other`, after the split, `get`\r\nwill become a valid command name, pass the `ERR unknown command`\r\ncheck, and finally crash in `addReplySubcommandSyntaxError`\r\n\r\nIn this case we do not need to split the command name with `|`\r\nand just look in the commands dict to find if `argv[0]` is a\r\ncontainer command.\r\n\r\nSo this commit introduce a new function call `isContainerCommandBySds`\r\nthat it will return true if a command name is a container command.\r\n\r\nAlso with the old code, there is a incorrect error message:\r\n```\r\n> config|get set\r\n(error) ERR Unknown subcommand or wrong number of arguments for 'set'. Try CONFIG|GET HELP.\r\n```\r\n\r\nThe crash was reported in #10070.","reactions":{"url":"https://api.github.com/repos/redis/redis/issues/10082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/10082/timeline","performed_via_github_app":null,"state_reason":null}},"event":"cross-referenced"},{"id":5862112660,"node_id":"COE_lADOAAJhcs5BWHhfzwAAAAFdaL2U","url":"https://api.github.com/repos/redis/redis/issues/events/5862112660","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"connected","commit_id":null,"commit_url":null,"created_at":"2022-01-09T09:44:21Z","performed_via_github_app":null},{"id":5862112941,"node_id":"UNLE_lADOAAJhcs5BWHhfzwAAAAFdaL6t","url":"https://api.github.com/repos/redis/redis/issues/events/5862112941","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"unlabeled","commit_id":null,"commit_url":null,"created_at":"2022-01-09T09:44:39Z","label":{"name":"7.0-must-have","color":"528D20"},"performed_via_github_app":null},{"id":5862184291,"node_id":"CE_lADOAAJhcs5BWHhfzwAAAAFdadVj","url":"https://api.github.com/repos/redis/redis/issues/events/5862184291","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"closed","commit_id":null,"commit_url":null,"created_at":"2022-01-09T11:06:52Z","state_reason":null,"performed_via_github_app":null},{"id":5862184364,"node_id":"REFE_lADOAAJhcs5BWHhfzwAAAAFdadWs","url":"https://api.github.com/repos/redis/redis/issues/events/5862184364","actor":{"login":"oranagra","id":7045099,"node_id":"MDQ6VXNlcjcwNDUwOTk=","avatar_url":"https://avatars.githubusercontent.com/u/7045099?v=4","gravatar_id":"","url":"https://api.github.com/users/oranagra","html_url":"https://github.com/oranagra","followers_url":"https://api.github.com/users/oranagra/followers","following_url":"https://api.github.com/users/oranagra/following{/other_user}","gists_url":"https://api.github.com/users/oranagra/gists{/gist_id}","starred_url":"https://api.github.com/users/oranagra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oranagra/subscriptions","organizations_url":"https://api.github.com/users/oranagra/orgs","repos_url":"https://api.github.com/users/oranagra/repos","events_url":"https://api.github.com/users/oranagra/events{/privacy}","received_events_url":"https://api.github.com/users/oranagra/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"a84c964d37a1899bf90c920efef85a1d7202d058","commit_url":"https://api.github.com/repos/redis/redis/commits/a84c964d37a1899bf90c920efef85a1d7202d058","created_at":"2022-01-09T11:06:55Z","performed_via_github_app":null},{"id":6000322772,"node_id":"REFE_lADOAAJhcs5BWHhfzwAAAAFlpajU","url":"https://api.github.com/repos/redis/redis/issues/events/6000322772","actor":{"login":"panjf2000","id":7496278,"node_id":"MDQ6VXNlcjc0OTYyNzg=","avatar_url":"https://avatars.githubusercontent.com/u/7496278?v=4","gravatar_id":"","url":"https://api.github.com/users/panjf2000","html_url":"https://github.com/panjf2000","followers_url":"https://api.github.com/users/panjf2000/followers","following_url":"https://api.github.com/users/panjf2000/following{/other_user}","gists_url":"https://api.github.com/users/panjf2000/gists{/gist_id}","starred_url":"https://api.github.com/users/panjf2000/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/panjf2000/subscriptions","organizations_url":"https://api.github.com/users/panjf2000/orgs","repos_url":"https://api.github.com/users/panjf2000/repos","events_url":"https://api.github.com/users/panjf2000/events{/privacy}","received_events_url":"https://api.github.com/users/panjf2000/received_events","type":"User","user_view_type":"public","site_admin":false},"event":"referenced","commit_id":"0a46a745bb060f2419e97ef55fe655959b51142b","commit_url":"https://api.github.com/repos/panjf2000/redis/commits/0a46a745bb060f2419e97ef55fe655959b51142b","created_at":"2022-02-03T05:36:21Z","performed_via_github_app":null}]