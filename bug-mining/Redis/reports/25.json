{"url":"https://api.github.com/repos/redis/redis/issues/3035","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/3035/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/3035/comments","events_url":"https://api.github.com/repos/redis/redis/issues/3035/events","html_url":"https://github.com/redis/redis/issues/3035","id":128856477,"node_id":"MDU6SXNzdWUxMjg4NTY0Nzc=","number":3035,"title":"Redis-sentinel 3.2rc1 crashed after master was shutdown using \"poweroff\"","user":{"login":"pako-pl","id":8288517,"node_id":"MDQ6VXNlcjgyODg1MTc=","avatar_url":"https://avatars.githubusercontent.com/u/8288517?v=4","gravatar_id":"","url":"https://api.github.com/users/pako-pl","html_url":"https://github.com/pako-pl","followers_url":"https://api.github.com/users/pako-pl/followers","following_url":"https://api.github.com/users/pako-pl/following{/other_user}","gists_url":"https://api.github.com/users/pako-pl/gists{/gist_id}","starred_url":"https://api.github.com/users/pako-pl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pako-pl/subscriptions","organizations_url":"https://api.github.com/users/pako-pl/orgs","repos_url":"https://api.github.com/users/pako-pl/repos","events_url":"https://api.github.com/users/pako-pl/events{/privacy}","received_events_url":"https://api.github.com/users/pako-pl/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155760,"node_id":"MDU6TGFiZWwxNTU3NjA=","url":"https://api.github.com/repos/redis/redis/labels/critical%20bug","name":"critical bug","color":"e10c02","default":false,"description":null},{"id":158983674,"node_id":"MDU6TGFiZWwxNTg5ODM2NzQ=","url":"https://api.github.com/repos/redis/redis/labels/sentinel","name":"sentinel","color":"207de5","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":13,"created_at":"2016-01-26T15:33:56Z","updated_at":"2016-01-27T15:39:54Z","closed_at":"2016-01-27T15:39:54Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"Redis-sentinel on one of the slaves crashed after master was shut down using the \"poweroff\" system command.\n\n```\nJan 26 15:52:06 redis-sentinel[652]: 652:X 26 Jan 15:52:06.315 # +sdown master redis-data-development 10.10.2.4 6379\nJan 26 15:52:06 redis-sentinel[652]: 652:X 26 Jan 15:52:06.315 # +sdown sentinel 10.10.2.4:26379 10.10.2.4 26379 @ redis-data-development 10.10.2.4 6379\nJan 26 15:52:07 redis-sentinel[652]: 652:X 26 Jan 15:52:07.180 # +new-epoch 22\nJan 26 15:52:07 redis-sentinel[652]: 652:X 26 Jan 15:52:07.188 # +vote-for-leader 6536d4c1dd3c9ad32fded751fe9a799947f88a85 22\nJan 26 15:52:07 redis-sentinel[652]: 652:X 26 Jan 15:52:07.440 # +odown master redis-data-development 10.10.2.4 6379 #quorum 2/2\nJan 26 15:52:07 redis-sentinel[652]: 652:X 26 Jan 15:52:07.440 # Next failover delay: I will not start a failover before Tue Jan 26 15:58:07 2016\nJan 26 15:52:08 redis-sentinel[652]: === REDIS BUG REPORT START: Cut & paste starting from here ===\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.233 # Redis 3.1.101 crashed by signal: 11\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.233 # Crashed running the instuction at: 0x470c4a\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.233 # Accessing address: (nil)\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.233 # Failed assertion: <no assertion failed> (<no file>:0)\nJan 26 15:52:08 redis-sentinel[652]: ------ STACK TRACE ------\nJan 26 15:52:08 redis-sentinel[652]: EIP:\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](sentinelEvent+0x24a)[0x470c4a]\nJan 26 15:52:08 redis-sentinel[652]: Backtrace:\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](logStackTrace+0x29)[0x45bf69]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](sigsegvHandler+0xa4)[0x45c454]\nJan 26 15:52:08 redis-sentinel[652]: /lib/x86_64-linux-gnu/libpthread.so.0(+0xf8d0)[0x7f76fe5ea8d0]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](sentinelEvent+0x24a)[0x470c4a]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](sentinelProcessHelloMessage+0x10d)[0x4731bd]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](sentinelPublishCommand+0x60)[0x4734d0]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](call+0x81)[0x4258c1]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](processCommand+0x44f)[0x4289af]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](processInputBuffer+0x97)[0x435087]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](aeProcessEvents+0x133)[0x41ff93]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](aeMain+0x2b)[0x4202ab]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel](main+0x40a)[0x41d24a]\nJan 26 15:52:08 redis-sentinel[652]: /lib/x86_64-linux-gnu/libc.so.6(__libc_start_main+0xf5)[0x7f76fe253b45]\nJan 26 15:52:08 redis-sentinel[652]: /opt/redis/bin/redis-sentinel *:26379 [sentinel][0x41d4af]\nJan 26 15:52:08 redis-sentinel[652]: ------ INFO OUTPUT ------\nJan 26 15:52:08 redis-sentinel[652]: # Server\nJan 26 15:52:08 redis-sentinel[652]: redis_version:3.1.101\nJan 26 15:52:08 redis-sentinel[652]: redis_git_sha1:00000000\nJan 26 15:52:08 redis-sentinel[652]: redis_git_dirty:0\nJan 26 15:52:08 redis-sentinel[652]: redis_build_id:a00651db5b4a8f93\nJan 26 15:52:08 redis-sentinel[652]: redis_mode:sentinel\nJan 26 15:52:08 redis-sentinel[652]: os:Linux 3.16.0-4-amd64 x86_64\nJan 26 15:52:08 redis-sentinel[652]: arch_bits:64\nJan 26 15:52:08 redis-sentinel[652]: multiplexing_api:epoll\nJan 26 15:52:08 redis-sentinel[652]: gcc_version:4.9.2\nJan 26 15:52:08 redis-sentinel[652]: process_id:652\nJan 26 15:52:08 redis-sentinel[652]: run_id:7084b1ec107b710eca77677f4210a1df2e36785b\nJan 26 15:52:08 redis-sentinel[652]: tcp_port:26379\nJan 26 15:52:08 redis-sentinel[652]: uptime_in_seconds:15534\nJan 26 15:52:08 redis-sentinel[652]: uptime_in_days:0\nJan 26 15:52:08 redis-sentinel[652]: hz:14\nJan 26 15:52:08 redis-sentinel[652]: lru_clock:10979352\nJan 26 15:52:08 redis-sentinel[652]: executable:/opt/redis/bin/redis-sentinel\nJan 26 15:52:08 redis-sentinel[652]: config_file:/etc/redis/sentinel.conf\nJan 26 15:52:08 redis-sentinel[652]: # Clients\nJan 26 15:52:08 redis-sentinel[652]: connected_clients:1\nJan 26 15:52:08 redis-sentinel[652]: client_longest_output_list:0\nJan 26 15:52:08 redis-sentinel[652]: client_biggest_input_buf:0\nJan 26 15:52:08 redis-sentinel[652]: blocked_clients:0\nJan 26 15:52:08 redis-sentinel[652]: # Memory\nJan 26 15:52:08 redis-sentinel[652]: used_memory:869152\nJan 26 15:52:08 redis-sentinel[652]: used_memory_human:848.78K\nJan 26 15:52:08 redis-sentinel[652]: used_memory_rss:4603904\nJan 26 15:52:08 redis-sentinel[652]: used_memory_rss_human:4.39M\nJan 26 15:52:08 redis-sentinel[652]: used_memory_peak:882272\nJan 26 15:52:08 redis-sentinel[652]: used_memory_peak_human:861.59K\nJan 26 15:52:08 redis-sentinel[652]: total_system_memory:67589103616\nJan 26 15:52:08 redis-sentinel[652]: total_system_memory_human:62.95G\nJan 26 15:52:08 redis-sentinel[652]: used_memory_lua:37888\nJan 26 15:52:08 redis-sentinel[652]: used_memory_lua_human:37.00K\nJan 26 15:52:08 redis-sentinel[652]: maxmemory:0\nJan 26 15:52:08 redis-sentinel[652]: maxmemory_human:0B\nJan 26 15:52:08 redis-sentinel[652]: maxmemory_policy:volatile-lru\nJan 26 15:52:08 redis-sentinel[652]: mem_fragmentation_ratio:5.30\nJan 26 15:52:08 redis-sentinel[652]: mem_allocator:jemalloc-4.0.3\nJan 26 15:52:08 redis-sentinel[652]: # Persistence\nJan 26 15:52:08 redis-sentinel[652]: loading:0\nJan 26 15:52:08 redis-sentinel[652]: rdb_changes_since_last_save:0\nJan 26 15:52:08 redis-sentinel[652]: rdb_bgsave_in_progress:0\nJan 26 15:52:08 redis-sentinel[652]: rdb_last_save_time:1453804394\nJan 26 15:52:08 redis-sentinel[652]: rdb_last_bgsave_status:ok\nJan 26 15:52:08 redis-sentinel[652]: rdb_last_bgsave_time_sec:-1\nJan 26 15:52:08 redis-sentinel[652]: rdb_current_bgsave_time_sec:-1\nJan 26 15:52:08 redis-sentinel[652]: aof_enabled:0\nJan 26 15:52:08 redis-sentinel[652]: aof_rewrite_in_progress:0\nJan 26 15:52:08 redis-sentinel[652]: aof_rewrite_scheduled:0\nJan 26 15:52:08 redis-sentinel[652]: aof_last_rewrite_time_sec:-1\nJan 26 15:52:08 redis-sentinel[652]: aof_current_rewrite_time_sec:-1\nJan 26 15:52:08 redis-sentinel[652]: aof_last_bgrewrite_status:ok\nJan 26 15:52:08 redis-sentinel[652]: aof_last_write_status:ok\nJan 26 15:52:08 redis-sentinel[652]: # Stats\nJan 26 15:52:08 redis-sentinel[652]: total_connections_received:2\nJan 26 15:52:08 redis-sentinel[652]: total_commands_processed:22563\nJan 26 15:52:08 redis-sentinel[652]: instantaneous_ops_per_sec:2\nJan 26 15:52:08 redis-sentinel[652]: total_net_input_bytes:1320536\nJan 26 15:52:08 redis-sentinel[652]: total_net_output_bytes:135174\nJan 26 15:52:08 redis-sentinel[652]: instantaneous_input_kbps:0.14\nJan 26 15:52:08 redis-sentinel[652]: instantaneous_output_kbps:0.05\nJan 26 15:52:08 redis-sentinel[652]: rejected_connections:0\nJan 26 15:52:08 redis-sentinel[652]: sync_full:0\nJan 26 15:52:08 redis-sentinel[652]: sync_partial_ok:0\nJan 26 15:52:08 redis-sentinel[652]: sync_partial_err:0\nJan 26 15:52:08 redis-sentinel[652]: expired_keys:0\nJan 26 15:52:08 redis-sentinel[652]: evicted_keys:0\nJan 26 15:52:08 redis-sentinel[652]: keyspace_hits:0\nJan 26 15:52:08 redis-sentinel[652]: keyspace_misses:0\nJan 26 15:52:08 redis-sentinel[652]: pubsub_channels:0\nJan 26 15:52:08 redis-sentinel[652]: pubsub_patterns:0\nJan 26 15:52:08 redis-sentinel[652]: latest_fork_usec:0\nJan 26 15:52:08 redis-sentinel[652]: migrate_cached_sockets:0\nJan 26 15:52:08 redis-sentinel[652]: # Replication\nJan 26 15:52:08 redis-sentinel[652]: role:master\nJan 26 15:52:08 redis-sentinel[652]: connected_slaves:0\nJan 26 15:52:08 redis-sentinel[652]: master_repl_offset:0\nJan 26 15:52:08 redis-sentinel[652]: repl_backlog_active:0\nJan 26 15:52:08 redis-sentinel[652]: repl_backlog_size:1048576\nJan 26 15:52:08 redis-sentinel[652]: repl_backlog_first_byte_offset:0\nJan 26 15:52:08 redis-sentinel[652]: repl_backlog_histlen:0\nJan 26 15:52:08 redis-sentinel[652]: # CPU\nJan 26 15:52:08 redis-sentinel[652]: used_cpu_sys:13.95\nJan 26 15:52:08 redis-sentinel[652]: used_cpu_user:11.71\nJan 26 15:52:08 redis-sentinel[652]: used_cpu_sys_children:0.00\nJan 26 15:52:08 redis-sentinel[652]: used_cpu_user_children:0.00\nJan 26 15:52:08 redis-sentinel[652]: # Commandstats\nJan 26 15:52:08 redis-sentinel[652]: # Cluster\nJan 26 15:52:08 redis-sentinel[652]: cluster_enabled:0\nJan 26 15:52:08 redis-sentinel[652]: # Keyspace\nJan 26 15:52:08 redis-sentinel[652]: hash_init_value: 1453940872\nJan 26 15:52:08 redis-sentinel[652]: ------ CLIENT LIST OUTPUT ------\nJan 26 15:52:08 redis-sentinel[652]: id=3 addr=10.100.10.100:47830 fd=15 name=sentinel-6536d4c1-cmd age=15519 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=60 oll=0 omem=0 events=r cmd=publish\nJan 26 15:52:08 redis-sentinel[652]: ------ CURRENT CLIENT INFO ------\nJan 26 15:52:08 redis-sentinel[652]: id=3 addr=10.100.10.100:47830 fd=15 name=sentinel-6536d4c1-cmd age=15519 idle=0 flags=N db=0 sub=0 psub=0 multi=-1 qbuf=0 qbuf-free=32768 obl=60 oll=0 omem=0 events=r cmd=publish\nJan 26 15:52:08 redis-sentinel[652]: argv[0]: 'PUBLISH'\nJan 26 15:52:08 redis-sentinel[652]: argv[1]: '__sentinel__:hello'\nJan 26 15:52:08 redis-sentinel[652]: argv[2]: '10.10.1.20,26379,6536d4c1dd3c9ad32fded751fe9a799947f88a85,22,redis-data-development,10.10.2.10,6379,22'\nJan 26 15:52:08 redis-sentinel[652]: ------ REGISTERS ------\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 #\nJan 26 15:52:08 redis-sentinel[652]: RAX:0000000000000025 RBX:0000000000000000\nJan 26 15:52:08 redis-sentinel[652]: RCX:00000000004f47e3 RDX:0000000000000000\nJan 26 15:52:08 redis-sentinel[652]: RDI:0000000000000003 RSI:00000000004f4a82\nJan 26 15:52:08 redis-sentinel[652]: RBP:0000000000000003 RSP:00007ffc31d17c30\nJan 26 15:52:08 redis-sentinel[652]: R8 :0000000000000088 R9 :00007f76fda0d070\nJan 26 15:52:08 redis-sentinel[652]: R10:0000000000000016 R11:00007f76fda0e1c0\nJan 26 15:52:08 redis-sentinel[652]: R12:00000000004f4a82 R13:00000000004f47e3\nJan 26 15:52:08 redis-sentinel[652]: R14:00000000000018eb R15:0000000000000000\nJan 26 15:52:08 redis-sentinel[652]: RIP:0000000000470c4a EFL:0000000000010246\nJan 26 15:52:08 redis-sentinel[652]: CSGSFS:0000000000000033\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3f) -> 617461642d736964\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3e) -> 0000000000000000\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3d) -> 00007ffc31d17d60\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3c) -> 00000000004f4ab4\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3b) -> 3a30312e322e302e\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c3a) -> 3031206576616c73\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c39) -> 00007f76fe302d62\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c38) -> 00007ffc31d17e30\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c37) -> 0000000000000000\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c36) -> 0000000000000040\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c35) -> 00007f76fe2ae070\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c34) -> 0000000000000002\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c33) -> 00007ffc31d17ca0\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c32) -> 00007ffc31d17ce0\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c31) -> 00007ffc31d18000\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # (00007ffc31d17c30) -> 0000000000000040\nJan 26 15:52:08 redis-sentinel[652]: ------ FAST MEMORY TEST ------\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # Bio thread for job type #0 terminated\nJan 26 15:52:08 redis-sentinel[652]: 652:X 26 Jan 15:52:08.236 # Bio thread for job type #1 terminated\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 72c000 (114688 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 78a000 (135168 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fc9ff000 (8388608 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fd200000 (10485760 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fe000000 (2097152 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fe5d7000 (16384 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fe7f4000 (16384 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fef13000 (16384 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fef19000 (16384 bytes)\nJan 26 15:52:08 redis-sentinel[652]: *** Preparing to test memory region 7f76fef1f000 (4096 bytes)\nJan 26 15:52:08 redis-sentinel[652]: .O.O.O.O.O.O.O.O.O.O\nJan 26 15:52:08 redis-sentinel[652]: Fast memory test PASSED, however your memory can still be broken. Please run a memory test for several hours if possible.\nJan 26 15:52:08 redis-sentinel[652]: === REDIS BUG REPORT END. Make sure to include from START to END. ===\nJan 26 15:52:08 redis-sentinel[652]: Please report the crash by opening an issue on github:\nJan 26 15:52:08 redis-sentinel[652]: http://github.com/antirez/redis/issues\nJan 26 15:52:08 redis-sentinel[652]: Suspect RAM error? Use redis-server --test-memory to verify it.\nJan 26 15:52:08 systemd[1]: redis-sentinel.service: main process exited, code=killed, status=11/SEGV\nJan 26 15:52:08 systemd[1]: Unit redis-sentinel.service entered failed state.\n```\n","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/3035/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/3035/timeline","performed_via_github_app":null,"state_reason":"completed"}