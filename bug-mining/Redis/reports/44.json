{"url":"https://api.github.com/repos/redis/redis/issues/868","repository_url":"https://api.github.com/repos/redis/redis","labels_url":"https://api.github.com/repos/redis/redis/issues/868/labels{/name}","comments_url":"https://api.github.com/repos/redis/redis/issues/868/comments","events_url":"https://api.github.com/repos/redis/redis/issues/868/events","html_url":"https://github.com/redis/redis/issues/868","id":9799238,"node_id":"MDU6SXNzdWU5Nzk5MjM4","number":868,"title":"redis rewriting AOF failed and crash","user":{"login":"ghost","id":10137,"node_id":"MDQ6VXNlcjEwMTM3","avatar_url":"https://avatars.githubusercontent.com/u/10137?v=4","gravatar_id":"","url":"https://api.github.com/users/ghost","html_url":"https://github.com/ghost","followers_url":"https://api.github.com/users/ghost/followers","following_url":"https://api.github.com/users/ghost/following{/other_user}","gists_url":"https://api.github.com/users/ghost/gists{/gist_id}","starred_url":"https://api.github.com/users/ghost/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ghost/subscriptions","organizations_url":"https://api.github.com/users/ghost/orgs","repos_url":"https://api.github.com/users/ghost/repos","events_url":"https://api.github.com/users/ghost/events{/privacy}","received_events_url":"https://api.github.com/users/ghost/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":155763,"node_id":"MDU6TGFiZWwxNTU3NjM=","url":"https://api.github.com/repos/redis/redis/labels/WAITING-OP-REPLY","name":"WAITING-OP-REPLY","color":"02d7e1","default":false,"description":""},{"id":1198954,"node_id":"MDU6TGFiZWwxMTk4OTU0","url":"https://api.github.com/repos/redis/redis/labels/crash%20report","name":"crash report","color":"e10c02","default":false,"description":null}],"state":"closed","locked":false,"assignee":null,"assignees":[],"milestone":null,"comments":5,"created_at":"2013-01-09T10:15:38Z","updated_at":"2013-07-17T13:10:32Z","closed_at":"2013-07-17T13:10:32Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"```\n...\n[9561] 09 Jan 17:10:08.374 * Starting automatic rewriting of AOF on 100% growth\n[9561] 09 Jan 17:10:08.552 * Background append only file rewriting started by pid 29812\n[9561] 09 Jan 17:10:31.007 * Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this ma\ny slow down Redis.\n[9561] 09 Jan 17:10:35.006 * Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this ma\ny slow down Redis.\n[9561] 09 Jan 17:10:39.006 * Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this ma\ny slow down Redis.\n[9561] 09 Jan 17:10:43.002 * Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this ma\ny slow down Redis.\n[9561] 09 Jan 17:10:46.007 * Asynchronous AOF fsync is taking too long (disk is busy?). Writing the AOF buffer without waiting for fsync to complete, this ma\ny slow down Redis.\n[29812] 09 Jan 17:10:47.220 #\n\n\n[29812] 09 Jan 17:10:47.537 # === ASSERTION FAILED ===\n[29812] 09 Jan 17:10:47.539 # ==> t_hash.c:325 'vptr != NULL' is not true\n[29812] 09 Jan 17:10:47.539 # (forcing SIGSEGV to print the bug report.)\n[29812] 09 Jan 17:10:47.539 #     Redis 2.6.6 crashed by signal: 11\n[29812] 09 Jan 17:10:47.539 #     Failed assertion: vptr != NULL (t_hash.c:325)\n[29812] 09 Jan 17:10:47.539 # --- STACK TRACE\n/usr/local/redis/bin/redis-server(logStackTrace+0x75)[0x440fb5]\n/usr/local/redis/bin/redis-server(_redisAssert+0x6f)[0x440e2f]\n/lib/libpthread.so.0(+0xf8f0)[0x7f0cdee938f0]\n/usr/local/redis/bin/redis-server(_redisAssert+0x6f)[0x440e2f]\n/usr/local/redis/bin/redis-server(hashTypeNext+0xe6)[0x438996]\n/usr/local/redis/bin/redis-server(rewriteHashObject+0xd2)[0x43d772]\n/usr/local/redis/bin/redis-server(rewriteAppendOnlyFile+0x1f4)[0x43f424]\n/usr/local/redis/bin/redis-server(rewriteAppendOnlyFileBackground+0xc4)[0x43f7e4]\n/usr/local/redis/bin/redis-server(serverCron+0x443)[0x41dce3]\n/usr/local/redis/bin/redis-server(aeProcessEvents+0x202)[0x417802]\n/usr/local/redis/bin/redis-server(aeMain+0x2b)[0x4179fb]\n/usr/local/redis/bin/redis-server(main+0x23b)[0x41e6ab]\n/lib/libc.so.6(__libc_start_main+0xfd)[0x7f0cdeb1fc4d]\n/usr/local/redis/bin/redis-server[0x416dc9]\n[29812] 09 Jan 17:10:47.810 # --- INFO OUTPUT\n[29812] 09 Jan 17:10:47.810 # # Server\nredis_version:2.6.6\nredis_git_sha1:00000000\nredis_git_dirty:0\nredis_mode:standalone\nos:Linux 2.6.32-21-server x86_64\narch_bits:64\nmultiplexing_api:epoll\ngcc_version:4.4.3\nprocess_id:29812\nrun_id:321b8046be44120fd80746fddf64199ab0f13892\ntcp_port:6386\nuptime_in_seconds:786487\nuptime_in_days:9\nlru_clock:1554532\n\n# Clients\nconnected_clients:38\nclient_longest_output_list:0\nblocked_clients:0\n\n# Memory\nused_memory:5507789808\nused_memory_human:5.13G\nused_memory_rss:5633081344\nused_memory_peak:5513067952\nused_memory_peak_human:5.13G\nused_memory_lua:31744\nmem_fragmentation_ratio:1.02\nmem_allocator:jemalloc-3.2.0\n\n# Persistence\nloading:0\nrdb_changes_since_last_save:20450345\nrdb_bgsave_in_progress:0\nrdb_last_save_time:1357660856\nrdb_last_bgsave_status:ok\nrdb_last_bgsave_time_sec:55\nrdb_current_bgsave_time_sec:-1\naof_enabled:1\naof_rewrite_in_progress:0\naof_rewrite_scheduled:0\naof_last_rewrite_time_sec:68\naof_current_rewrite_time_sec:-1\naof_last_bgrewrite_status:ok\naof_current_size:11727211392\naof_base_size:5863605642\naof_pending_rewrite:0\naof_buffer_length:0\naof_rewrite_buffer_length:0\naof_pending_bio_fsync:0\naof_delayed_fsync:38\n\n# Stats\ntotal_connections_received:78996577\ntotal_commands_processed:8553080268\ninstantaneous_ops_per_sec:14392\nrejected_connections:0\nexpired_keys:0\nevicted_keys:0\n\nkeyspace_hits:8137002949\nkeyspace_misses:22946621\npubsub_channels:0\npubsub_patterns:0\nlatest_fork_usec:219996\n\n# Replication\nrole:master\nconnected_slaves:0\n\n# CPU\nused_cpu_sys:5.52\nused_cpu_user:33.16\nused_cpu_sys_children:0.00\nused_cpu_user_children:0.00\n\n# Commandstats\ncmdstat_del:calls=2535263,usec=17922460,usec_per_call=7.07\ncmdstat_lpush:calls=2648761,usec=11724381,usec_per_call=4.43\ncmdstat_rpop:calls=3164942,usec=16855835,usec_per_call=5.33\ncmdstat_llen:calls=91,usec=229,usec_per_call=2.52\ncmdstat_hset:calls=384768500,usec=2597644930,usec_per_call=6.75\ncmdstat_hget:calls=5979730156,usec=26494193464,usec_per_call=4.43\ncmdstat_hgetall:calls=2180219323,usec=47638987054,usec_per_call=21.85\ncmdstat_bgsave:calls=9,usec=1751970,usec_per_call=194663.33\ncmdstat_info:calls=13223,usec=4085738,usec_per_call=308.99\n\n# Keyspace\ndb0:keys=6377758,expires=0\nhash_init_value: 1357679091\n\n[29812] 09 Jan 17:10:47.810 # --- CLIENT LIST OUTPUT\n\n...\n\n[29812] 09 Jan 17:10:47.811 # --- REGISTERS\n[29812] 09 Jan 17:10:47.811 #\nRAX:0000000000000000 RBX:0000000000000145\nRCX:0000000000016e40 RDX:00007f0cdee7fe98\nRDI:0000000000000000 RSI:0000000000000000\nRBP:00000000004991a0 RSP:00007fff0413a3c0\nR8 :0000000001cb8e90 R9 :00000000ffffffff\nR10:7562206568742074 R11:0000000000000206\nR12:00000000004991ba R13:ffffffffffffffda\nR14:0000000000000000 R15:0000000000000040\nRIP:0000000000440e2f EFL:0000000000010202\nCSGSFS:0000000000000033\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a438) -> 00007fff0413a4b0\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a430) -> ffffffffffffffff\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a428) -> 00007fff0413a470\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a420) -> 00007f0cde188300\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a418) -> 00007f0c77d0bf60\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a410) -> 00007f0bb1216e80\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a408) -> 00007fff0413a4b0\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a400) -> 00007f0bf1f29088\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a3f8) -> 000000000043d772\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a3f0) -> 00007f0b98870580\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a3e8) -> 00007fff0413a470\n[29812] 09 Jan 17:10:47.811 # (00007fff0413a3e0) -> 0000000000000020\n[29812] 09 Jan 17:10:47.812 # (00007fff0413a3d8) -> 0000000000438996\n[29812] 09 Jan 17:10:47.812 # (00007fff0413a3d0) -> 00007f0c6abe5800\n[29812] 09 Jan 17:10:47.812 # (00007fff0413a3c8) -> 00007f0c6abf0b27\n[29812] 09 Jan 17:10:47.812 # (00007fff0413a3c0) -> 00007f0b98870580\n[29812] 09 Jan 17:10:47.812 #\n\n```\n","closed_by":{"login":"antirez","id":65632,"node_id":"MDQ6VXNlcjY1NjMy","avatar_url":"https://avatars.githubusercontent.com/u/65632?v=4","gravatar_id":"","url":"https://api.github.com/users/antirez","html_url":"https://github.com/antirez","followers_url":"https://api.github.com/users/antirez/followers","following_url":"https://api.github.com/users/antirez/following{/other_user}","gists_url":"https://api.github.com/users/antirez/gists{/gist_id}","starred_url":"https://api.github.com/users/antirez/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/antirez/subscriptions","organizations_url":"https://api.github.com/users/antirez/orgs","repos_url":"https://api.github.com/users/antirez/repos","events_url":"https://api.github.com/users/antirez/events{/privacy}","received_events_url":"https://api.github.com/users/antirez/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/redis/redis/issues/868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/redis/redis/issues/868/timeline","performed_via_github_app":null,"state_reason":"completed"}