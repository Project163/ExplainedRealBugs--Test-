{"url":"https://api.github.com/repos/alacritty/alacritty/issues/7443","repository_url":"https://api.github.com/repos/alacritty/alacritty","labels_url":"https://api.github.com/repos/alacritty/alacritty/issues/7443/labels{/name}","comments_url":"https://api.github.com/repos/alacritty/alacritty/issues/7443/comments","events_url":"https://api.github.com/repos/alacritty/alacritty/issues/7443/events","html_url":"https://github.com/alacritty/alacritty/issues/7443","id":2045412947,"node_id":"I_kwDOAxkop8556oZT","number":7443,"title":"Alt + 4 wrongly sends escape sequence inside Alacritty+Neovim (Swedish/Nordic kb layout!)","user":{"login":"Jeppelelle","id":12833176,"node_id":"MDQ6VXNlcjEyODMzMTc2","avatar_url":"https://avatars.githubusercontent.com/u/12833176?v=4","gravatar_id":"","url":"https://api.github.com/users/Jeppelelle","html_url":"https://github.com/Jeppelelle","followers_url":"https://api.github.com/users/Jeppelelle/followers","following_url":"https://api.github.com/users/Jeppelelle/following{/other_user}","gists_url":"https://api.github.com/users/Jeppelelle/gists{/gist_id}","starred_url":"https://api.github.com/users/Jeppelelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jeppelelle/subscriptions","organizations_url":"https://api.github.com/users/Jeppelelle/orgs","repos_url":"https://api.github.com/users/Jeppelelle/repos","events_url":"https://api.github.com/users/Jeppelelle/events{/privacy}","received_events_url":"https://api.github.com/users/Jeppelelle/received_events","type":"User","user_view_type":"public","site_admin":false},"labels":[{"id":327960155,"node_id":"MDU6TGFiZWwzMjc5NjAxNTU=","url":"https://api.github.com/repos/alacritty/alacritty/labels/B%20-%20bug","name":"B - bug","color":"c6071e","default":false,"description":""}],"state":"closed","locked":false,"assignee":{"login":"kchibisov","id":27620401,"node_id":"MDQ6VXNlcjI3NjIwNDAx","avatar_url":"https://avatars.githubusercontent.com/u/27620401?v=4","gravatar_id":"","url":"https://api.github.com/users/kchibisov","html_url":"https://github.com/kchibisov","followers_url":"https://api.github.com/users/kchibisov/followers","following_url":"https://api.github.com/users/kchibisov/following{/other_user}","gists_url":"https://api.github.com/users/kchibisov/gists{/gist_id}","starred_url":"https://api.github.com/users/kchibisov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kchibisov/subscriptions","organizations_url":"https://api.github.com/users/kchibisov/orgs","repos_url":"https://api.github.com/users/kchibisov/repos","events_url":"https://api.github.com/users/kchibisov/events{/privacy}","received_events_url":"https://api.github.com/users/kchibisov/received_events","type":"User","user_view_type":"public","site_admin":false},"assignees":[{"login":"kchibisov","id":27620401,"node_id":"MDQ6VXNlcjI3NjIwNDAx","avatar_url":"https://avatars.githubusercontent.com/u/27620401?v=4","gravatar_id":"","url":"https://api.github.com/users/kchibisov","html_url":"https://github.com/kchibisov","followers_url":"https://api.github.com/users/kchibisov/followers","following_url":"https://api.github.com/users/kchibisov/following{/other_user}","gists_url":"https://api.github.com/users/kchibisov/gists{/gist_id}","starred_url":"https://api.github.com/users/kchibisov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kchibisov/subscriptions","organizations_url":"https://api.github.com/users/kchibisov/orgs","repos_url":"https://api.github.com/users/kchibisov/repos","events_url":"https://api.github.com/users/kchibisov/events{/privacy}","received_events_url":"https://api.github.com/users/kchibisov/received_events","type":"User","user_view_type":"public","site_admin":false}],"milestone":null,"comments":5,"created_at":"2023-12-17T22:58:38Z","updated_at":"2023-12-20T06:37:23Z","closed_at":"2023-12-20T06:37:23Z","author_association":"NONE","type":null,"active_lock_reason":null,"sub_issues_summary":{"total":0,"completed":0,"percent_completed":0},"issue_dependencies_summary":{"blocked_by":0,"total_blocked_by":0,"blocking":0,"total_blocking":0},"body":"OS: macOS Ventura 13.6.1\r\nVersion: Current commit: https://github.com/alacritty/alacritty/tree/a10fb8adc0857633be428d673ab8d36d2a90193a (but same issues since kitty key protocol)\r\nKeyboard layout: Swedish/Nordic\r\n\r\noption_as_alt = \"None\"\r\n\r\nKey events:\r\n\r\nSame output for command line inside Alacritty, Inside Neovim, Inside Neovim inside Tmux:\r\n```\r\n[122.479315289s] [INFO ] [alacritty] winit event: WindowEvent { window_id: WindowId(WindowId(140634396691760)), event: KeyboardInput { device_id: DeviceId(DeviceId), event: KeyEvent { physical_key: Code(AltLeft), logical_key: Named(Alt), text: None, location: Left, state: Pressed, repeat: false, platform_specific: KeyEventExtra { text_with_all_modifiers: None, key_without_modifiers: Named(Alt) } }, is_synthetic: false } }\r\n[122.483869688s] [INFO ] [alacritty] winit event: WindowEvent { window_id: WindowId(WindowId(140634396691760)), event: KeyboardInput { device_id: DeviceId(DeviceId), event: KeyEvent { physical_key: Code(Digit4), logical_key: Character(\"$\"), text: Some(\"$\"), location: Standard, state: Pressed, repeat: false, platform_specific: KeyEventExtra { text_with_all_modifiers: Some(\"$\"), key_without_modifiers: Character(\"4\") } }, is_synthetic: false } }\r\n[122.550189254s] [INFO ] [alacritty] winit event: WindowEvent { window_id: WindowId(WindowId(140634396691760)), event: KeyboardInput { device_id: DeviceId(DeviceId), event: KeyEvent { physical_key: Code(Digit4), logical_key: Character(\"$\"), text: None, location: Standard, state: Released, repeat: false, platform_specific: KeyEventExtra { text_with_all_modifiers: Some(\"$\"), key_without_modifiers: Character(\"4\") } }, is_synthetic: false } }\r\n[122.554484575s] [INFO ] [alacritty] winit event: WindowEvent { window_id: WindowId(WindowId(140634396691760)), event: KeyboardInput { device_id: DeviceId(DeviceId), event: KeyEvent { physical_key: Code(AltLeft), logical_key: Named(Alt), text: None, location: Left, state: Released, repeat: false, platform_specific: KeyEventExtra { text_with_all_modifiers: None, key_without_modifiers: Named(Alt) } }, is_synthetic: false } }\r\n```\r\n\r\n_Alt + 4_ inside Alacritty command line outputs **$**\r\n\r\n_Alt + 4_ inside Alacritty+Neovim from Insert mode it switches to Normal mode and then sends the keycode which result in my caret ending up at the end of the line instead of inserting a **$**\r\n\r\n_Alt + 4_ inside Alacritty+Tmux+Neovim correctly inserts **$** inside Neovim\r\n\r\n\r\nI had a similar issue when Alacritty switched from \"alt_send_esc\" to \"option_as_alt\", \"option_as_alt\" = \"None\" has been working correctly ever since the following issue was filed:\r\nhttps://github.com/alacritty/alacritty/issues/6637#issuecomment-1420837553\r\n\r\nBack then i had to comment out a section that appended an escape sequence/bytes to make it work, after that issue a fix was implemented and it has worked natively ever since then.\r\n\r\n\r\nBut now something has changed (i think it changed after switching to the kitty keyboard protocol?), it is as if the option \"None\" doesn't work anymore, it seems to have no effect, but i have not tested it out properly, instead; this time i simply commented out code again to get it to work as i expect it to:\r\n\r\nhttps://github.com/alacritty/alacritty/blob/master/alacritty_terminal/src/term/mod.rs#L94-L95\r\n\r\nAfter commenting out/removing:\r\n\r\n```\r\nlet disambiguate_esc_codes = value.contains(KeyboardModes::DISAMBIGUATE_ESC_CODES);\r\nmode.set(TermMode::DISAMBIGUATE_ESC_CODES, disambiguate_esc_codes);\r\n```\r\n\r\nOnce again Alacritty works as expected, always inserting a **$** no matter if i am just using Alacritty cmdline, Alacritty + Neovim, Alacritty + Tmux + Neovim\r\n\r\nI have only used it for 1 hour so far but so far there has been no negative issues for me without those lines, i am sure there is some unforseen issues i will run into in the future but for now, Alacritty works as expected\r\n\r\nSo, in latest commit, it seems like **option_as_alt = \"None\"** isn't respected, or something else is going on?\r\n\r\nAnd it is weird that it works in Alacritty+Tmux+Neovim but not Alacritty+Neovim, i don't know how Tmux is handling events, is it stripping out the escape sequence?\r\n\r\nAnyway, with my \"fix\" i can use Alacritty properly again but it not a nice solution","closed_by":{"login":"kchibisov","id":27620401,"node_id":"MDQ6VXNlcjI3NjIwNDAx","avatar_url":"https://avatars.githubusercontent.com/u/27620401?v=4","gravatar_id":"","url":"https://api.github.com/users/kchibisov","html_url":"https://github.com/kchibisov","followers_url":"https://api.github.com/users/kchibisov/followers","following_url":"https://api.github.com/users/kchibisov/following{/other_user}","gists_url":"https://api.github.com/users/kchibisov/gists{/gist_id}","starred_url":"https://api.github.com/users/kchibisov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kchibisov/subscriptions","organizations_url":"https://api.github.com/users/kchibisov/orgs","repos_url":"https://api.github.com/users/kchibisov/repos","events_url":"https://api.github.com/users/kchibisov/events{/privacy}","received_events_url":"https://api.github.com/users/kchibisov/received_events","type":"User","user_view_type":"public","site_admin":false},"reactions":{"url":"https://api.github.com/repos/alacritty/alacritty/issues/7443/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"timeline_url":"https://api.github.com/repos/alacritty/alacritty/issues/7443/timeline","performed_via_github_app":null,"state_reason":"completed"}